<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Significance Ranking: The 5Rs of Historical Significance</title>
<style>
  :root {
    --bg-parchment: #f5eedc;
    --bg-parchment-dark: #e8ddc8;
    --bg-card: #fffdf7;
    --bg-header: #3e2723;
    --text-primary: #3e2723;
    --text-secondary: #5d4037;
    --text-light: #8d6e63;
    --text-on-dark: #f5eedc;
    --gold: #c6952b;
    --gold-light: #e8c36a;
    --gold-pale: #faf0d1;
    --amber: #d4880f;
    --accent-r1: #c62828;
    --accent-r2: #ad6200;
    --accent-r3: #2e7d32;
    --accent-r4: #1565c0;
    --accent-r5: #6a1b9a;
    --border: #c9b896;
    --border-light: #ddd3be;
    --shadow: rgba(62, 39, 35, 0.12);
    --shadow-strong: rgba(62, 39, 35, 0.22);
    --radius: 8px;
    --radius-lg: 12px;
    --transition: 0.25s ease;
    --max-width: 1200px;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: Georgia, 'Times New Roman', serif;
    background: var(--bg-parchment);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
  }

  header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--bg-header);
    color: var(--text-on-dark);
    padding: 16px 24px;
    box-shadow: 0 3px 10px var(--shadow-strong);
  }

  header h1 {
    font-size: 1.6rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    color: var(--gold-light);
  }

  header p {
    font-size: 0.9rem;
    color: #bcaaa4;
    margin-top: 2px;
    font-style: italic;
  }

  .header-inner {
    max-width: var(--max-width);
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
  }

  .header-actions {
    display: flex;
    gap: 10px;
  }

  .btn {
    font-family: inherit;
    font-size: 0.85rem;
    padding: 8px 16px;
    border: none;
    border-radius: var(--radius);
    cursor: pointer;
    transition: var(--transition);
    font-weight: 600;
  }

  .btn-gold {
    background: var(--gold);
    color: #fff;
  }

  .btn-gold:hover { background: var(--amber); }

  .btn-outline {
    background: transparent;
    color: var(--gold-light);
    border: 1.5px solid var(--gold-light);
  }

  .btn-outline:hover {
    background: var(--gold-light);
    color: var(--bg-header);
  }

  main {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 24px 16px 60px;
  }

  /* Topic Selector */
  .topic-selector {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 20px 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 6px var(--shadow);
  }

  .topic-selector h2 {
    font-size: 1.1rem;
    color: var(--text-secondary);
    margin-bottom: 12px;
  }

  .topic-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .topic-btn {
    font-family: inherit;
    font-size: 0.9rem;
    padding: 10px 18px;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    background: var(--bg-parchment);
    color: var(--text-primary);
    cursor: pointer;
    transition: var(--transition);
  }

  .topic-btn:hover {
    border-color: var(--gold);
    background: var(--gold-pale);
  }

  .topic-btn.active {
    border-color: var(--gold);
    background: var(--gold);
    color: #fff;
  }

  /* Cards Grid */
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }

  .item-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 20px;
    box-shadow: 0 2px 8px var(--shadow);
    transition: var(--transition);
    display: flex;
    flex-direction: column;
  }

  .item-card:hover {
    box-shadow: 0 4px 16px var(--shadow-strong);
    transform: translateY(-2px);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
    gap: 10px;
  }

  .card-header h3 {
    font-size: 1.05rem;
    color: var(--text-primary);
  }

  .card-header .score-badge {
    flex-shrink: 0;
    background: var(--gold);
    color: #fff;
    font-size: 0.85rem;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 20px;
    min-width: 40px;
    text-align: center;
  }

  .card-desc {
    font-size: 0.85rem;
    color: var(--text-light);
    margin-bottom: 14px;
    font-style: italic;
  }

  .rating-section { margin-bottom: 8px; }

  .rating-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
    flex-wrap: wrap;
  }

  .rating-label {
    font-size: 0.8rem;
    font-weight: 600;
    width: 130px;
    flex-shrink: 0;
  }

  .rating-label.r1 { color: var(--accent-r1); }
  .rating-label.r2 { color: var(--accent-r2); }
  .rating-label.r3 { color: var(--accent-r3); }
  .rating-label.r4 { color: var(--accent-r4); }
  .rating-label.r5 { color: var(--accent-r5); }

  .star-group {
    display: flex;
    gap: 3px;
  }

  .star-btn {
    width: 28px;
    height: 28px;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    background: var(--bg-parchment);
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--text-light);
    transition: var(--transition);
    font-family: inherit;
  }

  .star-btn:hover { border-color: var(--gold); background: var(--gold-pale); }

  .star-btn.filled {
    background: var(--gold);
    border-color: var(--gold);
    color: #fff;
  }

  .chart-container {
    display: flex;
    justify-content: center;
    margin-top: auto;
    padding-top: 10px;
  }

  .chart-container canvas {
    max-width: 180px;
    max-height: 180px;
  }

  /* Leaderboard */
  .leaderboard-section {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 6px var(--shadow);
  }

  .leaderboard-section h2 {
    font-size: 1.2rem;
    color: var(--gold);
    margin-bottom: 16px;
    border-bottom: 2px solid var(--border-light);
    padding-bottom: 8px;
  }

  .leaderboard-table {
    width: 100%;
    border-collapse: collapse;
  }

  .leaderboard-table th {
    text-align: left;
    font-size: 0.8rem;
    color: var(--text-light);
    padding: 6px 10px;
    border-bottom: 1px solid var(--border-light);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .leaderboard-table td {
    padding: 10px;
    border-bottom: 1px solid var(--border-light);
    font-size: 0.9rem;
  }

  .leaderboard-table tr:last-child td { border-bottom: none; }

  .rank-num {
    font-weight: 700;
    color: var(--gold);
    font-size: 1.1rem;
    width: 36px;
    text-align: center;
  }

  .rank-1 { color: #c6952b; }
  .rank-2 { color: #8d8d8d; }
  .rank-3 { color: #a0522d; }

  .score-bar-cell { width: 180px; }

  .score-bar-wrapper {
    background: var(--bg-parchment-dark);
    border-radius: 10px;
    height: 16px;
    overflow: hidden;
  }

  .score-bar-fill {
    height: 100%;
    border-radius: 10px;
    background: linear-gradient(90deg, var(--gold), var(--amber));
    transition: width 0.5s ease;
  }

  /* Justification */
  .justification-section {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 6px var(--shadow);
  }

  .justification-section h2 {
    font-size: 1.1rem;
    color: var(--text-secondary);
    margin-bottom: 6px;
  }

  .justification-section p {
    font-size: 0.85rem;
    color: var(--text-light);
    margin-bottom: 12px;
  }

  .justification-section textarea {
    width: 100%;
    min-height: 100px;
    padding: 12px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    font-family: inherit;
    font-size: 0.9rem;
    color: var(--text-primary);
    background: var(--bg-parchment);
    resize: vertical;
    transition: var(--transition);
  }

  .justification-section textarea:focus {
    outline: none;
    border-color: var(--gold);
    box-shadow: 0 0 0 3px var(--gold-pale);
  }

  /* Compare Panel */
  .compare-section {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 6px var(--shadow);
  }

  .compare-section h2 {
    font-size: 1.1rem;
    color: var(--text-secondary);
    margin-bottom: 12px;
  }

  .compare-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.88rem;
  }

  .compare-table th {
    text-align: left;
    padding: 8px 10px;
    font-size: 0.78rem;
    color: var(--text-light);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid var(--border);
  }

  .compare-table td {
    padding: 8px 10px;
    border-bottom: 1px solid var(--border-light);
  }

  .match-icon { font-size: 1rem; }

  .hidden { display: none !important; }

  /* Info Panel / Modal */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    max-width: 680px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
    padding: 32px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
  }

  .modal-content h2 {
    font-size: 1.3rem;
    color: var(--gold);
    margin-bottom: 16px;
  }

  .modal-content h3 {
    font-size: 1.05rem;
    color: var(--text-secondary);
    margin: 18px 0 8px;
  }

  .modal-content p, .modal-content li {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-bottom: 8px;
    line-height: 1.65;
  }

  .modal-content ul {
    padding-left: 20px;
    margin-bottom: 12px;
  }

  .modal-close {
    float: right;
    background: none;
    border: none;
    font-size: 1.6rem;
    color: var(--text-light);
    cursor: pointer;
    line-height: 1;
  }

  .modal-close:hover { color: var(--text-primary); }

  .r-tag {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: 700;
    font-size: 0.82rem;
    color: #fff;
    margin-right: 4px;
  }

  .r-tag.r1 { background: var(--accent-r1); }
  .r-tag.r2 { background: var(--accent-r2); }
  .r-tag.r3 { background: var(--accent-r3); }
  .r-tag.r4 { background: var(--accent-r4); }
  .r-tag.r5 { background: var(--accent-r5); }

  .no-data-msg {
    text-align: center;
    color: var(--text-light);
    font-style: italic;
    padding: 30px;
    font-size: 0.95rem;
  }

  @media (max-width: 600px) {
    header { padding: 12px 16px; }
    header h1 { font-size: 1.2rem; }
    .cards-grid { grid-template-columns: 1fr; }
    .rating-row { flex-wrap: wrap; }
    .rating-label { width: 100%; }
    .score-bar-cell { width: 100px; }
    .header-inner { flex-direction: column; align-items: flex-start; }
    .compare-table { font-size: 0.8rem; }
  }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div>
      <h1>Significance Ranking</h1>
      <p>Rate historical events and figures using the 5Rs framework</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" id="infoBtn">About the 5Rs</button>
      <button class="btn btn-gold" id="resetBtn">Reset Ratings</button>
    </div>
  </div>
</header>

<main>
  <section class="topic-selector">
    <h2>Choose a Topic</h2>
    <div class="topic-buttons" id="topicButtons"></div>
  </section>

  <section id="cardsSection" class="hidden">
    <div class="cards-grid" id="cardsGrid"></div>
  </section>

  <section class="leaderboard-section hidden" id="leaderboardSection">
    <h2>Significance Leaderboard</h2>
    <table class="leaderboard-table">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Item</th>
          <th>Score</th>
          <th>Bar</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
    </table>
  </section>

  <section class="justification-section hidden" id="justificationSection">
    <h2>Justify Your Top Choice</h2>
    <p id="justificationPrompt">Explain why your #1 ranked item is the most historically significant.</p>
    <textarea id="justificationText" placeholder="Write your justification here, using evidence and reasoning to support why this event or figure is the most significant..."></textarea>
  </section>

  <section class="compare-section hidden" id="compareSection">
    <h2>Compare with a Historian's View</h2>
    <p style="font-size:0.85rem;color:var(--text-light);margin-bottom:14px;">
      See how your ranking compares with one possible expert interpretation. Remember: historians often disagree about significance, and your view is valid if well supported.
    </p>
    <table class="compare-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>Your Rank</th>
          <th>Historian</th>
          <th>Match</th>
        </tr>
      </thead>
      <tbody id="compareBody"></tbody>
    </table>
  </section>
</main>

<!-- Info Modal -->
<div class="modal-overlay hidden" id="infoModal">
  <div class="modal-content">
    <button class="modal-close" id="modalClose">&times;</button>
    <h2>What is Historical Significance?</h2>
    <p>
      Historical significance is a judgement about which events, people, or changes from the past are especially important or meaningful. It is not a fixed quality: what counts as "significant" can change depending on who is asking, when they are asking, and what criteria they use.
    </p>
    <p>
      Significance is one of the key second-order concepts in history. It helps us decide what is worth studying, remembering, and learning from.
    </p>

    <h3>Partington's 5Rs Framework</h3>
    <p>Historian Geoffrey Partington proposed five criteria (the "5Rs") for judging whether something is historically significant:</p>
    <ul>
      <li><span class="r-tag r1">R</span> <strong>Remembered:</strong> Is it still well known and remembered today? Has it entered collective memory, textbooks, or public memorials?</li>
      <li><span class="r-tag r2">R</span> <strong>Resulted in change:</strong> Did it lead to lasting, deep change for many people? Did it reshape society, politics, or culture?</li>
      <li><span class="r-tag r3">R</span> <strong>Resonates:</strong> Does it connect to issues, debates, or experiences that still matter today? Can people relate to it?</li>
      <li><span class="r-tag r4">R</span> <strong>Remarkable:</strong> Was it commented on as extraordinary or notable at the time it happened? Did contemporaries see it as special?</li>
      <li><span class="r-tag r5">R</span> <strong>Revealing:</strong> Does it tell us something important about the attitudes, beliefs, or conditions of that period in history?</li>
    </ul>

    <h3>Why is Significance Debated?</h3>
    <p>
      Different historians weight these criteria differently. A Marxist historian might prioritise "Resulted in change" for the working class, while a cultural historian might value "Resonates" with modern audiences. National perspectives, newly discovered evidence, and changing social values all influence what we consider significant.
    </p>
    <p>
      There is no single "correct" ranking. The value of this exercise is in developing your reasoning: can you explain and justify why you think something matters?
    </p>
  </div>
</div>

<script>
(function() {
  /* ===== DATA ===== */
  const TOPICS = {
    industrial: {
      label: "Key Figures of the Industrial Revolution",
      items: [
        { id: "arkwright", name: "Richard Arkwright", desc: "Developed the water frame; pioneered the factory system in textile manufacturing.", expert: [4, 5, 3, 4, 5] },
        { id: "stephenson", name: "George Stephenson", desc: "Built the first public railway using steam locomotives (Stockton-Darlington, 1825).", expert: [5, 5, 4, 5, 4] },
        { id: "watt", name: "James Watt", desc: "Improved the steam engine, making it efficient enough to power factories and transport.", expert: [5, 5, 3, 5, 4] },
        { id: "wedgwood", name: "Josiah Wedgwood", desc: "Revolutionised pottery production with mass manufacturing and marketing techniques.", expert: [3, 3, 2, 4, 5] },
        { id: "owen", name: "Robert Owen", desc: "Factory owner who campaigned for workers' rights and founded model communities.", expert: [3, 4, 5, 4, 5] },
        { id: "brunel", name: "Isambard Kingdom Brunel", desc: "Engineer behind the Great Western Railway, SS Great Britain, and Clifton Suspension Bridge.", expert: [5, 4, 3, 5, 3] },
        { id: "luddites", name: "The Luddites", desc: "Workers who destroyed machinery in protest against industrialisation and job losses.", expert: [4, 2, 5, 4, 5] }
      ]
    },
    events1066: {
      label: "Events of 1066",
      items: [
        { id: "edwarddeath", name: "Death of Edward the Confessor", desc: "Left no clear heir, triggering a succession crisis and three rival claims to the throne.", expert: [4, 5, 3, 4, 5] },
        { id: "haroldcrown", name: "Harold Godwinson crowned King", desc: "England's most powerful earl took the throne within a day of Edward's death.", expert: [4, 5, 3, 5, 4] },
        { id: "stamford", name: "Battle of Stamford Bridge", desc: "Harold defeated Norwegian invader Harald Hardrada in a decisive English victory.", expert: [3, 3, 2, 5, 4] },
        { id: "march", name: "Harold's March South", desc: "Harold force-marched 250 miles from Stamford Bridge to face William at Hastings.", expert: [3, 4, 2, 4, 4] },
        { id: "hastings", name: "Battle of Hastings", desc: "William of Normandy defeated Harold on 14 October 1066, changing England's history.", expert: [5, 5, 4, 5, 5] },
        { id: "coronation", name: "William's Coronation", desc: "William was crowned King on Christmas Day 1066 in Westminster Abbey.", expert: [5, 5, 3, 4, 4] },
        { id: "harrying", name: "Harrying of the North", desc: "William devastated northern England (1069-70) to crush rebellions; thousands died.", expert: [3, 5, 4, 4, 5] }
      ]
    },
    ww2causes: {
      label: "Causes of World War II",
      items: [
        { id: "versailles", name: "Treaty of Versailles (1919)", desc: "Imposed harsh terms on Germany: war guilt, reparations, territorial losses, and military limits.", expert: [5, 5, 4, 4, 5] },
        { id: "depression", name: "Great Depression (1929)", desc: "Global economic collapse caused mass unemployment and political extremism.", expert: [4, 5, 5, 4, 5] },
        { id: "hitlerrise", name: "Hitler's Rise to Power (1933)", desc: "Nazi Party gained control of Germany through elections, propaganda, and intimidation.", expert: [5, 5, 5, 5, 5] },
        { id: "appeasement", name: "Policy of Appeasement", desc: "Britain and France made concessions to Hitler (e.g. Munich Agreement) to avoid war.", expert: [4, 4, 5, 3, 5] },
        { id: "rhineland", name: "Remilitarisation of the Rhineland (1936)", desc: "Hitler moved troops into the demilitarised zone, testing Allied resolve.", expert: [3, 4, 3, 4, 5] },
        { id: "anschluss", name: "Anschluss with Austria (1938)", desc: "Germany annexed Austria, uniting German-speaking peoples and expanding Nazi territory.", expert: [3, 4, 3, 4, 4] },
        { id: "nazisoviepact", name: "Nazi-Soviet Pact (1939)", desc: "Non-aggression pact between Hitler and Stalin shocked the world and freed Hitler to invade Poland.", expert: [4, 5, 3, 5, 5] },
        { id: "polandinvasion", name: "Invasion of Poland (1939)", desc: "Germany invaded Poland on 1 September 1939, directly triggering declarations of war.", expert: [5, 5, 4, 5, 4] }
      ]
    },
    civilrights: {
      label: "Civil Rights Leaders (USA)",
      items: [
        { id: "mlk", name: "Martin Luther King Jr.", desc: "Led the non-violent civil rights movement; delivered the 'I Have a Dream' speech.", expert: [5, 5, 5, 5, 5] },
        { id: "parks", name: "Rosa Parks", desc: "Refused to give up her bus seat in Montgomery (1955), sparking the bus boycott.", expert: [5, 4, 5, 5, 4] },
        { id: "malcolm", name: "Malcolm X", desc: "Advocated Black self-defence and pride; challenged the mainstream civil rights approach.", expert: [5, 4, 5, 5, 5] },
        { id: "marshall", name: "Thurgood Marshall", desc: "First Black Supreme Court Justice; argued Brown v. Board of Education (1954).", expert: [4, 5, 4, 4, 4] },
        { id: "evers", name: "Medgar Evers", desc: "NAACP field secretary in Mississippi; assassinated in 1963 for his activism.", expert: [3, 3, 4, 4, 5] },
        { id: "carmichael", name: "Stokely Carmichael", desc: "Popularised 'Black Power'; shifted the movement toward more radical direct action.", expert: [4, 4, 5, 5, 5] },
        { id: "bridges", name: "Ruby Bridges", desc: "At age 6, became the first Black child to desegregate a white school in Louisiana (1960).", expert: [5, 3, 5, 5, 4] }
      ]
    }
  };

  const R_LABELS = [
    { key: "remembered", label: "Remembered", cls: "r1" },
    { key: "resulted", label: "Resulted in change", cls: "r2" },
    { key: "resonates", label: "Resonates", cls: "r3" },
    { key: "remarkable", label: "Remarkable", cls: "r4" },
    { key: "revealing", label: "Revealing", cls: "r5" }
  ];

  const R_COLORS = ["#c62828", "#d4880f", "#2e7d32", "#1565c0", "#6a1b9a"];

  /* ===== STATE ===== */
  let currentTopic = null;
  let ratings = {}; // { itemId: [r1, r2, r3, r4, r5] }

  /* ===== DOM REFS ===== */
  const topicButtonsEl = document.getElementById("topicButtons");
  const cardsSection = document.getElementById("cardsSection");
  const cardsGrid = document.getElementById("cardsGrid");
  const leaderboardSection = document.getElementById("leaderboardSection");
  const leaderboardBody = document.getElementById("leaderboardBody");
  const justificationSection = document.getElementById("justificationSection");
  const justificationPrompt = document.getElementById("justificationPrompt");
  const justificationText = document.getElementById("justificationText");
  const compareSection = document.getElementById("compareSection");
  const compareBody = document.getElementById("compareBody");
  const infoModal = document.getElementById("infoModal");

  /* ===== INIT TOPICS ===== */
  Object.keys(TOPICS).forEach(key => {
    const btn = document.createElement("button");
    btn.className = "topic-btn";
    btn.textContent = TOPICS[key].label;
    btn.addEventListener("click", () => selectTopic(key));
    topicButtonsEl.appendChild(btn);
  });

  /* ===== TOPIC SELECTION ===== */
  function selectTopic(key) {
    currentTopic = key;
    ratings = {};
    TOPICS[key].items.forEach(item => { ratings[item.id] = [0, 0, 0, 0, 0]; });
    justificationText.value = "";

    topicButtonsEl.querySelectorAll(".topic-btn").forEach((btn, i) => {
      btn.classList.toggle("active", Object.keys(TOPICS)[i] === key);
    });

    renderCards();
    updateLeaderboard();
    updateCompare();
    cardsSection.classList.remove("hidden");
    leaderboardSection.classList.remove("hidden");
    justificationSection.classList.remove("hidden");
    compareSection.classList.remove("hidden");
  }

  /* ===== RENDER CARDS ===== */
  function renderCards() {
    cardsGrid.innerHTML = "";
    const items = TOPICS[currentTopic].items;
    items.forEach(item => {
      const card = document.createElement("div");
      card.className = "item-card";
      card.id = "card-" + item.id;

      const totalScore = ratings[item.id].reduce((a, b) => a + b, 0);

      let ratingsHTML = "";
      R_LABELS.forEach((r, ri) => {
        let starsHTML = "";
        for (let s = 1; s <= 5; s++) {
          const filled = ratings[item.id][ri] >= s ? "filled" : "";
          starsHTML += `<button class="star-btn ${filled}" data-item="${item.id}" data-r="${ri}" data-val="${s}">${s}</button>`;
        }
        ratingsHTML += `
          <div class="rating-row">
            <span class="rating-label ${r.cls}">${r.label}</span>
            <div class="star-group">${starsHTML}</div>
          </div>`;
      });

      card.innerHTML = `
        <div class="card-header">
          <h3>${item.name}</h3>
          <span class="score-badge">${totalScore}/25</span>
        </div>
        <div class="card-desc">${item.desc}</div>
        <div class="rating-section">${ratingsHTML}</div>
        <div class="chart-container"><canvas id="chart-${item.id}" width="180" height="180"></canvas></div>
      `;
      cardsGrid.appendChild(card);
    });

    /* Attach star click events */
    cardsGrid.querySelectorAll(".star-btn").forEach(btn => {
      btn.addEventListener("click", function() {
        const itemId = this.dataset.item;
        const ri = parseInt(this.dataset.r);
        const val = parseInt(this.dataset.val);
        if (ratings[itemId][ri] === val) {
          ratings[itemId][ri] = 0;
        } else {
          ratings[itemId][ri] = val;
        }
        refreshCard(itemId);
        updateLeaderboard();
        updateCompare();
      });
    });

    /* Draw all charts */
    items.forEach(item => drawRadar("chart-" + item.id, ratings[item.id]));
  }

  /* ===== REFRESH SINGLE CARD ===== */
  function refreshCard(itemId) {
    const card = document.getElementById("card-" + itemId);
    if (!card) return;
    const totalScore = ratings[itemId].reduce((a, b) => a + b, 0);
    card.querySelector(".score-badge").textContent = totalScore + "/25";

    card.querySelectorAll(".star-btn").forEach(btn => {
      if (btn.dataset.item === itemId) {
        const ri = parseInt(btn.dataset.r);
        const val = parseInt(btn.dataset.val);
        btn.classList.toggle("filled", ratings[itemId][ri] >= val);
      }
    });

    drawRadar("chart-" + itemId, ratings[itemId]);
  }

  /* ===== RADAR CHART (Canvas) ===== */
  function drawRadar(canvasId, values) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    const ctx = canvas.getContext("2d");
    const w = canvas.width;
    const h = canvas.height;
    const cx = w / 2;
    const cy = h / 2;
    const maxR = 70;
    const steps = 5;
    const n = 5;
    const angleOffset = -Math.PI / 2;

    ctx.clearRect(0, 0, w, h);

    /* Grid rings */
    for (let s = 1; s <= steps; s++) {
      const r = (maxR / steps) * s;
      ctx.beginPath();
      for (let i = 0; i <= n; i++) {
        const angle = angleOffset + (2 * Math.PI / n) * i;
        const x = cx + r * Math.cos(angle);
        const y = cy + r * Math.sin(angle);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.strokeStyle = "rgba(62,39,35,0.12)";
      ctx.lineWidth = 1;
      ctx.stroke();
    }

    /* Axis lines and labels */
    const shortLabels = ["Rem", "Res", "Rsn", "Rmk", "Rev"];
    ctx.font = "10px Georgia";
    ctx.fillStyle = "#8d6e63";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    for (let i = 0; i < n; i++) {
      const angle = angleOffset + (2 * Math.PI / n) * i;
      const x1 = cx + maxR * Math.cos(angle);
      const y1 = cy + maxR * Math.sin(angle);
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.lineTo(x1, y1);
      ctx.strokeStyle = "rgba(62,39,35,0.1)";
      ctx.stroke();
      const lx = cx + (maxR + 14) * Math.cos(angle);
      const ly = cy + (maxR + 14) * Math.sin(angle);
      ctx.fillStyle = R_COLORS[i];
      ctx.fillText(shortLabels[i], lx, ly);
    }

    /* Data polygon */
    const hasData = values.some(v => v > 0);
    if (hasData) {
      ctx.beginPath();
      for (let i = 0; i < n; i++) {
        const angle = angleOffset + (2 * Math.PI / n) * i;
        const r = (maxR / steps) * values[i];
        const x = cx + r * Math.cos(angle);
        const y = cy + r * Math.sin(angle);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fillStyle = "rgba(198, 149, 43, 0.25)";
      ctx.fill();
      ctx.strokeStyle = "rgba(198, 149, 43, 0.85)";
      ctx.lineWidth = 2;
      ctx.stroke();

      /* Data points */
      for (let i = 0; i < n; i++) {
        const angle = angleOffset + (2 * Math.PI / n) * i;
        const r = (maxR / steps) * values[i];
        const x = cx + r * Math.cos(angle);
        const y = cy + r * Math.sin(angle);
        ctx.beginPath();
        ctx.arc(x, y, 3.5, 0, Math.PI * 2);
        ctx.fillStyle = R_COLORS[i];
        ctx.fill();
      }
    }
  }

  /* ===== LEADERBOARD ===== */
  function updateLeaderboard() {
    if (!currentTopic) return;
    const items = TOPICS[currentTopic].items;
    const scored = items.map(item => ({
      ...item,
      score: ratings[item.id].reduce((a, b) => a + b, 0)
    }));
    scored.sort((a, b) => b.score - a.score);

    const anyRated = scored.some(s => s.score > 0);

    if (!anyRated) {
      leaderboardBody.innerHTML = `<tr><td colspan="4" class="no-data-msg">Rate items above to see the leaderboard.</td></tr>`;
      justificationPrompt.textContent = "Rate some items above first, then justify your top choice here.";
      return;
    }

    leaderboardBody.innerHTML = "";
    scored.forEach((item, idx) => {
      const tr = document.createElement("tr");
      const rankClass = idx < 3 ? " rank-" + (idx + 1) : "";
      const pct = (item.score / 25) * 100;
      tr.innerHTML = `
        <td class="rank-num${rankClass}">${idx + 1}</td>
        <td>${item.name}</td>
        <td><strong>${item.score}</strong>/25</td>
        <td class="score-bar-cell">
          <div class="score-bar-wrapper"><div class="score-bar-fill" style="width:${pct}%"></div></div>
        </td>
      `;
      leaderboardBody.appendChild(tr);
    });

    const topItem = scored[0];
    justificationPrompt.textContent = `Explain why "${topItem.name}" is the most historically significant item in this set. Use the 5Rs to support your argument.`;
  }

  /* ===== COMPARE ===== */
  function updateCompare() {
    if (!currentTopic) return;
    const items = TOPICS[currentTopic].items;

    const userScored = items.map(item => ({
      ...item,
      score: ratings[item.id].reduce((a, b) => a + b, 0)
    }));
    userScored.sort((a, b) => b.score - a.score);

    const expertScored = items.map(item => ({
      ...item,
      expertScore: item.expert.reduce((a, b) => a + b, 0)
    }));
    expertScored.sort((a, b) => b.expertScore - a.expertScore);

    const anyRated = userScored.some(s => s.score > 0);

    if (!anyRated) {
      compareBody.innerHTML = `<tr><td colspan="4" class="no-data-msg">Rate items above to compare with the historian's view.</td></tr>`;
      return;
    }

    const userRankMap = {};
    userScored.forEach((item, idx) => { userRankMap[item.id] = idx + 1; });
    const expertRankMap = {};
    expertScored.forEach((item, idx) => { expertRankMap[item.id] = idx + 1; });

    compareBody.innerHTML = "";
    items.forEach(item => {
      const ur = userRankMap[item.id];
      const er = expertRankMap[item.id];
      const diff = Math.abs(ur - er);
      let matchIcon = "";
      if (diff === 0) matchIcon = "Exact match";
      else if (diff === 1) matchIcon = "Close";
      else matchIcon = "Different";

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.name}</td>
        <td style="text-align:center;font-weight:600;">#${ur}</td>
        <td style="text-align:center;font-weight:600;">#${er}</td>
        <td class="match-icon">${matchIcon}</td>
      `;
      compareBody.appendChild(tr);
    });
  }

  /* ===== MODAL ===== */
  document.getElementById("infoBtn").addEventListener("click", () => {
    infoModal.classList.remove("hidden");
  });
  document.getElementById("modalClose").addEventListener("click", () => {
    infoModal.classList.add("hidden");
  });
  infoModal.addEventListener("click", (e) => {
    if (e.target === infoModal) infoModal.classList.add("hidden");
  });

  /* ===== RESET ===== */
  document.getElementById("resetBtn").addEventListener("click", () => {
    if (!currentTopic) return;
    if (!confirm("Reset all ratings for this topic?")) return;
    TOPICS[currentTopic].items.forEach(item => { ratings[item.id] = [0, 0, 0, 0, 0]; });
    justificationText.value = "";
    renderCards();
    updateLeaderboard();
    updateCompare();
  });
})();
</script>
</body>
</html>
