<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Case Declension Trainer</title>
<style>
  :root {
    --purple-dark: #4a1a6b;
    --purple-mid: #6b3fa0;
    --purple-light: #9b6fd0;
    --purple-pale: #e8daf5;
    --nom-blue: #2563eb;
    --nom-blue-light: #dbeafe;
    --nom-blue-pale: #eff6ff;
    --acc-green: #16a34a;
    --acc-green-light: #dcfce7;
    --acc-green-pale: #f0fdf4;
    --dat-orange: #d97706;
    --dat-orange-light: #fef3c7;
    --dat-orange-pale: #fffbeb;
    --gen-red: #dc2626;
    --gen-red-light: #fee2e2;
    --gen-red-pale: #fef2f2;
    --bg: #faf8fc;
    --surface: #ffffff;
    --text: #1e1b2e;
    --text-light: #5c5672;
    --border: #d8d0e4;
    --correct: #16a34a;
    --incorrect: #dc2626;
    --radius: 8px;
    --shadow: 0 2px 8px rgba(74, 26, 107, 0.1);
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }

  header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: linear-gradient(135deg, var(--purple-dark), var(--purple-mid));
    color: white;
    padding: 16px 24px;
    box-shadow: 0 2px 12px rgba(74, 26, 107, 0.3);
  }

  header h1 { font-size: 1.5rem; font-weight: 700; letter-spacing: 0.5px; }
  header p { font-size: 0.85rem; opacity: 0.85; margin-top: 2px; }

  .tabs {
    display: flex;
    gap: 4px;
    background: var(--purple-pale);
    padding: 4px;
    margin: 16px 24px 0;
    border-radius: var(--radius);
    max-width: 360px;
  }

  .tab-btn {
    flex: 1;
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    background: transparent;
    color: var(--purple-mid);
    transition: all 0.2s;
  }

  .tab-btn.active {
    background: var(--purple-mid);
    color: white;
    box-shadow: 0 2px 6px rgba(107, 63, 160, 0.3);
  }

  .tab-btn:hover:not(.active) { background: rgba(107, 63, 160, 0.12); }

  main { max-width: 960px; margin: 0 auto; padding: 20px 24px 60px; }

  .panel { display: none; }
  .panel.active { display: block; }

  /* Learn Mode */
  .section-card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 24px;
    margin-bottom: 20px;
    border: 1px solid var(--border);
  }

  .section-card h2 {
    font-size: 1.15rem;
    color: var(--purple-dark);
    margin-bottom: 14px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--purple-pale);
  }

  .article-grid {
    display: grid;
    grid-template-columns: 120px repeat(4, 1fr);
    gap: 2px;
    background: var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .grid-header {
    background: var(--purple-dark);
    color: white;
    padding: 10px 8px;
    font-weight: 700;
    font-size: 0.85rem;
    text-align: center;
  }

  .grid-label {
    font-weight: 700;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px 8px;
    text-align: center;
  }

  .grid-cell {
    padding: 12px 8px;
    text-align: center;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.15s;
    position: relative;
  }

  .grid-cell:hover { filter: brightness(0.92); transform: scale(1.03); z-index: 2; }

  .row-nom .grid-label, .row-nom .grid-cell { background: var(--nom-blue-light); color: var(--nom-blue); }
  .row-nom .grid-label { background: var(--nom-blue); color: white; }
  .row-acc .grid-label, .row-acc .grid-cell { background: var(--acc-green-light); color: var(--acc-green); }
  .row-acc .grid-label { background: var(--acc-green); color: white; }
  .row-dat .grid-label, .row-dat .grid-cell { background: var(--dat-orange-light); color: var(--dat-orange); }
  .row-dat .grid-label { background: var(--dat-orange); color: white; }
  .row-gen .grid-label, .row-gen .grid-cell { background: var(--gen-red-light); color: var(--gen-red); }
  .row-gen .grid-label { background: var(--gen-red); color: white; }

  .cell-detail {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 16px 20px;
    margin-top: 14px;
    border-left: 4px solid var(--purple-mid);
    box-shadow: var(--shadow);
    display: none;
  }

  .cell-detail.visible { display: block; }
  .cell-detail .detail-case { font-weight: 700; font-size: 1rem; margin-bottom: 4px; }
  .cell-detail .detail-gender { color: var(--text-light); font-size: 0.85rem; margin-bottom: 8px; }
  .cell-detail .detail-example { font-style: italic; margin-bottom: 4px; }
  .cell-detail .detail-english { color: var(--text-light); font-size: 0.9rem; }

  .case-ref-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
  }

  .case-ref-card {
    border-radius: var(--radius);
    padding: 14px 16px;
  }

  .case-ref-card h3 { font-size: 0.95rem; margin-bottom: 6px; }
  .case-ref-card .role { font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; }
  .case-ref-card .question { font-size: 0.85rem; color: var(--text-light); margin-bottom: 6px; }
  .case-ref-card .example-sent { font-size: 0.85rem; font-style: italic; }

  .case-nom { background: var(--nom-blue-pale); border: 1px solid var(--nom-blue-light); }
  .case-nom h3 { color: var(--nom-blue); }
  .case-acc { background: var(--acc-green-pale); border: 1px solid var(--acc-green-light); }
  .case-acc h3 { color: var(--acc-green); }
  .case-dat { background: var(--dat-orange-pale); border: 1px solid var(--dat-orange-light); }
  .case-dat h3 { color: var(--dat-orange); }
  .case-gen { background: var(--gen-red-pale); border: 1px solid var(--gen-red-light); }
  .case-gen h3 { color: var(--gen-red); }

  .prep-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
  .prep-table th, .prep-table td { padding: 10px 12px; text-align: left; font-size: 0.9rem; }
  .prep-table th { font-weight: 700; border-bottom: 2px solid var(--border); }
  .prep-table td { border-bottom: 1px solid var(--border); }
  .prep-table tr:last-child td { border-bottom: none; }
  .prep-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.8rem;
    margin-right: 4px;
    margin-bottom: 4px;
  }

  .badge-nom { background: var(--nom-blue-light); color: var(--nom-blue); }
  .badge-acc { background: var(--acc-green-light); color: var(--acc-green); }
  .badge-dat { background: var(--dat-orange-light); color: var(--dat-orange); }
  .badge-gen { background: var(--gen-red-light); color: var(--gen-red); }

  .wechsel-box {
    background: linear-gradient(135deg, var(--acc-green-pale), var(--dat-orange-pale));
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px 20px;
    margin-top: 14px;
  }

  .wechsel-box h3 { color: var(--purple-dark); font-size: 0.95rem; margin-bottom: 8px; }
  .wechsel-rule { display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px; }
  .wechsel-rule div { flex: 1; min-width: 200px; padding: 10px 14px; border-radius: 6px; font-size: 0.88rem; }
  .wechsel-motion { background: var(--acc-green-light); border: 1px solid var(--acc-green); }
  .wechsel-location { background: var(--dat-orange-light); border: 1px solid var(--dat-orange); }

  /* Practice Mode */
  .practice-controls {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
    margin-bottom: 20px;
  }

  .difficulty-select {
    padding: 8px 14px;
    border-radius: var(--radius);
    border: 2px solid var(--purple-mid);
    font-size: 0.9rem;
    color: var(--purple-dark);
    background: white;
    cursor: pointer;
  }

  .score-display {
    margin-left: auto;
    display: flex;
    gap: 16px;
    align-items: center;
    font-weight: 600;
    font-size: 0.95rem;
  }

  .score-correct { color: var(--correct); }
  .score-incorrect { color: var(--incorrect); }
  .score-streak { color: var(--purple-mid); }

  .reset-btn {
    padding: 8px 16px;
    border: 2px solid var(--purple-mid);
    border-radius: var(--radius);
    background: transparent;
    color: var(--purple-mid);
    font-weight: 600;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
  }

  .reset-btn:hover { background: var(--purple-mid); color: white; }

  .question-card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    padding: 28px 24px;
    margin-bottom: 16px;
    text-align: center;
  }

  .q-number { font-size: 0.8rem; color: var(--text-light); margin-bottom: 8px; }

  .q-sentence {
    font-size: 1.25rem;
    font-weight: 500;
    margin-bottom: 6px;
    line-height: 1.7;
  }

  .q-gap {
    display: inline-block;
    min-width: 80px;
    border-bottom: 3px solid var(--purple-mid);
    margin: 0 4px;
    padding: 2px 8px;
    font-weight: 700;
    color: var(--purple-dark);
  }

  .q-hint { font-size: 0.85rem; color: var(--text-light); margin-bottom: 16px; font-style: italic; }

  .options {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 16px;
  }

  .option-btn {
    padding: 10px 22px;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
    min-width: 80px;
  }

  .option-btn:hover:not(:disabled) {
    border-color: var(--purple-mid);
    background: var(--purple-pale);
  }

  .option-btn.correct-choice {
    border-color: var(--correct);
    background: var(--acc-green-light);
    color: var(--correct);
  }

  .option-btn.incorrect-choice {
    border-color: var(--incorrect);
    background: var(--gen-red-light);
    color: var(--incorrect);
  }

  .option-btn:disabled { cursor: default; opacity: 0.7; }

  .feedback {
    margin-top: 18px;
    padding: 14px 18px;
    border-radius: var(--radius);
    font-size: 0.9rem;
    display: none;
    text-align: left;
  }

  .feedback.visible { display: block; }
  .feedback.correct-fb { background: var(--acc-green-light); border: 1px solid var(--acc-green); color: #15803d; }
  .feedback.incorrect-fb { background: var(--gen-red-light); border: 1px solid var(--gen-red); color: #b91c1c; }
  .feedback strong { display: block; margin-bottom: 4px; }

  .next-btn {
    margin-top: 16px;
    padding: 10px 28px;
    border: none;
    border-radius: var(--radius);
    background: var(--purple-mid);
    color: white;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
    display: none;
  }

  .next-btn.visible { display: inline-block; }
  .next-btn:hover { background: var(--purple-dark); }

  .progress-bar {
    width: 100%;
    height: 6px;
    background: var(--purple-pale);
    border-radius: 3px;
    margin-bottom: 16px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: var(--purple-mid);
    border-radius: 3px;
    transition: width 0.3s;
  }

  /* Info Panel */
  .info-panel {
    background: var(--purple-pale);
    border-radius: var(--radius);
    padding: 20px 24px;
    margin-bottom: 20px;
  }

  .info-panel h2 { color: var(--purple-dark); font-size: 1.1rem; margin-bottom: 10px; }
  .info-panel p { font-size: 0.9rem; margin-bottom: 8px; color: var(--text); }
  .info-panel ul { padding-left: 20px; font-size: 0.9rem; }
  .info-panel li { margin-bottom: 4px; }

  .tip-box {
    background: white;
    border-radius: 6px;
    padding: 12px 16px;
    margin-top: 12px;
    border-left: 4px solid var(--purple-mid);
  }

  .tip-box strong { color: var(--purple-dark); }

  /* Responsive */
  @media (max-width: 640px) {
    header { padding: 12px 16px; }
    header h1 { font-size: 1.2rem; }
    main { padding: 16px; }
    .tabs { margin: 12px 16px 0; }
    .article-grid { grid-template-columns: 80px repeat(4, 1fr); font-size: 0.82rem; }
    .grid-header, .grid-label { padding: 8px 4px; font-size: 0.75rem; }
    .grid-cell { padding: 10px 4px; font-size: 0.82rem; }
    .q-sentence { font-size: 1.05rem; }
    .option-btn { padding: 8px 16px; font-size: 0.9rem; min-width: 65px; }
    .score-display { margin-left: 0; width: 100%; justify-content: space-between; }
    .case-ref-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<header>
  <h1>Case Declension Trainer</h1>
  <p>Master the German case system: Nominative, Accusative, Dative, Genitive</p>
</header>

<div class="tabs">
  <button class="tab-btn active" data-tab="learn" onclick="switchTab('learn')">Learn</button>
  <button class="tab-btn" data-tab="practice" onclick="switchTab('practice')">Practice</button>
</div>

<main>
  <!-- LEARN PANEL -->
  <div id="learn-panel" class="panel active">

    <div class="info-panel">
      <h2>What are cases?</h2>
      <p>In German, the role a noun plays in a sentence determines its <strong>case</strong>. The case changes the articles (der, die, das) and sometimes adjective endings. English mostly uses word order to show meaning; German uses case endings instead.</p>
      <p>There are four cases in German:</p>
      <ul>
        <li><strong style="color:var(--nom-blue)">Nominativ</strong>: the subject (who/what is doing the action)</li>
        <li><strong style="color:var(--acc-green)">Akkusativ</strong>: the direct object (who/what receives the action)</li>
        <li><strong style="color:var(--dat-orange)">Dativ</strong>: the indirect object (to/for whom)</li>
        <li><strong style="color:var(--gen-red)">Genitiv</strong>: possession (whose)</li>
      </ul>
      <div class="tip-box">
        <strong>Tip:</strong> Think of the mnemonic <em>"Never Accuse a Dative of being Genitive"</em> for the order: Nom, Acc, Dat, Gen. Another approach: learn the <em>question words</em> for each case (wer? wen? wem? wessen?).
      </div>
    </div>

    <div class="section-card">
      <h2>Definite Article Table (der, die, das)</h2>
      <p style="font-size:0.85rem;color:var(--text-light);margin-bottom:12px">Click any cell to see details and an example sentence.</p>
      <div class="article-grid">
        <div class="grid-header"></div>
        <div class="grid-header">Maskulin (m)</div>
        <div class="grid-header">Feminin (f)</div>
        <div class="grid-header">Neutrum (n)</div>
        <div class="grid-header">Plural (pl)</div>

        <div class="grid-label row-nom">Nominativ</div>
        <div class="grid-cell row-nom" onclick="showDetail('nom','m')">der</div>
        <div class="grid-cell row-nom" onclick="showDetail('nom','f')">die</div>
        <div class="grid-cell row-nom" onclick="showDetail('nom','n')">das</div>
        <div class="grid-cell row-nom" onclick="showDetail('nom','pl')">die</div>

        <div class="grid-label row-acc">Akkusativ</div>
        <div class="grid-cell row-acc" onclick="showDetail('acc','m')">den</div>
        <div class="grid-cell row-acc" onclick="showDetail('acc','f')">die</div>
        <div class="grid-cell row-acc" onclick="showDetail('acc','n')">das</div>
        <div class="grid-cell row-acc" onclick="showDetail('acc','pl')">die</div>

        <div class="grid-label row-dat">Dativ</div>
        <div class="grid-cell row-dat" onclick="showDetail('dat','m')">dem</div>
        <div class="grid-cell row-dat" onclick="showDetail('dat','f')">der</div>
        <div class="grid-cell row-dat" onclick="showDetail('dat','n')">dem</div>
        <div class="grid-cell row-dat" onclick="showDetail('dat','pl')">den (+n)</div>

        <div class="grid-label row-gen">Genitiv</div>
        <div class="grid-cell row-gen" onclick="showDetail('gen','m')">des (+s)</div>
        <div class="grid-cell row-gen" onclick="showDetail('gen','f')">der</div>
        <div class="grid-cell row-gen" onclick="showDetail('gen','n')">des (+s)</div>
        <div class="grid-cell row-gen" onclick="showDetail('gen','pl')">der</div>
      </div>
      <div id="cell-detail" class="cell-detail"></div>
    </div>

    <div class="section-card">
      <h2>When to Use Each Case</h2>
      <div class="case-ref-grid">
        <div class="case-ref-card case-nom">
          <h3>Nominativ</h3>
          <div class="role">The Subject</div>
          <div class="question">Question: Wer? Was? (Who? What?)</div>
          <div class="example-sent"><strong>Der Hund</strong> schlaeft. (The dog sleeps.)</div>
        </div>
        <div class="case-ref-card case-acc">
          <h3>Akkusativ</h3>
          <div class="role">The Direct Object</div>
          <div class="question">Question: Wen? Was? (Whom? What?)</div>
          <div class="example-sent">Ich sehe <strong>den Hund</strong>. (I see the dog.)</div>
        </div>
        <div class="case-ref-card case-dat">
          <h3>Dativ</h3>
          <div class="role">The Indirect Object</div>
          <div class="question">Question: Wem? (To whom?)</div>
          <div class="example-sent">Ich gebe <strong>dem Hund</strong> Futter. (I give the dog food.)</div>
        </div>
        <div class="case-ref-card case-gen">
          <h3>Genitiv</h3>
          <div class="role">Possession</div>
          <div class="question">Question: Wessen? (Whose?)</div>
          <div class="example-sent">Das Spielzeug <strong>des Hundes</strong>. (The dog's toy.)</div>
        </div>
      </div>
    </div>

    <div class="section-card">
      <h2>Prepositions and Their Cases</h2>
      <table class="prep-table">
        <tr>
          <th>Case</th>
          <th>Prepositions</th>
        </tr>
        <tr>
          <td><span class="prep-badge badge-acc">Akkusativ</span></td>
          <td><strong>durch</strong> (through), <strong>fuer</strong> (for), <strong>gegen</strong> (against), <strong>ohne</strong> (without), <strong>um</strong> (around/at)</td>
        </tr>
        <tr>
          <td><span class="prep-badge badge-dat">Dativ</span></td>
          <td><strong>aus</strong> (out of), <strong>bei</strong> (at/near), <strong>mit</strong> (with), <strong>nach</strong> (after/to), <strong>seit</strong> (since), <strong>von</strong> (from), <strong>zu</strong> (to), <strong>gegenueber</strong> (opposite)</td>
        </tr>
        <tr>
          <td><span class="prep-badge badge-gen">Genitiv</span></td>
          <td><strong>waehrend</strong> (during), <strong>wegen</strong> (because of), <strong>trotz</strong> (despite), <strong>statt</strong> / <strong>anstatt</strong> (instead of), <strong>ausserhalb</strong> (outside of), <strong>innerhalb</strong> (inside of)</td>
        </tr>
      </table>

      <div class="wechsel-box">
        <h3>Wechselpraepositionen (Two-Way Prepositions)</h3>
        <p style="font-size:0.88rem;margin-bottom:8px">These nine prepositions take <strong>either Akkusativ or Dativ</strong>, depending on meaning:</p>
        <p style="font-size:0.88rem;margin-bottom:10px"><strong>an, auf, hinter, in, neben, ueber, unter, vor, zwischen</strong></p>
        <div class="wechsel-rule">
          <div class="wechsel-motion">
            <strong style="color:var(--acc-green)">Akkusativ</strong><br>
            Movement / change of position (Wohin? Where to?)<br>
            <em>Ich gehe <strong>in die Schule</strong>.</em> (I go into the school.)
          </div>
          <div class="wechsel-location">
            <strong style="color:var(--dat-orange)">Dativ</strong><br>
            Location / staying in place (Wo? Where?)<br>
            <em>Ich bin <strong>in der Schule</strong>.</em> (I am in the school.)
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- PRACTICE PANEL -->
  <div id="practice-panel" class="panel">
    <div class="practice-controls">
      <select class="difficulty-select" id="difficulty" onchange="resetPractice()">
        <option value="articles">Articles Only</option>
        <option value="adjectives">Articles + Adjective Endings</option>
        <option value="full">Full Sentences</option>
      </select>
      <div class="score-display">
        <span class="score-correct" id="score-correct">0 correct</span>
        <span class="score-incorrect" id="score-incorrect">0 wrong</span>
        <span class="score-streak" id="score-streak">Streak: 0</span>
      </div>
      <button class="reset-btn" onclick="resetPractice()">Reset</button>
    </div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    <div id="question-area"></div>
  </div>
</main>

<script>
// --- DATA ---
const articleTable = {
  nom: { m: 'der', f: 'die', n: 'das', pl: 'die' },
  acc: { m: 'den', f: 'die', n: 'das', pl: 'die' },
  dat: { m: 'dem', f: 'der', n: 'dem', pl: 'den' },
  gen: { m: 'des', f: 'der', n: 'des', pl: 'der' }
};

const caseNames = { nom: 'Nominativ', acc: 'Akkusativ', dat: 'Dativ', gen: 'Genitiv' };
const genderNames = { m: 'Maskulin', f: 'Feminin', n: 'Neutrum', pl: 'Plural' };

const cellExamples = {
  nom_m: { article: 'der', sentence: 'Der Mann liest ein Buch.', english: 'The man reads a book. (man = subject)' },
  nom_f: { article: 'die', sentence: 'Die Frau singt.', english: 'The woman sings. (woman = subject)' },
  nom_n: { article: 'das', sentence: 'Das Kind spielt.', english: 'The child plays. (child = subject)' },
  nom_pl: { article: 'die', sentence: 'Die Kinder spielen.', english: 'The children play. (children = subject)' },
  acc_m: { article: 'den', sentence: 'Ich sehe den Mann.', english: 'I see the man. (man = direct object)' },
  acc_f: { article: 'die', sentence: 'Er kauft die Tasche.', english: 'He buys the bag. (bag = direct object)' },
  acc_n: { article: 'das', sentence: 'Sie liest das Buch.', english: 'She reads the book. (book = direct object)' },
  acc_pl: { article: 'die', sentence: 'Wir lieben die Hunde.', english: 'We love the dogs. (dogs = direct object)' },
  dat_m: { article: 'dem', sentence: 'Ich gebe dem Lehrer das Buch.', english: 'I give the teacher the book. (teacher = indirect object)' },
  dat_f: { article: 'der', sentence: 'Er hilft der Frau.', english: 'He helps the woman. (woman = indirect object, helfen takes dative)' },
  dat_n: { article: 'dem', sentence: 'Sie gibt dem Kind einen Apfel.', english: 'She gives the child an apple. (child = indirect object)' },
  dat_pl: { article: 'den', sentence: 'Er dankt den Kindern.', english: 'He thanks the children. (children = indirect object, plural dative adds -n)' },
  gen_m: { article: 'des', sentence: 'Das Auto des Mannes ist neu.', english: "The man's car is new. (man's = possession, masculine adds -(e)s)" },
  gen_f: { article: 'der', sentence: 'Die Tasche der Frau ist rot.', english: "The woman's bag is red. (woman's = possession)" },
  gen_n: { article: 'des', sentence: 'Das Spielzeug des Kindes ist kaputt.', english: "The child's toy is broken. (child's = possession, neuter adds -(e)s)" },
  gen_pl: { article: 'der', sentence: 'Die Eltern der Kinder kommen.', english: "The children's parents are coming. (children's = possession)" }
};

// Practice sentences: 30+ across all cases and genders
const practiceData = {
  articles: [
    { before: 'Ich sehe', gap: 'den', after: 'Hund.', answer: 'den', options: ['der','den','dem','des'], caseKey: 'acc', gender: 'm', explanation: '"den Hund" is the direct object (Akkusativ). Masculine Akkusativ changes der to den.' },
    { before: '', gap: 'Die', after: 'Katze schlaeft.', answer: 'Die', options: ['Die','Den','Der','Das'], caseKey: 'nom', gender: 'f', explanation: '"Die Katze" is the subject of the sentence (Nominativ). Feminine Nominativ uses die.' },
    { before: 'Er gibt', gap: 'dem', after: 'Kind ein Geschenk.', answer: 'dem', options: ['das','dem','den','des'], caseKey: 'dat', gender: 'n', explanation: '"dem Kind" is the indirect object, receiving the gift (Dativ). Neuter Dativ uses dem.' },
    { before: 'Das Auto', gap: 'des', after: 'Mannes ist rot.', answer: 'des', options: ['der','dem','des','den'], caseKey: 'gen', gender: 'm', explanation: '"des Mannes" shows possession (Genitiv). Masculine Genitiv uses des (+s on noun).' },
    { before: 'Sie liest', gap: 'das', after: 'Buch.', answer: 'das', options: ['der','die','das','dem'], caseKey: 'acc', gender: 'n', explanation: '"das Buch" is the direct object (Akkusativ). Neuter Akkusativ stays as das.' },
    { before: 'Ich helfe', gap: 'der', after: 'Frau.', answer: 'der', options: ['die','der','dem','den'], caseKey: 'dat', gender: 'f', explanation: '"helfen" always takes Dativ. Feminine Dativ uses der.' },
    { before: '', gap: 'Der', after: 'Lehrer erklaert die Aufgabe.', answer: 'Der', options: ['Der','Den','Dem','Des'], caseKey: 'nom', gender: 'm', explanation: '"Der Lehrer" is the subject (Nominativ). Masculine Nominativ uses der.' },
    { before: 'Ich fahre mit', gap: 'dem', after: 'Bus.', answer: 'dem', options: ['der','den','dem','des'], caseKey: 'dat', gender: 'm', explanation: '"mit" always triggers Dativ. Masculine Dativ uses dem.' },
    { before: 'Er geht durch', gap: 'den', after: 'Park.', answer: 'den', options: ['der','den','dem','des'], caseKey: 'acc', gender: 'm', explanation: '"durch" always triggers Akkusativ. Masculine Akkusativ uses den.' },
    { before: 'Waehrend', gap: 'des', after: 'Sommers reisen wir.', answer: 'des', options: ['der','den','dem','des'], caseKey: 'gen', gender: 'm', explanation: '"waehrend" triggers Genitiv. Masculine Genitiv uses des.' },
    { before: 'Die Farbe', gap: 'der', after: 'Blume ist schoen.', answer: 'der', options: ['die','der','dem','den'], caseKey: 'gen', gender: 'f', explanation: '"der Blume" shows possession (Genitiv). Feminine Genitiv uses der.' },
    { before: 'Ich kaufe', gap: 'die', after: 'Schuhe.', answer: 'die', options: ['die','den','der','das'], caseKey: 'acc', gender: 'pl', explanation: '"die Schuhe" is the direct object (Akkusativ). Plural Akkusativ uses die.' },
    { before: 'Er dankt', gap: 'den', after: 'Kindern.', answer: 'den', options: ['die','den','der','dem'], caseKey: 'dat', gender: 'pl', explanation: '"danken" takes Dativ. Plural Dativ uses den (noun adds -n).' },
    { before: '', gap: 'Das', after: 'Maedchen singt laut.', answer: 'Das', options: ['Das','Die','Der','Den'], caseKey: 'nom', gender: 'n', explanation: '"Das Maedchen" is the subject (Nominativ). Neuter Nominativ uses das.' },
    { before: 'Ich schreibe', gap: 'dem', after: 'Lehrer einen Brief.', answer: 'dem', options: ['der','den','dem','des'], caseKey: 'dat', gender: 'm', explanation: '"dem Lehrer" is the indirect object, receiving the letter (Dativ). Masculine Dativ uses dem.' },
    { before: 'Trotz', gap: 'des', after: 'Regens spielen wir.', answer: 'des', options: ['der','den','dem','des'], caseKey: 'gen', gender: 'm', explanation: '"trotz" triggers Genitiv. Masculine Genitiv uses des.' },
    { before: 'Sie kommt aus', gap: 'der', after: 'Schule.', answer: 'der', options: ['die','der','dem','den'], caseKey: 'dat', gender: 'f', explanation: '"aus" always triggers Dativ. Feminine Dativ uses der.' },
    { before: 'Ohne', gap: 'den', after: 'Schluessel kann ich nicht rein.', answer: 'den', options: ['der','den','dem','des'], caseKey: 'acc', gender: 'm', explanation: '"ohne" triggers Akkusativ. Masculine Akkusativ uses den.' },
    { before: 'Die Meinungen', gap: 'der', after: 'Leute sind verschieden.', answer: 'der', options: ['die','der','den','des'], caseKey: 'gen', gender: 'pl', explanation: '"der Leute" shows possession (Genitiv). Plural Genitiv uses der.' },
    { before: '', gap: 'Die', after: 'Schueler lernen Deutsch.', answer: 'Die', options: ['Die','Den','Der','Das'], caseKey: 'nom', gender: 'pl', explanation: '"Die Schueler" is the subject (Nominativ). Plural Nominativ uses die.' },
    { before: 'Ich wohne bei', gap: 'der', after: 'Familie.', answer: 'der', options: ['die','der','dem','den'], caseKey: 'dat', gender: 'f', explanation: '"bei" always triggers Dativ. Feminine Dativ uses der.' },
    { before: 'Er laeuft um', gap: 'den', after: 'See.', answer: 'den', options: ['der','den','dem','des'], caseKey: 'acc', gender: 'm', explanation: '"um" triggers Akkusativ. Masculine Akkusativ uses den.' },
    { before: 'Die Tuer', gap: 'des', after: 'Hauses ist offen.', answer: 'des', options: ['der','den','dem','des'], caseKey: 'gen', gender: 'n', explanation: '"des Hauses" shows possession (Genitiv). Neuter Genitiv uses des.' },
    { before: 'Ich gebe', gap: 'der', after: 'Lehrerin die Hausaufgabe.', answer: 'der', options: ['die','der','dem','den'], caseKey: 'dat', gender: 'f', explanation: '"der Lehrerin" is the indirect object (Dativ). Feminine Dativ uses der.' },
    { before: 'Wir besuchen', gap: 'die', after: 'Grosseltern.', answer: 'die', options: ['die','den','der','das'], caseKey: 'acc', gender: 'pl', explanation: '"die Grosseltern" is the direct object (Akkusativ). Plural Akkusativ uses die.' },
    { before: 'Er faehrt nach', gap: 'der', after: 'Arbeit nach Hause.', answer: 'der', options: ['die','der','dem','den'], caseKey: 'dat', gender: 'f', explanation: '"nach" triggers Dativ. Feminine Dativ uses der.' },
    { before: 'Ich lege das Buch auf', gap: 'den', after: 'Tisch.', answer: 'den', options: ['der','den','dem','des'], caseKey: 'acc', gender: 'm', explanation: '"auf" with movement (Wohin?) triggers Akkusativ. Masculine Akkusativ uses den.' },
    { before: 'Das Buch liegt auf', gap: 'dem', after: 'Tisch.', answer: 'dem', options: ['der','den','dem','des'], caseKey: 'dat', gender: 'm', explanation: '"auf" with location (Wo?) triggers Dativ. Masculine Dativ uses dem.' },
    { before: 'Wegen', gap: 'des', after: 'Wetters bleiben wir zu Hause.', answer: 'des', options: ['der','den','dem','des'], caseKey: 'gen', gender: 'n', explanation: '"wegen" triggers Genitiv. Neuter Genitiv uses des.' },
    { before: '', gap: 'Die', after: 'Musik ist schoen.', answer: 'Die', options: ['Die','Den','Dem','Das'], caseKey: 'nom', gender: 'f', explanation: '"Die Musik" is the subject (Nominativ). Feminine Nominativ uses die.' },
    { before: 'Sie spielt mit', gap: 'den', after: 'Kindern.', answer: 'den', options: ['die','den','der','dem'], caseKey: 'dat', gender: 'pl', explanation: '"mit" triggers Dativ. Plural Dativ uses den.' },
    { before: 'Anstatt', gap: 'des', after: 'Kuchens esse ich Obst.', answer: 'des', options: ['der','den','dem','des'], caseKey: 'gen', gender: 'm', explanation: '"anstatt" triggers Genitiv. Masculine Genitiv uses des.' },
    { before: 'Ich sehe', gap: 'die', after: 'Frau.', answer: 'die', options: ['die','der','dem','den'], caseKey: 'acc', gender: 'f', explanation: '"die Frau" is the direct object (Akkusativ). Feminine Akkusativ uses die.' },
    { before: 'Er geht in', gap: 'die', after: 'Schule.', answer: 'die', options: ['die','der','dem','den'], caseKey: 'acc', gender: 'f', explanation: '"in" with movement (Wohin?) triggers Akkusativ. Feminine Akkusativ uses die.' },
    { before: 'Er ist in', gap: 'der', after: 'Schule.', answer: 'der', options: ['die','der','dem','den'], caseKey: 'dat', gender: 'f', explanation: '"in" with location (Wo?) triggers Dativ. Feminine Dativ uses der.' }
  ],
  adjectives: [
    { before: 'Ich sehe', gap: 'den alten', after: 'Mann.', answer: 'den alten', options: ['der alte','den alten','dem alten','des alten'], caseKey: 'acc', gender: 'm', explanation: 'Direct object (Akkusativ) + masculine. After "den", adjectives end in -en.' },
    { before: '', gap: 'Die kleine', after: 'Katze schlaeft.', answer: 'Die kleine', options: ['Die kleine','Den kleinen','Der kleinen','Das kleine'], caseKey: 'nom', gender: 'f', explanation: 'Subject (Nominativ) + feminine. After "die" (nom), adjectives end in -e.' },
    { before: 'Er gibt', gap: 'dem netten', after: 'Kind einen Ball.', answer: 'dem netten', options: ['das nette','dem netten','den netten','des netten'], caseKey: 'dat', gender: 'n', explanation: 'Indirect object (Dativ) + neuter. After "dem", adjectives end in -en.' },
    { before: 'Die Farbe', gap: 'des roten', after: 'Autos ist schoen.', answer: 'des roten', options: ['der rote','den roten','dem roten','des roten'], caseKey: 'gen', gender: 'n', explanation: 'Possession (Genitiv) + neuter. After "des", adjectives end in -en.' },
    { before: 'Wir helfen', gap: 'den kleinen', after: 'Kindern.', answer: 'den kleinen', options: ['die kleinen','den kleinen','der kleinen','des kleinen'], caseKey: 'dat', gender: 'pl', explanation: 'Dativ plural. After "den" (dat pl), adjectives end in -en.' },
    { before: '', gap: 'Der grosse', after: 'Hund bellt.', answer: 'Der grosse', options: ['Der grosse','Den grossen','Dem grossen','Des grossen'], caseKey: 'nom', gender: 'm', explanation: 'Subject (Nominativ) + masculine. After "der" (nom), adjectives end in -e.' },
    { before: 'Ich kaufe', gap: 'die neuen', after: 'Schuhe.', answer: 'die neuen', options: ['die neuen','den neuen','der neuen','das neue'], caseKey: 'acc', gender: 'pl', explanation: 'Direct object (Akkusativ) + plural. After "die" (acc pl), adjectives end in -en.' },
    { before: 'Er faehrt mit', gap: 'dem schnellen', after: 'Zug.', answer: 'dem schnellen', options: ['der schnelle','den schnellen','dem schnellen','des schnellen'], caseKey: 'dat', gender: 'm', explanation: '"mit" triggers Dativ + masculine. After "dem", adjectives end in -en.' },
    { before: 'Trotz', gap: 'des schlechten', after: 'Wetters gehen wir raus.', answer: 'des schlechten', options: ['der schlechte','den schlechten','dem schlechten','des schlechten'], caseKey: 'gen', gender: 'n', explanation: '"trotz" triggers Genitiv + neuter. After "des", adjectives end in -en.' },
    { before: 'Sie liest', gap: 'das interessante', after: 'Buch.', answer: 'das interessante', options: ['der interessante','das interessante','dem interessanten','des interessanten'], caseKey: 'acc', gender: 'n', explanation: 'Direct object (Akkusativ) + neuter. After "das" (acc), adjectives end in -e.' }
  ],
  full: [
    { before: '', gap: 'Der freundliche Lehrer', after: 'erklaert die Grammatik.', answer: 'Der freundliche Lehrer', options: ['Der freundliche Lehrer','Den freundlichen Lehrer','Dem freundlichen Lehrer','Des freundlichen Lehrers'], caseKey: 'nom', gender: 'm', explanation: 'The teacher is the subject performing the action (Nominativ). Masculine nom: der + -e ending.' },
    { before: 'Ich besuche', gap: 'den alten Freund', after: 'in Berlin.', answer: 'den alten Freund', options: ['der alte Freund','den alten Freund','dem alten Freund','des alten Freundes'], caseKey: 'acc', gender: 'm', explanation: 'The friend is the direct object being visited (Akkusativ). Masculine acc: den + -en ending.' },
    { before: 'Sie schreibt', gap: 'der netten Lehrerin', after: 'einen Brief.', answer: 'der netten Lehrerin', options: ['die nette Lehrerin','der netten Lehrerin','dem netten Lehrerin','des netten Lehrerin'], caseKey: 'dat', gender: 'f', explanation: 'The teacher receives the letter, indirect object (Dativ). Feminine dat: der + -en ending.' },
    { before: 'Das Dach', gap: 'des alten Hauses', after: 'ist kaputt.', answer: 'des alten Hauses', options: ['das alte Haus','dem alten Haus','den alten Hauses','des alten Hauses'], caseKey: 'gen', gender: 'n', explanation: 'Possession: the roof belongs to the house (Genitiv). Neuter gen: des + -en ending + -(e)s on noun.' },
    { before: 'Er geht mit', gap: 'dem kleinen Kind', after: 'in den Park.', answer: 'dem kleinen Kind', options: ['das kleine Kind','den kleinen Kind','dem kleinen Kind','des kleinen Kindes'], caseKey: 'dat', gender: 'n', explanation: '"mit" triggers Dativ. Neuter dat: dem + -en ending.' },
    { before: '', gap: 'Die neuen Schueler', after: 'kommen morgen.', answer: 'Die neuen Schueler', options: ['Die neuen Schueler','Den neuen Schuelern','Der neuen Schueler','Des neuen Schueler'], caseKey: 'nom', gender: 'pl', explanation: 'The students are the subject (Nominativ). Plural nom: die + -en ending.' },
    { before: 'Wegen', gap: 'des starken Regens', after: 'bleiben wir zu Hause.', answer: 'des starken Regens', options: ['der starke Regen','den starken Regen','dem starken Regen','des starken Regens'], caseKey: 'gen', gender: 'm', explanation: '"wegen" triggers Genitiv. Masculine gen: des + -en ending + -(e)s on noun.' },
    { before: 'Ich lege das Buch auf', gap: 'den grossen Tisch', after: '.', answer: 'den grossen Tisch', options: ['der grosse Tisch','den grossen Tisch','dem grossen Tisch','des grossen Tisches'], caseKey: 'acc', gender: 'm', explanation: '"auf" with movement (placing the book) triggers Akkusativ. Masculine acc: den + -en ending.' },
    { before: 'Das Buch liegt auf', gap: 'dem grossen Tisch', after: '.', answer: 'dem grossen Tisch', options: ['der grosse Tisch','den grossen Tisch','dem grossen Tisch','des grossen Tisches'], caseKey: 'dat', gender: 'm', explanation: '"auf" with location (the book is there) triggers Dativ. Masculine dat: dem + -en ending.' },
    { before: 'Ich kaufe', gap: 'die bunten Blumen', after: 'fuer meine Mutter.', answer: 'die bunten Blumen', options: ['die bunten Blumen','den bunten Blumen','der bunten Blumen','des bunten Blumen'], caseKey: 'acc', gender: 'pl', explanation: 'The flowers are the direct object (Akkusativ). Plural acc: die + -en ending.' }
  ]
};

// --- STATE ---
let currentTab = 'learn';
let score = { correct: 0, incorrect: 0, streak: 0 };
let questionIndex = 0;
let shuffledQuestions = [];
let answered = false;

// --- TABS ---
function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.dataset.tab === tab));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById(tab + '-panel').classList.add('active');
  if (tab === 'practice' && shuffledQuestions.length === 0) {
    resetPractice();
  }
}

// --- LEARN: CELL DETAIL ---
function showDetail(caseKey, gender) {
  const key = caseKey + '_' + gender;
  const data = cellExamples[key];
  if (!data) return;
  const colors = { nom: 'var(--nom-blue)', acc: 'var(--acc-green)', dat: 'var(--dat-orange)', gen: 'var(--gen-red)' };
  const el = document.getElementById('cell-detail');
  el.innerHTML =
    '<div class="detail-case" style="color:' + colors[caseKey] + '">' + caseNames[caseKey] + ' (' + genderNames[gender] + ')</div>' +
    '<div class="detail-gender">Article: <strong>' + data.article + '</strong></div>' +
    '<div class="detail-example">' + data.sentence + '</div>' +
    '<div class="detail-english">' + data.english + '</div>';
  el.style.borderLeftColor = colors[caseKey];
  el.classList.add('visible');
}

// --- PRACTICE ---
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function resetPractice() {
  const diff = document.getElementById('difficulty').value;
  shuffledQuestions = shuffle(practiceData[diff]);
  questionIndex = 0;
  score = { correct: 0, incorrect: 0, streak: 0 };
  answered = false;
  updateScore();
  renderQuestion();
}

function updateScore() {
  document.getElementById('score-correct').textContent = score.correct + ' correct';
  document.getElementById('score-incorrect').textContent = score.incorrect + ' wrong';
  document.getElementById('score-streak').textContent = 'Streak: ' + score.streak;
  const total = shuffledQuestions.length;
  const pct = total > 0 ? ((questionIndex) / total * 100) : 0;
  document.getElementById('progress-fill').style.width = pct + '%';
}

function renderQuestion() {
  const area = document.getElementById('question-area');
  if (questionIndex >= shuffledQuestions.length) {
    const pct = shuffledQuestions.length > 0 ? Math.round(score.correct / shuffledQuestions.length * 100) : 0;
    let msg = pct >= 90 ? 'Outstanding work!' : pct >= 70 ? 'Good effort!' : pct >= 50 ? 'Keep practising.' : 'Review the Learn tab and try again.';
    area.innerHTML =
      '<div class="question-card">' +
        '<h2 style="color:var(--purple-dark);margin-bottom:12px">Round Complete</h2>' +
        '<p style="font-size:1.2rem;margin-bottom:8px">' + score.correct + ' / ' + shuffledQuestions.length + ' correct (' + pct + '%)</p>' +
        '<p style="color:var(--text-light);margin-bottom:16px">' + msg + '</p>' +
        '<button class="next-btn visible" onclick="resetPractice()">Try Again</button>' +
      '</div>';
    document.getElementById('progress-fill').style.width = '100%';
    return;
  }

  const q = shuffledQuestions[questionIndex];
  answered = false;
  const caseColors = { nom: 'var(--nom-blue)', acc: 'var(--acc-green)', dat: 'var(--dat-orange)', gen: 'var(--gen-red)' };
  const caseBadge = '<span class="prep-badge badge-' + q.caseKey + '">' + caseNames[q.caseKey] + '</span>';

  let optionsHtml = '';
  q.options.forEach(function(opt) {
    optionsHtml += '<button class="option-btn" onclick="checkAnswer(this, \'' + opt.replace(/'/g, "\\'") + '\')">' + opt + '</button>';
  });

  area.innerHTML =
    '<div class="question-card">' +
      '<div class="q-number">Question ' + (questionIndex + 1) + ' of ' + shuffledQuestions.length + '</div>' +
      '<div class="q-sentence">' +
        escapeHtml(q.before) + ' <span class="q-gap" id="gap-text">???</span> ' + escapeHtml(q.after) +
      '</div>' +
      '<div class="q-hint">Select the correct form:</div>' +
      '<div class="options" id="options-area">' + optionsHtml + '</div>' +
      '<div class="feedback" id="feedback-box"></div>' +
      '<button class="next-btn" id="next-btn" onclick="nextQuestion()">Next</button>' +
    '</div>';
  updateScore();
}

function escapeHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function checkAnswer(btn, selected) {
  if (answered) return;
  answered = true;

  const q = shuffledQuestions[questionIndex];
  const isCorrect = selected === q.answer;
  const caseColors = { nom: 'var(--nom-blue)', acc: 'var(--acc-green)', dat: 'var(--dat-orange)', gen: 'var(--gen-red)' };

  // Highlight buttons
  document.querySelectorAll('.option-btn').forEach(function(b) {
    b.disabled = true;
    if (b.textContent === q.answer) b.classList.add('correct-choice');
    if (b === btn && !isCorrect) b.classList.add('incorrect-choice');
  });

  // Fill the gap
  document.getElementById('gap-text').textContent = q.answer;

  // Feedback
  const fb = document.getElementById('feedback-box');
  if (isCorrect) {
    score.correct++;
    score.streak++;
    fb.className = 'feedback visible correct-fb';
    fb.innerHTML = '<strong>Correct!</strong>' + q.explanation;
  } else {
    score.incorrect++;
    score.streak = 0;
    fb.className = 'feedback visible incorrect-fb';
    fb.innerHTML = '<strong>Not quite. The answer is: ' + q.answer + '</strong>' + q.explanation;
  }

  document.getElementById('next-btn').classList.add('visible');
  updateScore();
}

function nextQuestion() {
  questionIndex++;
  renderQuestion();
}

// --- INIT ---
document.addEventListener('DOMContentLoaded', function() {
  // Nothing else needed; learn tab is default
});
</script>
</body>
</html>