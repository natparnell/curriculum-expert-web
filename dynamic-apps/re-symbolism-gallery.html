<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Religious Symbolism Gallery</title>
<style>
:root {
  --bg-primary: #1a1a2e;
  --bg-secondary: #16213e;
  --bg-card: #1e2a45;
  --bg-card-hover: #253454;
  --text-primary: #e8e8e8;
  --text-secondary: #a8b0c0;
  --text-muted: #6b7280;
  --gold: #d4a843;
  --gold-light: #f0d078;
  --gold-dim: #a07830;
  --christianity: #c0392b;
  --islam: #27ae60;
  --judaism: #2980b9;
  --hinduism: #e67e22;
  --buddhism: #8e44ad;
  --sikhism: #d4a843;
  --general: #1abc9c;
  --layer-surface: #5dade2;
  --layer-history: #f39c12;
  --layer-theology: #e74c3c;
  --layer-contemporary: #2ecc71;
  --border-radius: 10px;
  --shadow: 0 4px 16px rgba(0,0,0,0.3);
  --transition: 0.3s ease;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  line-height: 1.6;
}

header {
  position: sticky; top: 0; z-index: 100;
  background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
  border-bottom: 2px solid var(--gold-dim);
  padding: 16px 24px;
  display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;
}

header h1 { font-size: 1.5rem; color: var(--gold); letter-spacing: 1px; }
header p { font-size: 0.85rem; color: var(--text-secondary); }

.header-left { display: flex; flex-direction: column; }

.header-actions { display: flex; gap: 8px; flex-wrap: wrap; }

.btn {
  padding: 8px 16px; border: 1px solid var(--gold-dim); border-radius: var(--border-radius);
  background: transparent; color: var(--gold); cursor: pointer; font-size: 0.85rem;
  transition: var(--transition);
}
.btn:hover { background: var(--gold-dim); color: #fff; }
.btn.active { background: var(--gold); color: var(--bg-primary); font-weight: 600; }

.filters {
  display: flex; gap: 6px; padding: 10px 24px; flex-wrap: wrap;
  background: var(--bg-secondary); border-bottom: 1px solid rgba(212,168,67,0.15);
}

.filter-btn {
  padding: 5px 12px; border-radius: 20px; border: 1px solid var(--text-muted);
  background: transparent; color: var(--text-secondary); cursor: pointer; font-size: 0.78rem;
  transition: var(--transition);
}
.filter-btn:hover { border-color: var(--gold); color: var(--gold); }
.filter-btn.active { background: var(--gold); color: var(--bg-primary); border-color: var(--gold); font-weight: 600; }

.container { max-width: 1200px; margin: 0 auto; padding: 20px; }

/* Gallery Grid */
.gallery {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 16px; padding: 10px 0;
}

.symbol-card {
  background: var(--bg-card); border-radius: var(--border-radius);
  padding: 16px; text-align: center; cursor: pointer;
  border: 1px solid rgba(255,255,255,0.06);
  transition: var(--transition); position: relative; overflow: hidden;
}
.symbol-card:hover {
  background: var(--bg-card-hover); transform: translateY(-3px);
  box-shadow: var(--shadow); border-color: var(--gold-dim);
}
.symbol-card canvas, .symbol-card svg { display: block; margin: 0 auto 10px; }
.symbol-card .card-name { font-size: 0.9rem; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; }
.symbol-card .card-religion { font-size: 0.75rem; padding: 2px 8px; border-radius: 10px; display: inline-block; }

/* Detail View */
.detail-overlay {
  display: none; position: fixed; inset: 0; z-index: 200;
  background: rgba(0,0,0,0.85); overflow-y: auto; padding: 20px;
}
.detail-overlay.visible { display: flex; justify-content: center; align-items: flex-start; }

.detail-panel {
  background: var(--bg-secondary); border-radius: var(--border-radius); max-width: 720px;
  width: 100%; margin: 30px auto; padding: 30px; position: relative;
  border: 1px solid var(--gold-dim); box-shadow: 0 8px 40px rgba(0,0,0,0.5);
}
.detail-close {
  position: absolute; top: 12px; right: 16px; background: none; border: none;
  color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;
}
.detail-close:hover { color: var(--gold); }

.detail-symbol-area { text-align: center; margin-bottom: 20px; }
.detail-symbol-area canvas { margin: 0 auto; }
.detail-title { font-size: 1.4rem; color: var(--gold); margin: 10px 0 4px; }
.detail-religion-badge { font-size: 0.8rem; padding: 3px 12px; border-radius: 12px; display: inline-block; margin-bottom: 16px; }

.layer {
  margin-bottom: 14px; border-radius: 8px; overflow: hidden;
  border: 1px solid rgba(255,255,255,0.08);
}
.layer-header {
  padding: 10px 14px; font-weight: 600; font-size: 0.85rem;
  display: flex; align-items: center; gap: 8px;
}
.layer-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
.layer-content {
  max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.3s ease;
  padding: 0 14px; font-size: 0.88rem; color: var(--text-secondary); line-height: 1.7;
}
.layer.revealed .layer-content { max-height: 300px; padding: 0 14px 12px; }

.reveal-btn {
  display: block; width: 100%; padding: 10px; margin-top: 8px;
  background: linear-gradient(135deg, var(--gold-dim), var(--gold));
  border: none; border-radius: 8px; color: var(--bg-primary); font-weight: 600;
  cursor: pointer; font-size: 0.9rem; transition: var(--transition);
}
.reveal-btn:hover { opacity: 0.9; }
.reveal-btn:disabled { opacity: 0.4; cursor: default; }

.similar-symbols { margin-top: 20px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.08); }
.similar-symbols h3 { font-size: 0.95rem; color: var(--gold); margin-bottom: 10px; }
.similar-grid { display: flex; gap: 10px; flex-wrap: wrap; }
.similar-chip {
  padding: 6px 14px; border-radius: 20px; background: var(--bg-card);
  border: 1px solid rgba(255,255,255,0.1); cursor: pointer; font-size: 0.8rem;
  color: var(--text-secondary); transition: var(--transition);
}
.similar-chip:hover { border-color: var(--gold); color: var(--gold); }

/* Quiz Mode */
.quiz-panel {
  display: none; text-align: center; padding: 30px 20px;
}
.quiz-panel.visible { display: block; }
.quiz-panel canvas { margin: 0 auto 20px; }
.quiz-question { font-size: 1.1rem; margin-bottom: 16px; color: var(--text-primary); }
.quiz-options { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 16px; }
.quiz-opt {
  padding: 10px 20px; border-radius: 8px; border: 1px solid var(--text-muted);
  background: var(--bg-card); color: var(--text-primary); cursor: pointer; font-size: 0.88rem;
  transition: var(--transition); min-width: 140px;
}
.quiz-opt:hover { border-color: var(--gold); }
.quiz-opt.correct { background: #27ae60; border-color: #27ae60; color: #fff; }
.quiz-opt.wrong { background: #c0392b; border-color: #c0392b; color: #fff; }
.quiz-score { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 14px; }
.quiz-feedback { font-size: 0.95rem; margin: 10px 0; min-height: 28px; }

/* Info Panel */
.info-panel {
  display: none; max-width: 800px; margin: 0 auto; padding: 20px 0;
}
.info-panel.visible { display: block; }
.info-panel h2 { color: var(--gold); margin-bottom: 14px; font-size: 1.2rem; }
.info-panel h3 { color: var(--gold-light); margin: 18px 0 8px; font-size: 1rem; }
.info-panel p { color: var(--text-secondary); margin-bottom: 10px; font-size: 0.92rem; }

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.symbol-card { animation: fadeIn 0.4s ease backwards; }
.symbol-card:nth-child(1) { animation-delay: 0.02s; }
.symbol-card:nth-child(2) { animation-delay: 0.04s; }
.symbol-card:nth-child(3) { animation-delay: 0.06s; }
.symbol-card:nth-child(4) { animation-delay: 0.08s; }
.symbol-card:nth-child(5) { animation-delay: 0.1s; }
.symbol-card:nth-child(6) { animation-delay: 0.12s; }
.symbol-card:nth-child(7) { animation-delay: 0.14s; }
.symbol-card:nth-child(8) { animation-delay: 0.16s; }
.symbol-card:nth-child(9) { animation-delay: 0.18s; }
.symbol-card:nth-child(10) { animation-delay: 0.2s; }
.symbol-card:nth-child(11) { animation-delay: 0.22s; }
.symbol-card:nth-child(12) { animation-delay: 0.24s; }
.symbol-card:nth-child(13) { animation-delay: 0.26s; }
.symbol-card:nth-child(14) { animation-delay: 0.28s; }
.symbol-card:nth-child(15) { animation-delay: 0.3s; }
.symbol-card:nth-child(16) { animation-delay: 0.32s; }
.symbol-card:nth-child(17) { animation-delay: 0.34s; }

@keyframes panelSlide {
  from { opacity: 0; transform: scale(0.95) translateY(20px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.detail-overlay.visible .detail-panel {
  animation: panelSlide 0.35s ease;
}

/* Focus styles for accessibility */
.symbol-card:focus-visible,
.btn:focus-visible,
.filter-btn:focus-visible,
.quiz-opt:focus-visible,
.reveal-btn:focus-visible {
  outline: 2px solid var(--gold);
  outline-offset: 2px;
}

.symbol-card:focus-visible {
  background: var(--bg-card-hover);
  border-color: var(--gold-dim);
}

/* Gallery count indicator */
.gallery-count {
  text-align: center;
  padding: 8px 0 4px;
  font-size: 0.8rem;
  color: var(--text-muted);
}

/* Responsive */
@media (max-width: 768px) {
  header { padding: 12px 16px; }
  header h1 { font-size: 1.2rem; }
  .header-actions { width: 100%; justify-content: flex-start; }
  .gallery { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; }
  .detail-panel { padding: 20px; margin: 10px; }
  .container { padding: 12px; }
  .similar-grid { gap: 6px; }
}

@media (max-width: 480px) {
  .gallery { grid-template-columns: repeat(2, 1fr); gap: 8px; }
  .symbol-card { padding: 12px; }
  .quiz-options { flex-direction: column; align-items: center; }
  .quiz-opt { width: 100%; max-width: 280px; }
  .filters { gap: 4px; padding: 8px 12px; }
  .filter-btn { font-size: 0.72rem; padding: 4px 10px; }
}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <h1>Religious Symbolism Gallery</h1>
    <p>Explore layered meanings behind symbols of world faiths</p>
  </div>
  <div class="header-actions">
    <button class="btn active" onclick="showView('gallery')">Gallery</button>
    <button class="btn" onclick="showView('quiz')">Quiz</button>
    <button class="btn" onclick="showView('info')">About Symbols</button>
  </div>
</header>

<div class="filters" id="filters"></div>

<div class="container">
  <div class="gallery" id="gallery"></div>
  <div class="quiz-panel" id="quizPanel"></div>
  <div class="info-panel" id="infoPanel">
    <h2>What Are Religious Symbols?</h2>
    <p>Religious symbols are visual representations that communicate complex spiritual
    ideas, beliefs, and traditions. They function as a shared visual language within
    faith communities, encoding layers of meaning that can take a lifetime to fully
    appreciate. Unlike ordinary signs (such as a stop sign that simply means "stop"),
    religious symbols carry multiple, often inexhaustible, layers of significance.</p>

    <p>A symbol is not just a label or abbreviation. It participates in the reality
    it points to. A cross is not merely a reminder of the crucifixion; for Christians,
    it embodies the very mystery of redemption. This "participatory" quality sets
    religious symbols apart from secular logos or trademarks.</p>

    <h3>Why Do Religions Use Symbols?</h3>
    <p>Symbols transcend spoken language. They allow believers to express concepts
    that words struggle to capture: the infinite, the sacred, the relationship between
    the human and the divine. A single symbol can simultaneously convey historical
    events, theological doctrines, and personal devotion.</p>

    <p>There are several reasons why every major faith tradition relies on symbols.
    First, the sacred often exceeds what language can describe. How do you put the
    infinite into words? A symbol can gesture toward what lies beyond rational
    expression. Second, symbols create community. Shared images bind believers
    together across cultures, centuries, and languages. Third, symbols aid memory
    and worship. Seeing a familiar image can instantly recall an entire tradition
    of prayer, story, and practice.</p>

    <h3>Semiotics: The Study of Signs</h3>
    <p>Semiotics, founded by Ferdinand de Saussure and Charles Sanders Peirce, is
    the study of how signs and symbols create meaning. Every symbol has a "signifier"
    (the image itself) and a "signified" (the concept it represents). Religious
    symbols are particularly rich because they operate on multiple levels: literal,
    allegorical, moral, and mystical.</p>

    <p>Peirce distinguished three types of signs. An icon resembles what it
    represents (a painting of Jesus). An index has a causal connection to its
    meaning (smoke indicating fire). A symbol is purely conventional: its
    meaning is assigned by cultural agreement. Most religious "symbols" actually
    blend all three categories, which is part of what makes them so powerful.</p>

    <p>The theologian Paul Tillich argued that genuine symbols "open up levels of
    reality which otherwise are closed." They cannot be invented deliberately;
    rather, they emerge from the collective experience of a community and die
    when they no longer resonate. This helps explain why some ancient symbols
    (such as the cross or the lotus) remain vibrant, while others have faded.</p>

    <h3>Layers of Meaning</h3>
    <p>This gallery uses a four-layer model to explore each symbol:</p>
    <p><strong>Layer 1, Surface:</strong> What you physically see. The shape,
    the colours, the visual impression. This is the signifier, the raw image
    before any interpretation is applied.</p>
    <p><strong>Layer 2, Historical:</strong> Where the symbol came from. Every
    symbol has a story of origin, shaped by the culture, politics, and events
    of its time. Understanding history prevents us from reading modern meanings
    back into ancient images.</p>
    <p><strong>Layer 3, Theological:</strong> The spiritual and doctrinal meaning.
    This is the heart of what the symbol communicates within its faith tradition.
    Theological meaning is often the richest and most contested layer.</p>
    <p><strong>Layer 4, Contemporary:</strong> How the symbol lives in the world
    today. Symbols do not stay fixed; they accumulate new associations as they
    move through history. A symbol's contemporary meaning may differ significantly
    from its original intent.</p>
    <p>Click "Reveal next layer" in any symbol's detail view to peel back
    these layers one at a time.</p>

    <h3>Cross-Religious Connections</h3>
    <p>Many symbols share themes across traditions: light and darkness, circles
    and wholeness, hands and divine protection. These parallels reveal common
    human impulses to represent the sacred, even when theologies differ
    considerably.</p>

    <p>For example, the concept of divine light appears in the Jewish menorah,
    the Christian imagery of Christ as "the light of the world," the Islamic
    "Verse of Light" in the Quran, and the Buddhist idea of enlightenment. The
    circle, representing eternity and completeness, features in the Dharma
    Wheel, the Sikh Chakkar, and the Yin-Yang. The hand as a symbol of
    protection or blessing connects the Hamsa across Islamic and Jewish
    traditions. Exploring these connections can foster respect and empathy
    between communities without erasing the real differences in belief.</p>

    <h3>Approaching Symbols with Respect</h3>
    <p>Religious symbols are sacred to the communities that use them. When
    studying them in an educational context, it is important to approach each
    symbol with curiosity and respect rather than judgement. Avoid reducing a
    symbol to a simple definition; be willing to sit with its complexity. Ask
    questions like: What does this symbol mean to the people who use it? How
    might its meaning differ depending on context? What can it teach me about
    a worldview different from my own?</p>

    <p>Symbols are not museum objects; they are living elements of real
    communities' worship, identity, and daily life. Treating them with care is
    a foundation of genuine interfaith understanding.</p>
  </div>
</div>

<div class="detail-overlay" id="detailOverlay">
  <div class="detail-panel" id="detailPanel"></div>
</div>

<script>
const SYMBOLS = [
  {
    id: "cross", name: "Cross", religion: "Christianity",
    related: ["ichthys","chi-rho","star-of-david","khanda"],
    layers: [
      "Two intersecting beams forming a vertical and horizontal axis. The most widely recognised symbol of the Christian faith, appearing on churches, jewellery, and gravestones worldwide.",
      "Crucifixion was a Roman execution method. Early Christians initially avoided depicting the cross due to its association with suffering and shame. It became a central symbol from the 4th century after Emperor Constantine's conversion.",
      "The cross represents the sacrifice of Jesus Christ, who Christians believe died to redeem humanity from sin. The vertical beam symbolises the relationship between God and humanity; the horizontal beam represents the connection between people.",
      "Today the cross appears in countless forms: Celtic, Orthodox, Latin, and more. It marks sacred spaces, serves as a personal devotional object, and appears in humanitarian logos such as the Red Cross (though its use there is secular in origin)."
    ]
  },
  {
    id: "ichthys", name: "Ichthys (Fish)", religion: "Christianity",
    related: ["cross","dove","chi-rho"],
    layers: [
      "A simple outline of a fish, formed by two curved lines intersecting at one end to create a tail. Often seen as a bumper sticker or pendant.",
      "The Greek word ICHTHYS (fish) was used as an acronym: Iesous Christos Theou Yios Soter (Jesus Christ, God's Son, Saviour). Early persecuted Christians used it as a secret recognition sign.",
      "The fish connects to multiple Gospel narratives: Jesus called fishermen as disciples, multiplied loaves and fishes, and told followers to be 'fishers of men.' It symbolises abundance, faith, and baptism (water).",
      "The ichthys experienced a revival in the 20th century as a popular emblem on cars and accessories. It has also inspired parody versions, reflecting its status as a culturally recognisable icon beyond church walls."
    ]
  },
  {
    id: "dove", name: "Dove", religion: "Christianity",
    related: ["ichthys","lotus","hand-of-fatima"],
    layers: [
      "A white bird in flight, often depicted with outstretched wings and sometimes carrying an olive branch. Smooth, gentle form suggesting peace.",
      "The dove appears in the Genesis flood narrative, returning to Noah's ark with an olive branch to signal receding waters. In the New Testament, the Holy Spirit descends 'like a dove' at the baptism of Jesus.",
      "The dove symbolises the Holy Spirit, the third person of the Christian Trinity. It represents purity, peace, divine inspiration, and the presence of God in the world. The olive branch adds themes of reconciliation and hope.",
      "Beyond Christianity, the dove has become a universal peace symbol, adopted by secular peace movements, the United Nations, and artists like Picasso. It appears on greeting cards, memorials, and in release ceremonies at weddings and funerals."
    ]
  },
  {
    id: "alpha-omega", name: "Alpha & Omega", religion: "Christianity",
    related: ["chi-rho","om","yin-yang"],
    layers: [
      "The first and last letters of the Greek alphabet, often displayed together or flanking a cross or Chi-Rho monogram. Stylised in ornamental forms.",
      "The phrase comes from the Book of Revelation, where God declares: 'I am the Alpha and the Omega, the beginning and the end.' Greek was the common language of early Christian scripture.",
      "These letters express God's eternal nature: existing before creation and beyond the end of time. They affirm divine sovereignty over all of history, encompassing everything from start to finish.",
      "Alpha and Omega appear in church architecture, liturgical vestments, and Christian art. They feature in funeral services to express hope in God's eternal presence and are used in ecumenical contexts across denominations."
    ]
  },
  {
    id: "chi-rho", name: "Chi-Rho", religion: "Christianity",
    related: ["cross","alpha-omega","calligraphy"],
    layers: [
      "A monogram formed by superimposing the Greek letters Chi (X) and Rho (P), creating a shape resembling a six-armed figure with a loop at the top.",
      "According to tradition, Emperor Constantine saw this symbol in a vision before the Battle of Milvian Bridge in 312 CE, accompanied by the words 'In this sign, conquer.' He adopted it as a military standard.",
      "The Chi and Rho are the first two letters of 'Christos' (Christ) in Greek. The monogram serves as a compact profession of faith in Jesus as the anointed one (Messiah) sent by God.",
      "The Chi-Rho appears in archaeological sites, early Christian catacombs, and manuscript illuminations. It remains in use in Catholic, Orthodox, and Anglican liturgical art and is studied as one of the earliest surviving Christian symbols."
    ]
  },
  {
    id: "star-crescent", name: "Star & Crescent", religion: "Islam",
    related: ["star-of-david","dharma-wheel","khanda"],
    layers: [
      "A crescent moon with a five-pointed star nestled in its concavity. Commonly seen on flags of Muslim-majority nations and atop mosque minarets.",
      "The symbol predates Islam, appearing in ancient Mesopotamian and Byzantine imagery. It became associated with Islam through the Ottoman Empire, which adopted it as an imperial emblem from the 15th century onward.",
      "While not prescribed by the Quran, the crescent references the Islamic lunar calendar central to religious observance (notably Ramadan). The star may represent divine guidance and light. Some scholars note the moon evokes God's creation of celestial bodies.",
      "The star and crescent appears on the flags of Turkey, Pakistan, Tunisia, and many other nations. It marks mosques, halal products, and Muslim charitable organisations, though some Muslims prefer not to use it, viewing it as a cultural rather than religious symbol."
    ]
  },
  {
    id: "calligraphy", name: "Allah Calligraphy", religion: "Islam",
    related: ["chi-rho","om","alpha-omega"],
    layers: [
      "The Arabic word for God, 'Allah,' rendered in flowing calligraphic script. Characterised by sweeping curves and elegant proportions typical of Islamic art.",
      "Arabic calligraphy developed as a major art form because Islamic tradition generally discourages figurative depictions of God and prophets. Writing the divine name became an act of devotion in itself, with master calligraphers revered across the Muslim world.",
      "The word 'Allah' encapsulates the Islamic concept of radical monotheism (tawhid). It is the same word used by Arabic-speaking Christians and Jews for God. In calligraphic form, its beauty is intended to reflect the perfection of the divine.",
      "Islamic calligraphy adorns mosques, Qurans, public buildings, and homes across the globe. It has influenced graphic design and contemporary art, and appears in digital form in apps and social media. Respect for the written name of God extends to careful disposal of any paper bearing it."
    ]
  },
  {
    id: "hand-of-fatima", name: "Hand of Fatima", religion: "Islam",
    related: ["dove","chai","lotus"],
    layers: [
      "An open right hand, symmetrical, with fingers pointing upward and sometimes an eye in the centre of the palm. Also called the Hamsa.",
      "Named after Fatima, daughter of the Prophet Muhammad, the symbol has roots in ancient Middle Eastern and North African cultures. It appears across Islamic, Jewish (Hand of Miriam), and other traditions, predating all three Abrahamic faiths.",
      "In Islamic tradition, the five fingers may represent the Five Pillars of Islam. The hand symbolises divine protection, blessings, strength, and power. The eye in some versions wards off the 'evil eye' (envy and malice).",
      "The Hamsa is enormously popular in jewellery, home decor, and fashion across the Middle East, North Africa, and globally. It bridges religious and secular contexts, often worn as a protective amulet regardless of the wearer's faith."
    ]
  },
  {
    id: "star-of-david", name: "Star of David", religion: "Judaism",
    related: ["cross","star-crescent","khanda"],
    layers: [
      "Two overlapping equilateral triangles forming a six-pointed star (hexagram). Clean geometric lines creating a shape of balanced symmetry.",
      "The hexagram appeared in Jewish contexts from the medieval period. It became strongly associated with Judaism in the 17th century through the Jewish community of Prague, and was later adopted by the Zionist movement in the 19th century.",
      "The interlocking triangles are interpreted as representing the relationship between God and humanity: one triangle pointing up (human aspiration toward the divine) and one pointing down (God's presence reaching into the world). The six points may symbolise God's rule over the six directions of space.",
      "The Star of David appears on the flag of Israel, on synagogues, and in Jewish ceremonial art. Tragically, it was forced upon Jews as an identifier during the Holocaust, an association that adds a powerful layer of memory and resilience to its meaning today."
    ]
  },
  {
    id: "menorah", name: "Menorah", religion: "Judaism",
    related: ["dharma-wheel","lotus","cross"],
    layers: [
      "A seven-branched candelabrum, typically depicted with a central stem and three curved branches on each side, each ending in a lamp holder.",
      "Described in the Book of Exodus as part of the Tabernacle furnishings, the menorah stood in the Temple in Jerusalem. After the Temple's destruction in 70 CE, it became a central symbol of Jewish identity and longing for restoration.",
      "The seven branches have been linked to the seven days of creation, the seven classical planets, and divine wisdom. Light in Judaism symbolises Torah, knowledge, and the presence of God. The menorah embodies the Jewish mission to be 'a light unto the nations.'",
      "The menorah is the emblem of the State of Israel. The nine-branched Hanukkiah (Hanukkah menorah) is lit during the Festival of Lights. Menorahs appear in synagogues, Jewish art, and public Hanukkah celebrations in cities worldwide."
    ]
  },
  {
    id: "chai", name: "Chai", religion: "Judaism",
    related: ["om","hand-of-fatima","alpha-omega"],
    layers: [
      "Two Hebrew letters, Chet and Yod, forming the word 'Chai,' meaning 'life' or 'living.' Often rendered in decorative calligraphic style.",
      "The significance of Chai is deeply tied to the Jewish numerological tradition of gematria, where each Hebrew letter has a numerical value. Chai equals 18, which is why gifts in multiples of 18 are traditional at Jewish celebrations.",
      "Judaism places supreme value on the sanctity of life. 'L'Chaim' (to life) is a traditional toast. The Chai symbol affirms the preciousness of existence, the obligation to preserve life, and the hope for continued vitality.",
      "Chai pendants are among the most popular items of Jewish jewellery worldwide. The number 18 influences charitable giving, and 'Chai' appears in synagogue art, greeting cards, and as a cultural marker of Jewish identity in everyday life."
    ]
  },
  {
    id: "om", name: "Om", religion: "Hinduism",
    related: ["calligraphy","chai","alpha-omega"],
    layers: [
      "A flowing Sanskrit character with curves, a crescent, and a dot at the top. Its visual form is distinctive and widely recognised, even outside Hindu contexts.",
      "Om is referenced in the oldest Hindu scriptures, the Vedas, and in the Upanishads. It may be the most ancient sacred syllable still in continuous use, with roots stretching back over 3,000 years.",
      "Om represents Brahman, the ultimate reality underlying all existence. Its three phonetic components (A-U-M) correspond to creation, preservation, and destruction; waking, dreaming, and deep sleep; and the three main Hindu deities. The silence after chanting represents the transcendent fourth state.",
      "Om is chanted in Hindu, Buddhist, Jain, and Sikh worship. It appears on temples, in yoga studios worldwide, and in popular culture. Its ubiquity has raised discussions about cultural appropriation when used purely as decoration."
    ]
  },
  {
    id: "lotus", name: "Lotus", religion: "Hinduism",
    related: ["dove","dharma-wheel","menorah"],
    layers: [
      "A stylised flower with layered petals opening upward, often depicted in profile or from above. The lotus has a distinctive rounded, symmetrical form.",
      "The lotus has been sacred in South Asian cultures for millennia. In Hindu mythology, Brahma the creator emerged from a lotus growing from Vishnu's navel. The flower also features prominently in Buddhist and ancient Egyptian traditions.",
      "The lotus grows in muddy water yet blooms immaculately on the surface, symbolising spiritual purity rising above the material world. It represents divine beauty, non-attachment, enlightenment, and the unfolding of spiritual potential.",
      "The lotus is India's national flower and appears throughout Hindu and Buddhist temple architecture. It is used in meditation imagery, yoga branding, and wellness culture. Its symbolism of resilience and beauty from adversity resonates across cultures."
    ]
  },
  {
    id: "dharma-wheel", name: "Dharma Wheel", religion: "Buddhism",
    related: ["star-crescent","menorah","yin-yang"],
    layers: [
      "A wheel with eight spokes radiating from a central hub, enclosed by an outer rim. It resembles a ship's wheel or chariot wheel, rendered with clean geometric lines.",
      "The wheel (Dharmachakra) references Buddha's first sermon at Deer Park in Sarnath, described as 'setting the wheel of Dharma in motion.' Wheel imagery existed in Indian culture before Buddhism, symbolising cosmic order and royal authority.",
      "The eight spokes represent the Noble Eightfold Path: right view, intention, speech, action, livelihood, effort, mindfulness, and concentration. The hub represents moral discipline, the spokes represent wisdom, and the rim represents meditative concentration holding everything together.",
      "The Dharma Wheel appears on the Indian national flag, in Buddhist temples across Asia, and on meditation apps and wellness products. It is one of the Eight Auspicious Symbols of Buddhism and serves as the primary identifier of the Buddhist faith."
    ]
  },
  {
    id: "buddhas-eyes", name: "Buddha's Eyes", religion: "Buddhism",
    related: ["hand-of-fatima","dove","om"],
    layers: [
      "A pair of stylised eyes painted on a surface, with a curling symbol resembling a question mark or the Nepali numeral one between them, replacing the nose. Sometimes a dot appears above.",
      "The eyes are most famously displayed on the four sides of Boudhanath and Swayambhunath stupas in Nepal. This tradition dates to at least the medieval period and may be much older.",
      "The all-seeing eyes represent the Buddha's awareness and compassion, watching over all beings in every direction. The 'nose' symbol represents unity and the single path to enlightenment. The dot (third eye) symbolises spiritual awakening.",
      "The Buddha's Eyes are iconic to Nepali Buddhist culture and appear on stupas, prayer flags, souvenirs, and travel imagery. They have become one of the most photographed religious symbols in Asia, recognisable to visitors worldwide."
    ]
  },
  {
    id: "khanda", name: "Khanda", religion: "Sikhism",
    related: ["cross","star-of-david","star-crescent"],
    layers: [
      "A double-edged sword in the centre, flanked by two curved swords (kirpans) on the outside, with a circular throwing weapon (chakkar) surrounding the central blade.",
      "The Khanda was adopted as the emblem of the Sikh faith during the time of the Sikh Gurus (16th to 18th centuries). It reflects the martial tradition that developed in response to Mughal persecution.",
      "The double-edged sword represents divine knowledge separating truth from falsehood. The chakkar (circle) symbolises the eternal, unchanging nature of God. The two kirpans represent spiritual and temporal authority (Miri and Piri), emphasising that Sikhs must engage with both the sacred and the worldly.",
      "The Khanda appears on the Sikh flag (Nishan Sahib), gurdwaras, and Sikh identity markers worldwide. It is a symbol of pride in Sikh communities and increasingly recognised in multicultural societies as a marker of Sikh heritage."
    ]
  },
  {
    id: "yin-yang", name: "Yin-Yang", religion: "General",
    related: ["dharma-wheel","om","alpha-omega"],
    layers: [
      "A circle divided into two swirling halves, one black and one white, each containing a smaller circle of the opposite colour. The form suggests continuous circular motion.",
      "The Yin-Yang (Taijitu) has roots in Chinese philosophy dating back at least to the 3rd century BCE, connected to Taoism and the I Ching. It emerged from observations of natural cycles: day and night, seasons, tides.",
      "Yin (dark, receptive, feminine) and Yang (light, active, masculine) represent complementary opposites that together form a dynamic whole. Neither exists without the other; each contains the seed of its counterpart. The symbol expresses the Taoist understanding that harmony arises from balanced opposition.",
      "The Yin-Yang has become one of the most globally recognised symbols, appearing in martial arts, holistic medicine, fashion, and popular culture. It features on the South Korean flag and influences design aesthetics worldwide, often used to express balance and interconnection."
    ]
  }
];

const RELIGION_COLOURS = {
  Christianity: "var(--christianity)", Islam: "var(--islam)", Judaism: "var(--judaism)",
  Hinduism: "var(--hinduism)", Buddhism: "var(--buddhism)", Sikhism: "var(--sikhism)", General: "var(--general)"
};

const RELIGIONS = ["All", "Christianity", "Islam", "Judaism", "Hinduism", "Buddhism", "Sikhism", "General"];

let currentFilter = "All";
let currentView = "gallery";
let quizState = { current: null, score: 0, total: 0, answered: false };

// ---- Drawing functions (Canvas) ----
function drawSymbol(canvas, id, size) {
  const ctx = canvas.getContext("2d");
  canvas.width = size; canvas.height = size;
  ctx.clearRect(0, 0, size, size);
  const cx = size / 2, cy = size / 2, r = size * 0.38;
  const sym = SYMBOLS.find(s => s.id === id);
  const col = RELIGION_COLOURS[sym.religion];
  ctx.strokeStyle = col; ctx.fillStyle = col; ctx.lineWidth = size * 0.025; ctx.lineCap = "round"; ctx.lineJoin = "round";

  switch (id) {
    case "cross":
      ctx.beginPath();
      ctx.moveTo(cx, cy - r); ctx.lineTo(cx, cy + r);
      ctx.moveTo(cx - r * 0.6, cy - r * 0.15); ctx.lineTo(cx + r * 0.6, cy - r * 0.15);
      ctx.lineWidth = size * 0.05; ctx.stroke();
      break;
    case "ichthys":
      ctx.beginPath();
      ctx.moveTo(cx + r, cy);
      ctx.bezierCurveTo(cx + r * 0.3, cy - r * 0.7, cx - r * 0.7, cy - r * 0.7, cx - r, cy);
      ctx.bezierCurveTo(cx - r * 0.7, cy + r * 0.7, cx + r * 0.3, cy + r * 0.7, cx + r, cy);
      ctx.moveTo(cx + r, cy);
      ctx.lineTo(cx + r * 1.15, cy - r * 0.35);
      ctx.moveTo(cx + r, cy);
      ctx.lineTo(cx + r * 1.15, cy + r * 0.35);
      ctx.lineWidth = size * 0.03; ctx.stroke();
      break;
    case "dove":
      ctx.save(); ctx.translate(cx, cy);
      ctx.beginPath();
      ctx.ellipse(0, r * 0.1, r * 0.3, r * 0.2, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo(-r * 0.15, 0);
      ctx.quadraticCurveTo(-r * 0.8, -r * 0.7, -r * 0.9, -r * 0.2);
      ctx.quadraticCurveTo(-r * 0.4, -r * 0.4, -r * 0.15, 0);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo(r * 0.15, 0);
      ctx.quadraticCurveTo(r * 0.8, -r * 0.7, r * 0.9, -r * 0.2);
      ctx.quadraticCurveTo(r * 0.4, -r * 0.4, r * 0.15, 0);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo(r * 0.3, r * 0.1);
      ctx.lineTo(r * 0.5, r * 0.45);
      ctx.lineTo(r * 0.05, r * 0.25);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(r * 0.1, r * 0.05, size * 0.02, 0, Math.PI * 2);
      ctx.fillStyle = "var(--bg-primary)"; ctx.fill();
      ctx.restore();
      break;
    case "alpha-omega":
      ctx.font = `bold ${size * 0.38}px serif`;
      ctx.textAlign = "center"; ctx.textBaseline = "middle";
      ctx.fillText("\u0391", cx - r * 0.45, cy);
      ctx.fillText("\u03A9", cx + r * 0.5, cy);
      break;
    case "chi-rho":
      ctx.lineWidth = size * 0.04;
      ctx.beginPath();
      ctx.moveTo(cx, cy - r); ctx.lineTo(cx, cy + r);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(cx - r * 0.7, cy - r * 0.5); ctx.lineTo(cx + r * 0.7, cy + r * 0.5);
      ctx.moveTo(cx + r * 0.7, cy - r * 0.5); ctx.lineTo(cx - r * 0.7, cy + r * 0.5);
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(cx, cy - r * 0.85, r * 0.25, Math.PI * 0.8, Math.PI * 2.2);
      ctx.stroke();
      break;
    case "star-crescent":
      ctx.beginPath();
      ctx.arc(cx - r * 0.15, cy, r * 0.55, 0, Math.PI * 2);
      ctx.lineWidth = size * 0.03; ctx.stroke();
      ctx.save();
      ctx.globalCompositeOperation = "destination-out";
      ctx.beginPath();
      ctx.arc(cx + r * 0.15, cy - r * 0.05, r * 0.45, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
      ctx.beginPath();
      ctx.arc(cx - r * 0.15, cy, r * 0.55, 0, Math.PI * 2);
      ctx.lineWidth = size * 0.03; ctx.stroke();
      drawStar(ctx, cx + r * 0.55, cy - r * 0.25, r * 0.18, 5);
      break;
    case "calligraphy":
      ctx.font = `bold ${size * 0.35}px serif`;
      ctx.textAlign = "center"; ctx.textBaseline = "middle";
      ctx.fillText("\u0627\u0644\u0644\u0647", cx, cy);
      break;
    case "hand-of-fatima":
      ctx.save(); ctx.translate(cx, cy + r * 0.1);
      ctx.beginPath();
      ctx.ellipse(0, r * 0.15, r * 0.55, r * 0.5, 0, 0, Math.PI);
      ctx.fill();
      const fw = r * 0.18;
      for (let i = -2; i <= 2; i++) {
        const fx = i * fw;
        const fh = (Math.abs(i) < 2) ? r * 0.7 : r * 0.55;
        ctx.beginPath();
        ctx.ellipse(fx, -fh * 0.2, fw * 0.42, fh * 0.55, 0, Math.PI, 0);
        ctx.fill();
      }
      ctx.beginPath();
      ctx.arc(0, r * 0.05, r * 0.12, 0, Math.PI * 2);
      ctx.fillStyle = "var(--bg-primary)"; ctx.fill();
      ctx.restore();
      break;
    case "star-of-david":
      drawHexStar(ctx, cx, cy, r * 0.7);
      break;
    case "menorah":
      ctx.lineWidth = size * 0.03;
      ctx.beginPath();
      ctx.moveTo(cx, cy + r * 0.8); ctx.lineTo(cx, cy - r * 0.3);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(cx - r * 0.5, cy + r * 0.8); ctx.lineTo(cx + r * 0.5, cy + r * 0.8);
      ctx.stroke();
      for (let i = -3; i <= 3; i++) {
        const bx = cx + i * r * 0.2;
        const topY = cy - r * 0.65;
        ctx.beginPath();
        if (i === 0) {
          ctx.moveTo(cx, cy - r * 0.3); ctx.lineTo(cx, topY);
        } else {
          ctx.moveTo(cx, cy - r * 0.1);
          ctx.quadraticCurveTo(bx, cy - r * 0.1, bx, topY);
        }
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(bx, topY - r * 0.06, r * 0.06, 0, Math.PI * 2);
        ctx.fill();
      }
      break;
    case "chai":
      ctx.font = `bold ${size * 0.48}px serif`;
      ctx.textAlign = "center"; ctx.textBaseline = "middle";
      ctx.fillText("\u05D7\u05D9", cx, cy);
      break;
    case "om":
      ctx.font = `bold ${size * 0.55}px serif`;
      ctx.textAlign = "center"; ctx.textBaseline = "middle";
      ctx.fillText("\u0950", cx, cy);
      break;
    case "lotus":
      ctx.save(); ctx.translate(cx, cy + r * 0.15);
      for (let layer = 0; layer < 3; layer++) {
        const petals = layer === 0 ? 5 : layer === 1 ? 6 : 7;
        const pr = r * (0.35 + layer * 0.2);
        const offset = layer * 0.15;
        for (let i = 0; i < petals; i++) {
          const ang = -Math.PI / 2 + (i / petals) * Math.PI * 2 + offset;
          ctx.save(); ctx.translate(0, 0); ctx.rotate(ang);
          ctx.beginPath();
          ctx.ellipse(0, -pr * 0.55, pr * 0.2, pr * 0.5, 0, 0, Math.PI * 2);
          ctx.globalAlpha = 0.3 + layer * 0.25;
          ctx.fill();
          ctx.restore();
        }
      }
      ctx.restore();
      break;
    case "dharma-wheel":
      ctx.beginPath();
      ctx.arc(cx, cy, r * 0.75, 0, Math.PI * 2);
      ctx.lineWidth = size * 0.025; ctx.stroke();
      ctx.beginPath();
      ctx.arc(cx, cy, r * 0.15, 0, Math.PI * 2);
      ctx.stroke();
      for (let i = 0; i < 8; i++) {
        const ang = (i / 8) * Math.PI * 2;
        ctx.beginPath();
        ctx.moveTo(cx + Math.cos(ang) * r * 0.15, cy + Math.sin(ang) * r * 0.15);
        ctx.lineTo(cx + Math.cos(ang) * r * 0.75, cy + Math.sin(ang) * r * 0.75);
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(cx + Math.cos(ang) * r * 0.75, cy + Math.sin(ang) * r * 0.75, r * 0.06, 0, Math.PI * 2);
        ctx.fill();
      }
      break;
    case "buddhas-eyes":
      ctx.save(); ctx.translate(cx, cy);
      const ew = r * 0.5, eh = r * 0.2;
      for (let side of [-1, 1]) {
        ctx.beginPath();
        ctx.ellipse(side * r * 0.35, -r * 0.1, ew, eh, 0, 0, Math.PI * 2);
        ctx.lineWidth = size * 0.025; ctx.stroke();
        ctx.beginPath();
        ctx.arc(side * r * 0.35, -r * 0.1, eh * 0.45, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.beginPath();
      ctx.moveTo(0, r * 0.05);
      ctx.quadraticCurveTo(r * 0.12, r * 0.35, 0, r * 0.6);
      ctx.quadraticCurveTo(-r * 0.12, r * 0.35, 0, r * 0.05);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(0, -r * 0.35, r * 0.07, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
      break;
    case "khanda":
      ctx.lineWidth = size * 0.03;
      ctx.beginPath();
      ctx.arc(cx, cy, r * 0.5, 0, Math.PI * 2);
      ctx.stroke();
      ctx.lineWidth = size * 0.035;
      ctx.beginPath();
      ctx.moveTo(cx, cy - r * 0.85); ctx.lineTo(cx, cy + r * 0.85);
      ctx.stroke();
      ctx.lineWidth = size * 0.02;
      for (let side of [-1, 1]) {
        ctx.beginPath();
        ctx.moveTo(cx, cy + r * 0.7);
        ctx.quadraticCurveTo(cx + side * r * 0.7, cy, cx + side * r * 0.2, cy - r * 0.85);
        ctx.stroke();
      }
      break;
    case "yin-yang":
      ctx.beginPath();
      ctx.arc(cx, cy, r * 0.75, 0, Math.PI * 2);
      ctx.fillStyle = "#e8e8e8"; ctx.fill();
      ctx.beginPath();
      ctx.arc(cx, cy, r * 0.75, Math.PI * 0.5, Math.PI * 1.5);
      ctx.fillStyle = col; ctx.fill();
      ctx.beginPath();
      ctx.arc(cx, cy - r * 0.375, r * 0.375, 0, Math.PI * 2);
      ctx.fillStyle = "#e8e8e8"; ctx.fill();
      ctx.beginPath();
      ctx.arc(cx, cy + r * 0.375, r * 0.375, 0, Math.PI * 2);
      ctx.fillStyle = col; ctx.fill();
      ctx.beginPath();
      ctx.arc(cx, cy - r * 0.375, r * 0.1, 0, Math.PI * 2);
      ctx.fillStyle = col; ctx.fill();
      ctx.beginPath();
      ctx.arc(cx, cy + r * 0.375, r * 0.1, 0, Math.PI * 2);
      ctx.fillStyle = "#e8e8e8"; ctx.fill();
      ctx.beginPath();
      ctx.arc(cx, cy, r * 0.75, 0, Math.PI * 2);
      ctx.lineWidth = size * 0.02; ctx.strokeStyle = col; ctx.stroke();
      break;
  }
}

function drawStar(ctx, x, y, r, points) {
  ctx.beginPath();
  for (let i = 0; i < points * 2; i++) {
    const ang = (i / (points * 2)) * Math.PI * 2 - Math.PI / 2;
    const sr = i % 2 === 0 ? r : r * 0.45;
    const method = i === 0 ? "moveTo" : "lineTo";
    ctx[method](x + Math.cos(ang) * sr, y + Math.sin(ang) * sr);
  }
  ctx.closePath(); ctx.fill();
}

function drawHexStar(ctx, x, y, r) {
  ctx.lineWidth = r * 0.08;
  for (let t = 0; t < 2; t++) {
    ctx.beginPath();
    for (let i = 0; i < 3; i++) {
      const ang = (i / 3) * Math.PI * 2 + (t ? Math.PI : 0) - Math.PI / 2;
      const method = i === 0 ? "moveTo" : "lineTo";
      ctx[method](x + Math.cos(ang) * r, y + Math.sin(ang) * r);
    }
    ctx.closePath(); ctx.stroke();
  }
}

// ---- Render Functions ----
function renderFilters() {
  const el = document.getElementById("filters");
  el.innerHTML = RELIGIONS.map(r =>
    `<button class="filter-btn${currentFilter === r ? ' active' : ''}" onclick="setFilter('${r}')">${r}</button>`
  ).join("");
}

function renderGallery() {
  const el = document.getElementById("gallery");
  const filtered = currentFilter === "All" ? SYMBOLS : SYMBOLS.filter(s => s.religion === currentFilter);
  el.innerHTML = filtered.map(s => {
    const col = RELIGION_COLOURS[s.religion];
    return `<div class="symbol-card" onclick="openDetail('${s.id}')">
      <canvas id="card-${s.id}" width="100" height="100"></canvas>
      <div class="card-name">${s.name}</div>
      <span class="card-religion" style="background:${col}22;color:${col};border:1px solid ${col}44">${s.religion}</span>
    </div>`;
  }).join("");
  filtered.forEach(s => {
    const c = document.getElementById("card-" + s.id);
    if (c) drawSymbol(c, s.id, 100);
  });
  addCardAccessibility();
  updateGalleryCount();
}

function setFilter(r) {
  currentFilter = r;
  renderFilters();
  renderGallery();
}

function showView(view) {
  currentView = view;
  document.querySelectorAll(".header-actions .btn").forEach((b, i) => {
    b.classList.toggle("active", (i === 0 && view === "gallery") || (i === 1 && view === "quiz") || (i === 2 && view === "info"));
  });
  document.getElementById("gallery").style.display = view === "gallery" ? "" : "none";
  document.getElementById("filters").style.display = view === "gallery" ? "" : "none";
  document.getElementById("quizPanel").classList.toggle("visible", view === "quiz");
  document.getElementById("infoPanel").classList.toggle("visible", view === "info");
  if (view === "quiz") startQuiz();
}

// ---- Detail View ----
let detailRevealedLayers = 0;

function openDetail(id) {
  const s = SYMBOLS.find(x => x.id === id);
  if (!s) return;
  detailRevealedLayers = 0;
  const col = RELIGION_COLOURS[s.religion];
  const layerNames = ["Surface: What It Looks Like", "Historical: Origin & History", "Theological: Spiritual Meaning", "Contemporary: Significance Today"];
  const layerColours = ["var(--layer-surface)", "var(--layer-history)", "var(--layer-theology)", "var(--layer-contemporary)"];

  const related = (s.related || []).map(rid => {
    const rs = SYMBOLS.find(x => x.id === rid);
    return rs ? `<span class="similar-chip" onclick="openDetail('${rs.id}')">${rs.name} (${rs.religion})</span>` : "";
  }).join("");

  document.getElementById("detailPanel").innerHTML = `
    <button class="detail-close" onclick="closeDetail()">&times;</button>
    <div class="detail-symbol-area">
      <canvas id="detail-canvas" width="180" height="180"></canvas>
      <div class="detail-title">${s.name}</div>
      <span class="detail-religion-badge" style="background:${col}22;color:${col};border:1px solid ${col}44">${s.religion}</span>
    </div>
    ${s.layers.map((txt, i) => `
      <div class="layer" id="layer-${i}" style="background:${layerColours[i]}11">
        <div class="layer-header"><span class="layer-dot" style="background:${layerColours[i]}"></span>${layerNames[i]}</div>
        <div class="layer-content">${txt}</div>
      </div>
    `).join("")}
    <button class="reveal-btn" id="revealBtn" onclick="revealNextLayer()">Reveal next layer</button>
    ${related ? `<div class="similar-symbols"><h3>Similar Symbols Across Faiths</h3><div class="similar-grid">${related}</div></div>` : ""}
  `;

  drawSymbol(document.getElementById("detail-canvas"), s.id, 180);
  document.getElementById("detailOverlay").classList.add("visible");
  revealNextLayer();
}

function revealNextLayer() {
  const layer = document.getElementById("layer-" + detailRevealedLayers);
  if (layer) {
    layer.classList.add("revealed");
    detailRevealedLayers++;
  }
  const btn = document.getElementById("revealBtn");
  if (detailRevealedLayers >= 4) {
    btn.textContent = "All layers revealed";
    btn.disabled = true;
  } else {
    const next = ["Historical: Origin & History", "Theological: Spiritual Meaning", "Contemporary: Significance Today"];
    btn.textContent = "Reveal next layer: " + next[detailRevealedLayers - 1];
  }
}

function closeDetail() {
  document.getElementById("detailOverlay").classList.remove("visible");
}

document.getElementById("detailOverlay").addEventListener("click", function(e) {
  if (e.target === this) closeDetail();
});

// ---- Quiz Mode ----
function startQuiz() {
  quizState = { current: null, score: 0, total: 0, answered: false };
  nextQuizQuestion();
}

function nextQuizQuestion() {
  quizState.answered = false;
  const s = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
  quizState.current = s;

  const qType = Math.random() < 0.5 ? "religion" : "name";
  let options;
  if (qType === "religion") {
    const religions = [...new Set(SYMBOLS.map(x => x.religion))];
    options = shuffle(religions).slice(0, 4);
    if (!options.includes(s.religion)) options[Math.floor(Math.random() * 4)] = s.religion;
  } else {
    const names = SYMBOLS.filter(x => x.religion === s.religion).map(x => x.name);
    const others = SYMBOLS.filter(x => x.id !== s.id).map(x => x.name);
    options = shuffle(others).slice(0, 3);
    options.push(s.name);
    options = shuffle(options);
  }

  const question = qType === "religion"
    ? "Which religion does this symbol belong to?"
    : "What is the name of this symbol?";
  const answer = qType === "religion" ? s.religion : s.name;

  const panel = document.getElementById("quizPanel");
  panel.innerHTML = `
    <div class="quiz-score">Score: ${quizState.score} / ${quizState.total}</div>
    <canvas id="quiz-canvas" width="160" height="160"></canvas>
    <div class="quiz-question">${question}</div>
    <div class="quiz-options">
      ${options.map(o => `<button class="quiz-opt" data-val="${o}" onclick="quizAnswer(this, '${o.replace(/'/g, "\\'")}', '${answer.replace(/'/g, "\\'")}')">${o}</button>`).join("")}
    </div>
    <div class="quiz-feedback" id="quizFeedback"></div>
    <button class="btn" id="quizNext" style="display:none;margin:10px auto" onclick="nextQuizQuestion()">Next Question</button>
  `;
  drawSymbol(document.getElementById("quiz-canvas"), s.id, 160);
}

function quizAnswer(btn, selected, correct) {
  if (quizState.answered) return;
  quizState.answered = true;
  quizState.total++;
  const isCorrect = selected === correct;
  if (isCorrect) quizState.score++;

  document.querySelectorAll(".quiz-opt").forEach(b => {
    if (b.dataset.val === correct) b.classList.add("correct");
    else if (b === btn && !isCorrect) b.classList.add("wrong");
    b.style.pointerEvents = "none";
  });

  document.getElementById("quizFeedback").textContent = isCorrect
    ? "Correct! Well done."
    : `Not quite. The answer is: ${correct}.`;
  document.getElementById("quizFeedback").style.color = isCorrect ? "var(--layer-contemporary)" : "var(--layer-theology)";
  document.querySelector(".quiz-score").textContent = `Score: ${quizState.score} / ${quizState.total}`;
  document.getElementById("quizNext").style.display = "inline-block";
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// ---- Gallery Count ----
function updateGalleryCount() {
  let countEl = document.getElementById("galleryCount");
  if (!countEl) {
    countEl = document.createElement("div");
    countEl.id = "galleryCount";
    countEl.className = "gallery-count";
    document.getElementById("gallery").parentNode.insertBefore(countEl, document.getElementById("gallery"));
  }
  const filtered = currentFilter === "All" ? SYMBOLS : SYMBOLS.filter(s => s.religion === currentFilter);
  if (currentView === "gallery") {
    countEl.style.display = "";
    countEl.textContent = currentFilter === "All"
      ? `Showing all ${filtered.length} symbols`
      : `Showing ${filtered.length} ${currentFilter} symbol${filtered.length !== 1 ? 's' : ''}`;
  } else {
    countEl.style.display = "none";
  }
}

// ---- Keyboard Navigation ----
document.addEventListener("keydown", function(e) {
  // Escape to close detail view
  if (e.key === "Escape") {
    const overlay = document.getElementById("detailOverlay");
    if (overlay.classList.contains("visible")) {
      closeDetail();
      e.preventDefault();
    }
  }

  // Space or Enter to reveal next layer when detail is open
  if (e.key === " " || e.key === "Enter") {
    const overlay = document.getElementById("detailOverlay");
    const btn = document.getElementById("revealBtn");
    if (overlay.classList.contains("visible") && btn && !btn.disabled && document.activeElement === btn) {
      revealNextLayer();
      e.preventDefault();
    }
  }
});

// Make symbol cards keyboard-accessible
function addCardAccessibility() {
  document.querySelectorAll(".symbol-card").forEach(card => {
    card.setAttribute("tabindex", "0");
    card.setAttribute("role", "button");
    card.addEventListener("keydown", function(e) {
      if (e.key === "Enter" || e.key === " ") {
        this.click();
        e.preventDefault();
      }
    });
  });
}

// ---- Init ----
renderFilters();
renderGallery();
updateGalleryCount();
</script>
</body>
</html>