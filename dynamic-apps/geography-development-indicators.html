<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Development Indicators Scatter Plot</title>
<style>
  :root {
    --geo-blue-dark: #1a3a5c;
    --geo-blue: #2563a8;
    --geo-blue-mid: #3b82c4;
    --geo-blue-light: #93c5e8;
    --geo-blue-pale: #dbeafe;
    --geo-green-dark: #1a4a2e;
    --geo-green: #16a34a;
    --geo-green-mid: #22c55e;
    --geo-green-light: #86efac;
    --geo-green-pale: #dcfce7;
    --geo-teal: #0d9488;
    --geo-teal-light: #99f6e4;
    --bg-page: #f0f7ff;
    --bg-card: #ffffff;
    --bg-sidebar: #f8faff;
    --text-dark: #0f2a47;
    --text-mid: #334155;
    --text-light: #64748b;
    --text-faint: #94a3b8;
    --border: #cbd5e1;
    --border-light: #e2e8f0;
    --shadow: 0 2px 8px rgba(37, 99, 168, 0.10);
    --shadow-lg: 0 4px 20px rgba(37, 99, 168, 0.14);
    --radius: 8px;
    --radius-lg: 12px;
    --col-africa: #e07b2a;
    --col-asia: #c0392b;
    --col-europe: #2563a8;
    --col-americas: #7c3aed;
    --col-oceania: #0d9488;
    --font: 'Segoe UI', Arial, sans-serif;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font);
    background: var(--bg-page);
    color: var(--text-dark);
    min-height: 100vh;
    font-size: 15px;
    line-height: 1.5;
  }

  /* Header */
  header {
    background: linear-gradient(135deg, var(--geo-blue-dark) 0%, var(--geo-blue) 60%, var(--geo-teal) 100%);
    color: #fff;
    padding: 18px 28px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: var(--shadow-lg);
    flex-wrap: wrap;
  }
  header .header-icon {
    font-size: 2rem;
    flex-shrink: 0;
  }
  header h1 {
    font-size: 1.45rem;
    font-weight: 700;
    letter-spacing: -0.01em;
  }
  header p.subtitle {
    font-size: 0.85rem;
    opacity: 0.82;
    margin-top: 2px;
  }
  header .badge {
    margin-left: auto;
    background: rgba(255,255,255,0.18);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 20px;
    padding: 4px 14px;
    font-size: 0.78rem;
    font-weight: 600;
    letter-spacing: 0.04em;
    white-space: nowrap;
  }

  /* Layout */
  .app-layout {
    display: grid;
    grid-template-columns: 260px 1fr 300px;
    grid-template-rows: auto 1fr;
    min-height: calc(100vh - 74px);
    gap: 0;
  }

  /* Controls panel (left) */
  .controls-panel {
    background: var(--bg-sidebar);
    border-right: 1px solid var(--border-light);
    padding: 20px 16px;
    overflow-y: auto;
    grid-row: 1 / 3;
  }

  /* Main chart area */
  .chart-area {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    min-width: 0;
  }

  /* Info panel (right) */
  .info-panel {
    background: var(--bg-sidebar);
    border-left: 1px solid var(--border-light);
    padding: 20px 16px;
    overflow-y: auto;
    grid-row: 1 / 3;
  }

  /* Cards */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--radius);
    padding: 14px;
    box-shadow: var(--shadow);
    margin-bottom: 14px;
  }
  .card:last-child { margin-bottom: 0; }
  .card-title {
    font-size: 0.78rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--geo-blue);
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .card-title .icon { font-size: 0.9rem; }

  /* Form elements */
  label.field-label {
    display: block;
    font-size: 0.78rem;
    font-weight: 600;
    color: var(--text-mid);
    margin-bottom: 4px;
    margin-top: 10px;
  }
  label.field-label:first-of-type { margin-top: 0; }

  select {
    width: 100%;
    padding: 7px 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: #fff;
    color: var(--text-dark);
    font-size: 0.85rem;
    font-family: var(--font);
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%232563a8' d='M1 1l5 5 5-5'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    padding-right: 28px;
    transition: border-color 0.15s;
  }
  select:focus {
    outline: none;
    border-color: var(--geo-blue-mid);
    box-shadow: 0 0 0 3px var(--geo-blue-pale);
  }

  /* Toggle options */
  .toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px solid var(--border-light);
  }
  .toggle-row:last-child { border-bottom: none; }
  .toggle-label {
    font-size: 0.83rem;
    color: var(--text-mid);
  }

  /* Custom toggle switch */
  .toggle {
    position: relative;
    width: 36px;
    height: 20px;
    flex-shrink: 0;
  }
  .toggle input { opacity: 0; width: 0; height: 0; position: absolute; }
  .toggle-track {
    position: absolute;
    inset: 0;
    background: var(--border);
    border-radius: 20px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .toggle input:checked + .toggle-track { background: var(--geo-blue); }
  .toggle-track::after {
    content: '';
    position: absolute;
    left: 2px;
    top: 2px;
    width: 16px;
    height: 16px;
    background: #fff;
    border-radius: 50%;
    transition: transform 0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }
  .toggle input:checked + .toggle-track::after { transform: translateX(16px); }

  /* Continent checkboxes */
  .continent-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 0;
    cursor: pointer;
    border-radius: 4px;
    font-size: 0.83rem;
    color: var(--text-mid);
  }
  .continent-item:hover { color: var(--text-dark); }
  .cont-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
    border: 2px solid rgba(0,0,0,0.15);
  }
  .cont-check {
    width: 15px;
    height: 15px;
    accent-color: var(--geo-blue);
    cursor: pointer;
    flex-shrink: 0;
  }

  /* Chart container */
  .chart-container {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
    flex: 1;
    min-height: 420px;
  }

  #scatterSvg {
    width: 100%;
    height: 100%;
    display: block;
  }

  /* Stats bar */
  .stats-bar {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .stat-chip {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: 20px;
    padding: 5px 14px;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: var(--shadow);
  }
  .stat-chip .stat-label { color: var(--text-light); }
  .stat-chip .stat-value { font-weight: 700; color: var(--geo-blue-dark); }

  /* Tooltip */
  #tooltip {
    position: fixed;
    background: var(--geo-blue-dark);
    color: #fff;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 0.82rem;
    pointer-events: none;
    z-index: 1000;
    max-width: 220px;
    box-shadow: var(--shadow-lg);
    display: none;
    line-height: 1.6;
  }
  #tooltip .tt-name {
    font-weight: 700;
    font-size: 0.9rem;
    margin-bottom: 4px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    padding-bottom: 4px;
  }
  #tooltip .tt-row { display: flex; justify-content: space-between; gap: 12px; }
  #tooltip .tt-key { opacity: 0.75; }
  #tooltip .tt-val { font-weight: 600; }

  /* Info panel content */
  .info-welcome {
    text-align: center;
    padding: 24px 8px;
    color: var(--text-light);
  }
  .info-welcome .welcome-icon { font-size: 3rem; margin-bottom: 10px; }
  .info-welcome p { font-size: 0.85rem; line-height: 1.6; }

  .country-card h2 {
    font-size: 1.15rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 4px;
  }
  .country-card .country-meta {
    font-size: 0.78rem;
    color: var(--text-light);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .country-card .cont-badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 12px;
    font-size: 0.72rem;
    font-weight: 700;
    color: #fff;
  }

  .data-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 12px;
  }
  .data-cell {
    background: var(--bg-page);
    border-radius: 6px;
    padding: 8px 10px;
    border: 1px solid var(--border-light);
  }
  .data-cell .dc-label {
    font-size: 0.68rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-faint);
    margin-bottom: 2px;
  }
  .data-cell .dc-value {
    font-size: 0.92rem;
    font-weight: 700;
    color: var(--text-dark);
  }

  /* Development bar */
  .dev-bar-wrap { margin-bottom: 12px; }
  .dev-bar-label {
    font-size: 0.75rem;
    color: var(--text-light);
    margin-bottom: 4px;
    display: flex;
    justify-content: space-between;
  }
  .dev-bar-track {
    height: 8px;
    background: var(--border-light);
    border-radius: 4px;
    overflow: hidden;
  }
  .dev-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.4s ease;
  }

  /* Info sections */
  .info-section {
    margin-bottom: 14px;
  }
  .info-section h3 {
    font-size: 0.78rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--geo-blue);
    margin-bottom: 8px;
  }
  .info-section p {
    font-size: 0.82rem;
    color: var(--text-mid);
    line-height: 1.6;
  }

  /* Legend */
  .legend-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4px 8px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.78rem;
    color: var(--text-mid);
  }
  .legend-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* Correlation display */
  .corr-display {
    text-align: center;
    padding: 10px;
    background: var(--geo-blue-pale);
    border-radius: 8px;
    border: 1px solid var(--geo-blue-light);
  }
  .corr-value {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--geo-blue-dark);
    line-height: 1;
  }
  .corr-label {
    font-size: 0.72rem;
    color: var(--geo-blue);
    margin-top: 2px;
    font-weight: 600;
  }
  .corr-desc {
    font-size: 0.75rem;
    color: var(--text-mid);
    margin-top: 6px;
    font-style: italic;
  }

  /* Axis labels on SVG */
  .axis-label { font-family: var(--font); }

  /* Responsive */
  @media (max-width: 1100px) {
    .app-layout {
      grid-template-columns: 220px 1fr 260px;
    }
  }
  @media (max-width: 768px) {
    .app-layout {
      grid-template-columns: 1fr;
      grid-template-rows: auto;
    }
    .controls-panel {
      grid-row: auto;
      border-right: none;
      border-bottom: 1px solid var(--border-light);
    }
    .info-panel {
      grid-row: auto;
      border-left: none;
      border-top: 1px solid var(--border-light);
    }
    .chart-container { min-height: 320px; }
    header h1 { font-size: 1.1rem; }
    header .badge { display: none; }
  }

  /* Scrollbar styling */
  .controls-panel::-webkit-scrollbar,
  .info-panel::-webkit-scrollbar { width: 4px; }
  .controls-panel::-webkit-scrollbar-track,
  .info-panel::-webkit-scrollbar-track { background: transparent; }
  .controls-panel::-webkit-scrollbar-thumb,
  .info-panel::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* SVG data point styles */
  .data-point {
    cursor: pointer;
    transition: opacity 0.15s;
  }
  .data-point circle {
    transition: r 0.15s, filter 0.15s;
  }
  .data-point:hover circle {
    filter: brightness(1.15) drop-shadow(0 2px 6px rgba(0,0,0,0.3));
  }
  .data-point.selected circle {
    stroke-width: 3;
    stroke: #fff;
    filter: drop-shadow(0 0 6px rgba(0,0,0,0.4));
  }

  /* Indicator info tab */
  .indicator-tabs {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
    margin-bottom: 8px;
  }
  .ind-tab {
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 0.72rem;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--border);
    background: #fff;
    color: var(--text-mid);
    transition: all 0.15s;
  }
  .ind-tab.active, .ind-tab:hover {
    background: var(--geo-blue);
    color: #fff;
    border-color: var(--geo-blue);
  }

  .ind-info-box {
    background: var(--geo-green-pale);
    border: 1px solid var(--geo-green-light);
    border-radius: 6px;
    padding: 10px 12px;
    font-size: 0.8rem;
    color: var(--geo-green-dark);
    line-height: 1.6;
    display: none;
  }
  .ind-info-box.active { display: block; }
  .ind-info-box strong { color: var(--geo-green-dark); }
</style>
</head>
<body>

<header>
  <div class="header-icon">üåç</div>
  <div>
    <h1>Development Indicators Scatter Plot</h1>
    <p class="subtitle">Compare countries using key development measures. Click a data point to explore country details.</p>
  </div>
  <div class="badge">GCSE Geography</div>
</header>

<div class="app-layout">

  <!-- LEFT: Controls -->
  <aside class="controls-panel">

    <div class="card">
      <div class="card-title"><span class="icon">üìä</span> Axes</div>
      <label class="field-label" for="xAxis">X Axis</label>
      <select id="xAxis">
        <option value="gdp">GDP per Capita (USD)</option>
        <option value="hdi" selected>HDI</option>
        <option value="literacy">Literacy Rate %</option>
        <option value="lifeExp">Life Expectancy</option>
        <option value="birthRate">Birth Rate (per 1,000)</option>
        <option value="deathRate">Death Rate (per 1,000)</option>
        <option value="infantMort">Infant Mortality (per 1,000)</option>
        <option value="cleanWater">Access to Clean Water %</option>
        <option value="co2">CO2 Emissions (tonnes/capita)</option>
        <option value="internet">Internet Users %</option>
      </select>

      <label class="field-label" for="yAxis">Y Axis</label>
      <select id="yAxis">
        <option value="gdp" selected>GDP per Capita (USD)</option>
        <option value="hdi">HDI</option>
        <option value="literacy">Literacy Rate %</option>
        <option value="lifeExp">Life Expectancy</option>
        <option value="birthRate">Birth Rate (per 1,000)</option>
        <option value="deathRate">Death Rate (per 1,000)</option>
        <option value="infantMort">Infant Mortality (per 1,000)</option>
        <option value="cleanWater">Access to Clean Water %</option>
        <option value="co2">CO2 Emissions (tonnes/capita)</option>
        <option value="internet">Internet Users %</option>
      </select>
    </div>

    <div class="card">
      <div class="card-title"><span class="icon">‚öôÔ∏è</span> Options</div>
      <div class="toggle-row">
        <span class="toggle-label">Trend line</span>
        <label class="toggle">
          <input type="checkbox" id="toggleTrend" checked>
          <span class="toggle-track"></span>
        </label>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Country labels</span>
        <label class="toggle">
          <input type="checkbox" id="toggleLabels">
          <span class="toggle-track"></span>
        </label>
      </div>
      <div class="toggle-row">
        <span class="toggle-label">Show correlation</span>
        <label class="toggle">
          <input type="checkbox" id="toggleCorr" checked>
          <span class="toggle-track"></span>
        </label>
      </div>
    </div>

    <div class="card">
      <div class="card-title"><span class="icon">üó∫Ô∏è</span> Continents</div>
      <div id="continentFilters"></div>
    </div>

    <div class="card">
      <div class="card-title"><span class="icon">üîë</span> Legend</div>
      <div class="legend-grid" id="legend"></div>
    </div>

  </aside>

  <!-- CENTRE: Chart -->
  <main class="chart-area">

    <div class="stats-bar" id="statsBar">
      <div class="stat-chip">
        <span class="stat-label">Countries shown:</span>
        <span class="stat-value" id="statCount">30</span>
      </div>
      <div class="stat-chip" id="corrChip">
        <span class="stat-label">Correlation (r):</span>
        <span class="stat-value" id="statCorr">-</span>
      </div>
      <div class="stat-chip">
        <span class="stat-label">Relationship:</span>
        <span class="stat-value" id="statRel">-</span>
      </div>
    </div>

    <div class="chart-container" id="chartContainer">
      <svg id="scatterSvg" xmlns="http://www.w3.org/2000/svg"></svg>
    </div>

  </main>

  <!-- RIGHT: Info panel -->
  <aside class="info-panel" id="infoPanel">

    <div id="welcomeView">
      <div class="info-welcome">
        <div class="welcome-icon">üñ±Ô∏è</div>
        <p>Click any country on the scatter plot to view its development data and analysis.</p>
      </div>

      <div class="card">
        <div class="card-title"><span class="icon">üìö</span> Indicator Guide</div>
        <div class="indicator-tabs">
          <div class="ind-tab active" onclick="showIndInfo('hdi')">HDI</div>
          <div class="ind-tab" onclick="showIndInfo('gdp')">GDP</div>
          <div class="ind-tab" onclick="showIndInfo('gap')">Dev Gap</div>
          <div class="ind-tab" onclick="showIndInfo('birth')">Birth Rate</div>
          <div class="ind-tab" onclick="showIndInfo('life')">Life Exp.</div>
        </div>
        <div class="ind-info-box active" id="info-hdi">
          <strong>Human Development Index (HDI)</strong><br>
          A composite measure combining life expectancy, education (mean and expected years of schooling) and income (GNI per capita). Scores range from 0 to 1. Countries above 0.8 are classified as "very high" development. The HDI was developed by the UNDP in 1990 to provide a broader picture of development than income alone.
        </div>
        <div class="ind-info-box" id="info-gdp">
          <strong>GDP per Capita (USD)</strong><br>
          Gross Domestic Product divided by the total population. It measures the average economic output per person and is used as a proxy for living standards. However, GDP does not account for inequality within countries. A high GDP per capita does not guarantee that wealth is shared equally.
        </div>
        <div class="ind-info-box" id="info-gap">
          <strong>The Development Gap</strong><br>
          The difference in wealth, health and living standards between HICs (High Income Countries) and LICs (Low Income Countries). The gap can be measured using many indicators. Despite some countries experiencing rapid development (e.g. the BRICS nations), a significant gap persists. The Brandt Line (1980) divided the world into a wealthy "North" and developing "South".
        </div>
        <div class="ind-info-box" id="info-birth">
          <strong>Birth Rate</strong><br>
          The number of live births per 1,000 people per year. In LICs, birth rates tend to be high due to limited access to family planning, high child mortality, and cultural factors. As countries develop, birth rates typically fall (Demographic Transition Model stages). High birth rates can strain resources and slow economic growth.
        </div>
        <div class="ind-info-box" id="info-life">
          <strong>Life Expectancy</strong><br>
          The average number of years a newborn can expect to live, given current mortality rates. It reflects access to healthcare, nutrition, sanitation and the absence of conflict. HICs typically exceed 80 years; some LICs fall below 65. Life expectancy is one of the three components of the HDI.
        </div>
      </div>

      <div class="card">
        <div class="card-title"><span class="icon">üí°</span> How to Use</div>
        <div class="info-section">
          <p>Select different indicators using the dropdown menus on the left. The scatter plot will update automatically. Use the trend line and correlation coefficient (r) to identify and describe relationships between indicators.</p>
        </div>
        <div class="info-section">
          <p style="font-size:0.78rem;color:var(--text-faint)">Data shown is approximate, sourced from World Bank and UNDP datasets (c. 2022-2023).</p>
        </div>
      </div>
    </div>

    <div id="countryView" style="display:none;"></div>

  </aside>

</div>

<div id="tooltip"></div>

<script>
// =============================================
// DATA
// =============================================
const INDICATORS = {
  gdp:        { label: 'GDP per Capita (USD)',        unit: '$',    fmt: v => '$' + v.toLocaleString(),                   short: 'GDP/cap' },
  hdi:        { label: 'HDI',                         unit: '',     fmt: v => v.toFixed(3),                                short: 'HDI' },
  literacy:   { label: 'Literacy Rate %',             unit: '%',    fmt: v => v.toFixed(1) + '%',                          short: 'Literacy' },
  lifeExp:    { label: 'Life Expectancy (years)',      unit: 'yrs',  fmt: v => v.toFixed(1),                                short: 'Life Exp.' },
  birthRate:  { label: 'Birth Rate (per 1,000)',       unit: '/1k',  fmt: v => v.toFixed(1),                                short: 'Birth Rate' },
  deathRate:  { label: 'Death Rate (per 1,000)',       unit: '/1k',  fmt: v => v.toFixed(1),                                short: 'Death Rate' },
  infantMort: { label: 'Infant Mortality (per 1,000)', unit: '/1k',  fmt: v => v.toFixed(1),                                short: 'Infant Mort.' },
  cleanWater: { label: 'Access to Clean Water %',     unit: '%',    fmt: v => v.toFixed(1) + '%',                          short: 'Clean Water' },
  co2:        { label: 'CO2 Emissions (t/capita)',    unit: 't',    fmt: v => v.toFixed(2) + 't',                          short: 'CO2/cap' },
  internet:   { label: 'Internet Users %',            unit: '%',    fmt: v => v.toFixed(1) + '%',                          short: 'Internet' }
};

const CONTINENTS = {
  Africa:   { colour: '#e07b2a', label: 'Africa' },
  Asia:     { colour: '#c0392b', label: 'Asia' },
  Europe:   { colour: '#2563a8', label: 'Europe' },
  Americas: { colour: '#7c3aed', label: 'Americas' },
  Oceania:  { colour: '#0d9488', label: 'Oceania' }
};

// gdp, hdi, literacy, lifeExp, birthRate, deathRate, infantMort, cleanWater, co2, internet
const COUNTRIES = [
  { name: 'Norway',       continent: 'Europe',   gdp: 89090, hdi: 0.966, literacy: 99.0, lifeExp: 82.9, birthRate: 10.2, deathRate: 7.8,  infantMort: 2.0,  cleanWater: 99.8, co2: 8.30,  internet: 98.0 },
  { name: 'Australia',    continent: 'Oceania',  gdp: 64840, hdi: 0.946, literacy: 99.0, lifeExp: 83.4, birthRate: 12.8, deathRate: 6.7,  infantMort: 3.1,  cleanWater: 99.9, co2: 15.10, internet: 90.0 },
  { name: 'Germany',      continent: 'Europe',   gdp: 53390, hdi: 0.942, literacy: 99.0, lifeExp: 81.2, birthRate: 10.0, deathRate: 11.5, infantMort: 3.1,  cleanWater: 99.7, co2: 8.10,  internet: 92.4 },
  { name: 'USA',          continent: 'Americas', gdp: 76990, hdi: 0.927, literacy: 99.0, lifeExp: 79.1, birthRate: 11.2, deathRate: 8.8,  infantMort: 5.4,  cleanWater: 99.2, co2: 14.44, internet: 91.8 },
  { name: 'Japan',        continent: 'Asia',     gdp: 42440, hdi: 0.920, literacy: 99.0, lifeExp: 84.3, birthRate: 7.3,  deathRate: 11.6, infantMort: 1.8,  cleanWater: 99.8, co2: 8.54,  internet: 93.0 },
  { name: 'UK',           continent: 'Europe',   gdp: 46740, hdi: 0.940, literacy: 99.0, lifeExp: 81.3, birthRate: 11.1, deathRate: 9.4,  infantMort: 3.6,  cleanWater: 99.9, co2: 5.15,  internet: 94.8 },
  { name: 'Argentina',    continent: 'Americas', gdp: 13690, hdi: 0.849, literacy: 99.0, lifeExp: 76.5, birthRate: 16.0, deathRate: 7.5,  infantMort: 8.8,  cleanWater: 99.2, co2: 3.96,  internet: 79.0 },
  { name: 'Mexico',       continent: 'Americas', gdp: 11310, hdi: 0.781, literacy: 94.5, lifeExp: 74.5, birthRate: 17.2, deathRate: 6.5,  infantMort: 12.1, cleanWater: 97.7, co2: 3.37,  internet: 72.0 },
  { name: 'Brazil',       continent: 'Americas', gdp: 9060,  hdi: 0.754, literacy: 94.2, lifeExp: 75.2, birthRate: 14.5, deathRate: 6.7,  infantMort: 13.0, cleanWater: 97.7, co2: 2.25,  internet: 81.3 },
  { name: 'China',        continent: 'Asia',     gdp: 12720, hdi: 0.788, literacy: 97.5, lifeExp: 78.2, birthRate: 10.6, deathRate: 7.3,  infantMort: 6.6,  cleanWater: 97.1, co2: 8.05,  internet: 75.6 },
  { name: 'South Africa', continent: 'Africa',   gdp: 7050,  hdi: 0.713, literacy: 95.0, lifeExp: 64.9, birthRate: 20.1, deathRate: 9.5,  infantMort: 27.5, cleanWater: 91.5, co2: 7.39,  internet: 68.2 },
  { name: 'Ukraine',      continent: 'Europe',   gdp: 4530,  hdi: 0.773, literacy: 99.8, lifeExp: 71.8, birthRate: 8.1,  deathRate: 14.8, infantMort: 7.2,  cleanWater: 97.7, co2: 3.80,  internet: 79.0 },
  { name: 'Egypt',        continent: 'Africa',   gdp: 4260,  hdi: 0.731, literacy: 73.1, lifeExp: 72.5, birthRate: 24.5, deathRate: 6.2,  infantMort: 17.6, cleanWater: 98.0, co2: 2.19,  internet: 71.9 },
  { name: 'Vietnam',      continent: 'Asia',     gdp: 4160,  hdi: 0.726, literacy: 95.8, lifeExp: 73.7, birthRate: 15.5, deathRate: 6.7,  infantMort: 16.5, cleanWater: 97.5, co2: 3.81,  internet: 73.2 },
  { name: 'Bolivia',      continent: 'Americas', gdp: 3620,  hdi: 0.698, literacy: 92.5, lifeExp: 71.1, birthRate: 21.9, deathRate: 6.4,  infantMort: 27.3, cleanWater: 91.0, co2: 1.97,  internet: 52.3 },
  { name: 'India',        continent: 'Asia',     gdp: 2390,  hdi: 0.633, literacy: 76.3, lifeExp: 70.0, birthRate: 18.7, deathRate: 7.4,  infantMort: 27.7, cleanWater: 94.1, co2: 1.89,  internet: 46.3 },
  { name: 'Ghana',        continent: 'Africa',   gdp: 2370,  hdi: 0.632, literacy: 79.0, lifeExp: 64.1, birthRate: 30.8, deathRate: 7.1,  infantMort: 34.9, cleanWater: 79.8, co2: 0.59,  internet: 53.0 },
  { name: 'Pakistan',     continent: 'Asia',     gdp: 1650,  hdi: 0.544, literacy: 57.9, lifeExp: 67.5, birthRate: 27.9, deathRate: 7.4,  infantMort: 56.5, cleanWater: 91.4, co2: 0.91,  internet: 36.7 },
  { name: 'Indonesia',    continent: 'Asia',     gdp: 4790,  hdi: 0.705, literacy: 96.0, lifeExp: 71.7, birthRate: 18.2, deathRate: 6.7,  infantMort: 19.2, cleanWater: 93.6, co2: 2.30,  internet: 62.1 },
  { name: 'Cambodia',     continent: 'Asia',     gdp: 1780,  hdi: 0.593, literacy: 84.7, lifeExp: 69.9, birthRate: 23.3, deathRate: 6.6,  infantMort: 25.5, cleanWater: 78.9, co2: 0.69,  internet: 59.0 },
  { name: 'Kenya',        continent: 'Africa',   gdp: 2060,  hdi: 0.601, literacy: 82.6, lifeExp: 67.9, birthRate: 29.7, deathRate: 5.6,  infantMort: 31.4, cleanWater: 72.7, co2: 0.40,  internet: 29.0 },
  { name: 'Nepal',        continent: 'Asia',     gdp: 1230,  hdi: 0.601, literacy: 68.6, lifeExp: 72.1, birthRate: 18.1, deathRate: 5.8,  infantMort: 27.8, cleanWater: 91.8, co2: 0.44,  internet: 46.1 },
  { name: 'Bangladesh',   continent: 'Asia',     gdp: 2730,  hdi: 0.661, literacy: 75.6, lifeExp: 73.6, birthRate: 18.9, deathRate: 5.6,  infantMort: 25.0, cleanWater: 97.0, co2: 0.60,  internet: 44.0 },
  { name: 'Nigeria',      continent: 'Africa',   gdp: 2190,  hdi: 0.535, literacy: 62.0, lifeExp: 53.6, birthRate: 38.0, deathRate: 11.5, infantMort: 72.0, cleanWater: 72.9, co2: 0.65,  internet: 55.4 },
  { name: 'Tanzania',     continent: 'Africa',   gdp: 1140,  hdi: 0.532, literacy: 78.0, lifeExp: 68.2, birthRate: 36.8, deathRate: 6.0,  infantMort: 38.7, cleanWater: 56.3, co2: 0.23,  internet: 20.0 },
  { name: 'Ethiopia',     continent: 'Africa',   gdp: 1020,  hdi: 0.492, literacy: 51.8, lifeExp: 66.4, birthRate: 34.9, deathRate: 6.7,  infantMort: 39.9, cleanWater: 60.4, co2: 0.18,  internet: 17.8 },
  { name: 'Haiti',        continent: 'Americas', gdp: 1710,  hdi: 0.535, literacy: 61.7, lifeExp: 64.0, birthRate: 24.2, deathRate: 8.5,  infantMort: 45.1, cleanWater: 67.3, co2: 0.30,  internet: 42.5 },
  { name: 'Mozambique',   continent: 'Africa',   gdp: 540,   hdi: 0.446, literacy: 63.4, lifeExp: 62.7, birthRate: 38.7, deathRate: 8.9,  infantMort: 56.9, cleanWater: 52.7, co2: 0.16,  internet: 22.4 },
  { name: 'Afghanistan',  continent: 'Asia',     gdp: 380,   hdi: 0.478, literacy: 43.0, lifeExp: 63.3, birthRate: 36.5, deathRate: 6.5,  infantMort: 50.0, cleanWater: 77.6, co2: 0.24,  internet: 18.4 },
  { name: 'Niger',        continent: 'Africa',   gdp: 590,   hdi: 0.394, literacy: 37.3, lifeExp: 62.9, birthRate: 47.0, deathRate: 8.1,  infantMort: 68.0, cleanWater: 54.6, co2: 0.10,  internet: 16.6 },
  { name: 'Chad',         continent: 'Africa',   gdp: 710,   hdi: 0.394, literacy: 26.8, lifeExp: 55.1, birthRate: 43.3, deathRate: 10.2, infantMort: 74.0, cleanWater: 42.5, co2: 0.11,  internet: 23.6 }
];

// =============================================
// STATE
// =============================================
let state = {
  xKey: 'hdi',
  yKey: 'gdp',
  showTrend: true,
  showLabels: false,
  showCorr: true,
  active–∫–æ–Ω—Ç–∏–Ωents: new Set(Object.keys(CONTINENTS)),
  selectedCountry: null
};

// Alias for clarity
const activeConts = () => state.activeontinents || state.activeContinents;

// =============================================
// INIT
// =============================================
function init() {
  state.activeContinents = new Set(Object.keys(CONTINENTS));

  buildContinentFilters();
  buildLegend();
  bindControls();
  render();
}

function buildContinentFilters() {
  const container = document.getElementById('continentFilters');
  container.innerHTML = '';
  Object.entries(CONTINENTS).forEach(([key, info]) => {
    const item = document.createElement('label');
    item.className = 'continent-item';
    item.innerHTML = `
      <input type="checkbox" class="cont-check" data-cont="${key}" checked>
      <span class="cont-dot" style="background:${info.colour}"></span>
      <span>${info.label}</span>
    `;
    container.appendChild(item);
    item.querySelector('input').addEventListener('change', e => {
      if (e.target.checked) {
        state.activeContinents.add(key);
      } else {
        state.activeContinents.delete(key);
      }
      render();
    });
  });
}

function buildLegend() {
  const container = document.getElementById('legend');
  container.innerHTML = '';
  Object.entries(CONTINENTS).forEach(([key, info]) => {
    const item = document.createElement('div');
    item.className = 'legend-item';
    item.innerHTML = `<span class="legend-dot" style="background:${info.colour}"></span><span>${info.label}</span>`;
    container.appendChild(item);
  });
}

function bindControls() {
  document.getElementById('xAxis').addEventListener('change', e => {
    state.xKey = e.target.value;
    render();
  });
  document.getElementById('yAxis').addEventListener('change', e => {
    state.yKey = e.target.value;
    render();
  });
  document.getElementById('toggleTrend').addEventListener('change', e => {
    state.showTrend = e.target.checked;
    render();
  });
  document.getElementById('toggleLabels').addEventListener('change', e => {
    state.showLabels = e.target.checked;
    render();
  });
  document.getElementById('toggleCorr').addEventListener('change', e => {
    state.showCorr = e.target.checked;
    updateStats(getVisibleCountries());
  });
}

// =============================================
// UTILS
// =============================================
function getVisibleCountries() {
  return COUNTRIES.filter(c => state.activeContinents.has(c.continent));
}

function calcCorrelation(data, xKey, yKey) {
  const n = data.length;
  if (n < 2) return 0;
  const xs = data.map(d => d[xKey]);
  const ys = data.map(d => d[yKey]);
  const mx = xs.reduce((a,b) => a+b, 0) / n;
  const my = ys.reduce((a,b) => a+b, 0) / n;
  const num = xs.reduce((s,x,i) => s + (x-mx)*(ys[i]-my), 0);
  const denX = Math.sqrt(xs.reduce((s,x) => s + (x-mx)**2, 0));
  const denY = Math.sqrt(ys.reduce((s,y) => s + (y-my)**2, 0));
  return (denX * denY === 0) ? 0 : num / (denX * denY);
}

function calcLinearRegression(data, xKey, yKey) {
  const n = data.length;
  if (n < 2) return null;
  const xs = data.map(d => d[xKey]);
  const ys = data.map(d => d[yKey]);
  const mx = xs.reduce((a,b) => a+b,0)/n;
  const my = ys.reduce((a,b) => a+b,0)/n;
  const num = xs.reduce((s,x,i) => s + (x-mx)*(ys[i]-my), 0);
  const den = xs.reduce((s,x) => s + (x-mx)**2, 0);
  const slope = den === 0 ? 0 : num/den;
  const intercept = my - slope * mx;
  return { slope, intercept };
}

function corrDescription(r) {
  const a = Math.abs(r);
  let strength = a < 0.2 ? 'very weak' : a < 0.4 ? 'weak' : a < 0.6 ? 'moderate' : a < 0.8 ? 'strong' : 'very strong';
  let dir = r > 0 ? 'positive' : 'negative';
  return strength + ' ' + dir;
}

function niceRange(min, max) {
  const range = max - min;
  const pad = range * 0.08 || Math.abs(max) * 0.1 || 1;
  return { lo: min - pad, hi: max + pad };
}

function devLevel(hdi) {
  if (hdi >= 0.8) return { label: 'Very High', colour: '#16a34a' };
  if (hdi >= 0.7) return { label: 'High', colour: '#2563a8' };
  if (hdi >= 0.55) return { label: 'Medium', colour: '#d97706' };
  return { label: 'Low', colour: '#dc2626' };
}

// =============================================
// RENDER
// =============================================
function render() {
  const svg = document.getElementById('scatterSvg');
  const container = document.getElementById('chartContainer');
  const rect = container.getBoundingClientRect();

  const W = rect.width || 600;
  const H = rect.height || 450;
  const margin = { top: 30, right: 24, bottom: 58, left: 72 };
  const plotW = W - margin.left - margin.right;
  const plotH = H - margin.top - margin.bottom;

  const visible = getVisibleCountries();
  const xInd = INDICATORS[state.xKey];
  const yInd = INDICATORS[state.yKey];

  // Ranges
  const xVals = visible.map(d => d[state.xKey]);
  const yVals = visible.map(d => d[state.yKey]);
  const xRange = niceRange(Math.min(...xVals), Math.max(...xVals));
  const yRange = niceRange(Math.min(...yVals), Math.max(...yVals));

  const xScale = v => margin.left + (v - xRange.lo) / (xRange.hi - xRange.lo) * plotW;
  const yScale = v => margin.top + plotH - (v - yRange.lo) / (yRange.hi - yRange.lo) * plotH;

  // Build SVG
  svg.setAttribute('viewBox', `0 0 ${W} ${H}`);
  svg.setAttribute('width', W);
  svg.setAttribute('height', H);

  let html = `<defs>
    <clipPath id="plotClip">
      <rect x="${margin.left}" y="${margin.top}" width="${plotW}" height="${plotH}"/>
    </clipPath>
  </defs>`;

  // Background
  html += `<rect x="${margin.left}" y="${margin.top}" width="${plotW}" height="${plotH}" fill="#f8faff" rx="4"/>`;

  // Grid lines
  const tickCount = 6;
  for (let i = 0; i <= tickCount; i++) {
    const frac = i / tickCount;
    const xv = xRange.lo + frac * (xRange.hi - xRange.lo);
    const yv = yRange.lo + frac * (yRange.hi - yRange.lo);
    const px = xScale(xv);
    const py = yScale(yv);
    html += `<line x1="${px}" y1="${margin.top}" x2="${px}" y2="${margin.top+plotH}" stroke="#e2e8f0" stroke-width="1"/>`;
    html += `<line x1="${margin.left}" y1="${py}" x2="${margin.left+plotW}" y2="${py}" stroke="#e2e8f0" stroke-width="1"/>`;
    // X tick labels
    let xLabel = xv;
    if (state.xKey === 'gdp') xLabel = xv >= 1000 ? (xv/1000).toFixed(0)+'k' : xv.toFixed(0);
    else if (xInd.unit === '%') xLabel = xv.toFixed(0)+'%';
    else xLabel = xv.toFixed(state.xKey === 'hdi' ? 2 : 1);
    html += `<text x="${px}" y="${margin.top+plotH+16}" text-anchor="middle" font-size="10" fill="#94a3b8" font-family="${getComputedStyle(document.body).fontFamily}">${xLabel}</text>`;
    // Y tick labels
    let yLabel = yv;
    if (state.yKey === 'gdp') yLabel = yv >= 1000 ? (yv/1000).toFixed(0)+'k' : yv.toFixed(0);
    else if (yInd.unit === '%') yLabel = yv.toFixed(0)+'%';
    else yLabel = yv.toFixed(state.yKey === 'hdi' ? 2 : 1);
    html += `<text x="${margin.left-8}" y="${py+4}" text-anchor="end" font-size="10" fill="#94a3b8" font-family="${getComputedStyle(document.body).fontFamily}">${yLabel}</text>`;
  }

  // Axis lines
  html += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${margin.top+plotH}" stroke="#94a3b8" stroke-width="1.5"/>`;
  html += `<line x1="${margin.left}" y1="${margin.top+plotH}" x2="${margin.left+plotW}" y2="${margin.top+plotH}" stroke="#94a3b8" stroke-width="1.5"/>`;

  // Axis labels
  html += `<text x="${margin.left + plotW/2}" y="${H-8}" text-anchor="middle" font-size="12" font-weight="600" fill="#334155" font-family="${getComputedStyle(document.body).fontFamily}">${xInd.label}</text>`;
  html += `<text x="${16}" y="${margin.top + plotH/2}" text-anchor="middle" font-size="12" font-weight="600" fill="#334155" font-family="${getComputedStyle(document.body).fontFamily}" transform="rotate(-90, 16, ${margin.top + plotH/2})">${yInd.label}</text>`;

  // Trend line
  if (state.showTrend && visible.length >= 2) {
    const reg = calcLinearRegression(visible, state.xKey, state.yKey);
    if (reg) {
      const x1v = xRange.lo;
      const x2v = xRange.hi;
      const y1v = reg.slope * x1v + reg.intercept;
      const y2v = reg.slope * x2v + reg.intercept;
      const tx1 = xScale(x1v);
      const ty1 = Math.max(margin.top, Math.min(margin.top + plotH, yScale(y1v)));
      const tx2 = xScale(x2v);
      const ty2 = Math.max(margin.top, Math.min(margin.top + plotH, yScale(y2v)));
      html += `<line x1="${tx1}" y1="${ty1}" x2="${tx2}" y2="${ty2}" stroke="#7c3aed" stroke-width="2" stroke-dasharray="6,4" opacity="0.65" clip-path="url(#plotClip)"/>`;
    }
  }

  // Country labels (rendered before points so points appear on top)
  if (state.showLabels) {
    visible.forEach(c => {
      const cx = xScale(c[state.xKey]);
      const cy = yScale(c[state.yKey]);
      html += `<text x="${cx+7}" y="${cy-5}" font-size="9" fill="#334155" font-family="${getComputedStyle(document.body).fontFamily}" clip-path="url(#plotClip)" pointer-events="none">${c.name}</text>`;
    });
  }

  // Data points group (will be interactive via JS event delegation)
  html += `<g id="dataPoints">`;
  visible.forEach((c, i) => {
    const cx = xScale(c[state.xKey]);
    const cy = yScale(c[state.yKey]);
    const col = CONTINENTS[c.continent].colour;
    const isSelected = state.selectedCountry && state.selectedCountry.name === c.name;
    const r = 7;
    html += `<g class="data-point${isSelected ? ' selected' : ''}" data-idx="${COUNTRIES.indexOf(c)}" clip-path="url(#plotClip)">
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="${col}" opacity="0.85" stroke="${isSelected ? '#fff' : 'rgba(255,255,255,0.5)'}" stroke-width="${isSelected ? 3 : 1.5}"/>
    </g>`;
  });
  html += `</g>`;

  svg.innerHTML = html;

  // Bind events to data points
  svg.querySelectorAll('.data-point').forEach(el => {
    el.addEventListener('mouseenter', e => onPointHover(e, parseInt(el.dataset.idx)));
    el.addEventListener('mouseleave', onPointLeave);
    el.addEventListener('click', e => onPointClick(parseInt(el.dataset.idx)));
  });

  updateStats(visible);
}

// =============================================
// TOOLTIP & INTERACTION
// =============================================
const tooltip = document.getElementById('tooltip');

function onPointHover(e, idx) {
  const c = COUNTRIES[idx];
  const xInd = INDICATORS[state.xKey];
  const yInd = INDICATORS[state.yKey];
  tooltip.innerHTML = `
    <div class="tt-name">${c.name}</div>
    <div class="tt-row"><span class="tt-key">${xInd.short}:</span><span class="tt-val">${xInd.fmt(c[state.xKey])}</span></div>
    <div class="tt-row"><span class="tt-key">${yInd.short}:</span><span class="tt-val">${yInd.fmt(c[state.yKey])}</span></div>
    <div class="tt-row"><span class="tt-key">Continent:</span><span class="tt-val">${c.continent}</span></div>
  `;
  tooltip.style.display = 'block';
  moveTooltip(e);
  document.addEventListener('mousemove', moveTooltip);
}

function moveTooltip(e) {
  const x = e.clientX + 14;
  const y = e.clientY - 10;
  const w = tooltip.offsetWidth;
  const h = tooltip.offsetHeight;
  tooltip.style.left = (x + w > window.innerWidth - 10 ? x - w - 28 : x) + 'px';
  tooltip.style.top = (y + h > window.innerHeight - 10 ? y - h - 4 : y) + 'px';
}

function onPointLeave() {
  tooltip.style.display = 'none';
  document.removeEventListener('mousemove', moveTooltip);
}

function onPointClick(idx) {
  state.selectedCountry = COUNTRIES[idx];
  showCountryPanel(COUNTRIES[idx]);
  render();
}

// =============================================
// COUNTRY PANEL
// =============================================
function showCountryPanel(c) {
  document.getElementById('welcomeView').style.display = 'none';
  const panel = document.getElementById('countryView');
  panel.style.display = 'block';

  const col = CONTINENTS[c.continent].colour;
  const dl = devLevel(c.hdi);

  panel.innerHTML = `
    <div class="card country-card">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;">
        <div>
          <h2>${c.name}</h2>
          <div class="country-meta">
            <span class="cont-badge" style="background:${col}">${c.continent}</span>
            <span>HDI classification: <strong style="color:${dl.colour}">${dl.label}</strong></span>
          </div>
        </div>
        <button onclick="closeCountryPanel()" style="background:none;border:none;cursor:pointer;font-size:1.1rem;color:var(--text-faint);padding:4px;">‚úï</button>
      </div>

      <div class="dev-bar-wrap">
        <div class="dev-bar-label"><span>HDI Score</span><span style="font-weight:700;color:${dl.colour}">${c.hdi.toFixed(3)}</span></div>
        <div class="dev-bar-track"><div class="dev-bar-fill" style="width:${c.hdi*100}%;background:${dl.colour}"></div></div>
      </div>

      <div class="data-grid">
        <div class="data-cell">
          <div class="dc-label">GDP per Capita</div>
          <div class="dc-value">$${c.gdp.toLocaleString()}</div>
        </div>
        <div class="data-cell">
          <div class="dc-label">Life Expectancy</div>
          <div class="dc-value">${c.lifeExp.toFixed(1)} yrs</div>
        </div>
        <div class="data-cell">
          <div class="dc-label">Literacy Rate</div>
          <div class="dc-value">${c.literacy.toFixed(1)}%</div>
        </div>
        <div class="data-cell">
          <div class="dc-label">Birth Rate</div>
          <div class="dc-value">${c.birthRate.toFixed(1)}/1,000</div>
        </div>
        <div class="data-cell">
          <div class="dc-label">Death Rate</div>
          <div class="dc-value">${c.deathRate.toFixed(1)}/1,000</div>
        </div>
        <div class="data-cell">
          <div class="dc-label">Infant Mortality</div>
          <div class="dc-value">${c.infantMort.toFixed(1)}/1,000</div>
        </div>
        <div class="data-cell">
          <div class="dc-label">Clean Water</div>
          <div class="dc-value">${c.cleanWater.toFixed(1)}%</div>
        </div>
        <div class="data-cell">
          <div class="dc-label">CO2/capita</div>
          <div class="dc-value">${c.co2.toFixed(2)}t</div>
        </div>
        <div class="data-cell">
          <div class="dc-label">Internet Users</div>
          <div class="dc-value">${c.internet.toFixed(1)}%</div>
        </div>
        <div class="data-cell">
          <div class="dc-label">HDI</div>
          <div class="dc-value" style="color:${dl.colour}">${c.hdi.toFixed(3)}</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title"><span class="icon">üìå</span> Analysis Notes</div>
      ${generateAnalysis(c)}
    </div>

    <div class="card">
      <div class="card-title"><span class="icon">üîó</span> Current Axes</div>
      <div style="display:flex;flex-direction:column;gap:6px;">
        <div style="display:flex;justify-content:space-between;font-size:0.82rem;">
          <span style="color:var(--text-light)">${INDICATORS[state.xKey].label}:</span>
          <strong>${INDICATORS[state.xKey].fmt(c[state.xKey])}</strong>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:0.82rem;">
          <span style="color:var(--text-light)">${INDICATORS[state.yKey].label}:</span>
          <strong>${INDICATORS[state.yKey].fmt(c[state.yKey])}</strong>
        </div>
      </div>
    </div>
  `;
}

function generateAnalysis(c) {
  const dl = devLevel(c.hdi);
  let notes = [];

  if (c.hdi >= 0.8) {
    notes.push(`${c.name} is classified as a <strong>High Income Country (HIC)</strong> with very high human development. It benefits from strong healthcare systems, high educational attainment and economic stability.`);
  } else if (c.hdi >= 0.7) {
    notes.push(`${c.name} has <strong>high human development</strong> and shows characteristics of a country in an advanced stage of development. There may still be internal inequalities or regional disparities.`);
  } else if (c.hdi >= 0.55) {
    notes.push(`${c.name} falls into the <strong>medium development</strong> category. It may be experiencing rapid growth (an NIC or emerging economy) but significant challenges remain in healthcare or education access.`);
  } else {
    notes.push(`${c.name} is classified as a <strong>Low Income Country (LIC)</strong> with low human development. Challenges include poverty, limited healthcare access, low literacy, and high birth rates.`);
  }

  if (c.birthRate > 30) notes.push(`A birth rate of <strong>${c.birthRate.toFixed(1)}</strong> per 1,000 is characteristic of stage 2 or early stage 3 in the <strong>Demographic Transition Model</strong>, associated with limited family planning and high child mortality.`);
  if (c.lifeExp < 65) notes.push(`A life expectancy of <strong>${c.lifeExp.toFixed(1)} years</strong> reflects challenges including disease burden, limited healthcare access, conflict, or poor nutrition.`);
  if (c.cleanWater < 80) notes.push(`Only <strong>${c.cleanWater.toFixed(1)}%</strong> of the population has access to clean water, a significant barrier to health and development.`);
  if (c.co2 > 10) notes.push(`CO2 emissions of <strong>${c.co2.toFixed(2)} tonnes per capita</strong> place ${c.name} among the world's higher emitters, raising sustainability concerns.`);
  if (c.literacy < 65) notes.push(`A literacy rate of <strong>${c.literacy.toFixed(1)}%</strong> limits human capital development and economic productivity.`);

  return notes.map(n => `<div class="info-section"><p>${n}</p></div>`).join('');
}

function closeCountryPanel() {
  state.selectedCountry = null;
  document.getElementById('welcomeView').style.display = 'block';
  document.getElementById('countryView').style.display = 'none';
  render();
}

// =============================================
// STATS BAR
// =============================================
function updateStats(visible) {
  document.getElementById('statCount').textContent = visible.length;
  const r = calcCorrelation(visible, state.xKey, state.yKey);
  const corrChip = document.getElementById('corrChip');
  const corrEl = document.getElementById('statCorr');
  const relEl = document.getElementById('statRel');

  if (state.showCorr && visible.length >= 3) {
    corrChip.style.display = '';
    corrEl.textContent = r.toFixed(3);
    relEl.textContent = corrDescription(r);
    corrEl.style.color = r > 0.5 ? 'var(--geo-green-dark)' : r < -0.5 ? '#c0392b' : 'var(--geo-blue-dark)';
  } else {
    corrChip.style.display = 'none';
    relEl.textContent = '-';
  }
}

// =============================================
// INDICATOR INFO TABS
// =============================================
function showIndInfo(key) {
  document.querySelectorAll('.ind-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.ind-info-box').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  const box = document.getElementById('info-' + key);
  if (box) box.classList.add('active');
}

// =============================================
// RESIZE HANDLER
// =============================================
let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(render, 120);
});

// =============================================
// START
// =============================================
init();
</script>
</body>
</html>
