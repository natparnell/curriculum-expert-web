<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sound Discrimination Trainer</title>
<style>
:root {
  --primary: #7c3aed;
  --primary-light: #a78bfa;
  --primary-dark: #5b21b6;
  --primary-glow: rgba(124,58,237,.15);
  --accent: #c084fc;
  --accent2: #e879f9;
  --french: #3b82f6;
  --french-light: #93c5fd;
  --german: #ef4444;
  --german-light: #fca5a5;
  --spanish: #f59e0b;
  --spanish-light: #fcd34d;
  --bg: #0f0a1a;
  --card: #1a1130;
  --card2: #251a42;
  --card3: #2f2050;
  --text: #f1f0f7;
  --text2: #9f95b8;
  --text3: #6b5f85;
  --success: #22c55e;
  --success-light: #86efac;
  --error: #ef4444;
  --error-light: #fca5a5;
  --gold: #fbbf24;
  --border: rgba(124,58,237,.25);
  --radius: 12px;
  --radius-sm: 8px;
  --shadow: 0 4px 24px rgba(0,0,0,.4);
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}
body::before {
  content:'';
  position:fixed;
  inset:0;
  background:
    radial-gradient(ellipse at 20% 30%, rgba(124,58,237,.1) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 60%, rgba(192,132,252,.08) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 90%, rgba(232,121,249,.06) 0%, transparent 50%);
  z-index:0;
  pointer-events:none;
}
.app { position:relative; z-index:1; max-width:1200px; margin:0 auto; padding:0 16px 40px; }

/* STICKY HEADER */
header {
  position:sticky;
  top:0;
  z-index:100;
  background: linear-gradient(180deg, var(--bg) 60%, transparent);
  padding:14px 0 18px;
  text-align:center;
}
header h1 {
  font-size: clamp(1.5rem, 4vw, 2.2rem);
  font-weight:800;
  background: linear-gradient(135deg, var(--primary-light), var(--accent), var(--accent2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  letter-spacing:-0.5px;
}
header .subtitle {
  color:var(--text2);
  font-size:0.85rem;
  margin-top:2px;
}

/* LANGUAGE TABS */
.lang-tabs {
  display:flex;
  justify-content:center;
  gap:6px;
  margin:8px 0 18px;
  flex-wrap:wrap;
}
.lang-tab {
  padding:8px 22px;
  border:2px solid var(--border);
  border-radius:40px;
  background:var(--card);
  color:var(--text2);
  font-size:0.9rem;
  font-weight:600;
  cursor:pointer;
  transition:all .25s;
  display:flex;
  align-items:center;
  gap:6px;
}
.lang-tab:hover { border-color:var(--primary-light); color:var(--text); }
.lang-tab.active-fr { border-color:var(--french); background:rgba(59,130,246,.15); color:var(--french-light); }
.lang-tab.active-de { border-color:var(--german); background:rgba(239,68,68,.15); color:var(--german-light); }
.lang-tab.active-es { border-color:var(--spanish); background:rgba(245,158,11,.15); color:var(--spanish-light); }
.lang-tab .flag { font-size:1.1rem; }

/* MODE TABS */
.mode-tabs {
  display:flex;
  justify-content:center;
  gap:4px;
  margin-bottom:18px;
}
.mode-tab {
  padding:7px 18px;
  border:none;
  border-radius:var(--radius-sm);
  background:var(--card2);
  color:var(--text2);
  font-size:0.82rem;
  font-weight:600;
  cursor:pointer;
  transition:all .2s;
}
.mode-tab:hover { background:var(--card3); color:var(--text); }
.mode-tab.active { background:var(--primary); color:#fff; }

/* STATS BAR */
.stats-bar {
  display:flex;
  justify-content:center;
  gap:20px;
  margin-bottom:18px;
  flex-wrap:wrap;
}
.stat {
  display:flex;
  align-items:center;
  gap:6px;
  font-size:0.85rem;
  color:var(--text2);
}
.stat-val {
  font-weight:700;
  font-size:1rem;
  color:var(--text);
}
.stat-val.green { color:var(--success); }
.stat-val.red { color:var(--error); }
.stat-val.gold { color:var(--gold); }

/* PANELS */
.panel {
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
  margin-bottom:16px;
  box-shadow:var(--shadow);
}
.panel-title {
  font-size:1rem;
  font-weight:700;
  margin-bottom:12px;
  color:var(--accent);
}

/* SOUND PAIR CARDS */
.pair-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(260px, 1fr));
  gap:12px;
}
.pair-card {
  background:var(--card2);
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  padding:14px;
  cursor:pointer;
  transition:all .25s;
  position:relative;
  overflow:hidden;
}
.pair-card:hover { border-color:var(--primary-light); transform:translateY(-2px); }
.pair-card.selected { border-color:var(--accent); box-shadow:0 0 20px rgba(192,132,252,.2); }
.pair-card .sounds {
  font-size:1.3rem;
  font-weight:800;
  margin-bottom:4px;
  display:flex;
  justify-content:center;
  gap:12px;
  align-items:center;
}
.pair-card .sounds .vs { font-size:0.7rem; color:var(--text3); font-weight:400; }
.pair-card .example {
  font-size:0.8rem;
  color:var(--text2);
  text-align:center;
}

/* EXERCISE AREA */
.exercise-area {
  display:none;
}
.exercise-area.visible { display:block; }

/* WAVEFORM + PLAY */
.wave-row {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  margin-bottom:16px;
}
.wave-box {
  background:var(--card2);
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  padding:14px;
  text-align:center;
}
.wave-box .label {
  font-size:1.1rem;
  font-weight:700;
  margin-bottom:6px;
}
.wave-box svg {
  width:100%;
  height:80px;
  display:block;
  margin-bottom:8px;
}
.play-btn {
  padding:8px 20px;
  border:2px solid var(--primary);
  border-radius:40px;
  background:transparent;
  color:var(--primary-light);
  font-size:0.85rem;
  font-weight:600;
  cursor:pointer;
  transition:all .2s;
}
.play-btn:hover { background:var(--primary); color:#fff; }
.play-btn.playing { background:var(--primary); color:#fff; animation:pulse-btn .8s infinite; }
@keyframes pulse-btn {
  0%,100% { box-shadow:0 0 0 0 rgba(124,58,237,.4); }
  50% { box-shadow:0 0 0 8px rgba(124,58,237,0); }
}

/* MOUTH DIAGRAM */
.diagram-row {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
  margin-bottom:16px;
}
.diagram-box {
  background:var(--card2);
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  padding:14px;
  text-align:center;
}
.diagram-box .label { font-weight:700; margin-bottom:6px; font-size:0.9rem; }
.diagram-box svg { width:100%; max-width:200px; height:160px; }
.diagram-box .desc { font-size:0.78rem; color:var(--text2); margin-top:6px; line-height:1.4; }

/* INFO PANEL */
.info-panel {
  background:var(--card2);
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  padding:16px;
  margin-bottom:16px;
}
.info-panel h3 { font-size:0.95rem; color:var(--accent); margin-bottom:8px; }
.info-panel p { font-size:0.82rem; color:var(--text2); line-height:1.6; margin-bottom:6px; }
.ipa { font-family:'Segoe UI', 'DejaVu Sans', sans-serif; color:var(--primary-light); font-weight:600; }

/* DRAG MATCH */
.match-exercise { margin-bottom:16px; }
.match-row {
  display:flex;
  gap:16px;
  align-items:flex-start;
  flex-wrap:wrap;
}
.match-sounds, .match-words {
  flex:1;
  min-width:200px;
}
.match-sounds h4, .match-words h4 {
  font-size:0.85rem;
  color:var(--text2);
  margin-bottom:8px;
}
.draggable-sound {
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:8px 16px;
  background:var(--primary-dark);
  border:2px solid var(--primary);
  border-radius:40px;
  color:#fff;
  font-weight:700;
  font-size:0.95rem;
  cursor:grab;
  margin:4px;
  transition:all .2s;
  user-select:none;
}
.draggable-sound:active { cursor:grabbing; transform:scale(1.05); }
.draggable-sound.matched { opacity:.4; pointer-events:none; }
.drop-zone {
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  background:var(--card3);
  border:2px dashed var(--border);
  border-radius:var(--radius-sm);
  margin-bottom:8px;
  min-height:48px;
  transition:all .2s;
}
.drop-zone.over { border-color:var(--accent); background:rgba(192,132,252,.1); }
.drop-zone.correct { border-color:var(--success); background:rgba(34,197,94,.1); }
.drop-zone.incorrect { border-color:var(--error); background:rgba(239,68,68,.1); }
.drop-zone .word { font-size:0.95rem; font-weight:600; min-width:100px; }
.drop-zone .dropped {
  padding:4px 12px;
  background:var(--primary);
  border-radius:20px;
  font-size:0.85rem;
  font-weight:600;
}
.drop-zone .feedback-icon { font-size:1.1rem; }

/* QUIZ MODE */
.quiz-area { display:none; }
.quiz-area.visible { display:block; }
.quiz-question {
  text-align:center;
  margin-bottom:16px;
}
.quiz-question .prompt {
  font-size:1rem;
  color:var(--text2);
  margin-bottom:10px;
}
.quiz-question .q-num {
  font-size:0.8rem;
  color:var(--text3);
  margin-bottom:6px;
}
.quiz-options {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  max-width:500px;
  margin:0 auto;
}
.quiz-opt {
  padding:14px;
  background:var(--card2);
  border:2px solid var(--border);
  border-radius:var(--radius-sm);
  text-align:center;
  font-size:1.1rem;
  font-weight:700;
  cursor:pointer;
  transition:all .2s;
}
.quiz-opt:hover { border-color:var(--primary-light); transform:translateY(-1px); }
.quiz-opt.correct-pick { border-color:var(--success); background:rgba(34,197,94,.15); }
.quiz-opt.wrong-pick { border-color:var(--error); background:rgba(239,68,68,.15); }
.quiz-opt.disabled { pointer-events:none; }
.quiz-play-btn {
  display:block;
  margin:0 auto 16px;
  padding:12px 32px;
  border:2px solid var(--accent);
  border-radius:40px;
  background:rgba(192,132,252,.1);
  color:var(--accent);
  font-size:1rem;
  font-weight:700;
  cursor:pointer;
  transition:all .2s;
}
.quiz-play-btn:hover { background:var(--accent); color:var(--bg); }
.quiz-result {
  text-align:center;
  padding:20px;
}
.quiz-result .score {
  font-size:2rem;
  font-weight:800;
  color:var(--accent);
}
.quiz-result .msg {
  color:var(--text2);
  margin-top:6px;
}
.quiz-next-btn, .quiz-restart-btn {
  margin-top:12px;
  padding:10px 24px;
  border:none;
  border-radius:var(--radius-sm);
  background:var(--primary);
  color:#fff;
  font-size:0.9rem;
  font-weight:600;
  cursor:pointer;
  transition:all .2s;
}
.quiz-next-btn:hover, .quiz-restart-btn:hover { background:var(--primary-light); color:var(--bg); }

/* PROGRESS BAR */
.progress-bar {
  width:100%;
  height:6px;
  background:var(--card3);
  border-radius:3px;
  margin-bottom:16px;
  overflow:hidden;
}
.progress-fill {
  height:100%;
  background:linear-gradient(90deg, var(--primary), var(--accent));
  border-radius:3px;
  transition:width .4s;
}

/* RESET BTN */
.reset-btn {
  display:block;
  margin:16px auto 0;
  padding:8px 20px;
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  background:transparent;
  color:var(--text2);
  font-size:0.82rem;
  cursor:pointer;
  transition:all .2s;
}
.reset-btn:hover { border-color:var(--error); color:var(--error); }

/* RESPONSIVE */
@media(max-width:768px) {
  .wave-row, .diagram-row { grid-template-columns:1fr; }
  .quiz-options { grid-template-columns:1fr; }
  .match-row { flex-direction:column; }
  .pair-grid { grid-template-columns:1fr 1fr; }
  .stats-bar { gap:12px; }
}
@media(max-width:480px) {
  .pair-grid { grid-template-columns:1fr; }
  .lang-tab { padding:6px 14px; font-size:0.82rem; }
}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Sound Discrimination Trainer</h1>
    <p class="subtitle">Train your ear to distinguish similar foreign language sounds</p>
  </header>

  <div class="lang-tabs" id="langTabs"></div>
  <div class="mode-tabs" id="modeTabs">
    <button class="mode-tab active" data-mode="explore">Explore</button>
    <button class="mode-tab" data-mode="match">Drag &amp; Match</button>
    <button class="mode-tab" data-mode="quiz">Quiz</button>
  </div>

  <div class="stats-bar" id="statsBar">
    <div class="stat">Attempted: <span class="stat-val" id="statAttempted">0</span></div>
    <div class="stat">Correct: <span class="stat-val green" id="statCorrect">0</span></div>
    <div class="stat">Accuracy: <span class="stat-val gold" id="statAccuracy">0%</span></div>
  </div>

  <!-- EXPLORE MODE -->
  <div id="exploreMode">
    <div class="panel">
      <div class="panel-title" id="pairListTitle">Select a Sound Pair</div>
      <div class="pair-grid" id="pairGrid"></div>
    </div>

    <div class="exercise-area" id="exerciseArea">
      <div class="panel">
        <div class="panel-title" id="exerciseTitle"></div>

        <div class="wave-row" id="waveRow"></div>
        <div class="diagram-row" id="diagramRow"></div>

        <div class="info-panel" id="infoPanel">
          <h3>Phonetics Guide</h3>
          <div id="infoContent"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- MATCH MODE -->
  <div id="matchMode" style="display:none">
    <div class="panel">
      <div class="panel-title">Drag each sound to its matching word</div>
      <div class="progress-bar"><div class="progress-fill" id="matchProgress" style="width:0"></div></div>
      <div class="match-exercise" id="matchExercise"></div>
      <button class="reset-btn" id="matchResetBtn">Reset exercise</button>
    </div>
  </div>

  <!-- QUIZ MODE -->
  <div id="quizMode" style="display:none">
    <div class="panel">
      <div class="panel-title">Sound Quiz</div>
      <div class="progress-bar"><div class="progress-fill" id="quizProgress" style="width:0"></div></div>
      <div class="quiz-area visible" id="quizArea"></div>
      <button class="reset-btn" id="quizResetBtn">Restart quiz</button>
    </div>
  </div>
</div>

<script>
/* ===== SOUND DATA ===== */
const DATA = {
  fr: {
    name: 'French', flag: '\uD83C\uDDEB\uD83C\uDDF7', colour: 'var(--french)', colourLight: 'var(--french-light)',
    pairs: [
      { a:{ symbol:'u', ipa:'/y/', word:'tu', meaning:'you', freq:320, mod:'sine', formant2:1900 },
        b:{ symbol:'ou', ipa:'/u/', word:'tout', meaning:'all', freq:280, mod:'triangle', formant2:800 },
        tip:'The French "u" requires rounded lips pushed forward with the tongue high and front. "ou" is a back vowel with lips rounded but tongue pulled back.',
        tongueA:{ height:85, front:75, lip:15 }, tongueB:{ height:85, front:25, lip:20 }
      },
      { a:{ symbol:'\u00e9', ipa:'/e/', word:'les', meaning:'the (pl.)', freq:400, mod:'sine', formant2:2100 },
        b:{ symbol:'\u00e8', ipa:'/\u025B/', word:'lait', meaning:'milk', freq:500, mod:'sine', formant2:1800 },
        tip:'"e accent aigu" is a close-mid front vowel with a tenser tongue. "e accent grave" opens the mouth wider in a more relaxed position.',
        tongueA:{ height:70, front:75, lip:30 }, tongueB:{ height:55, front:70, lip:35 }
      },
      { a:{ symbol:'on', ipa:'/\u0254\u0303/', word:'bon', meaning:'good', freq:260, mod:'triangle', formant2:700 },
        b:{ symbol:'an', ipa:'/\u0251\u0303/', word:'banc', meaning:'bench', freq:300, mod:'sawtooth', formant2:1100 },
        tip:'"on" is a rounded back nasal vowel. "an" is an open nasal vowel with the mouth wider and no lip rounding.',
        tongueA:{ height:50, front:25, lip:18 }, tongueB:{ height:35, front:50, lip:40 }
      },
      { a:{ symbol:'in', ipa:'/\u025B\u0303/', word:'vin', meaning:'wine', freq:380, mod:'sine', formant2:1700 },
        b:{ symbol:'un', ipa:'/\u0153\u0303/', word:'brun', meaning:'brown', freq:340, mod:'triangle', formant2:1400 },
        tip:'"in" is a front nasal vowel with spread lips. "un" adds lip rounding to a similar tongue position, creating a more muffled sound.',
        tongueA:{ height:55, front:70, lip:35 }, tongueB:{ height:55, front:65, lip:15 }
      },
      { a:{ symbol:'r', ipa:'/\u0281/', word:'rouge', meaning:'red', freq:180, mod:'sawtooth', formant2:1200 },
        b:{ symbol:'l', ipa:'/l/', word:'louge', meaning:'(lodge)', freq:220, mod:'sine', formant2:1000 },
        tip:'French "r" is uvular, produced at the back of the throat with vibration. "l" uses the tongue tip touching the ridge behind the upper teeth.',
        tongueA:{ height:40, front:15, lip:30 }, tongueB:{ height:60, front:80, lip:30 }
      },
      { a:{ symbol:'b', ipa:'/b/', word:'bon', meaning:'good', freq:120, mod:'square', formant2:900 },
        b:{ symbol:'p', ipa:'/p/', word:'pont', meaning:'bridge', freq:110, mod:'sine', formant2:900 },
        tip:'"b" is voiced: the vocal cords vibrate during production. "p" is voiceless: air is released in a short burst without vocal cord vibration.',
        tongueA:{ height:30, front:90, lip:5 }, tongueB:{ height:30, front:90, lip:5 }
      },
      { a:{ symbol:'ss', ipa:'/s/', word:'poisson', meaning:'fish', freq:5000, mod:'sawtooth', formant2:4500 },
        b:{ symbol:'z', ipa:'/z/', word:'poison', meaning:'poison', freq:4200, mod:'square', formant2:4000 },
        tip:'"ss" produces a voiceless hissing sibilant. "z" adds voicing, creating a buzzing quality. The tongue position is identical for both.',
        tongueA:{ height:75, front:78, lip:28 }, tongueB:{ height:75, front:78, lip:28 }
      }
    ]
  },
  de: {
    name: 'German', flag: '\uD83C\uDDE9\uD83C\uDDEA', colour: 'var(--german)', colourLight: 'var(--german-light)',
    pairs: [
      { a:{ symbol:'ch', ipa:'/\u00E7/', word:'ich', meaning:'I', freq:3500, mod:'sawtooth', formant2:3200 },
        b:{ symbol:'sch', ipa:'/\u0283/', word:'isch', meaning:'(suffix)', freq:2800, mod:'square', formant2:2200 },
        tip:'"ich-Laut" (ch after front vowels) is a palatal fricative made with the tongue near the hard palate. "sch" is a postalveolar fricative with the tongue further back and lips rounded.',
        tongueA:{ height:80, front:70, lip:30 }, tongueB:{ height:70, front:55, lip:15 }
      },
      { a:{ symbol:'\u00fc', ipa:'/y\u02D0/', word:'f\u00fchlen', meaning:'to feel', freq:320, mod:'sine', formant2:1850 },
        b:{ symbol:'u', ipa:'/u\u02D0/', word:'Stuhl', meaning:'chair', freq:280, mod:'triangle', formant2:800 },
        tip:'German "\u00fc" is identical to French "u": lips rounded, tongue high and front. "u" keeps the lips rounded but the tongue moves to the back of the mouth.',
        tongueA:{ height:85, front:75, lip:15 }, tongueB:{ height:85, front:25, lip:18 }
      },
      { a:{ symbol:'\u00f6', ipa:'/\u00F8\u02D0/', word:'sch\u00f6n', meaning:'beautiful', freq:350, mod:'sine', formant2:1600 },
        b:{ symbol:'o', ipa:'/o\u02D0/', word:'Sohn', meaning:'son', freq:300, mod:'triangle', formant2:850 },
        tip:'"\u00f6" is a front rounded vowel: the tongue is in "e" position but the lips are rounded as for "o". Pure "o" has the tongue in a back position.',
        tongueA:{ height:65, front:70, lip:18 }, tongueB:{ height:65, front:25, lip:20 }
      },
      { a:{ symbol:'z', ipa:'/ts/', word:'zehn', meaning:'ten', freq:4000, mod:'sawtooth', formant2:3800 },
        b:{ symbol:'s', ipa:'/z/', word:'sein', meaning:'to be', freq:3600, mod:'square', formant2:3400 },
        tip:'German "z" is an affricate /ts/, starting with a stop then releasing into a hiss. "s" before vowels is a voiced /z/ like English "z".',
        tongueA:{ height:80, front:82, lip:26 }, tongueB:{ height:76, front:78, lip:28 }
      },
      { a:{ symbol:'ach', ipa:'/x/', word:'Buch', meaning:'book', freq:2200, mod:'sawtooth', formant2:1800 },
        b:{ symbol:'ch (ich)', ipa:'/\u00E7/', word:'Licht', meaning:'light', freq:3500, mod:'sawtooth', formant2:3200 },
        tip:'"ach-Laut" (ch after back vowels) is a velar fricative at the back of the mouth. "ich-Laut" (after front vowels) is a palatal fricative further forward.',
        tongueA:{ height:60, front:20, lip:25 }, tongueB:{ height:80, front:70, lip:30 }
      },
      { a:{ symbol:'ei', ipa:'/a\u026A/', word:'Eis', meaning:'ice', freq:420, mod:'sine', formant2:2000 },
        b:{ symbol:'ie', ipa:'/i\u02D0/', word:'Tier', meaning:'animal', freq:280, mod:'sine', formant2:2400 },
        tip:'"ei" is a diphthong gliding from open "a" to "i". "ie" is a long, steady /i:/ sound. The letter order matches the pronunciation.',
        tongueA:{ height:40, front:55, lip:40 }, tongueB:{ height:90, front:80, lip:32 }
      },
      { a:{ symbol:'w', ipa:'/v/', word:'Wasser', meaning:'water', freq:200, mod:'square', formant2:1100 },
        b:{ symbol:'v', ipa:'/f/', word:'Vater', meaning:'father', freq:4500, mod:'sawtooth', formant2:4200 },
        tip:'German "w" is pronounced like English "v" with lower lip against upper teeth and voicing. "v" in native German words is voiceless /f/.',
        tongueA:{ height:40, front:88, lip:10 }, tongueB:{ height:40, front:88, lip:10 }
      }
    ]
  },
  es: {
    name: 'Spanish', flag: '\uD83C\uDDEA\uD83C\uDDF8', colour: 'var(--spanish)', colourLight: 'var(--spanish-light)',
    pairs: [
      { a:{ symbol:'r', ipa:'/\u027E/', word:'pero', meaning:'but', freq:240, mod:'sine', formant2:1300 },
        b:{ symbol:'rr', ipa:'/r/', word:'perro', meaning:'dog', freq:240, mod:'square', formant2:1300 },
        tip:'Single "r" is a single tap of the tongue against the alveolar ridge. "rr" is a trill with multiple rapid vibrations of the tongue tip.',
        tongueA:{ height:72, front:78, lip:30 }, tongueB:{ height:72, front:78, lip:30 }
      },
      { a:{ symbol:'b (initial)', ipa:'/b/', word:'boca', meaning:'mouth', freq:120, mod:'square', formant2:900 },
        b:{ symbol:'b (between vowels)', ipa:'/\u03B2/', word:'haba', meaning:'bean', freq:140, mod:'triangle', formant2:950 },
        tip:'Initial "b" is a full stop with lips completely closed. Between vowels, "b" softens to a fricative where the lips barely touch, allowing air through.',
        tongueA:{ height:30, front:90, lip:3 }, tongueB:{ height:30, front:88, lip:8 }
      },
      { a:{ symbol:'d (initial)', ipa:'/d/', word:'donde', meaning:'where', freq:150, mod:'square', formant2:1500 },
        b:{ symbol:'d (between vowels)', ipa:'/\u00F0/', word:'nada', meaning:'nothing', freq:170, mod:'triangle', formant2:1500 },
        tip:'Initial "d" is a dental stop with the tongue firmly against the upper teeth. Between vowels it becomes a fricative like English "th" in "the".',
        tongueA:{ height:65, front:85, lip:30 }, tongueB:{ height:55, front:82, lip:32 }
      },
      { a:{ symbol:'j', ipa:'/x/', word:'jota', meaning:'letter J', freq:2500, mod:'sawtooth', formant2:2000 },
        b:{ symbol:'g (before e/i)', ipa:'/x/', word:'gente', meaning:'people', freq:2500, mod:'sawtooth', formant2:2000 },
        tip:'Both "j" and "g" before "e" or "i" produce the same velar fricative /x/. This is a common source of spelling confusion for learners.',
        tongueA:{ height:55, front:20, lip:28 }, tongueB:{ height:55, front:20, lip:28 }
      },
      { a:{ symbol:'\u00f1', ipa:'/\u0272/', word:'a\u00f1o', meaning:'year', freq:280, mod:'sine', formant2:1800 },
        b:{ symbol:'n', ipa:'/n/', word:'ano', meaning:'anus', freq:260, mod:'sine', formant2:1500 },
        tip:'"\u00f1" is a palatal nasal with the tongue blade pressed against the hard palate. "n" uses only the tongue tip against the alveolar ridge. The meaning difference can be significant!',
        tongueA:{ height:80, front:60, lip:28 }, tongueB:{ height:72, front:78, lip:30 }
      },
      { a:{ symbol:'ll', ipa:'/\u028E/', word:'calle', meaning:'street', freq:300, mod:'sine', formant2:1900 },
        b:{ symbol:'y', ipa:'/\u029D/', word:'yo', meaning:'I', freq:310, mod:'triangle', formant2:2000 },
        tip:'"ll" and "y" have merged in most dialects (ye\u00edsmo). Where distinguished, "ll" is a lateral palatal and "y" is a palatal fricative.',
        tongueA:{ height:82, front:65, lip:28 }, tongueB:{ height:78, front:68, lip:28 }
      },
      { a:{ symbol:'c (before e/i)', ipa:'/\u03B8/ or /s/', word:'cena', meaning:'dinner', freq:4800, mod:'sawtooth', formant2:4500 },
        b:{ symbol:'s', ipa:'/s/', word:'sena', meaning:'(name)', freq:5000, mod:'sawtooth', formant2:4500 },
        tip:'In Castilian Spanish, "c" before "e/i" is /\u03B8/ (like English "th"). In Latin American Spanish, both merge to /s/ (seseo).',
        tongueA:{ height:65, front:85, lip:28 }, tongueB:{ height:76, front:78, lip:28 }
      },
      { a:{ symbol:'g (before a/o/u)', ipa:'/g/', word:'gato', meaning:'cat', freq:160, mod:'square', formant2:1000 },
        b:{ symbol:'gu (before e/i)', ipa:'/g/', word:'guerra', meaning:'war', freq:160, mod:'square', formant2:1000 },
        tip:'Before a/o/u, "g" is pronounced directly. Before e/i, a silent "u" is needed to keep the hard /g/ sound. Without "u", "g" would be /x/.',
        tongueA:{ height:50, front:18, lip:28 }, tongueB:{ height:50, front:18, lip:28 }
      }
    ]
  }
};

/* ===== STATE ===== */
let currentLang = 'fr';
let currentPairIdx = -1;
let currentMode = 'explore';
let stats = { attempted:0, correct:0 };
let audioCtx = null;
let matchState = {};
let quizState = {};

function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

/* ===== RENDER LANGUAGE TABS ===== */
function renderLangTabs() {
  const el = document.getElementById('langTabs');
  el.innerHTML = '';
  for (const [key, lang] of Object.entries(DATA)) {
    const btn = document.createElement('button');
    btn.className = 'lang-tab' + (key === currentLang ? ` active-${key}` : '');
    btn.innerHTML = `<span class="flag">${lang.flag}</span> ${lang.name}`;
    btn.onclick = () => { currentLang = key; currentPairIdx = -1; render(); };
    el.appendChild(btn);
  }
}

/* ===== RENDER MODE TABS ===== */
function initModeTabs() {
  document.querySelectorAll('.mode-tab').forEach(btn => {
    btn.onclick = () => {
      currentMode = btn.dataset.mode;
      document.querySelectorAll('.mode-tab').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      render();
    };
  });
}

/* ===== STATS ===== */
function updateStats() {
  document.getElementById('statAttempted').textContent = stats.attempted;
  document.getElementById('statCorrect').textContent = stats.correct;
  const pct = stats.attempted > 0 ? Math.round(stats.correct / stats.attempted * 100) : 0;
  document.getElementById('statAccuracy').textContent = pct + '%';
}

/* ===== SVG WAVEFORM ===== */
function generateWaveformSVG(freq, modType, colour, id) {
  const w = 240, h = 70;
  let path = '';
  const steps = 120;
  for (let i = 0; i <= steps; i++) {
    const x = (i / steps) * w;
    const t = (i / steps) * Math.PI * 6;
    let y;
    if (modType === 'sine') {
      y = h/2 + Math.sin(t * freq/300) * 25 * Math.sin(t * 0.5);
    } else if (modType === 'triangle') {
      const tri = 2 * Math.abs(2 * ((t * freq/300)/(2*Math.PI) - Math.floor((t * freq/300)/(2*Math.PI) + 0.5))) - 1;
      y = h/2 + tri * 22 * Math.sin(t * 0.4);
    } else if (modType === 'sawtooth') {
      const saw = 2 * ((t * freq/300)/(2*Math.PI) - Math.floor(0.5 + (t * freq/300)/(2*Math.PI)));
      y = h/2 + saw * 20 * Math.cos(t * 0.3);
    } else {
      const sq = Math.sign(Math.sin(t * freq/300));
      y = h/2 + sq * 18 * Math.sin(t * 0.5);
    }
    path += (i === 0 ? 'M' : 'L') + ` ${x.toFixed(1)} ${y.toFixed(1)}`;
  }
  return `<svg viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">
    <rect width="${w}" height="${h}" fill="rgba(0,0,0,.2)" rx="6"/>
    <path d="${path}" fill="none" stroke="${colour}" stroke-width="2.5" stroke-linecap="round" opacity="0.9">
      <animate id="waveAnim${id}" attributeName="stroke-dasharray" from="0 2000" to="2000 0" dur="1.2s" fill="freeze" begin="indefinite"/>
    </path>
  </svg>`;
}

/* ===== SVG MOUTH DIAGRAM ===== */
function generateMouthSVG(tongue, colour, label) {
  const { height, front, lip } = tongue;
  // Cross-section: outline of mouth cavity
  const tongueX = 30 + (1 - front/100) * 100;
  const tongueY = 130 - (height/100) * 60;
  const lipOpen = 20 + lip;

  return `<svg viewBox="0 0 180 150" xmlns="http://www.w3.org/2000/svg">
    <!-- Head outline -->
    <path d="M 20 30 Q 20 10, 90 10 Q 160 10, 160 30 L 160 120 Q 160 145, 90 145 Q 20 145, 20 120 Z"
      fill="none" stroke="var(--text3)" stroke-width="1.5" opacity="0.4"/>
    <!-- Hard palate -->
    <path d="M 30 45 Q 70 25, 130 45" fill="none" stroke="var(--text2)" stroke-width="2"/>
    <!-- Soft palate / uvula -->
    <path d="M 130 45 Q 145 55, 140 70 Q 138 78, 132 75" fill="none" stroke="var(--text2)" stroke-width="1.5"/>
    <!-- Tongue -->
    <path d="M 30 120 Q 50 ${tongueY + 20}, ${tongueX} ${tongueY} Q ${tongueX + 30} ${tongueY - 5}, 130 100 L 130 120 Z"
      fill="${colour}" fill-opacity="0.3" stroke="${colour}" stroke-width="2"/>
    <!-- Lips (top) -->
    <line x1="15" y1="75" x2="28" y2="${75 - lipOpen/3}" stroke="var(--text)" stroke-width="2.5" stroke-linecap="round"/>
    <!-- Lips (bottom) -->
    <line x1="15" y1="80" x2="28" y2="${80 + lipOpen/3}" stroke="var(--text)" stroke-width="2.5" stroke-linecap="round"/>
    <!-- Lip opening indicator -->
    <text x="8" y="${78}" font-size="6" fill="var(--text3)" text-anchor="middle">${lip < 20 ? 'O' : lip < 30 ? '(' : '{'}</text>
    <!-- Labels -->
    <text x="75" y="38" font-size="7" fill="var(--text3)" text-anchor="middle">palate</text>
    <text x="${tongueX}" y="${tongueY + 35}" font-size="7" fill="${colour}" text-anchor="middle">tongue</text>
    <text x="90" y="142" font-size="9" fill="${colour}" font-weight="bold" text-anchor="middle">${label}</text>
  </svg>`;
}

/* ===== PLAY SOUND ===== */
function playSound(soundData, btnEl) {
  const ctx = getAudioCtx();
  if (ctx.state === 'suspended') ctx.resume();

  const dur = 0.7;
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  const filter = ctx.createBiquadFilter();

  osc.type = soundData.mod || 'sine';
  osc.frequency.setValueAtTime(soundData.freq, ctx.currentTime);
  osc.frequency.linearRampToValueAtTime(soundData.freq * 1.02, ctx.currentTime + dur * 0.3);
  osc.frequency.linearRampToValueAtTime(soundData.freq * 0.98, ctx.currentTime + dur);

  filter.type = 'bandpass';
  filter.frequency.setValueAtTime(soundData.formant2 || 1500, ctx.currentTime);
  filter.Q.setValueAtTime(2.5, ctx.currentTime);

  gain.gain.setValueAtTime(0, ctx.currentTime);
  gain.gain.linearRampToValueAtTime(0.3, ctx.currentTime + 0.05);
  gain.gain.setValueAtTime(0.3, ctx.currentTime + dur - 0.15);
  gain.gain.linearRampToValueAtTime(0, ctx.currentTime + dur);

  osc.connect(filter);
  filter.connect(gain);
  gain.connect(ctx.destination);
  osc.start(ctx.currentTime);
  osc.stop(ctx.currentTime + dur);

  if (btnEl) {
    btnEl.classList.add('playing');
    setTimeout(() => btnEl.classList.remove('playing'), dur * 1000);
  }
}

/* ===== RENDER EXPLORE MODE ===== */
function renderExplore() {
  const lang = DATA[currentLang];
  document.getElementById('pairListTitle').textContent = `${lang.name} Sound Pairs`;
  document.getElementById('pairListTitle').style.color = lang.colourLight;

  const grid = document.getElementById('pairGrid');
  grid.innerHTML = '';
  lang.pairs.forEach((pair, idx) => {
    const card = document.createElement('div');
    card.className = 'pair-card' + (idx === currentPairIdx ? ' selected' : '');
    card.innerHTML = `
      <div class="sounds"><span>${pair.a.symbol}</span><span class="vs">vs</span><span>${pair.b.symbol}</span></div>
      <div class="example">${pair.a.word} / ${pair.b.word}</div>`;
    card.onclick = () => { currentPairIdx = idx; renderExplore(); renderExercise(); };
    grid.appendChild(card);
  });

  const area = document.getElementById('exerciseArea');
  if (currentPairIdx >= 0) {
    area.classList.add('visible');
    renderExercise();
  } else {
    area.classList.remove('visible');
  }
}

function renderExercise() {
  const lang = DATA[currentLang];
  const pair = lang.pairs[currentPairIdx];
  if (!pair) return;

  document.getElementById('exerciseTitle').textContent =
    `${pair.a.symbol} ${pair.a.ipa} vs ${pair.b.symbol} ${pair.b.ipa}`;
  document.getElementById('exerciseTitle').style.color = lang.colourLight;

  // Waveforms
  const waveRow = document.getElementById('waveRow');
  waveRow.innerHTML = `
    <div class="wave-box">
      <div class="label" style="color:${lang.colour}">${pair.a.symbol} ${pair.a.ipa}</div>
      ${generateWaveformSVG(pair.a.freq, pair.a.mod, lang.colour, 'A')}
      <div style="font-size:0.85rem;color:var(--text2);margin-bottom:6px">${pair.a.word} (${pair.a.meaning})</div>
      <button class="play-btn" id="playA">Play ${pair.a.symbol}</button>
    </div>
    <div class="wave-box">
      <div class="label" style="color:${lang.colourLight}">${pair.b.symbol} ${pair.b.ipa}</div>
      ${generateWaveformSVG(pair.b.freq, pair.b.mod, lang.colourLight, 'B')}
      <div style="font-size:0.85rem;color:var(--text2);margin-bottom:6px">${pair.b.word} (${pair.b.meaning})</div>
      <button class="play-btn" id="playB">Play ${pair.b.symbol}</button>
    </div>`;

  document.getElementById('playA').onclick = function() { playSound(pair.a, this); };
  document.getElementById('playB').onclick = function() { playSound(pair.b, this); };

  // Mouth diagrams
  const diagRow = document.getElementById('diagramRow');
  diagRow.innerHTML = `
    <div class="diagram-box">
      <div class="label" style="color:${lang.colour}">Mouth position: ${pair.a.symbol}</div>
      ${generateMouthSVG(pair.tongueA, lang.colour, pair.a.symbol)}
      <div class="desc">Tongue ${pair.tongueA.height > 60 ? 'high' : 'low'}, ${pair.tongueA.front > 50 ? 'front' : 'back'}. Lips ${pair.tongueA.lip < 20 ? 'tightly rounded' : pair.tongueA.lip < 30 ? 'slightly rounded' : 'spread'}.</div>
    </div>
    <div class="diagram-box">
      <div class="label" style="color:${lang.colourLight}">Mouth position: ${pair.b.symbol}</div>
      ${generateMouthSVG(pair.tongueB, lang.colourLight, pair.b.symbol)}
      <div class="desc">Tongue ${pair.tongueB.height > 60 ? 'high' : 'low'}, ${pair.tongueB.front > 50 ? 'front' : 'back'}. Lips ${pair.tongueB.lip < 20 ? 'tightly rounded' : pair.tongueB.lip < 30 ? 'slightly rounded' : 'spread'}.</div>
    </div>`;

  // Info panel
  document.getElementById('infoContent').innerHTML = `
    <p>${pair.tip}</p>
    <p><span class="ipa">${pair.a.symbol}</span> ${pair.a.ipa}: as in <strong>${pair.a.word}</strong> (${pair.a.meaning})</p>
    <p><span class="ipa">${pair.b.symbol}</span> ${pair.b.ipa}: as in <strong>${pair.b.word}</strong> (${pair.b.meaning})</p>`;
}

/* ===== RENDER MATCH MODE ===== */
function renderMatch() {
  const lang = DATA[currentLang];
  const ex = document.getElementById('matchExercise');
  ex.innerHTML = '';

  // Build items: for each pair, create two word entries
  const items = [];
  lang.pairs.forEach((pair, pi) => {
    items.push({ word: pair.a.word, meaning: pair.a.meaning, correctSymbol: pair.a.symbol, pairIdx: pi, side: 'a' });
    items.push({ word: pair.b.word, meaning: pair.b.meaning, correctSymbol: pair.b.symbol, pairIdx: pi, side: 'b' });
  });

  // Shuffle items
  const shuffled = [...items].sort(() => Math.random() - 0.5);
  // Take first 8
  const selected = shuffled.slice(0, 8);

  // Gather unique symbols needed
  const symbols = [...new Set(selected.map(it => it.correctSymbol))];
  const shuffledSymbols = [...symbols].sort(() => Math.random() - 0.5);

  matchState = { items: selected, matched: {}, total: selected.length };

  // Sound chips
  const soundsDiv = document.createElement('div');
  soundsDiv.className = 'match-sounds';
  soundsDiv.innerHTML = '<h4>Sounds (drag these)</h4>';
  shuffledSymbols.forEach(sym => {
    const chip = document.createElement('span');
    chip.className = 'draggable-sound';
    chip.textContent = sym;
    chip.draggable = true;
    chip.dataset.symbol = sym;
    chip.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', sym);
    });
    // Touch support
    chip.addEventListener('touchstart', e => {
      matchState.dragging = sym;
      chip.style.opacity = '0.5';
    });
    soundsDiv.appendChild(chip);
  });

  // Word drop zones
  const wordsDiv = document.createElement('div');
  wordsDiv.className = 'match-words';
  wordsDiv.innerHTML = '<h4>Words (drop sound here)</h4>';
  selected.forEach((item, idx) => {
    const zone = document.createElement('div');
    zone.className = 'drop-zone';
    zone.dataset.idx = idx;
    zone.innerHTML = `<span class="word">${item.word} (${item.meaning})</span>`;

    zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('over'); });
    zone.addEventListener('dragleave', () => zone.classList.remove('over'));
    zone.addEventListener('drop', e => {
      e.preventDefault();
      zone.classList.remove('over');
      const sym = e.dataTransfer.getData('text/plain');
      handleMatchDrop(idx, sym, zone);
    });
    // Touch support
    zone.addEventListener('touchend', e => {
      if (matchState.dragging) {
        handleMatchDrop(idx, matchState.dragging, zone);
        matchState.dragging = null;
        document.querySelectorAll('.draggable-sound').forEach(c => c.style.opacity = '');
      }
    });

    wordsDiv.appendChild(zone);
  });

  const row = document.createElement('div');
  row.className = 'match-row';
  row.appendChild(soundsDiv);
  row.appendChild(wordsDiv);
  ex.appendChild(row);

  // Play buttons for each sound
  const playRow = document.createElement('div');
  playRow.style.cssText = 'display:flex;gap:6px;flex-wrap:wrap;margin-top:12px;justify-content:center;';
  shuffledSymbols.forEach(sym => {
    const pairData = findSoundBySymbol(sym);
    if (!pairData) return;
    const btn = document.createElement('button');
    btn.className = 'play-btn';
    btn.textContent = 'Hear ' + sym;
    btn.onclick = function() { playSound(pairData, this); };
    playRow.appendChild(btn);
  });
  ex.appendChild(playRow);

  updateMatchProgress();
}

function findSoundBySymbol(sym) {
  const lang = DATA[currentLang];
  for (const pair of lang.pairs) {
    if (pair.a.symbol === sym) return pair.a;
    if (pair.b.symbol === sym) return pair.b;
  }
  return null;
}

function handleMatchDrop(idx, sym, zone) {
  if (matchState.matched[idx]) return;
  const item = matchState.items[idx];
  stats.attempted++;
  const correct = item.correctSymbol === sym;
  if (correct) {
    stats.correct++;
    matchState.matched[idx] = true;
    zone.classList.add('correct');
    zone.innerHTML += `<span class="dropped">${sym}</span><span class="feedback-icon" style="color:var(--success)">&#10003;</span>`;
  } else {
    zone.classList.add('incorrect');
    zone.innerHTML += `<span class="feedback-icon" style="color:var(--error)">&#10007;</span>`;
    setTimeout(() => {
      zone.classList.remove('incorrect');
      zone.querySelector('.feedback-icon')?.remove();
    }, 1200);
  }
  updateStats();
  updateMatchProgress();
}

function updateMatchProgress() {
  const matched = Object.keys(matchState.matched || {}).length;
  const total = matchState.total || 1;
  document.getElementById('matchProgress').style.width = (matched / total * 100) + '%';
}

/* ===== RENDER QUIZ MODE ===== */
function renderQuiz() {
  const lang = DATA[currentLang];
  // Build quiz questions: play a sound, identify which symbol it is
  const questions = [];
  lang.pairs.forEach(pair => {
    // For each pair, one question for side a, one for side b
    questions.push({
      sound: pair.a,
      correct: pair.a.symbol,
      wrong: pair.b.symbol,
      word: pair.a.word,
      meaning: pair.a.meaning
    });
    questions.push({
      sound: pair.b,
      correct: pair.b.symbol,
      wrong: pair.a.symbol,
      word: pair.b.word,
      meaning: pair.b.meaning
    });
  });

  // Shuffle and take 10
  const shuffled = questions.sort(() => Math.random() - 0.5).slice(0, 10);
  quizState = { questions: shuffled, current: 0, score: 0, answered: false };

  renderQuizQuestion();
}

function renderQuizQuestion() {
  const area = document.getElementById('quizArea');
  const q = quizState.questions[quizState.current];

  if (!q) {
    // Show final result
    const pct = Math.round(quizState.score / quizState.questions.length * 100);
    let msg = 'Keep practising!';
    if (pct >= 90) msg = 'Outstanding ear! Excellent discrimination.';
    else if (pct >= 70) msg = 'Good work! You are distinguishing most sounds well.';
    else if (pct >= 50) msg = 'Decent effort. Focus on the pairs you find trickiest.';

    area.innerHTML = `
      <div class="quiz-result">
        <div class="score">${quizState.score} / ${quizState.questions.length}</div>
        <div class="msg">${pct}% accuracy. ${msg}</div>
        <button class="quiz-restart-btn" onclick="renderQuiz()">Try again</button>
      </div>`;
    return;
  }

  const num = quizState.current + 1;
  const total = quizState.questions.length;
  document.getElementById('quizProgress').style.width = ((num - 1) / total * 100) + '%';

  // Randomise option order
  const opts = [q.correct, q.wrong].sort(() => Math.random() - 0.5);
  quizState.answered = false;

  area.innerHTML = `
    <div class="quiz-question">
      <div class="q-num">Question ${num} of ${total}</div>
      <div class="prompt">Listen to the sound, then choose which symbol you hear.</div>
    </div>
    <button class="quiz-play-btn" id="quizPlayBtn">Play sound</button>
    <div class="quiz-options" id="quizOpts">
      ${opts.map(o => `<div class="quiz-opt" data-sym="${o}">${o}</div>`).join('')}
    </div>
    <div style="text-align:center;margin-top:8px;font-size:0.82rem;color:var(--text3)" id="quizHint"></div>`;

  document.getElementById('quizPlayBtn').onclick = function() { playSound(q.sound, this); };
  // Auto-play
  setTimeout(() => playSound(q.sound, document.getElementById('quizPlayBtn')), 300);

  document.querySelectorAll('.quiz-opt').forEach(opt => {
    opt.onclick = () => handleQuizAnswer(opt, q);
  });
}

function handleQuizAnswer(optEl, q) {
  if (quizState.answered) return;
  quizState.answered = true;
  stats.attempted++;

  const chosen = optEl.dataset.sym;
  const correct = chosen === q.correct;

  document.querySelectorAll('.quiz-opt').forEach(o => {
    o.classList.add('disabled');
    if (o.dataset.sym === q.correct) o.classList.add('correct-pick');
  });

  if (correct) {
    stats.correct++;
    quizState.score++;
    optEl.classList.add('correct-pick');
  } else {
    optEl.classList.add('wrong-pick');
  }

  document.getElementById('quizHint').innerHTML = correct
    ? `<span style="color:var(--success)">Correct!</span> That was <strong>${q.correct}</strong> as in "${q.word}" (${q.meaning}).`
    : `<span style="color:var(--error)">Not quite.</span> The sound was <strong>${q.correct}</strong> as in "${q.word}" (${q.meaning}).`;

  updateStats();
  document.getElementById('quizProgress').style.width = ((quizState.current + 1) / quizState.questions.length * 100) + '%';

  // Next button
  const nextBtn = document.createElement('button');
  nextBtn.className = 'quiz-next-btn';
  nextBtn.textContent = quizState.current + 1 < quizState.questions.length ? 'Next question' : 'See results';
  nextBtn.onclick = () => {
    quizState.current++;
    renderQuizQuestion();
  };
  document.getElementById('quizOpts').after(nextBtn);
}

/* ===== RENDER ===== */
function render() {
  renderLangTabs();
  updateStats();

  document.getElementById('exploreMode').style.display = currentMode === 'explore' ? '' : 'none';
  document.getElementById('matchMode').style.display = currentMode === 'match' ? '' : 'none';
  document.getElementById('quizMode').style.display = currentMode === 'quiz' ? '' : 'none';

  if (currentMode === 'explore') renderExplore();
  else if (currentMode === 'match') renderMatch();
  else if (currentMode === 'quiz') renderQuiz();
}

/* ===== INIT ===== */
document.getElementById('matchResetBtn').onclick = () => renderMatch();
document.getElementById('quizResetBtn').onclick = () => renderQuiz();
initModeTabs();
render();
</script>
</body>
</html>
