<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conflict Resolution Flowchart</title>
<style>
:root {
  --bg: #faf7f2;
  --bg-card: #ffffff;
  --bg-sidebar: #f0eeea;
  --text: #2d2a26;
  --text-muted: #6b6560;
  --teal: #2a9d8f;
  --teal-light: #e6f5f3;
  --teal-dark: #1f7a6f;
  --green: #4caf50;
  --green-light: #e8f5e9;
  --amber: #f0a500;
  --amber-light: #fff8e1;
  --red: #d94f4f;
  --red-light: #fde8e8;
  --border: #ddd8d0;
  --shadow: 0 2px 8px rgba(0,0,0,0.08);
  --radius: 10px;
  --header-h: 72px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
header {
  position: sticky; top: 0; z-index: 100; background: var(--teal);
  color: #fff; padding: 12px 24px; height: var(--header-h);
  display: flex; align-items: center; gap: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.15);
}
header h1 { font-size: 1.35rem; font-weight: 700; }
header p { font-size: 0.85rem; opacity: 0.9; }
.layout {
  display: grid; grid-template-columns: 280px 1fr; gap: 0;
  min-height: calc(100vh - var(--header-h));
}
/* Sidebar */
.sidebar {
  background: var(--bg-sidebar); border-right: 1px solid var(--border);
  padding: 20px; overflow-y: auto; max-height: calc(100vh - var(--header-h));
  position: sticky; top: var(--header-h);
}
.sidebar h3 { font-size: 0.95rem; color: var(--teal-dark); margin: 0 0 10px; text-transform: uppercase; letter-spacing: 0.5px; }
.sidebar section { margin-bottom: 24px; }
.skill-tag {
  display: inline-block; background: var(--teal-light); color: var(--teal-dark);
  padding: 4px 10px; border-radius: 20px; font-size: 0.78rem; margin: 3px 2px; font-weight: 500;
}
.info-block { background: var(--bg-card); border-radius: var(--radius); padding: 14px; border: 1px solid var(--border); margin-bottom: 12px; }
.info-block h4 { font-size: 0.85rem; color: var(--teal); margin-bottom: 6px; }
.info-block p, .info-block li { font-size: 0.8rem; color: var(--text-muted); }
.info-block ol, .info-block ul { padding-left: 18px; }
.info-block li { margin-bottom: 4px; }
/* Main */
.main { padding: 24px 28px; max-width: 900px; }
/* Scenario selector */
.scenario-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 24px; }
.scenario-btn {
  background: var(--bg-card); border: 2px solid var(--border); border-radius: var(--radius);
  padding: 16px; cursor: pointer; text-align: left; transition: all 0.2s;
}
.scenario-btn:hover { border-color: var(--teal); transform: translateY(-2px); box-shadow: var(--shadow); }
.scenario-btn .sc-num { font-size: 0.75rem; color: var(--teal); font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
.scenario-btn .sc-title { font-size: 0.95rem; font-weight: 600; margin-bottom: 4px; }
.scenario-btn .sc-desc { font-size: 0.8rem; color: var(--text-muted); }
/* Active scenario */
.scenario-header {
  background: var(--bg-card); border-radius: var(--radius); padding: 18px 20px;
  border-left: 4px solid var(--teal); margin-bottom: 20px; box-shadow: var(--shadow);
}
.scenario-header h2 { font-size: 1.1rem; margin-bottom: 6px; }
.scenario-header p { font-size: 0.88rem; color: var(--text-muted); }
.back-link { display: inline-block; margin-bottom: 16px; color: var(--teal); cursor: pointer; font-size: 0.85rem; font-weight: 500; }
.back-link:hover { text-decoration: underline; }
/* Flowchart */
.flowchart { position: relative; margin: 20px 0; }
.flow-node {
  position: relative; background: var(--bg-card); border: 2px solid var(--border);
  border-radius: var(--radius); padding: 14px 16px; margin-bottom: 8px;
  max-width: 520px; margin-left: auto; margin-right: auto;
}
.flow-node.visited { border-color: var(--teal); background: var(--teal-light); }
.flow-node.current { border-color: var(--teal); box-shadow: 0 0 0 3px rgba(42,157,143,0.2); }
.flow-node .node-label { font-size: 0.72rem; color: var(--teal); font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
.flow-node .node-text { font-size: 0.88rem; }
.flow-connector {
  width: 3px; height: 28px; background: var(--teal); margin: 0 auto;
  position: relative;
}
.flow-connector::after {
  content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%);
  border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 7px solid var(--teal);
}
/* Choice cards */
.choices { display: flex; flex-direction: column; gap: 10px; margin: 16px 0; max-width: 560px; margin-left: auto; margin-right: auto; }
.choice-card {
  background: var(--bg-card); border: 2px solid var(--border); border-radius: var(--radius);
  padding: 14px 18px; cursor: pointer; transition: all 0.2s; position: relative;
}
.choice-card:hover { border-color: var(--teal); transform: translateX(4px); box-shadow: var(--shadow); }
.choice-card .choice-label { font-size: 0.72rem; color: var(--text-muted); font-weight: 600; margin-bottom: 3px; }
.choice-card .choice-text { font-size: 0.88rem; }
.choice-card.selected { border-color: var(--teal); background: var(--teal-light); }
/* Outcome */
.outcome-panel {
  border-radius: var(--radius); padding: 20px; margin: 20px auto; max-width: 560px;
  border: 2px solid; text-align: center;
}
.outcome-panel.green { border-color: var(--green); background: var(--green-light); }
.outcome-panel.amber { border-color: var(--amber); background: var(--amber-light); }
.outcome-panel.red { border-color: var(--red); background: var(--red-light); }
.outcome-panel h3 { margin-bottom: 8px; font-size: 1.05rem; }
.outcome-panel .rating-badge {
  display: inline-block; padding: 4px 14px; border-radius: 20px; color: #fff;
  font-size: 0.8rem; font-weight: 600; margin-bottom: 10px;
}
.outcome-panel.green .rating-badge { background: var(--green); }
.outcome-panel.amber .rating-badge { background: var(--amber); }
.outcome-panel.red .rating-badge { background: var(--red); }
.outcome-panel p { font-size: 0.88rem; color: var(--text-muted); }
/* Review panel */
.review-panel {
  background: var(--bg-card); border-radius: var(--radius); padding: 20px;
  margin: 20px auto; max-width: 600px; box-shadow: var(--shadow); border: 1px solid var(--border);
}
.review-panel h3 { font-size: 1rem; color: var(--teal-dark); margin-bottom: 14px; }
.review-step { display: flex; gap: 12px; margin-bottom: 12px; align-items: flex-start; }
.review-step .step-dot {
  width: 24px; height: 24px; border-radius: 50%; background: var(--teal);
  color: #fff; display: flex; align-items: center; justify-content: center;
  font-size: 0.7rem; font-weight: 700; flex-shrink: 0; margin-top: 2px;
}
.review-step .step-content { font-size: 0.85rem; }
.review-step .step-content strong { color: var(--teal-dark); }
.reflection-box {
  background: var(--amber-light); border: 1px solid var(--amber); border-radius: var(--radius);
  padding: 14px; margin-top: 16px;
}
.reflection-box h4 { font-size: 0.88rem; color: var(--amber); margin-bottom: 6px; }
.reflection-box p { font-size: 0.82rem; color: var(--text-muted); }
/* Buttons */
.btn {
  display: inline-block; padding: 10px 22px; border-radius: var(--radius);
  border: none; cursor: pointer; font-size: 0.88rem; font-weight: 600; transition: all 0.2s;
}
.btn-primary { background: var(--teal); color: #fff; }
.btn-primary:hover { background: var(--teal-dark); }
.btn-outline { background: transparent; border: 2px solid var(--teal); color: var(--teal); }
.btn-outline:hover { background: var(--teal-light); }
.btn-group { display: flex; gap: 10px; justify-content: center; margin-top: 18px; flex-wrap: wrap; }
.hidden { display: none !important; }
/* Responsive */
@media (max-width: 840px) {
  .layout { grid-template-columns: 1fr; }
  .sidebar {
    position: static; max-height: none; border-right: none;
    border-bottom: 1px solid var(--border);
    display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
  }
  .sidebar section { margin-bottom: 8px; }
  .scenario-grid { grid-template-columns: 1fr; }
}
@media (max-width: 520px) {
  .sidebar { grid-template-columns: 1fr; }
  header h1 { font-size: 1.1rem; }
  .main { padding: 16px; }
}
</style>
</head>
<body>
<header>
  <div>
    <h1>Conflict Resolution Flowchart</h1>
    <p>Interactive decision tree for resolving student conflicts</p>
  </div>
</header>

<div class="layout">
  <aside class="sidebar">
    <section>
      <h3>Key Skills</h3>
      <div>
        <span class="skill-tag">Active Listening</span>
        <span class="skill-tag">I-Statements</span>
        <span class="skill-tag">Compromise</span>
        <span class="skill-tag">Empathy</span>
        <span class="skill-tag">Seeking Adult Help</span>
        <span class="skill-tag">Staying Calm</span>
        <span class="skill-tag">Perspective-Taking</span>
      </div>
    </section>
    <section>
      <h3>Conflict Resolution Steps</h3>
      <div class="info-block">
        <h4>Stop, Think, Act</h4>
        <ol>
          <li><strong>Stop:</strong> Pause before reacting. Take a breath and notice your emotions.</li>
          <li><strong>Think:</strong> Consider the other person's perspective. What are the options?</li>
          <li><strong>Act:</strong> Choose a response that works towards a fair outcome for everyone.</li>
        </ol>
      </div>
      <div class="info-block">
        <h4>Win-Win Outcomes</h4>
        <p>The best resolutions leave everyone feeling heard and respected. A win-win does not mean everyone gets exactly what they want; it means everyone's core needs are met and relationships are preserved.</p>
      </div>
      <div class="info-block">
        <h4>When to Use Mediation</h4>
        <p>If two people cannot resolve a conflict on their own, a neutral third party (peer mediator, teacher, or pastoral staff) can help facilitate a fair conversation. Mediation works best when both sides are willing to listen.</p>
      </div>
    </section>
  </aside>

  <main class="main" id="app"></main>
</div>

<script>
const SCENARIOS = [
  {
    id: 'pe-equipment',
    title: 'The PE Equipment Dispute',
    desc: 'Two students, Alex and Jordan, both grab the last remaining tennis racket at the same time during PE. Neither wants to let go, and voices are rising. Other students are starting to watch.',
    tree: {
      id: 'root', text: 'Alex and Jordan are both gripping the racket. The teacher has not noticed yet. What do you (as a bystander or one of the students) do first?',
      choices: [
        {
          text: 'Suggest they both let go of the racket and talk it through calmly.',
          next: {
            id: 'n1a', text: 'They both release the racket. Jordan says, "I had it first." Alex disagrees. How should this be handled?',
            choices: [
              {
                text: 'Ask each person to explain their side without interrupting the other.',
                next: {
                  id: 'n1a1', text: 'Both share their view. It turns out Jordan picked it up a moment before Alex. Alex admits they did not see that. What next?',
                  choices: [
                    {
                      text: 'Alex agrees Jordan can use it this lesson and asks to go first next time.',
                      next: { id: 'out1', outcome: true, rating: 'green', title: 'Resolved Well',
                        text: 'A fair compromise was reached. Both students feel heard, and the agreement to take turns preserves the friendship.',
                        reflection: 'Active listening and willingness to compromise resolved this quickly. Acknowledging the facts and planning ahead prevented future conflict.'
                      }
                    },
                    {
                      text: 'Alex says "fine" but walks away looking upset, refusing to participate.',
                      next: { id: 'out2', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'The immediate argument stopped, but Alex is now withdrawn and resentful. The underlying frustration has not been addressed.',
                        reflection: 'Although the dispute over the racket ended, the emotional impact was not managed. A follow-up conversation with Alex would help, asking how they feel and whether a better system could be agreed.'
                      }
                    }
                  ]
                }
              },
              {
                text: 'Tell Jordan to just hand it over since Alex is more upset.',
                next: {
                  id: 'n1a2', text: 'Jordan feels this is unfair and protests. "Why does being louder mean you win?" The tension increases.',
                  choices: [
                    {
                      text: 'Acknowledge Jordan is right; being louder should not decide things. Start again with fair listening.',
                      next: { id: 'out3', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'The situation was rescued, but Jordan felt dismissed initially. Trust was dented before it was rebuilt.',
                        reflection: 'Favouring the louder person rewards escalation. Fair conflict resolution gives equal voice to both sides from the start.'
                      }
                    },
                    {
                      text: 'Insist Alex should have it because they asked first (even though that is unclear).',
                      next: { id: 'out4', outcome: true, rating: 'red', title: 'Escalated',
                        text: 'Jordan storms off, feeling the process was rigged. The dispute spreads as Jordan tells friends what happened.',
                        reflection: 'Taking sides without evidence makes the mediator part of the problem. Fairness requires hearing both perspectives before making any judgement.'
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          text: 'Shout "Just share it!" and try to pull the racket away from both of them.',
          next: {
            id: 'n1b', text: 'The racket slips and hits the floor. Alex accuses you of interfering. Jordan is annoyed too. Now all three of you are in conflict.',
            choices: [
              {
                text: 'Apologise for grabbing it and suggest asking the teacher for help.',
                next: {
                  id: 'n1b1', text: 'The teacher comes over. They ask what happened and set up a fair rota for equipment. How do you respond?',
                  choices: [
                    {
                      text: 'Explain honestly what happened, including your own mistake in grabbing the racket.',
                      next: { id: 'out5', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'The teacher resolves the equipment issue, and your honesty is noted. However, the physical intervention could have been avoided entirely.',
                        reflection: 'Seeking adult help was the right call after things escalated. Being honest about your role showed maturity. Next time, use words before actions.'
                      }
                    },
                    {
                      text: 'Blame Alex and Jordan and say you were just trying to help.',
                      next: { id: 'out6', outcome: true, rating: 'red', title: 'Escalated',
                        text: 'Alex and Jordan both deny your version. The teacher is now dealing with dishonesty on top of the original dispute.',
                        reflection: 'Deflecting blame destroys trust. Taking responsibility for your part, even when you meant well, is essential in conflict resolution.'
                      }
                    }
                  ]
                }
              },
              {
                text: 'Tell them both to stop overreacting; it is just a racket.',
                next: { id: 'out7', outcome: true, rating: 'red', title: 'Escalated',
                  text: 'Dismissing their feelings makes both students feel belittled. The argument intensifies and the teacher has to intervene.',
                  reflection: 'Minimising someone\'s feelings ("it\'s just a racket") invalidates their experience. Even small disputes matter to those involved. Empathy is always the better starting point.'
                }
              }
            ]
          }
        },
        {
          text: 'Go and quietly tell the teacher what is happening.',
          next: {
            id: 'n1c', text: 'The teacher approaches calmly and asks both students to put the racket down. They set up a brief mediation on the spot.',
            choices: [
              {
                text: 'Support the mediation by encouraging both students to share their feelings.',
                next: { id: 'out8', outcome: true, rating: 'green', title: 'Resolved Well',
                  text: 'The teacher facilitates a fair discussion. Alex and Jordan agree to a turn-taking system. You are thanked for handling it maturely.',
                  reflection: 'Knowing when to involve an adult is a strength, not a weakness. You prevented escalation and supported a fair process.'
                }
              },
              {
                text: 'Stay out of it now that the teacher is involved.',
                next: { id: 'out9', outcome: true, rating: 'green', title: 'Resolved Well',
                  text: 'The teacher handles it fairly. Both students calm down. Stepping back after alerting an adult was a reasonable choice.',
                  reflection: 'Sometimes the best thing a bystander can do is get help and then step back. Not every conflict requires your direct involvement.'
                }
              }
            ]
          }
        }
      ]
    }
  },
  {
    id: 'exclusion',
    title: 'Feeling Excluded from a Friendship Group',
    desc: 'Sam has noticed that their close friends have been making plans without them, whispering when Sam approaches, and sitting together at lunch without saving a seat. Sam feels hurt and left out. What should Sam do?',
    tree: {
      id: 'root', text: 'Sam feels increasingly isolated. At break time, the group walks off together without inviting Sam. Sam is standing alone. What is the best first step?',
      choices: [
        {
          text: 'Sam approaches one trusted friend from the group privately and explains how they feel using I-statements.',
          next: {
            id: 'n2a', text: 'Sam says to Riley, "I feel left out when plans are made without me. I\'m not sure what\'s changed." Riley looks uncomfortable but listens. Riley says, "We didn\'t realise. Some of us thought you were busy with your new club."',
            choices: [
              {
                text: 'Sam says, "I appreciate you telling me. I\'d love to be included again. Can we talk to the others together?"',
                next: {
                  id: 'n2a1', text: 'Riley agrees. They both speak to the group. Most friends are apologetic and did not intend to exclude Sam.',
                  choices: [
                    {
                      text: 'Sam suggests a group chat to coordinate plans so nobody misses out.',
                      next: { id: 'out10', outcome: true, rating: 'green', title: 'Resolved Well',
                        text: 'The group reconnects with a practical solution. Sam feels valued again, and the friends understand the impact of their actions.',
                        reflection: 'Using I-statements, choosing a trusted person to confide in, and proposing a practical solution were all excellent conflict resolution strategies.'
                      }
                    },
                    {
                      text: 'Sam says it is fine now but stays guarded and does not fully re-engage.',
                      next: { id: 'out11', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'The immediate issue is addressed, but Sam\'s lingering hurt means the friendship feels different. Without fully opening up, trust rebuilds slowly.',
                        reflection: 'Forgiveness and vulnerability take time. It is okay to be cautious, but expressing ongoing feelings honestly helps rebuild trust faster than withdrawing.'
                      }
                    }
                  ]
                }
              },
              {
                text: 'Sam gets defensive: "So it\'s my fault for joining a club? Some friends you are."',
                next: {
                  id: 'n2a2', text: 'Riley pulls back. "I was trying to explain. If you\'re going to be like that..." The conversation breaks down.',
                  choices: [
                    {
                      text: 'Sam takes a breath, apologises, and asks to start the conversation again.',
                      next: { id: 'out12', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'Sam recovers the situation, but the defensive reaction made Riley wary. Trust will need rebuilding.',
                        reflection: 'Defensiveness is a natural reaction when hurt, but it closes down dialogue. Sam did well to recognise the mistake and reset the conversation.'
                      }
                    },
                    {
                      text: 'Sam walks away, convinced the group does not care.',
                      next: { id: 'out13', outcome: true, rating: 'red', title: 'Escalated',
                        text: 'Sam isolates further. The group feels Sam rejected their explanation. The distance grows.',
                        reflection: 'Walking away from a conversation mid-flow can feel like self-protection, but it often deepens the divide. Staying present, even when emotions run high, is a crucial skill.'
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          text: 'Sam starts making negative comments about the group to other classmates.',
          next: {
            id: 'n2b', text: 'Word gets back to the friend group. They feel betrayed that Sam talked behind their backs instead of coming to them directly.',
            choices: [
              {
                text: 'Sam realises this was a mistake and goes to the group to apologise and explain the hurt behind the behaviour.',
                next: {
                  id: 'n2b1', text: 'The group is upset but one friend says, "We get that you were hurting, but this made it worse." They are willing to talk.',
                  choices: [
                    {
                      text: 'Sam acknowledges the harm caused and commits to being direct in future.',
                      next: { id: 'out14', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'The group accepts Sam\'s apology, but trust has been damaged. It will take consistent honest communication to fully repair things.',
                        reflection: 'Talking behind people\'s backs often stems from pain, but it always makes conflict worse. Direct, honest communication, even when difficult, protects relationships.'
                      }
                    },
                    {
                      text: 'Sam tries to justify the comments: "Well, you excluded me first."',
                      next: { id: 'out15', outcome: true, rating: 'red', title: 'Escalated',
                        text: 'The group feels Sam is not truly sorry. The friendship fractures further, and sides begin to form in the wider class.',
                        reflection: 'Justifying hurtful actions by pointing to what the other person did first creates a cycle of blame. Genuine resolution requires owning your part regardless of what triggered it.'
                      }
                    }
                  ]
                }
              },
              {
                text: 'Sam doubles down and says the group deserved it for being mean.',
                next: { id: 'out16', outcome: true, rating: 'red', title: 'Escalated',
                  text: 'The conflict spreads across the year group. Both sides feel wronged. A pastoral lead has to get involved to mediate.',
                  reflection: 'Escalation through retaliation turns a fixable misunderstanding into a wider dispute. The original issue (feeling excluded) gets lost in the noise of blame.'
                }
              }
            ]
          }
        },
        {
          text: 'Sam speaks to a teacher or pastoral staff member about how they are feeling.',
          next: {
            id: 'n2c', text: 'The pastoral lead listens to Sam and validates their feelings. They offer to facilitate a conversation with the friend group.',
            choices: [
              {
                text: 'Sam agrees to a facilitated conversation where everyone can share their perspective.',
                next: { id: 'out17', outcome: true, rating: 'green', title: 'Resolved Well',
                  text: 'With adult support, misunderstandings are cleared up. The group did not intend to exclude Sam, and they agree on better communication going forward.',
                  reflection: 'Seeking help from a trusted adult is a mature choice. Facilitated conversations create a safe space where everyone can be honest.'
                }
              },
              {
                text: 'Sam asks the teacher to tell the group to include them, without Sam being present.',
                next: { id: 'out18', outcome: true, rating: 'amber', title: 'Partially Resolved',
                  text: 'The teacher speaks to the group, who feel told off rather than part of a conversation. They include Sam but it feels forced.',
                  reflection: 'Being present in the resolution process is important. When solutions are imposed rather than agreed, they often feel superficial. Brave conversations lead to genuine change.'
                }
              }
            ]
          }
        }
      ]
    }
  },
  {
    id: 'group-work',
    title: 'Disagreement About Group Work',
    desc: 'In a science project, four students are working together. Morgan has done most of the research and presentation, while two others (Casey and Drew) have contributed very little. The deadline is tomorrow. Morgan is frustrated and considering telling the teacher. How should this be handled?',
    tree: {
      id: 'root', text: 'Morgan is visibly stressed and says to the group, "I\'ve done almost everything. This isn\'t fair." Casey shrugs. Drew looks uncomfortable. What happens next?',
      choices: [
        {
          text: 'Morgan asks for a quick group meeting to divide the remaining work clearly and fairly.',
          next: {
            id: 'n3a', text: 'Morgan says, "I\'m not trying to blame anyone. I just need help finishing this. Can we split what\'s left?" Drew agrees. Casey says, "I didn\'t know what to do."',
            choices: [
              {
                text: 'Morgan assigns specific tasks to each person with clear deadlines for tonight.',
                next: {
                  id: 'n3a1', text: 'Drew completes their part. Casey does some but not all of it. The project is submitted on time, though not perfect.',
                  choices: [
                    {
                      text: 'Morgan thanks Drew and talks to Casey honestly: "I noticed some parts were missing. Is there something that made it hard to contribute?"',
                      next: { id: 'out19', outcome: true, rating: 'green', title: 'Resolved Well',
                        text: 'Casey admits they found the topic confusing and were embarrassed to say so. Morgan helps them understand, and they agree to communicate better in future group work.',
                        reflection: 'Asking "what made it hard?" instead of "why didn\'t you?" opens the door to honesty. Many contribution issues stem from confusion or anxiety, not laziness.'
                      }
                    },
                    {
                      text: 'Morgan complains to friends that Casey is useless at group work.',
                      next: { id: 'out20', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'The project got done, but Morgan\'s comments damage Casey\'s reputation. Casey hears about it and feels humiliated.',
                        reflection: 'Venting to others might feel relieving, but it creates new conflict. Addressing concerns directly with the person is always more effective and kinder.'
                      }
                    }
                  ]
                }
              },
              {
                text: 'Morgan says, "Fine, I\'ll just do it all myself. As usual."',
                next: {
                  id: 'n3a2', text: 'Drew and Casey feel dismissed. Drew says, "I offered to help and you just shut us down." Morgan is too stressed to listen.',
                  choices: [
                    {
                      text: 'Drew steps up: "Let me take the conclusion section. Casey, can you do the diagrams? Morgan, you\'ve done enough."',
                      next: { id: 'out21', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'Drew\'s leadership rescues the situation. The project gets finished, but Morgan\'s martyr approach nearly derailed collaboration.',
                        reflection: 'Taking on everything yourself and then resenting others is a common pattern. Delegating and trusting others, even imperfectly, builds a stronger team.'
                      }
                    },
                    {
                      text: 'Everyone gives up trying and the project is submitted incomplete.',
                      next: { id: 'out22', outcome: true, rating: 'red', title: 'Escalated',
                        text: 'The whole group receives a lower mark. Resentment lingers. The teacher notes poor teamwork.',
                        reflection: 'When frustration takes over, everyone loses. Even under pressure, clear communication and shared responsibility lead to better outcomes than giving up.'
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          text: 'Morgan goes straight to the teacher to complain about the others.',
          next: {
            id: 'n3b', text: 'The teacher asks, "Have you spoken to your group about this first?" Morgan admits they have not really tried.',
            choices: [
              {
                text: 'Morgan accepts the teacher\'s advice to have a group conversation first, and the teacher offers to check in afterwards.',
                next: {
                  id: 'n3b1', text: 'Morgan returns to the group and says, "I should have spoken to you before going to the teacher. I\'m stressed but I want us to sort this out together."',
                  choices: [
                    {
                      text: 'The group appreciates Morgan\'s honesty. They divide the remaining work and agree on a check-in system for future projects.',
                      next: { id: 'out23', outcome: true, rating: 'green', title: 'Resolved Well',
                        text: 'Morgan\'s willingness to come back and be honest transformed the dynamic. The project is completed collaboratively.',
                        reflection: 'Admitting you handled something poorly takes courage. Morgan\'s honesty rebuilt trust and led to a practical solution.'
                      }
                    },
                    {
                      text: 'Casey is angry that Morgan went to the teacher. "You could have just asked us." The tension remains.',
                      next: { id: 'out24', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'The work gets divided, but Casey feels betrayed. The relationship will need repair beyond this project.',
                        reflection: 'Going to authority figures before attempting peer resolution can feel like a betrayal. Trying direct communication first usually preserves relationships better.'
                      }
                    }
                  ]
                }
              },
              {
                text: 'Morgan insists the teacher should just give the others lower marks.',
                next: { id: 'out25', outcome: true, rating: 'red', title: 'Escalated',
                  text: 'The teacher explains that group work includes managing teamwork challenges. Morgan\'s refusal to engage with the group is noted as a concern.',
                  reflection: 'Seeking punishment for others instead of resolution misses the point of group work. Learning to navigate contribution differences is a life skill.'
                }
              }
            ]
          }
        }
      ]
    }
  },
  {
    id: 'rumour',
    title: 'A Rumour Has Been Spread',
    desc: 'Taylor discovers that a rumour has been spread about them online and in school. Several classmates seem to know, and some are giving Taylor odd looks. Taylor suspects it started with a student called Kai, who they recently had a falling out with. How should Taylor handle this?',
    tree: {
      id: 'root', text: 'Taylor feels embarrassed and angry. At lunch, a classmate confirms the rumour is circulating. Taylor knows they need to act, but emotions are running high. What should Taylor do first?',
      choices: [
        {
          text: 'Taylor takes some time to calm down, then approaches Kai privately to talk.',
          next: {
            id: 'n4a', text: 'Taylor finds Kai and says calmly, "I\'ve heard something is being said about me and I think it started with you. Can we talk?" Kai looks defensive.',
            choices: [
              {
                text: 'Taylor says, "I\'m not here to fight. I just want to understand what happened and sort it out."',
                next: {
                  id: 'n4a1', text: 'Kai admits they said something when they were upset after the falling out. "I didn\'t think it would spread like that. I\'m sorry."',
                  choices: [
                    {
                      text: 'Taylor says, "I appreciate the apology. Can you help set the record straight with the people you told?"',
                      next: { id: 'out26', outcome: true, rating: 'green', title: 'Resolved Well',
                        text: 'Kai agrees and corrects the rumour with the key people. Taylor and Kai also discuss what caused their original falling out and begin to repair the relationship.',
                        reflection: 'Approaching the source calmly, using non-threatening language, and asking for practical help (correcting the rumour) led to genuine resolution. Addressing the root cause (the falling out) prevents future incidents.'
                      }
                    },
                    {
                      text: 'Taylor accepts the apology but says, "I don\'t think I can trust you again." They walk away.',
                      next: { id: 'out27', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'The rumour may slow down now that Kai feels remorseful, but the relationship is damaged and Kai has not corrected it with others.',
                        reflection: 'Accepting an apology does not require immediate trust, and that boundary is valid. However, not asking Kai to correct the rumour means misinformation continues to spread.'
                      }
                    }
                  ]
                }
              },
              {
                text: 'Taylor loses composure and says, "You\'re a liar and everyone will know what you\'re really like."',
                next: {
                  id: 'n4a2', text: 'Kai fires back. The confrontation becomes a public argument in the corridor. Other students start filming on their phones.',
                  choices: [
                    {
                      text: 'A friend pulls Taylor away and they go to speak to a pastoral lead together.',
                      next: { id: 'out28', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'The pastoral lead mediates. The public argument made things worse before they got better, but adult involvement helps de-escalate.',
                        reflection: 'Public confrontations almost always escalate conflict. The friend\'s intervention was crucial. Having a trusted person who can help you step back is invaluable.'
                      }
                    },
                    {
                      text: 'Taylor threatens to spread a rumour about Kai in retaliation.',
                      next: { id: 'out29', outcome: true, rating: 'red', title: 'Escalated',
                        text: 'The situation spirals into mutual harassment. Both students face consequences and the original issue is buried under layers of retaliation.',
                        reflection: 'Retaliation never resolves conflict; it doubles it. "An eye for an eye" thinking harms everyone involved and can have serious consequences in school.'
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          text: 'Taylor posts a response online, calling Kai out publicly.',
          next: {
            id: 'n4b', text: 'The online post gets significant attention. Some students support Taylor, others support Kai. The conflict is now very public and polarising.',
            choices: [
              {
                text: 'Taylor realises this was a mistake, deletes the post, and asks to see the pastoral lead.',
                next: {
                  id: 'n4b1', text: 'The pastoral lead helps both students. The online post is gone, but screenshots exist. The damage is partially contained.',
                  choices: [
                    {
                      text: 'Taylor and Kai agree, through mediation, to a face-to-face resolution and both commit to stopping online comments.',
                      next: { id: 'out30', outcome: true, rating: 'amber', title: 'Partially Resolved',
                        text: 'Mediation helps, but the online dimension means the conflict reached a wider audience than necessary. Digital footprints are hard to erase.',
                        reflection: 'Taking conflict online amplifies it enormously. Deleting and seeking help showed maturity, but the lesson is clear: resolve disputes privately and in person wherever possible.'
                      }
                    },
                    {
                      text: 'Taylor refuses mediation, saying Kai started it and should face consequences.',
                      next: { id: 'out31', outcome: true, rating: 'red', title: 'Escalated',
                        text: 'Without mediation, both students receive sanctions for online behaviour. The original rumour is now the least of their problems.',
                        reflection: 'Refusing to engage in resolution keeps you stuck in the conflict. When both sides focus on blame, nobody moves forward.'
                      }
                    }
                  ]
                }
              },
              {
                text: 'Taylor keeps posting, escalating the online argument.',
                next: { id: 'out32', outcome: true, rating: 'red', title: 'Escalated',
                  text: 'The school\'s online safety policy is triggered. Both students face serious consequences. Parents are contacted. The original issue is now a safeguarding concern.',
                  reflection: 'Online escalation can quickly cross the line into cyberbullying. What starts as a rumour can become a safeguarding matter with lasting consequences for everyone involved.'
                }
              }
            ]
          }
        },
        {
          text: 'Taylor goes to a trusted teacher or pastoral lead to report the rumour and ask for help.',
          next: {
            id: 'n4c', text: 'The pastoral lead takes it seriously. They speak to Taylor about how they feel and discuss options: mediation with Kai, or the school addressing it through anti-bullying procedures.',
            choices: [
              {
                text: 'Taylor agrees to a mediated conversation with Kai, with adult support.',
                next: { id: 'out33', outcome: true, rating: 'green', title: 'Resolved Well',
                  text: 'In mediation, Kai apologises and explains the falling out made them act badly. Taylor accepts the apology. Kai corrects the rumour with those they told. Both students reflect on the importance of handling disagreements face to face.',
                  reflection: 'This is the gold standard for rumour resolution: calm, adult-supported, face-to-face, with a practical plan to undo the damage. Seeking help early prevented escalation.'
                }
              },
              {
                text: 'Taylor asks the school to handle it formally without Taylor having to speak to Kai.',
                next: { id: 'out34', outcome: true, rating: 'amber', title: 'Partially Resolved',
                  text: 'The school addresses the rumour-spreading behaviour. Kai faces a consequence. However, the underlying falling out remains unresolved and there is tension between them.',
                  reflection: 'Formal processes are important for serious situations, but they do not replace interpersonal resolution. Sometimes both formal and informal approaches are needed.'
                }
              }
            ]
          }
        }
      ]
    }
  }
];

let currentScenario = null;
let path = [];
let currentNode = null;

function render() {
  const app = document.getElementById('app');
  if (!currentScenario) {
    app.innerHTML = renderScenarioSelect();
  } else if (currentNode && currentNode.outcome) {
    app.innerHTML = renderOutcome();
  } else {
    app.innerHTML = renderFlowchart();
  }
}

function renderScenarioSelect() {
  return `
    <h2 style="margin-bottom:6px;">Choose a Scenario</h2>
    <p style="color:var(--text-muted);margin-bottom:18px;font-size:0.9rem;">Select a conflict scenario to work through. Make choices at each stage and see how the situation unfolds.</p>
    <div class="scenario-grid">
      ${SCENARIOS.map((s, i) => `
        <button class="scenario-btn" onclick="startScenario(${i})">
          <div class="sc-num">Scenario ${i + 1}</div>
          <div class="sc-title">${s.title}</div>
          <div class="sc-desc">${s.desc.substring(0, 100)}...</div>
        </button>
      `).join('')}
    </div>
  `;
}

function renderFlowchart() {
  let html = `<span class="back-link" onclick="backToMenu()">&larr; Back to scenarios</span>`;
  html += `<div class="scenario-header"><h2>${currentScenario.title}</h2><p>${currentScenario.desc}</p></div>`;
  html += `<div class="flowchart">`;

  // Render visited nodes
  for (let i = 0; i < path.length; i++) {
    const step = path[i];
    html += `<div class="flow-node visited">
      <div class="node-label">${i === 0 ? 'Situation' : 'Stage ' + i}</div>
      <div class="node-text">${step.node.text}</div>
    </div>`;
    html += `<div class="flow-connector"></div>`;
    html += `<div class="flow-node visited" style="background:var(--teal-light);border-style:dashed;">
      <div class="node-label">Your Choice</div>
      <div class="node-text">${step.choiceText}</div>
    </div>`;
    html += `<div class="flow-connector"></div>`;
  }

  // Render current node
  html += `<div class="flow-node current">
    <div class="node-label">${path.length === 0 ? 'Situation' : 'Stage ' + path.length}</div>
    <div class="node-text">${currentNode.text}</div>
  </div>`;

  // Render choices
  if (currentNode.choices) {
    html += `<div class="flow-connector"></div>`;
    html += `<div class="choices">`;
    currentNode.choices.forEach((c, i) => {
      const label = String.fromCharCode(65 + i);
      html += `<div class="choice-card" onclick="makeChoice(${i})">
        <div class="choice-label">Option ${label}</div>
        <div class="choice-text">${c.text}</div>
      </div>`;
    });
    html += `</div>`;
  }

  html += `</div>`;
  return html;
}

function renderOutcome() {
  const rating = currentNode.rating;
  const ratingLabel = rating === 'green' ? 'Resolved Well' : rating === 'amber' ? 'Partially Resolved' : 'Escalated';

  let html = `<span class="back-link" onclick="backToMenu()">&larr; Back to scenarios</span>`;
  html += `<div class="scenario-header"><h2>${currentScenario.title}</h2><p>${currentScenario.desc}</p></div>`;

  // Outcome panel
  html += `<div class="outcome-panel ${rating}">
    <span class="rating-badge">${ratingLabel}</span>
    <h3>${currentNode.title}</h3>
    <p>${currentNode.text}</p>
  </div>`;

  // Review panel
  html += `<div class="review-panel">
    <h3>Your Path Through This Conflict</h3>`;
  for (let i = 0; i < path.length; i++) {
    html += `<div class="review-step">
      <div class="step-dot">${i + 1}</div>
      <div class="step-content">
        <strong>Situation:</strong> ${path[i].node.text.substring(0, 120)}...<br>
        <strong>You chose:</strong> ${path[i].choiceText}
      </div>
    </div>`;
  }
  html += `<div class="reflection-box">
    <h4>Reflection</h4>
    <p>${currentNode.reflection}</p>
  </div>`;

  // Alternative paths hint
  const altCount = countOutcomes(currentScenario.tree);
  html += `<p style="text-align:center;margin-top:14px;font-size:0.82rem;color:var(--text-muted);">
    This scenario has ${altCount} possible outcomes. Try again to explore different paths.
  </p>`;

  html += `<div class="btn-group">
    <button class="btn btn-primary" onclick="restartScenario()">Try Again</button>
    <button class="btn btn-outline" onclick="backToMenu()">Choose Another Scenario</button>
  </div>`;
  html += `</div>`;

  return html;
}

function countOutcomes(node) {
  if (node.outcome) return 1;
  if (!node.choices) return 0;
  let count = 0;
  for (const c of node.choices) {
    count += countOutcomes(c.next);
  }
  return count;
}

function startScenario(index) {
  currentScenario = SCENARIOS[index];
  path = [];
  currentNode = currentScenario.tree;
  render();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function makeChoice(index) {
  const choice = currentNode.choices[index];
  path.push({ node: currentNode, choiceText: choice.text });
  currentNode = choice.next;
  render();
  // Scroll to bottom of flowchart to show new content
  setTimeout(() => {
    const main = document.querySelector('.main');
    main.scrollTop = main.scrollHeight;
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  }, 50);
}

function restartScenario() {
  path = [];
  currentNode = currentScenario.tree;
  render();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function backToMenu() {
  currentScenario = null;
  path = [];
  currentNode = null;
  render();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

render();
</script>
</body>
</html>