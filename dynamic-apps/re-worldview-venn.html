<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Worldview Venn Diagram</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #faf7f2;
  --bg-alt: #f0ebe3;
  --text: #3a322a;
  --text-light: #7a6f63;
  --border: #d4c9ba;
  --accent: #c4813c;
  --accent-light: #e8a95b;
  --success: #5a9e6f;
  --error: #c0544f;
  --shadow: 0 2px 12px rgba(58,50,42,0.10);
  --shadow-lg: 0 4px 24px rgba(58,50,42,0.15);
  --radius: 10px;
  --radius-sm: 6px;
  --transition: 0.25s ease;

  --christianity: #6b8cae;
  --islam: #5a9e6f;
  --judaism: #c4813c;
  --hinduism: #c0544f;
  --buddhism: #e8a95b;
  --sikhism: #8b7dbf;
  --humanism: #5ba0a0;
}

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

header {
  background: linear-gradient(135deg, #5c4a3a 0%, #7a6350 100%);
  color: #faf7f2;
  padding: 18px 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 12px;
  box-shadow: 0 2px 16px rgba(58,50,42,0.2);
}

header h1 {
  font-size: 1.55rem;
  font-weight: 700;
  letter-spacing: -0.02em;
}

header h1 span {
  font-weight: 300;
  opacity: 0.8;
  font-size: 0.9em;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.score-display {
  background: rgba(255,255,255,0.15);
  border-radius: var(--radius);
  padding: 8px 16px;
  font-size: 0.95rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 120px;
}

.score-display .score-pct { font-size: 1.2rem; }

.btn {
  padding: 8px 18px;
  border: none;
  border-radius: var(--radius-sm);
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition);
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.btn:hover { transform: translateY(-1px); }
.btn:active { transform: translateY(0); }

.btn-primary {
  background: var(--accent);
  color: #fff;
}
.btn-primary:hover { background: var(--accent-light); }

.btn-secondary {
  background: rgba(255,255,255,0.18);
  color: #fff;
  border: 1px solid rgba(255,255,255,0.25);
}
.btn-secondary:hover { background: rgba(255,255,255,0.28); }

.btn-success { background: var(--success); color: #fff; }
.btn-success:hover { background: #4e8e60; }

.btn-ghost {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
}
.btn-ghost:hover { background: var(--bg-alt); }

/* Selector Panel */
.selector-panel {
  background: #fff;
  border-bottom: 1px solid var(--border);
  padding: 16px 32px;
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

.selector-panel label {
  font-weight: 600;
  font-size: 0.95rem;
  white-space: nowrap;
}

.worldview-options {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.wv-chip {
  padding: 7px 16px;
  border-radius: 20px;
  border: 2px solid var(--border);
  background: #fff;
  font-size: 0.88rem;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--transition);
  user-select: none;
  position: relative;
}

.wv-chip:hover { border-color: var(--accent); }

.wv-chip.selected {
  color: #fff;
  border-color: transparent;
}

.wv-chip.selected[data-wv="Christianity"] { background: var(--christianity); }
.wv-chip.selected[data-wv="Islam"] { background: var(--islam); }
.wv-chip.selected[data-wv="Judaism"] { background: var(--judaism); }
.wv-chip.selected[data-wv="Hinduism"] { background: var(--hinduism); }
.wv-chip.selected[data-wv="Buddhism"] { background: var(--buddhism); }
.wv-chip.selected[data-wv="Sikhism"] { background: var(--sikhism); }
.wv-chip.selected[data-wv="Humanism"] { background: var(--humanism); }

.wv-chip .order-badge {
  display: none;
  position: absolute;
  top: -6px;
  right: -6px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--text);
  color: #fff;
  font-size: 0.7rem;
  font-weight: 700;
  line-height: 20px;
  text-align: center;
}

.wv-chip.selected .order-badge { display: block; }

.mode-note {
  font-size: 0.82rem;
  color: var(--text-light);
  margin-left: auto;
}

/* Main Layout */
.main-layout {
  display: flex;
  height: calc(100vh - 130px);
  overflow: hidden;
}

/* Card Bank */
.card-bank {
  width: 320px;
  min-width: 280px;
  background: #fff;
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.card-bank-header {
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  font-weight: 700;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--bg-alt);
}

.card-bank-header .card-count {
  font-weight: 400;
  font-size: 0.82rem;
  color: var(--text-light);
}

.category-tabs {
  display: flex;
  border-bottom: 1px solid var(--border);
  background: var(--bg);
}

.cat-tab {
  flex: 1;
  padding: 9px 8px;
  text-align: center;
  font-size: 0.78rem;
  font-weight: 600;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all var(--transition);
  color: var(--text-light);
}

.cat-tab:hover { color: var(--text); background: var(--bg-alt); }
.cat-tab.active { color: var(--accent); border-bottom-color: var(--accent); }

.card-list {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.card-list::-webkit-scrollbar { width: 6px; }
.card-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

/* Cards */
.belief-card {
  background: #fff;
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 10px 12px;
  font-size: 0.85rem;
  cursor: grab;
  transition: all var(--transition);
  position: relative;
  user-select: none;
  display: flex;
  align-items: flex-start;
  gap: 8px;
  line-height: 1.4;
}

.belief-card:hover {
  border-color: var(--accent);
  box-shadow: var(--shadow);
}

.belief-card:active { cursor: grabbing; }

.belief-card .card-cat-dot {
  width: 8px;
  height: 8px;
  min-width: 8px;
  border-radius: 50%;
  margin-top: 4px;
}

.belief-card[data-category="beliefs"] .card-cat-dot { background: #c0544f; }
.belief-card[data-category="practices"] .card-cat-dot { background: #5a9e6f; }
.belief-card[data-category="values"] .card-cat-dot { background: #6b8cae; }

.card-content { flex: 1; }
.card-title { font-weight: 600; margin-bottom: 2px; }

.card-info-btn {
  width: 22px;
  height: 22px;
  min-width: 22px;
  border-radius: 50%;
  border: 1.5px solid var(--border);
  background: transparent;
  color: var(--text-light);
  font-size: 0.72rem;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--transition);
  margin-top: 1px;
}

.card-info-btn:hover { background: var(--bg-alt); color: var(--text); }

.card-detail {
  display: none;
  font-size: 0.78rem;
  color: var(--text-light);
  margin-top: 4px;
  padding-top: 4px;
  border-top: 1px solid var(--border);
  line-height: 1.45;
}

.belief-card.show-detail .card-detail { display: block; }

/* Dragging state */
.belief-card.dragging {
  opacity: 0.85;
  transform: scale(1.04) rotate(1.5deg);
  box-shadow: var(--shadow-lg);
  z-index: 1000;
  pointer-events: none;
  position: fixed;
}

.belief-card.placed {
  border-left-width: 4px;
}

.belief-card.correct { border-color: var(--success) !important; background: #f0faf3 !important; }
.belief-card.incorrect { border-color: var(--error) !important; background: #fdf0ef !important; }

.belief-card .feedback-icon {
  display: none;
  position: absolute;
  top: -8px;
  right: -8px;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  font-size: 0.75rem;
  font-weight: 700;
  text-align: center;
  line-height: 22px;
  color: #fff;
}

.belief-card.correct .feedback-icon {
  display: block;
  background: var(--success);
}
.belief-card.incorrect .feedback-icon {
  display: block;
  background: var(--error);
}

.card-tooltip {
  display: none;
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--text);
  color: #fff;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  font-size: 0.78rem;
  white-space: nowrap;
  max-width: 260px;
  white-space: normal;
  text-align: center;
  z-index: 100;
  pointer-events: none;
  box-shadow: var(--shadow-lg);
  line-height: 1.4;
}

.card-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: var(--text);
}

.belief-card.incorrect:hover .card-tooltip,
.belief-card.correct:hover .card-tooltip { display: block; }

/* Venn Diagram Area */
.venn-area {
  flex: 1;
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

.venn-svg {
  width: 100%;
  height: 100%;
}

.zone-label {
  font-size: 13px;
  font-weight: 600;
  fill: currentColor;
  text-anchor: middle;
  pointer-events: none;
  opacity: 0.7;
}

.circle-label {
  font-size: 16px;
  font-weight: 700;
  text-anchor: middle;
  pointer-events: none;
}

.venn-zone {
  cursor: default;
  transition: fill-opacity 0.2s;
}

.venn-zone.drag-hover {
  fill-opacity: 0.35 !important;
  stroke-width: 3 !important;
}

/* Placed cards in zones */
.zone-cards-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.placed-card {
  position: absolute;
  background: #fff;
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 5px 8px;
  font-size: 0.73rem;
  font-weight: 500;
  box-shadow: var(--shadow);
  pointer-events: auto;
  cursor: grab;
  max-width: 140px;
  line-height: 1.3;
  transition: border-color var(--transition), background var(--transition);
  z-index: 5;
}

.placed-card:hover { z-index: 10; }

.placed-card .remove-btn {
  position: absolute;
  top: -7px;
  right: -7px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--text-light);
  color: #fff;
  border: none;
  font-size: 0.65rem;
  cursor: pointer;
  display: none;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

.placed-card:hover .remove-btn { display: flex; }

.placed-card.correct { border-color: var(--success); background: #f0faf3; }
.placed-card.incorrect { border-color: var(--error); background: #fdf0ef; }

.placed-card .feedback-icon {
  display: none;
  position: absolute;
  top: -8px;
  left: -8px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  font-size: 0.65rem;
  font-weight: 700;
  text-align: center;
  line-height: 18px;
  color: #fff;
}

.placed-card.correct .feedback-icon { display: block; background: var(--success); }
.placed-card.incorrect .feedback-icon { display: block; background: var(--error); }

.placed-card .card-tooltip {
  display: none;
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--text);
  color: #fff;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
  max-width: 240px;
  text-align: center;
  z-index: 100;
  pointer-events: none;
  box-shadow: var(--shadow-lg);
  line-height: 1.4;
}

.placed-card .card-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: var(--text);
}

.placed-card.incorrect:hover .card-tooltip,
.placed-card.correct:hover .card-tooltip { display: block; }

/* Empty state */
.venn-empty {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: var(--text-light);
}

.venn-empty svg {
  width: 80px;
  height: 80px;
  margin-bottom: 16px;
  opacity: 0.3;
}

.venn-empty h3 {
  font-size: 1.1rem;
  margin-bottom: 6px;
  color: var(--text);
}

.venn-empty p {
  font-size: 0.9rem;
}

/* Feedback overlay */
.feedback-toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--text);
  color: #fff;
  padding: 14px 28px;
  border-radius: var(--radius);
  font-size: 0.95rem;
  font-weight: 600;
  box-shadow: var(--shadow-lg);
  z-index: 2000;
  transition: transform 0.4s cubic-bezier(0.22,1,0.36,1);
  text-align: center;
  max-width: 500px;
}

.feedback-toast.show { transform: translateX(-50%) translateY(0); }

/* Info Modal */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(58,50,42,0.4);
  z-index: 3000;
  align-items: center;
  justify-content: center;
}

.modal-overlay.show { display: flex; }

.modal {
  background: #fff;
  border-radius: var(--radius);
  padding: 28px;
  max-width: 480px;
  width: 90%;
  box-shadow: var(--shadow-lg);
  max-height: 80vh;
  overflow-y: auto;
}

.modal h3 { margin-bottom: 8px; font-size: 1.1rem; }
.modal p { font-size: 0.9rem; line-height: 1.6; color: var(--text-light); margin-bottom: 12px; }
.modal .modal-close { margin-top: 8px; }

/* Responsive */
@media (max-width: 900px) {
  .main-layout { flex-direction: column-reverse; }
  .card-bank { width: 100%; min-width: unset; max-height: 40vh; border-right: none; border-top: 1px solid var(--border); }
  .venn-area { min-height: 50vh; }
  header { padding: 12px 16px; }
  header h1 { font-size: 1.2rem; }
  .selector-panel { padding: 12px 16px; }
}

/* Animation for card placement */
@keyframes snapIn {
  0% { transform: scale(1.15); opacity: 0.6; }
  60% { transform: scale(0.95); }
  100% { transform: scale(1); opacity: 1; }
}

.placed-card.snap-in { animation: snapIn 0.35s ease; }

/* Legend dot for placed cards */
.placed-card .cat-dot-mini {
  display: inline-block;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  margin-right: 4px;
  vertical-align: middle;
}
</style>
</head>
<body>

<header>
  <h1>Worldview Venn Diagram <span>| RE Interactive</span></h1>
  <div class="header-controls">
    <div class="score-display" id="scoreDisplay">
      Score: <span class="score-pct" id="scorePct">--%</span>
    </div>
    <button class="btn btn-secondary" id="btnCheck" onclick="checkAnswers()">Check Answers</button>
    <button class="btn btn-secondary" id="btnReveal" onclick="revealAll()">Reveal All</button>
    <button class="btn btn-secondary" id="btnReset" onclick="resetAll()">Reset</button>
  </div>
</header>

<div class="selector-panel">
  <label>Compare worldviews (select 2 or 3):</label>
  <div class="worldview-options" id="worldviewOptions">
    <div class="wv-chip" data-wv="Christianity" onclick="toggleWorldview(this)">Christianity<span class="order-badge"></span></div>
    <div class="wv-chip" data-wv="Islam" onclick="toggleWorldview(this)">Islam<span class="order-badge"></span></div>
    <div class="wv-chip" data-wv="Judaism" onclick="toggleWorldview(this)">Judaism<span class="order-badge"></span></div>
    <div class="wv-chip" data-wv="Hinduism" onclick="toggleWorldview(this)">Hinduism<span class="order-badge"></span></div>
    <div class="wv-chip" data-wv="Buddhism" onclick="toggleWorldview(this)">Buddhism<span class="order-badge"></span></div>
    <div class="wv-chip" data-wv="Sikhism" onclick="toggleWorldview(this)">Sikhism<span class="order-badge"></span></div>
    <div class="wv-chip" data-wv="Humanism" onclick="toggleWorldview(this)">Humanism<span class="order-badge"></span></div>
  </div>
  <span class="mode-note" id="modeNote">Select 2 or 3 worldviews to begin</span>
</div>

<div class="main-layout">
  <div class="card-bank" id="cardBank">
    <div class="card-bank-header">
      Card Bank
      <span class="card-count" id="cardCount">0 cards</span>
    </div>
    <div class="category-tabs">
      <div class="cat-tab active" data-cat="all" onclick="filterCategory('all', this)">All</div>
      <div class="cat-tab" data-cat="beliefs" onclick="filterCategory('beliefs', this)">Beliefs</div>
      <div class="cat-tab" data-cat="practices" onclick="filterCategory('practices', this)">Practices</div>
      <div class="cat-tab" data-cat="values" onclick="filterCategory('values', this)">Values</div>
    </div>
    <div class="card-list" id="cardList"></div>
  </div>
  <div class="venn-area" id="vennArea">
    <div class="venn-empty" id="vennEmpty">
      <svg viewBox="0 0 100 100" fill="none"><circle cx="38" cy="50" r="28" stroke="currentColor" stroke-width="2" opacity="0.4"/><circle cx="62" cy="50" r="28" stroke="currentColor" stroke-width="2" opacity="0.4"/></svg>
      <h3>Select worldviews to compare</h3>
      <p>Choose 2 or 3 worldviews from the panel above</p>
    </div>
    <svg class="venn-svg" id="vennSvg" style="display:none;"></svg>
    <div class="zone-cards-container" id="zoneCardsContainer"></div>
  </div>
</div>

<div class="feedback-toast" id="feedbackToast"></div>
<div class="modal-overlay" id="infoModal">
  <div class="modal">
    <h3 id="modalTitle"></h3>
    <p id="modalBody"></p>
    <button class="btn btn-ghost modal-close" onclick="closeModal()">Close</button>
  </div>
</div>

<script>
// ===========================
// DATA: Cards per worldview
// ===========================
const WORLDVIEW_DATA = {
  Christianity: {
    color: '#6b8cae',
    cards: [
      { id:'chr_trinity', title:'God as the Trinity (Father, Son, Holy Spirit)', category:'beliefs', detail:'The doctrine of the Trinity teaches that God is three persons in one being. This distinguishes Christianity from other monotheistic faiths.' },
      { id:'chr_jesus', title:'Jesus as the Son of God and saviour', category:'beliefs', detail:'Christians believe Jesus is the incarnation of God, who died on the cross to atone for humanity\'s sins and rose from the dead, offering salvation.' },
      { id:'chr_resurrection', title:'Belief in the resurrection of Jesus', category:'beliefs', detail:'The resurrection of Jesus on the third day after crucifixion is the foundation of Christian faith, celebrated at Easter.' },
      { id:'chr_bible', title:'The Bible (Old and New Testaments)', category:'beliefs', detail:'The Bible, comprising the Old and New Testaments, is regarded as the inspired Word of God and the primary source of Christian teaching.' },
      { id:'chr_salvation', title:'Salvation through faith in Jesus Christ', category:'beliefs', detail:'Many Christians believe that salvation (being saved from sin) comes through faith in Jesus Christ and God\'s grace, not through works alone.' },
      { id:'chr_heaven_hell', title:'Belief in heaven and hell', category:'beliefs', detail:'Most Christians believe in an afterlife where souls go to heaven (eternal life with God) or hell (separation from God), based on faith and actions.' },
      { id:'chr_original_sin', title:'The concept of original sin', category:'beliefs', detail:'Many Christians believe humanity inherited a sinful nature from Adam and Eve\'s disobedience in the Garden of Eden, which Jesus\'s sacrifice redeems.' },
      { id:'chr_worship', title:'Sunday worship and church services', category:'practices', detail:'Most Christians gather on Sundays for communal worship, including hymns, readings from the Bible, sermons, and the Eucharist/Communion.' },
      { id:'chr_baptism', title:'Baptism as a rite of passage', category:'practices', detail:'Baptism with water symbolises purification and admission into the Christian community. It may occur in infancy or upon personal profession of faith.' },
      { id:'chr_communion', title:'Holy Communion (Eucharist)', category:'practices', detail:'The Eucharist commemorates Jesus\'s Last Supper. Bread and wine (or grape juice) represent the body and blood of Christ.' },
      { id:'chr_christmas', title:'Celebrating Christmas and Easter', category:'practices', detail:'Christmas celebrates the birth of Jesus, and Easter his resurrection. These are the two most important Christian festivals.' },
      { id:'chr_lords_prayer', title:'The Lord\'s Prayer', category:'practices', detail:'The Lord\'s Prayer, taught by Jesus to his disciples, is the most widely known Christian prayer, beginning "Our Father, who art in heaven..."' },
      { id:'chr_love', title:'Love thy neighbour', category:'values', detail:'"Love your neighbour as yourself" is one of Jesus\'s greatest commandments, calling Christians to show active love and care for all people.' },
      { id:'chr_grace', title:'Grace \u2013 God\'s unconditional love', category:'values', detail:'Grace is the belief that God offers love and forgiveness freely, not because it is earned. This shapes how Christians relate to God and others.' },
      { id:'chr_sanctity', title:'Sanctity of life \u2013 life is sacred', category:'values', detail:'Christians believe all human life is sacred because humans are made in the image of God (imago Dei). This informs views on many ethical issues.' },
    ]
  },
  Islam: {
    color: '#5a9e6f',
    cards: [
      { id:'isl_shahada', title:'The Shahada \u2013 declaration of faith', category:'beliefs', detail:'The Shahada ("There is no god but Allah, and Muhammad is His messenger") is the first pillar of Islam and the foundation of Muslim belief.' },
      { id:'isl_muhammad', title:'Muhammad (PBUH) as the final prophet', category:'beliefs', detail:'Muslims believe Prophet Muhammad (peace be upon him) is the last in a line of prophets including Adam, Abraham, Moses, and Jesus, who brought God\'s final message.' },
      { id:'isl_quran', title:'The Qur\'an as the literal word of Allah', category:'beliefs', detail:'The Qur\'an is believed to be the literal word of Allah, revealed to Prophet Muhammad through the Angel Jibril (Gabriel) over 23 years.' },
      { id:'isl_judgement', title:'The Day of Judgement (Yawm al-Qiyamah)', category:'beliefs', detail:'Muslims believe in Yawm al-Qiyamah, when all people will be judged by Allah and sent to Jannah (paradise) or Jahannam (hell).' },
      { id:'isl_angels', title:'Belief in angels (malaikah)', category:'beliefs', detail:'Belief in angels is one of the six articles of faith. Angels are beings created by Allah from light to carry out His commands.' },
      { id:'isl_predestination', title:'Belief in divine predestination (Al-Qadr)', category:'beliefs', detail:'Muslims believe Allah has knowledge of all that will happen. This is balanced with the belief that humans have free will to make moral choices.' },
      { id:'isl_five_pillars', title:'The Five Pillars of Islam', category:'beliefs', detail:'The Five Pillars (Shahada, Salah, Zakat, Sawm, Hajj) are the five core duties that every Muslim must follow.' },
      { id:'isl_prayer', title:'Salah \u2013 five daily prayers facing Makkah', category:'practices', detail:'Muslims pray five times daily (Fajr, Dhuhr, Asr, Maghrib, Isha) facing Makkah. Salah is the second pillar of Islam.' },
      { id:'isl_fasting', title:'Fasting during Ramadan (Sawm)', category:'practices', detail:'During the holy month of Ramadan, Muslims fast from dawn to sunset, abstaining from food, drink, and other needs. This is the fourth pillar.' },
      { id:'isl_hajj', title:'Hajj \u2013 pilgrimage to Makkah', category:'practices', detail:'Hajj is the annual pilgrimage to Makkah that every able Muslim should undertake at least once. It is the fifth pillar of Islam.' },
      { id:'isl_zakat', title:'Zakat \u2013 giving 2.5% of savings to charity', category:'practices', detail:'Zakat (almsgiving) is the third pillar of Islam. Muslims give 2.5% of their savings annually to help those in need, purifying their wealth.' },
      { id:'isl_eidulfitri', title:'Celebrating Eid ul-Fitr and Eid ul-Adha', category:'practices', detail:'Eid ul-Fitr marks the end of Ramadan, and Eid ul-Adha commemorates Ibrahim\'s willingness to sacrifice his son. Both involve prayer, feasting, and charity.' },
      { id:'isl_halal', title:'Halal dietary laws', category:'practices', detail:'Muslims follow halal (permissible) dietary guidelines. Pork and alcohol are forbidden (haram), and meat must be slaughtered in the prescribed way.' },
      { id:'isl_ummah', title:'Ummah \u2013 the global Muslim community', category:'values', detail:'The concept of Ummah emphasises the unity and brotherhood/sisterhood of all Muslims worldwide, regardless of race, nationality, or background.' },
      { id:'isl_submission', title:'Submission to the will of Allah', category:'values', detail:'The word "Islam" means submission. Muslims strive to submit to Allah\'s will in all aspects of life, finding peace through obedience.' },
      { id:'isl_compassion', title:'Compassion and mercy (Rahma)', category:'values', detail:'Compassion and mercy are fundamental. Each chapter of the Qur\'an (except one) begins "In the name of God, the Most Gracious, the Most Merciful."' },
    ]
  },
  Judaism: {
    color: '#c4813c',
    cards: [
      { id:'jud_covenant', title:'The covenant between God and Abraham', category:'beliefs', detail:'Jews believe God made a special covenant (agreement) with Abraham and his descendants, making them His chosen people with particular responsibilities.' },
      { id:'jud_torah', title:'The Torah \u2013 first five books of the Hebrew Bible', category:'beliefs', detail:'The Torah (the first five books of the Hebrew Bible) is the most sacred text in Judaism, believed to have been given by God to Moses at Mount Sinai.' },
      { id:'jud_messiah', title:'Awaiting the coming of the Messiah', category:'beliefs', detail:'Many Jews believe a Messiah (anointed one) will come in the future to bring peace, rebuild the Temple, and gather all Jews to Israel.' },
      { id:'jud_olam_haba', title:'Olam Ha-Ba \u2013 the World to Come', category:'beliefs', detail:'Jewish views on the afterlife vary. Many believe in Olam Ha-Ba (the World to Come), though Judaism focuses more on righteous living in the present.' },
      { id:'jud_613', title:'Following the 613 mitzvot (commandments)', category:'beliefs', detail:'Traditional Judaism identifies 613 commandments (mitzvot) in the Torah, covering all aspects of life from ethics to ritual practice.' },
      { id:'jud_chosenpeople', title:'The Jewish people as chosen to follow God\'s law', category:'beliefs', detail:'Jews understand being "chosen" not as superiority but as a special responsibility to follow God\'s commandments and be a moral example.' },
      { id:'jud_mosesten', title:'Moses receiving the Ten Commandments at Sinai', category:'beliefs', detail:'The giving of the Torah to Moses at Mount Sinai is a foundational event. The Ten Commandments form the heart of Jewish moral and religious law.' },
      { id:'jud_shabbat', title:'Shabbat \u2013 weekly day of rest (Friday to Saturday)', category:'practices', detail:'Shabbat is observed from Friday sunset to Saturday nightfall. Jews rest from work, attend synagogue, share meals, and spend time with family.' },
      { id:'jud_kosher', title:'Keeping kosher \u2013 Jewish dietary laws', category:'practices', detail:'Kashrut (kosher laws) govern what Jews can eat. Pork and shellfish are forbidden, meat and dairy must not be mixed, and meat must be prepared correctly.' },
      { id:'jud_barmitzvah', title:'Bar/Bat Mitzvah \u2013 coming of age at 12/13', category:'practices', detail:'At age 13 (boys) or 12/13 (girls), young Jews become Bar/Bat Mitzvah, taking on adult religious responsibilities in a synagogue ceremony.' },
      { id:'jud_passover', title:'Celebrating Passover with the Seder meal', category:'practices', detail:'Passover commemorates the Exodus from Egypt. Families gather for the Seder meal, retelling the story and eating symbolic foods like matzah.' },
      { id:'jud_synagogue', title:'Worship at the synagogue', category:'practices', detail:'Jews worship at the synagogue, where the Torah scrolls are kept. Services include prayers, Torah readings, and the rabbi\'s sermon.' },
      { id:'jud_tzedakah', title:'Tzedakah \u2013 charitable giving as a duty of justice', category:'practices', detail:'Tzedakah (righteousness through giving) is a religious obligation in Judaism. It is considered a matter of justice, not just generosity.' },
      { id:'jud_tikkunolam', title:'Tikkun Olam \u2013 repairing the world', category:'values', detail:'Tikkun Olam is the concept of acting constructively to make the world a better place. It motivates social action and environmental care.' },
      { id:'jud_pikuach', title:'Pikuach nefesh \u2013 saving a life overrides other laws', category:'values', detail:'The principle of pikuach nefesh teaches that preserving human life is so important that it overrides almost all other commandments.' },
      { id:'jud_community', title:'Kehillah \u2013 strong sense of community and family', category:'values', detail:'Judaism places great importance on community (kehillah) and family. Shared rituals, festivals, and Shabbat strengthen communal bonds.' },
    ]
  },
  Hinduism: {
    color: '#c0544f',
    cards: [
      { id:'hin_brahman', title:'Brahman \u2013 the supreme, formless ultimate reality', category:'beliefs', detail:'Hindus believe in Brahman, the supreme, formless, infinite reality that pervades everything. Different traditions understand Brahman in varied ways.' },
      { id:'hin_manyforms', title:'God worshipped in many forms (e.g. Vishnu, Shiva, Lakshmi)', category:'beliefs', detail:'Hinduism recognises many deities as expressions of Brahman, including Brahma (creator), Vishnu (preserver), and Shiva (transformer), as well as goddesses like Lakshmi and Durga.' },
      { id:'hin_atman', title:'The atman \u2013 eternal soul in every being', category:'beliefs', detail:'Hindus believe every living being has an atman (soul) that is eternal and part of Brahman. The body is temporary, but the soul endures.' },
      { id:'hin_moksha', title:'Moksha \u2013 liberation of the soul from rebirth', category:'beliefs', detail:'The ultimate goal in Hinduism is moksha: the liberation of the atman from the cycle of rebirth, reuniting with Brahman.' },
      { id:'hin_dharma', title:'Following dharma \u2013 moral duty and righteousness', category:'beliefs', detail:'Dharma refers to moral law and duty. Hindus believe in following their dharma (righteous path) according to their stage of life and circumstances.' },
      { id:'hin_vedas', title:'Sacred texts: Vedas, Upanishads, Bhagavad Gita', category:'beliefs', detail:'Hindu scriptures include the ancient Vedas, the philosophical Upanishads, and the Bhagavad Gita, which contains Krishna\'s teachings on duty and devotion.' },
      { id:'hin_four_paths', title:'Four paths to God: karma, jnana, bhakti, raja yoga', category:'beliefs', detail:'Hinduism teaches four main paths to spiritual realisation: karma yoga (action), jnana yoga (knowledge), bhakti yoga (devotion), and raja yoga (meditation).' },
      { id:'hin_puja', title:'Puja \u2013 daily worship with offerings at a shrine', category:'practices', detail:'Puja involves offering prayers, flowers, food, and incense to deities at a home shrine (mandir) or temple. It is a daily devotional practice.' },
      { id:'hin_diwali', title:'Celebrating Diwali \u2013 festival of lights', category:'practices', detail:'Diwali celebrates the triumph of light over darkness and good over evil. Families light lamps, share sweets, and offer prayers to Lakshmi.' },
      { id:'hin_yoga', title:'Yoga as a spiritual discipline', category:'practices', detail:'Yoga is a path to spiritual growth in Hinduism, helping practitioners focus the mind, discipline the body, and connect with the divine.' },
      { id:'hin_pilgrimage', title:'Pilgrimage to sites like Varanasi and the Ganges', category:'practices', detail:'Pilgrimage (tirtha yatra) to sacred sites like Varanasi, Rishikesh, and the River Ganges is an important devotional practice in Hinduism.' },
      { id:'hin_vegetarian', title:'Vegetarianism and the sacred cow', category:'practices', detail:'Many Hindus practise vegetarianism based on the principle of ahimsa (non-violence). Cows are considered sacred and are protected.' },
      { id:'hin_cremation', title:'Cremation and scattering ashes in a holy river', category:'practices', detail:'Hindus typically cremate their dead and scatter the ashes in a holy river, believing this helps release the soul for its next journey.' },
      { id:'hin_ahimsa', title:'Ahimsa \u2013 non-violence towards all living things', category:'values', detail:'Ahimsa (non-violence) is a core Hindu value, extending compassion and respect to all living creatures. It influences diet, behaviour, and ethics.' },
      { id:'hin_seva', title:'Seva \u2013 selfless service to others', category:'values', detail:'Hindus value seva (selfless service) and karuna (compassion), believing that serving others is a form of serving God.' },
      { id:'hin_truth', title:'Satya \u2013 truthfulness in word and deed', category:'values', detail:'Truthfulness (satya) is one of the highest virtues in Hinduism. Mahatma Gandhi famously declared "Truth is God" as a guiding principle.' },
    ]
  },
  Buddhism: {
    color: '#e8a95b',
    cards: [
      { id:'bud_nogodfig', title:'No creator God \u2013 focus on the Buddha\'s teachings', category:'beliefs', detail:'Buddhism does not centre on a creator God. Instead, it focuses on the Buddha\'s teachings (Dharma) as a path to overcome suffering and reach enlightenment.' },
      { id:'bud_fourtruths', title:'The Four Noble Truths about suffering (dukkha)', category:'beliefs', detail:'The Buddha taught: (1) life involves suffering, (2) suffering is caused by craving, (3) suffering can end, (4) the way to end it is the Eightfold Path.' },
      { id:'bud_eightfold', title:'The Noble Eightfold Path', category:'beliefs', detail:'The Eightfold Path is the Buddhist guide to ethical and mental development: right view, intention, speech, action, livelihood, effort, mindfulness, and concentration.' },
      { id:'bud_nirvana', title:'Nirvana \u2013 the end of all suffering', category:'beliefs', detail:'Nirvana (or nibbana) is the ultimate goal: the cessation of suffering, craving, and the cycle of rebirth. It is a state of perfect peace and liberation.' },
      { id:'bud_threemarks', title:'Three Marks of Existence: impermanence, suffering, no-self', category:'beliefs', detail:'The Buddha taught three characteristics: anicca (impermanence), dukkha (suffering), and anatta (no permanent, unchanging self).' },
      { id:'bud_anatta', title:'Anatta \u2013 there is no permanent self or soul', category:'beliefs', detail:'Unlike Hinduism, Buddhism teaches anatta: there is no permanent, unchanging soul. What we call "self" is a collection of ever-changing processes.' },
      { id:'bud_tripitaka', title:'Sacred texts: the Tripitaka (Pali Canon)', category:'beliefs', detail:'The Tripitaka (Three Baskets) is the main collection of Buddhist scriptures, containing the Buddha\'s teachings (suttas), rules for monks, and philosophical analysis.' },
      { id:'bud_meditation', title:'Meditation \u2013 mindfulness and insight practice', category:'practices', detail:'Meditation is central to Buddhism, used to develop mindfulness (sati), concentration (samadhi), and insight (vipassana).' },
      { id:'bud_fiveprecepts', title:'Following the Five Precepts (ethical rules)', category:'practices', detail:'Lay Buddhists follow five precepts: not to kill, steal, engage in sexual misconduct, lie, or take intoxicants. These guide ethical behaviour.' },
      { id:'bud_vesak', title:'Celebrating Vesak (Buddha Day)', category:'practices', detail:'Vesak celebrates the birth, enlightenment, and death of the Buddha. It is marked with meditation, offerings, acts of kindness, and visiting temples.' },
      { id:'bud_dana', title:'Dana \u2013 practising generosity', category:'practices', detail:'Dana (generosity) is a key Buddhist practice. Giving to monks, the poor, and the community generates positive karma and develops selflessness.' },
      { id:'bud_sangha', title:'The Sangha \u2013 community of monks, nuns, and lay followers', category:'practices', detail:'The Sangha is one of the Three Jewels. Buddhist monks and nuns follow strict rules (vinaya) and serve as teachers and spiritual guides.' },
      { id:'bud_chanting', title:'Chanting sutras and taking refuge in the Three Jewels', category:'practices', detail:'Buddhists chant sutras (teachings) and take refuge in the Three Jewels: the Buddha, the Dharma (teachings), and the Sangha (community).' },
      { id:'bud_compassion', title:'Karuna \u2013 deep compassion for all sentient beings', category:'values', detail:'Karuna (compassion) is a central Buddhist value. The Buddha taught that compassion should extend to all sentient beings without exception.' },
      { id:'bud_metta', title:'Metta \u2013 loving-kindness towards all', category:'values', detail:'Metta (loving-kindness) is a practice of wishing well for all beings. The Metta Sutta describes radiating goodwill in all directions without limit.' },
      { id:'bud_middle_way', title:'The Middle Way \u2013 avoiding extremes', category:'values', detail:'The Buddha taught the Middle Way: avoiding both extreme luxury and extreme self-denial. Balance and moderation guide Buddhist living.' },
    ]
  },
  Sikhism: {
    color: '#8b7dbf',
    cards: [
      { id:'sik_ikonkar', title:'Ik Onkar \u2013 there is only one God', category:'beliefs', detail:'Sikhs believe in one God who is formless, timeless, and omnipresent, described in the opening of the Guru Granth Sahib as "Ik Onkar" (One God).' },
      { id:'sik_gurus', title:'Teachings of the ten human Gurus', category:'beliefs', detail:'Sikhism was shaped by ten human Gurus, from Guru Nanak (founder) to Guru Gobind Singh. Their teachings form the core of Sikh belief and practice.' },
      { id:'sik_gurugranthsahib', title:'Guru Granth Sahib as the eternal living Guru', category:'beliefs', detail:'The Guru Granth Sahib is treated as the eternal, living Guru. It contains hymns and teachings from the Gurus, Hindu saints, and Muslim Sufis.' },
      { id:'sik_equality', title:'All people are equal before God \u2013 no caste system', category:'beliefs', detail:'Guru Nanak taught that all people \u2013 regardless of caste, gender, race, or religion \u2013 are equal in the eyes of God. This is fundamental to Sikhism.' },
      { id:'sik_mukti', title:'Mukti \u2013 liberation through devotion to God', category:'beliefs', detail:'The ultimate aim in Sikhism is mukti: freedom from the cycle of rebirth and merging of the soul with God, achieved through devotion and righteous living.' },
      { id:'sik_hukam', title:'Living in God\'s will (Hukam)', category:'beliefs', detail:'Sikhs believe in Hukam \u2013 living according to God\'s divine will. Acceptance of Hukam brings peace and moves one closer to God.' },
      { id:'sik_nam_simran', title:'Nam Simran \u2013 remembering God\'s name always', category:'beliefs', detail:'Nam Simran (meditating on God\'s name) is the most important spiritual practice in Sikhism. Constant remembrance of God leads to spiritual liberation.' },
      { id:'sik_prayer', title:'Reciting daily prayers (Nitnem)', category:'practices', detail:'Sikhs recite set prayers at specific times: Japji Sahib in the morning, Rehras Sahib in the evening, and Kirtan Sohila before sleep.' },
      { id:'sik_gurdwara', title:'Worship at the Gurdwara with kirtan (hymn singing)', category:'practices', detail:'Sikhs worship at the Gurdwara, where the Guru Granth Sahib is kept. Services include kirtan (hymn singing), readings, and communal prayer.' },
      { id:'sik_langar', title:'Langar \u2013 free communal kitchen open to all', category:'practices', detail:'Every Gurdwara has a langar (free kitchen) where anyone, regardless of background, can eat together as equals. This expresses equality and service.' },
      { id:'sik_amrit', title:'Amrit ceremony \u2013 initiation into the Khalsa', category:'practices', detail:'The Amrit ceremony initiates Sikhs into the Khalsa (community of the committed). Initiates take on the Five Ks and commit to a disciplined life.' },
      { id:'sik_fiveKs', title:'Wearing the Five Ks (Kesh, Kangha, Kara, Kachera, Kirpan)', category:'practices', detail:'Khalsa Sikhs wear five articles of faith: Kesh (uncut hair), Kangha (comb), Kara (steel bracelet), Kachera (undergarment), and Kirpan (ceremonial sword).' },
      { id:'sik_vaisakhi', title:'Celebrating Vaisakhi \u2013 birth of the Khalsa', category:'practices', detail:'Vaisakhi marks the founding of the Khalsa by Guru Gobind Singh in 1699. It is celebrated with processions, kirtan, and langar.' },
      { id:'sik_seva', title:'Seva \u2013 selfless service as a way of life', category:'values', detail:'Seva (selfless service) is a core Sikh value. Sikhs serve others without expecting reward, as service to humanity is service to God.' },
      { id:'sik_kirat_karni', title:'Kirat Karni \u2013 earning an honest living', category:'values', detail:'Sikhs are expected to earn their living honestly through hard work and ethical means, avoiding exploitation and dishonesty.' },
      { id:'sik_vand_chakko', title:'Vand Chakko \u2013 sharing what you have with others', category:'values', detail:'Sikhs are taught to share their earnings, food, and time with others, especially those in need. This is one of the three pillars of Sikh living.' },
    ]
  },
  Humanism: {
    color: '#5ba0a0',
    cards: [
      { id:'hum_nogod', title:'No belief in God or supernatural beings', category:'beliefs', detail:'Humanists do not believe in gods or supernatural forces. They hold that the natural world is all there is and that meaning comes from human experience.' },
      { id:'hum_reason', title:'Reason and evidence as the basis for understanding', category:'beliefs', detail:'Humanists rely on reason, science, and evidence rather than faith or revelation to understand the world and make decisions.' },
      { id:'hum_onelife', title:'This is the only life we have \u2013 no afterlife', category:'beliefs', detail:'Humanists believe there is no afterlife. This makes the present life precious and motivates them to make the most of it and help others do the same.' },
      { id:'hum_evolution', title:'Evolution explains the diversity of life', category:'beliefs', detail:'Humanists accept the scientific explanation that life evolved through natural processes over billions of years, without supernatural intervention.' },
      { id:'hum_nosoul', title:'No belief in a soul that survives death', category:'beliefs', detail:'Humanists do not believe in a soul that survives death. They find meaning in the legacy of their actions, relationships, and contributions to society.' },
      { id:'hum_ethics', title:'Morality comes from empathy, not divine command', category:'beliefs', detail:'Humanists believe moral principles arise from human empathy, reason, and shared experience \u2013 not from religious authority or sacred texts.' },
      { id:'hum_purpose', title:'We create our own purpose and meaning in life', category:'beliefs', detail:'Humanists believe humans create their own meaning through relationships, creativity, learning, and contributing to human flourishing.' },
      { id:'hum_science', title:'Science as the most reliable way to understand the world', category:'beliefs', detail:'Humanists see science as the most reliable method for understanding the natural world, subject to revision as new evidence emerges.' },
      { id:'hum_ceremonies', title:'Non-religious ceremonies (namings, weddings, funerals)', category:'practices', detail:'Humanists hold non-religious ceremonies for key life events. These focus on celebrating life, love, and human connections without religious content.' },
      { id:'hum_thinking', title:'Critical thinking and questioning everything', category:'practices', detail:'Humanists encourage questioning, scepticism, and critical thinking. They believe all ideas should be open to scrutiny and evidence-based evaluation.' },
      { id:'hum_campaigning', title:'Campaigning for human rights and secularism', category:'practices', detail:'Many humanists actively campaign for human rights, secularism (separation of religion and state), and evidence-based policy making.' },
      { id:'hum_humanistday', title:'Celebrating World Humanist Day (21 June)', category:'practices', detail:'World Humanist Day celebrates humanist values. Humanist groups also participate in Darwin Day (12 Feb) and Human Rights Day (10 Dec) events.' },
      { id:'hum_dialogue', title:'Open dialogue and respectful debate', category:'practices', detail:'Humanists value open discussion, debate, and the free exchange of ideas as essential to a healthy society and personal growth.' },
      { id:'hum_goldenrule', title:'The Golden Rule \u2013 treat others as you wish to be treated', category:'values', detail:'Humanists embrace the Golden Rule as a universal ethical principle, grounded in empathy rather than divine command.' },
      { id:'hum_equality', title:'Equality and human rights for all people', category:'values', detail:'Humanists champion equal rights and dignity for all people regardless of gender, sexuality, ethnicity, or belief.' },
      { id:'hum_autonomy', title:'Individual freedom and personal autonomy', category:'values', detail:'Humanists value the right of every person to make their own choices about how to live, provided they do not harm others.' },
    ]
  }
};

// ===========================
// SHARED BELIEFS/PRACTICES DATA
// These are cards that belong to overlapping zones
// ===========================
const SHARED_CARDS = [
  // --- Shared between Abrahamic faiths ---
  { id:'shared_abr_mono', title:'Belief in one God (monotheism)', category:'beliefs',
    detail:'Christianity, Islam, Judaism, and Sikhism all affirm belief in one God, though they understand God\'s nature differently.',
    religions:['Christianity','Islam','Judaism','Sikhism'] },
  { id:'shared_abr_prophets', title:'Belief in prophets sent by God', category:'beliefs',
    detail:'Christianity, Islam, and Judaism all recognise prophets as messengers of God, including Abraham and Moses, though they differ on which prophets are most important.',
    religions:['Christianity','Islam','Judaism'] },
  { id:'shared_abr_afterlife', title:'Belief in an afterlife', category:'beliefs',
    detail:'Christianity, Islam, Judaism (in many traditions), Hinduism, Buddhism, and Sikhism all include beliefs about what happens after death, though the details vary greatly.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism'] },
  { id:'shared_abr_creation', title:'God as Creator of the universe', category:'beliefs',
    detail:'Christianity, Islam, Judaism, and Sikhism share the belief that God created the universe and everything in it.',
    religions:['Christianity','Islam','Judaism','Sikhism'] },
  { id:'shared_abr_prayer', title:'Prayer as communication with God', category:'practices',
    detail:'Prayer is a central practice in Christianity, Islam, Judaism, and Sikhism, though the form, frequency, and style of prayer differ.',
    religions:['Christianity','Islam','Judaism','Sikhism'] },
  { id:'shared_abr_holy_book', title:'A holy book as a guide for living', category:'beliefs',
    detail:'Most worldviews have key texts: the Bible, Qur\'an, Torah, Vedas, Tripitaka, and Guru Granth Sahib each serve as foundational scripture.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism'] },
  { id:'shared_abr_charity', title:'Giving to charity and helping those in need', category:'practices',
    detail:'All these worldviews emphasise the importance of charitable giving and helping the less fortunate.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism','Humanism'] },
  { id:'shared_abr_pilgrimage', title:'Pilgrimage to a holy site', category:'practices',
    detail:'Pilgrimage is practised in Christianity, Islam, Judaism, Hinduism, Buddhism, and Sikhism, each with their own sacred destinations.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism'] },
  { id:'shared_abr_fasting', title:'Fasting as a spiritual practice', category:'practices',
    detail:'Fasting is practised in Islam (Ramadan), Christianity (Lent), Judaism (Yom Kippur), Hinduism, Buddhism, and Sikhism for spiritual discipline.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism'] },
  { id:'shared_abr_festivals', title:'Religious festivals marking key events', category:'practices',
    detail:'All religious worldviews celebrate festivals that mark important events in their history and calendar.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism'] },
  { id:'shared_abr_rites', title:'Rites of passage (birth, coming of age, marriage, death)', category:'practices',
    detail:'All these worldviews have ceremonies marking life\'s key transitions, though the rituals differ significantly.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism','Humanism'] },

  // --- Shared values ---
  { id:'shared_v_compassion', title:'Compassion for others', category:'values',
    detail:'Compassion is a universal value found across all these worldviews, though it may be expressed and motivated differently.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism','Humanism'] },
  { id:'shared_v_justice', title:'Working for justice and fairness', category:'values',
    detail:'The pursuit of justice is emphasised across all these worldviews as a moral duty.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism','Humanism'] },
  { id:'shared_v_goldenrule', title:'The Golden Rule \u2013 treat others well', category:'values',
    detail:'A version of the Golden Rule appears in virtually every worldview: treat others as you would wish to be treated.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism','Humanism'] },
  { id:'shared_v_peace', title:'Working towards peace', category:'values',
    detail:'Peace \u2013 both inner and outer \u2013 is valued across all these worldviews.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism','Humanism'] },
  { id:'shared_v_community', title:'Importance of community', category:'values',
    detail:'All these worldviews recognise the importance of belonging to a community and supporting one another.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism','Humanism'] },
  { id:'shared_v_forgiveness', title:'Forgiveness', category:'values',
    detail:'Forgiveness is taught in Christianity, Islam, Judaism, Hinduism, Buddhism, and Sikhism as a virtue that frees both the forgiver and the forgiven.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism'] },
  { id:'shared_v_equality', title:'Equality of all people', category:'values',
    detail:'The belief that all people have equal worth and dignity is found across these worldviews.',
    religions:['Christianity','Islam','Judaism','Sikhism','Humanism'] },
  { id:'shared_v_stewardship', title:'Care for the environment', category:'values',
    detail:'Stewardship of the earth and care for the natural world is taught in many worldviews, both religious and non-religious.',
    religions:['Christianity','Islam','Judaism','Hinduism','Buddhism','Sikhism','Humanism'] },

  // --- Karma/rebirth ---
  { id:'shared_karma', title:'Belief in karma', category:'beliefs',
    detail:'Hinduism, Buddhism, and Sikhism all teach that actions have moral consequences (karma), though the details of how karma works differ.',
    religions:['Hinduism','Buddhism','Sikhism'] },
  { id:'shared_rebirth', title:'Belief in a cycle of rebirth (samsara)', category:'beliefs',
    detail:'Hinduism, Buddhism, and Sikhism share the concept of samsara \u2013 the cycle of birth, death, and rebirth \u2013 though they understand the nature of what is reborn differently.',
    religions:['Hinduism','Buddhism','Sikhism'] },
  { id:'shared_liberation', title:'Liberation from the cycle of rebirth as the goal', category:'beliefs',
    detail:'Hinduism (moksha), Buddhism (nirvana), and Sikhism (mukti) all aim for liberation from the cycle of rebirth, though the nature of liberation differs.',
    religions:['Hinduism','Buddhism','Sikhism'] },

  // --- Non-violence ---
  { id:'shared_nonviolence', title:'Non-violence (ahimsa) as a core principle', category:'values',
    detail:'Hinduism, Buddhism, and Sikhism all teach ahimsa (non-violence), though they apply it in different ways.',
    religions:['Hinduism','Buddhism','Sikhism'] },

  // --- Meditation ---
  { id:'shared_meditation', title:'Meditation as a spiritual practice', category:'practices',
    detail:'Meditation is practised in Hinduism, Buddhism, and Sikhism (and valued in many other traditions) as a way to develop spiritual awareness and inner peace.',
    religions:['Hinduism','Buddhism','Sikhism'] },

  // --- Dietary ---
  { id:'shared_dietary', title:'Dietary rules or guidelines', category:'practices',
    detail:'Islam (halal), Judaism (kosher), Hinduism (many vegetarian), Sikhism (some vegetarian), and Buddhism (many vegetarian) all have dietary guidelines, though the specifics differ greatly.',
    religions:['Islam','Judaism','Hinduism','Buddhism','Sikhism'] },

  // --- Christianity & Islam ---
  { id:'shared_ci_jesus', title:'Jesus as an important figure', category:'beliefs',
    detail:'Both Christians and Muslims revere Jesus. Christians believe he is the Son of God; Muslims honour him as a great prophet (Isa) but not divine.',
    religions:['Christianity','Islam'] },
  { id:'shared_ci_abraham', title:'Abraham as a key ancestor of faith', category:'beliefs',
    detail:'Abraham is a central figure in Christianity, Islam, and Judaism. He is seen as a model of faith and obedience to God.',
    religions:['Christianity','Islam','Judaism'] },
];

// ===========================
// STATE
// ===========================
let selectedWorldviews = [];
let activeCards = [];
let placedCards = {}; // cardId -> { zoneKey, x, y }
let currentCategory = 'all';
let checkMode = false;
let vennZones = {}; // zoneKey -> { path, cx, cy, religions:[] }
let vennCircles = [];
let dragState = null;

// ===========================
// WORLDVIEW SELECTION
// ===========================
function toggleWorldview(chip) {
  const wv = chip.dataset.wv;
  const idx = selectedWorldviews.indexOf(wv);
  if (idx >= 0) {
    selectedWorldviews.splice(idx, 1);
    chip.classList.remove('selected');
  } else {
    if (selectedWorldviews.length >= 3) {
      showToast('You can compare up to 3 worldviews. Deselect one first.');
      return;
    }
    selectedWorldviews.push(wv);
    chip.classList.add('selected');
  }
  // Update order badges
  document.querySelectorAll('.wv-chip').forEach(c => {
    const i = selectedWorldviews.indexOf(c.dataset.wv);
    const badge = c.querySelector('.order-badge');
    badge.textContent = i >= 0 ? String.fromCharCode(65 + i) : '';
  });
  updateModeNote();
  if (selectedWorldviews.length >= 2) {
    buildDiagram();
    buildCardBank();
  } else {
    clearDiagram();
    clearCardBank();
  }
  checkMode = false;
  clearFeedback();
  updateScore();
}

function updateModeNote() {
  const note = document.getElementById('modeNote');
  if (selectedWorldviews.length < 2) note.textContent = 'Select 2 or 3 worldviews to begin';
  else if (selectedWorldviews.length === 2) note.textContent = '2-way comparison';
  else note.textContent = '3-way comparison';
}

// ===========================
// CARD BANK
// ===========================
function buildCardBank() {
  activeCards = [];
  const selected = selectedWorldviews;

  // Unique cards for each selected worldview
  selected.forEach(wv => {
    const data = WORLDVIEW_DATA[wv];
    data.cards.forEach(card => {
      // Only add if not already placed
      activeCards.push({
        ...card,
        religions: [wv],
        correctZone: getZoneKeyForReligions([wv])
      });
    });
  });

  // Shared cards
  SHARED_CARDS.forEach(card => {
    const relevant = card.religions.filter(r => selected.includes(r));
    if (relevant.length >= 2) {
      // For 2-way: shared between 2 selected
      // For 3-way: could be shared between 2 or all 3
      activeCards.push({
        ...card,
        religions: relevant,
        correctZone: getZoneKeyForReligions(relevant)
      });
    }
  });

  renderCardBank();
}

function getZoneKeyForReligions(religions) {
  // Zone keys are sorted religion names joined by '+'
  const sorted = [...religions].filter(r => selectedWorldviews.includes(r)).sort();
  return sorted.join('+');
}

function renderCardBank() {
  const list = document.getElementById('cardList');
  list.innerHTML = '';
  const filtered = currentCategory === 'all' ? activeCards : activeCards.filter(c => c.category === currentCategory);
  // Exclude already-placed cards
  const unplaced = filtered.filter(c => !placedCards[c.id]);

  unplaced.forEach(card => {
    const el = createCardElement(card);
    list.appendChild(el);
  });

  document.getElementById('cardCount').textContent = `${unplaced.length} card${unplaced.length !== 1 ? 's' : ''}`;
}

function createCardElement(card) {
  const el = document.createElement('div');
  el.className = 'belief-card';
  el.dataset.cardId = card.id;
  el.dataset.category = card.category;
  el.draggable = false; // We use custom drag

  el.innerHTML = `
    <span class="card-cat-dot"></span>
    <div class="card-content">
      <div class="card-title">${card.title}</div>
      <div class="card-detail">${card.detail}</div>
    </div>
    <button class="card-info-btn" title="More info">i</button>
    <span class="feedback-icon"></span>
    <div class="card-tooltip"></div>
  `;

  // Info button
  el.querySelector('.card-info-btn').addEventListener('click', (e) => {
    e.stopPropagation();
    el.classList.toggle('show-detail');
  });

  // Drag start
  el.addEventListener('mousedown', (e) => startDrag(e, card, el));
  el.addEventListener('touchstart', (e) => startDrag(e, card, el), { passive: false });

  return el;
}

function clearCardBank() {
  document.getElementById('cardList').innerHTML = '';
  document.getElementById('cardCount').textContent = '0 cards';
  activeCards = [];
  placedCards = {};
}

function filterCategory(cat, tabEl) {
  currentCategory = cat;
  document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
  tabEl.classList.add('active');
  renderCardBank();
}

// ===========================
// VENN DIAGRAM
// ===========================
function clearDiagram() {
  document.getElementById('vennSvg').style.display = 'none';
  document.getElementById('vennEmpty').style.display = '';
  document.getElementById('zoneCardsContainer').innerHTML = '';
  vennZones = {};
  vennCircles = [];
  placedCards = {};
}

function buildDiagram() {
  placedCards = {};
  document.getElementById('zoneCardsContainer').innerHTML = '';
  const svg = document.getElementById('vennSvg');
  svg.style.display = '';
  document.getElementById('vennEmpty').style.display = 'none';

  const area = document.getElementById('vennArea');
  const W = area.clientWidth;
  const H = area.clientHeight;
  svg.setAttribute('viewBox', `0 0 ${W} ${H}`);

  vennZones = {};
  vennCircles = [];

  if (selectedWorldviews.length === 2) {
    build2Venn(svg, W, H);
  } else {
    build3Venn(svg, W, H);
  }
}

function build2Venn(svg, W, H) {
  const cx = W / 2;
  const cy = H / 2;
  const r = Math.min(W, H) * 0.32;
  const offset = r * 0.55;

  const A = selectedWorldviews[0];
  const B = selectedWorldviews[1];
  const colA = WORLDVIEW_DATA[A].color;
  const colB = WORLDVIEW_DATA[B].color;

  const c1 = { cx: cx - offset, cy, r, wv: A, color: colA };
  const c2 = { cx: cx + offset, cy, r, wv: B, color: colB };
  vennCircles = [c1, c2];

  // Compute zone centres
  const onlyA_cx = cx - offset - r * 0.35;
  const onlyB_cx = cx + offset + r * 0.35;
  const shared_cx = cx;

  const zoneA = getZoneKeyForReligions([A]);
  const zoneB = getZoneKeyForReligions([B]);
  const zoneAB = getZoneKeyForReligions([A, B]);

  vennZones[zoneA] = { cx: onlyA_cx, cy, religions: [A], label: 'Only ' + A };
  vennZones[zoneB] = { cx: onlyB_cx, cy, religions: [B], label: 'Only ' + B };
  vennZones[zoneAB] = { cx: shared_cx, cy, religions: [A, B], label: 'Shared' };

  // Draw SVG
  svg.innerHTML = `
    <defs>
      <clipPath id="clipA"><circle cx="${c1.cx}" cy="${c1.cy}" r="${c1.r}"/></clipPath>
      <clipPath id="clipB"><circle cx="${c2.cx}" cy="${c2.cy}" r="${c2.r}"/></clipPath>
    </defs>
    <!-- Circle A only (clip to A, exclude B) -->
    <circle class="venn-zone" data-zone="${zoneA}" cx="${c1.cx}" cy="${c1.cy}" r="${c1.r}" fill="${colA}" fill-opacity="0.18" stroke="${colA}" stroke-width="2.5"/>
    <circle class="venn-zone" data-zone="${zoneB}" cx="${c2.cx}" cy="${c2.cy}" r="${c2.r}" fill="${colB}" fill-opacity="0.18" stroke="${colB}" stroke-width="2.5"/>
    <!-- Overlap highlight -->
    <clipPath id="overlapClip"><circle cx="${c1.cx}" cy="${c1.cy}" r="${c1.r}"/></clipPath>
    <circle class="venn-zone" data-zone="${zoneAB}" cx="${c2.cx}" cy="${c2.cy}" r="${c2.r}" fill="#7a6f63" fill-opacity="0.12" stroke="none" clip-path="url(#overlapClip)"/>
    <!-- Labels -->
    <text class="circle-label" x="${c1.cx}" y="${c1.cy - c1.r - 14}" fill="${colA}">${A}</text>
    <text class="circle-label" x="${c2.cx}" y="${c2.cy - c2.r - 14}" fill="${colB}">${B}</text>
    <text class="zone-label" x="${onlyA_cx}" y="${cy + 4}">Only ${A}</text>
    <text class="zone-label" x="${onlyB_cx}" y="${cy + 4}">Only ${B}</text>
    <text class="zone-label" x="${shared_cx}" y="${cy + 4}">Shared</text>
  `;
}

function build3Venn(svg, W, H) {
  const cx = W / 2;
  const cy = H / 2;
  const r = Math.min(W, H) * 0.27;
  const offset = r * 0.58;

  const A = selectedWorldviews[0];
  const B = selectedWorldviews[1];
  const C = selectedWorldviews[2];
  const colA = WORLDVIEW_DATA[A].color;
  const colB = WORLDVIEW_DATA[B].color;
  const colC = WORLDVIEW_DATA[C].color;

  // Position circles in a triangle
  const angle = -Math.PI / 2;
  const c1 = { cx: cx + offset * Math.cos(angle), cy: cy + offset * Math.sin(angle), r, wv: A, color: colA };
  const c2 = { cx: cx + offset * Math.cos(angle + 2 * Math.PI / 3), cy: cy + offset * Math.sin(angle + 2 * Math.PI / 3), r, wv: B, color: colB };
  const c3 = { cx: cx + offset * Math.cos(angle + 4 * Math.PI / 3), cy: cy + offset * Math.sin(angle + 4 * Math.PI / 3), r, wv: C, color: colC };
  vennCircles = [c1, c2, c3];

  // Zone centres (approximate)
  const zoneA = getZoneKeyForReligions([A]);
  const zoneB = getZoneKeyForReligions([B]);
  const zoneC = getZoneKeyForReligions([C]);
  const zoneAB = getZoneKeyForReligions([A, B]);
  const zoneAC = getZoneKeyForReligions([A, C]);
  const zoneBC = getZoneKeyForReligions([B, C]);
  const zoneABC = getZoneKeyForReligions([A, B, C]);

  // Only-A is away from B and C
  const onlyA_cx = c1.cx + (c1.cx - cx) * 0.6;
  const onlyA_cy = c1.cy + (c1.cy - cy) * 0.6;
  const onlyB_cx = c2.cx + (c2.cx - cx) * 0.6;
  const onlyB_cy = c2.cy + (c2.cy - cy) * 0.6;
  const onlyC_cx = c3.cx + (c3.cx - cx) * 0.6;
  const onlyC_cy = c3.cy + (c3.cy - cy) * 0.6;

  // Pair overlaps
  const abMid_cx = (c1.cx + c2.cx) / 2;
  const abMid_cy = (c1.cy + c2.cy) / 2;
  // Push slightly away from centre
  const ab_cx = abMid_cx + (abMid_cx - cx) * 0.15;
  const ab_cy = abMid_cy + (abMid_cy - cy) * 0.15;

  const acMid_cx = (c1.cx + c3.cx) / 2;
  const acMid_cy = (c1.cy + c3.cy) / 2;
  const ac_cx = acMid_cx + (acMid_cx - cx) * 0.15;
  const ac_cy = acMid_cy + (acMid_cy - cy) * 0.15;

  const bcMid_cx = (c2.cx + c3.cx) / 2;
  const bcMid_cy = (c2.cy + c3.cy) / 2;
  const bc_cx = bcMid_cx + (bcMid_cx - cx) * 0.15;
  const bc_cy = bcMid_cy + (bcMid_cy - cy) * 0.15;

  vennZones[zoneA] = { cx: onlyA_cx, cy: onlyA_cy, religions: [A], label: 'Only ' + A };
  vennZones[zoneB] = { cx: onlyB_cx, cy: onlyB_cy, religions: [B], label: 'Only ' + B };
  vennZones[zoneC] = { cx: onlyC_cx, cy: onlyC_cy, religions: [C], label: 'Only ' + C };
  vennZones[zoneAB] = { cx: ab_cx, cy: ab_cy, religions: [A, B], label: A.substring(0,3) + ' & ' + B.substring(0,3) };
  vennZones[zoneAC] = { cx: ac_cx, cy: ac_cy, religions: [A, C], label: A.substring(0,3) + ' & ' + C.substring(0,3) };
  vennZones[zoneBC] = { cx: bc_cx, cy: bc_cy, religions: [B, C], label: B.substring(0,3) + ' & ' + C.substring(0,3) };
  vennZones[zoneABC] = { cx, cy, religions: [A, B, C], label: 'All three' };

  svg.innerHTML = `
    <defs>
      <clipPath id="clipA3"><circle cx="${c1.cx}" cy="${c1.cy}" r="${c1.r}"/></clipPath>
      <clipPath id="clipB3"><circle cx="${c2.cx}" cy="${c2.cy}" r="${c2.r}"/></clipPath>
      <clipPath id="clipC3"><circle cx="${c3.cx}" cy="${c3.cy}" r="${c3.r}"/></clipPath>
    </defs>
    <!-- Base circles -->
    <circle class="venn-zone" data-zone="${zoneA}" cx="${c1.cx}" cy="${c1.cy}" r="${c1.r}" fill="${colA}" fill-opacity="0.16" stroke="${colA}" stroke-width="2.5"/>
    <circle class="venn-zone" data-zone="${zoneB}" cx="${c2.cx}" cy="${c2.cy}" r="${c2.r}" fill="${colB}" fill-opacity="0.16" stroke="${colB}" stroke-width="2.5"/>
    <circle class="venn-zone" data-zone="${zoneC}" cx="${c3.cx}" cy="${c3.cy}" r="${c3.r}" fill="${colC}" fill-opacity="0.16" stroke="${colC}" stroke-width="2.5"/>
    <!-- Overlap zones (drawn with clip paths for hit detection) -->
    <circle class="venn-zone" data-zone="${zoneAB}" cx="${c2.cx}" cy="${c2.cy}" r="${c2.r}" fill="${colA}" fill-opacity="0.08" stroke="none" clip-path="url(#clipA3)"/>
    <circle class="venn-zone" data-zone="${zoneAC}" cx="${c3.cx}" cy="${c3.cy}" r="${c3.r}" fill="${colA}" fill-opacity="0.08" stroke="none" clip-path="url(#clipA3)"/>
    <circle class="venn-zone" data-zone="${zoneBC}" cx="${c3.cx}" cy="${c3.cy}" r="${c3.r}" fill="${colB}" fill-opacity="0.08" stroke="none" clip-path="url(#clipB3)"/>
    <!-- Labels above circles -->
    <text class="circle-label" x="${c1.cx}" y="${c1.cy - c1.r - 12}" fill="${colA}">${A}</text>
    <text class="circle-label" x="${c2.cx}" y="${c2.cy + c2.r + 24}" fill="${colB}">${B}</text>
    <text class="circle-label" x="${c3.cx}" y="${c3.cy + c3.r + 24}" fill="${colC}">${C}</text>
    <!-- Zone labels -->
    <text class="zone-label" x="${onlyA_cx}" y="${onlyA_cy + 4}" font-size="11">Only ${A}</text>
    <text class="zone-label" x="${onlyB_cx}" y="${onlyB_cy + 4}" font-size="11">Only ${B}</text>
    <text class="zone-label" x="${onlyC_cx}" y="${onlyC_cy + 4}" font-size="11">Only ${C}</text>
    <text class="zone-label" x="${cx}" y="${cy + 4}" font-size="11">All three</text>
  `;
}

// ===========================
// DRAG AND DROP
// ===========================
function startDrag(e, card, el) {
  if (e.target.closest('.card-info-btn') || e.target.closest('.remove-btn')) return;
  e.preventDefault();

  const touch = e.touches ? e.touches[0] : e;
  const rect = el.getBoundingClientRect();

  dragState = {
    card,
    el,
    offsetX: touch.clientX - rect.left,
    offsetY: touch.clientY - rect.top,
    startX: touch.clientX,
    startY: touch.clientY,
    ghost: null
  };

  // Create ghost
  const ghost = document.createElement('div');
  ghost.className = 'belief-card dragging';
  ghost.style.width = rect.width + 'px';
  ghost.innerHTML = `<span class="card-cat-dot" style="background:${getCatColor(card.category)}"></span><div class="card-content"><div class="card-title">${card.title}</div></div>`;
  ghost.style.left = (touch.clientX - dragState.offsetX) + 'px';
  ghost.style.top = (touch.clientY - dragState.offsetY) + 'px';
  document.body.appendChild(ghost);
  dragState.ghost = ghost;

  el.style.opacity = '0.3';

  document.addEventListener('mousemove', onDragMove);
  document.addEventListener('mouseup', onDragEnd);
  document.addEventListener('touchmove', onDragMove, { passive: false });
  document.addEventListener('touchend', onDragEnd);
}

function onDragMove(e) {
  if (!dragState) return;
  e.preventDefault();
  const touch = e.touches ? e.touches[0] : e;
  dragState.ghost.style.left = (touch.clientX - dragState.offsetX) + 'px';
  dragState.ghost.style.top = (touch.clientY - dragState.offsetY) + 'px';

  // Highlight zone
  highlightZone(touch.clientX, touch.clientY);
}

function onDragEnd(e) {
  if (!dragState) return;
  const touch = e.changedTouches ? e.changedTouches[0] : e;

  // Determine which zone the card was dropped in
  const zone = getZoneAtPoint(touch.clientX, touch.clientY);

  if (zone) {
    placeCard(dragState.card, zone, touch.clientX, touch.clientY);
  }

  // Cleanup
  dragState.el.style.opacity = '';
  if (dragState.ghost) dragState.ghost.remove();
  clearZoneHighlights();

  document.removeEventListener('mousemove', onDragMove);
  document.removeEventListener('mouseup', onDragEnd);
  document.removeEventListener('touchmove', onDragMove);
  document.removeEventListener('touchend', onDragEnd);
  dragState = null;
}

function getCatColor(cat) {
  if (cat === 'beliefs') return '#c0544f';
  if (cat === 'practices') return '#5a9e6f';
  return '#6b8cae';
}

function getZoneAtPoint(x, y) {
  const area = document.getElementById('vennArea');
  const areaRect = area.getBoundingClientRect();
  const svg = document.getElementById('vennSvg');
  const svgRect = svg.getBoundingClientRect();

  // Convert to SVG coordinates
  const viewBox = svg.getAttribute('viewBox').split(' ').map(Number);
  const svgX = (x - svgRect.left) / svgRect.width * viewBox[2];
  const svgY = (y - svgRect.top) / svgRect.height * viewBox[3];

  // Check which circles contain this point
  const inside = [];
  vennCircles.forEach(c => {
    const dx = svgX - c.cx;
    const dy = svgY - c.cy;
    if (dx * dx + dy * dy <= c.r * c.r) {
      inside.push(c.wv);
    }
  });

  if (inside.length === 0) return null;

  const zoneKey = getZoneKeyForReligions(inside);
  return vennZones[zoneKey] ? zoneKey : null;
}

function highlightZone(x, y) {
  clearZoneHighlights();
  const zone = getZoneAtPoint(x, y);
  if (zone) {
    // Highlight all SVG zone elements that match
    document.querySelectorAll('.venn-zone').forEach(el => {
      if (el.dataset.zone === zone) {
        el.classList.add('drag-hover');
      }
    });
  }
}

function clearZoneHighlights() {
  document.querySelectorAll('.venn-zone.drag-hover').forEach(el => el.classList.remove('drag-hover'));
}

function placeCard(card, zoneKey, dropX, dropY) {
  const zone = vennZones[zoneKey];
  if (!zone) return;

  const area = document.getElementById('vennArea');
  const areaRect = area.getBoundingClientRect();
  const svg = document.getElementById('vennSvg');
  const svgRect = svg.getBoundingClientRect();
  const viewBox = svg.getAttribute('viewBox').split(' ').map(Number);

  // Convert zone centre from SVG coords to pixel coords
  const pixelX = zone.cx / viewBox[2] * svgRect.width + (svgRect.left - areaRect.left);
  const pixelY = zone.cy / viewBox[3] * svgRect.height + (svgRect.top - areaRect.top);

  // Stack cards in the zone with some offset
  const existingInZone = Object.values(placedCards).filter(p => p.zoneKey === zoneKey);
  const stackOffset = existingInZone.length;
  const cols = 2;
  const row = Math.floor(stackOffset / cols);
  const col = stackOffset % cols;

  const cardX = pixelX - 70 + col * 75 + (Math.random() - 0.5) * 10;
  const cardY = pixelY - 20 + row * 40 + (Math.random() - 0.5) * 8;

  placedCards[card.id] = { zoneKey, x: cardX, y: cardY, card };

  renderPlacedCards();
  renderCardBank();

  if (checkMode) {
    checkAnswers();
  }
  updateScore();
}

function renderPlacedCards() {
  const container = document.getElementById('zoneCardsContainer');
  container.innerHTML = '';

  Object.entries(placedCards).forEach(([cardId, placement]) => {
    const card = placement.card;
    const el = document.createElement('div');
    el.className = 'placed-card snap-in';
    el.dataset.cardId = cardId;
    el.style.left = placement.x + 'px';
    el.style.top = placement.y + 'px';

    el.innerHTML = `
      <span class="cat-dot-mini" style="background:${getCatColor(card.category)}"></span>${card.title}
      <button class="remove-btn" title="Remove">x</button>
      <span class="feedback-icon"></span>
      <div class="card-tooltip"></div>
    `;

    el.querySelector('.remove-btn').addEventListener('click', (e) => {
      e.stopPropagation();
      delete placedCards[cardId];
      renderPlacedCards();
      renderCardBank();
      if (checkMode) checkAnswers();
      updateScore();
    });

    // Make placed card draggable again
    el.addEventListener('mousedown', (e) => startPlacedDrag(e, card, el, cardId));
    el.addEventListener('touchstart', (e) => startPlacedDrag(e, card, el, cardId), { passive: false });

    container.appendChild(el);
  });
}

function startPlacedDrag(e, card, el, cardId) {
  if (e.target.closest('.remove-btn')) return;
  e.preventDefault();

  const touch = e.touches ? e.touches[0] : e;
  const rect = el.getBoundingClientRect();

  // Remove from placed
  delete placedCards[cardId];
  renderPlacedCards();
  renderCardBank();

  dragState = {
    card,
    el: document.querySelector(`.belief-card[data-card-id="${cardId}"]`) || el,
    offsetX: touch.clientX - rect.left,
    offsetY: touch.clientY - rect.top,
    ghost: null
  };

  const ghost = document.createElement('div');
  ghost.className = 'belief-card dragging';
  ghost.style.width = '200px';
  ghost.innerHTML = `<span class="card-cat-dot" style="background:${getCatColor(card.category)}"></span><div class="card-content"><div class="card-title">${card.title}</div></div>`;
  ghost.style.left = (touch.clientX - dragState.offsetX) + 'px';
  ghost.style.top = (touch.clientY - dragState.offsetY) + 'px';
  document.body.appendChild(ghost);
  dragState.ghost = ghost;

  document.addEventListener('mousemove', onDragMove);
  document.addEventListener('mouseup', onPlacedDragEnd);
  document.addEventListener('touchmove', onDragMove, { passive: false });
  document.addEventListener('touchend', onPlacedDragEnd);
}

function onPlacedDragEnd(e) {
  if (!dragState) return;
  const touch = e.changedTouches ? e.changedTouches[0] : e;
  const zone = getZoneAtPoint(touch.clientX, touch.clientY);

  if (zone) {
    placeCard(dragState.card, zone, touch.clientX, touch.clientY);
  }
  // If dropped outside, card returns to bank (already removed from placedCards)

  if (dragState.ghost) dragState.ghost.remove();
  clearZoneHighlights();

  document.removeEventListener('mousemove', onDragMove);
  document.removeEventListener('mouseup', onPlacedDragEnd);
  document.removeEventListener('touchmove', onDragMove);
  document.removeEventListener('touchend', onPlacedDragEnd);
  dragState = null;

  renderCardBank();
  updateScore();
}

// ===========================
// CHECK ANSWERS
// ===========================
function checkAnswers() {
  checkMode = true;
  let correct = 0;
  let total = Object.keys(placedCards).length;

  Object.entries(placedCards).forEach(([cardId, placement]) => {
    const card = placement.card;
    const isCorrect = placement.zoneKey === card.correctZone;
    if (isCorrect) correct++;

    // Update placed card visuals
    const el = document.querySelector(`.placed-card[data-card-id="${cardId}"]`);
    if (el) {
      el.classList.remove('correct', 'incorrect');
      el.classList.add(isCorrect ? 'correct' : 'incorrect');
      const icon = el.querySelector('.feedback-icon');
      icon.textContent = isCorrect ? '\u2713' : '\u2717';
      const tooltip = el.querySelector('.card-tooltip');
      if (isCorrect) {
        tooltip.textContent = 'Correct! This belongs here.';
      } else {
        const correctZone = vennZones[card.correctZone];
        tooltip.textContent = correctZone
          ? `This should be in: ${correctZone.label || card.correctZone.replace(/\+/g, ' & ')}`
          : 'Check which worldviews share this.';
      }
    }
  });

  if (total > 0) {
    const pct = Math.round(correct / total * 100);
    updateScore(pct, correct, total);

    if (pct === 100) {
      showToast(`Excellent! All ${total} cards placed correctly! Well done!`);
    } else if (pct >= 70) {
      showToast(`Good effort! ${correct}/${total} correct (${pct}%). Keep going!`);
    } else if (pct >= 40) {
      showToast(`${correct}/${total} correct (${pct}%). Review the highlighted cards and try again.`);
    } else {
      showToast(`${correct}/${total} correct (${pct}%). Don\u2019t give up \u2013 try moving the red cards.`);
    }
  } else {
    showToast('Place some cards on the diagram first, then check your answers.');
  }
}

function clearFeedback() {
  checkMode = false;
  document.querySelectorAll('.placed-card').forEach(el => {
    el.classList.remove('correct', 'incorrect');
  });
}

function updateScore(pct, correct, total) {
  const el = document.getElementById('scorePct');
  if (pct !== undefined) {
    el.textContent = pct + '%';
    el.style.color = pct >= 70 ? '#a8e6b0' : pct >= 40 ? '#ffe0a0' : '#ffa0a0';
  } else {
    const totalCards = activeCards.length;
    const placedCount = Object.keys(placedCards).length;
    el.textContent = placedCount > 0 ? `${placedCount}/${totalCards}` : '--%';
    el.style.color = '';
  }
}

// ===========================
// REVEAL ALL
// ===========================
function revealAll() {
  if (selectedWorldviews.length < 2) {
    showToast('Select worldviews first.');
    return;
  }

  placedCards = {};

  activeCards.forEach(card => {
    const zoneKey = card.correctZone;
    if (!vennZones[zoneKey]) return;

    const zone = vennZones[zoneKey];
    const existing = Object.values(placedCards).filter(p => p.zoneKey === zoneKey);
    const stackOffset = existing.length;
    const cols = 2;
    const row = Math.floor(stackOffset / cols);
    const col = stackOffset % cols;

    const area = document.getElementById('vennArea');
    const areaRect = area.getBoundingClientRect();
    const svg = document.getElementById('vennSvg');
    const svgRect = svg.getBoundingClientRect();
    const viewBox = svg.getAttribute('viewBox').split(' ').map(Number);

    const pixelX = zone.cx / viewBox[2] * svgRect.width + (svgRect.left - areaRect.left);
    const pixelY = zone.cy / viewBox[3] * svgRect.height + (svgRect.top - areaRect.top);

    const cardX = pixelX - 70 + col * 75 + (Math.random() - 0.5) * 8;
    const cardY = pixelY - 30 + row * 34 + (Math.random() - 0.5) * 6;

    placedCards[card.id] = { zoneKey, x: cardX, y: cardY, card };
  });

  renderPlacedCards();
  renderCardBank();
  checkMode = true;

  // Mark all correct
  document.querySelectorAll('.placed-card').forEach(el => {
    el.classList.add('correct');
    el.querySelector('.feedback-icon').textContent = '\u2713';
    el.querySelector('.card-tooltip').textContent = 'Correctly placed.';
  });

  updateScore(100, activeCards.length, activeCards.length);
  showToast('All cards have been placed correctly for discussion.');
}

// ===========================
// RESET
// ===========================
function resetAll() {
  placedCards = {};
  checkMode = false;
  renderPlacedCards();
  renderCardBank();
  updateScore();
  showToast('All cards returned to the card bank.');
}

// ===========================
// TOAST
// ===========================
function showToast(msg) {
  const toast = document.getElementById('feedbackToast');
  toast.textContent = msg;
  toast.classList.add('show');
  clearTimeout(toast._timer);
  toast._timer = setTimeout(() => toast.classList.remove('show'), 4000);
}

// ===========================
// MODAL
// ===========================
function showModal(title, body) {
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('modalBody').textContent = body;
  document.getElementById('infoModal').classList.add('show');
}

function closeModal() {
  document.getElementById('infoModal').classList.remove('show');
}

document.getElementById('infoModal').addEventListener('click', (e) => {
  if (e.target === e.currentTarget) closeModal();
});

// ===========================
// RESIZE HANDLER
// ===========================
let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => {
    if (selectedWorldviews.length >= 2) {
      // Save placed cards, rebuild, reposition
      const savedPlacements = { ...placedCards };
      buildDiagram();

      // Reposition placed cards to their zones
      Object.entries(savedPlacements).forEach(([cardId, placement]) => {
        const zoneKey = placement.zoneKey;
        if (vennZones[zoneKey]) {
          const zone = vennZones[zoneKey];
          const area = document.getElementById('vennArea');
          const areaRect = area.getBoundingClientRect();
          const svg = document.getElementById('vennSvg');
          const svgRect = svg.getBoundingClientRect();
          const viewBox = svg.getAttribute('viewBox').split(' ').map(Number);

          const pixelX = zone.cx / viewBox[2] * svgRect.width + (svgRect.left - areaRect.left);
          const pixelY = zone.cy / viewBox[3] * svgRect.height + (svgRect.top - areaRect.top);

          const existing = Object.values(placedCards).filter(p => p.zoneKey === zoneKey);
          const stackOffset = existing.length;
          const cols = 2;
          const row = Math.floor(stackOffset / cols);
          const col = stackOffset % cols;

          placedCards[cardId] = {
            ...placement,
            x: pixelX - 70 + col * 75 + (Math.random() - 0.5) * 8,
            y: pixelY - 20 + row * 34 + (Math.random() - 0.5) * 6
          };
        }
      });

      renderPlacedCards();
      if (checkMode) checkAnswers();
    }
  }, 250);
});

// ===========================
// INIT
// ===========================
updateScore();
</script>
</body>
</html>
