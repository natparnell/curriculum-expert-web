<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Periodic Table Explorer</title>
<style>
/* ============================================================
   CSS VARIABLES AND BASE STYLES
   ============================================================ */
:root {
  --bg: #f0f2f5;
  --surface: #ffffff;
  --text: #1a1a2e;
  --text-muted: #5a6278;
  --text-light: #8892a4;
  --border: #dde1e8;
  --border-light: #ebeef3;
  --header-bg: #1a1a2e;
  --header-text: #ffffff;
  --accent: #3b82f6;
  --accent-light: #93bbfd;
  --panel-bg: #ffffff;
  --panel-shadow: 0 4px 24px rgba(0,0,0,0.12);
  /* Category colours */
  --cat-alkali: #ff6b6b;
  --cat-alkaline: #ffa94d;
  --cat-transition: #ffd43b;
  --cat-post-transition: #69db7c;
  --cat-metalloid: #66d9e8;
  --cat-nonmetal: #74c0fc;
  --cat-halogen: #b197fc;
  --cat-noble: #f783ac;
  --cat-lanthanide: #e8a598;
  --cat-actinide: #c8b6e2;
  --cat-unknown: #ced4da;
  /* Trend gradient endpoints */
  --trend-low: #4fc3f7;
  --trend-mid: #fff176;
  --trend-high: #ef5350;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  line-height: 1.5;
}

/* ============================================================
   HEADER
   ============================================================ */
header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--header-bg);
  color: var(--header-text);
  padding: 10px 24px;
  display: flex;
  align-items: center;
  gap: 18px;
  flex-wrap: wrap;
  box-shadow: 0 2px 12px rgba(0,0,0,0.25);
}

header h1 {
  font-size: 1.3rem;
  font-weight: 700;
  letter-spacing: 0.5px;
  white-space: nowrap;
}

header .subtitle {
  font-size: 0.78rem;
  opacity: 0.65;
  margin-top: 1px;
}

.header-left {
  display: flex;
  flex-direction: column;
}

/* ============================================================
   CONTROLS (Search, Trend Buttons, Info Toggle)
   ============================================================ */
.controls {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
  margin-left: auto;
}

.search-wrap {
  position: relative;
}

.search-wrap svg {
  position: absolute;
  left: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 14px;
  height: 14px;
  stroke: rgba(255,255,255,0.45);
  fill: none;
  stroke-width: 2;
  pointer-events: none;
}

.controls input[type=text] {
  padding: 6px 12px 6px 28px;
  border-radius: 6px;
  border: 1px solid rgba(255,255,255,0.25);
  background: rgba(255,255,255,0.1);
  color: #fff;
  font-size: 0.82rem;
  width: 180px;
  outline: none;
  transition: border 0.2s, background 0.2s;
}

.controls input[type=text]::placeholder {
  color: rgba(255,255,255,0.45);
}

.controls input[type=text]:focus {
  border-color: var(--accent);
  background: rgba(255,255,255,0.18);
}

.trend-btns {
  display: flex;
  gap: 3px;
  flex-wrap: wrap;
}

.trend-btn {
  padding: 5px 10px;
  border-radius: 5px;
  border: 1px solid rgba(255,255,255,0.25);
  background: transparent;
  color: #fff;
  font-size: 0.72rem;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.trend-btn:hover {
  background: rgba(255,255,255,0.15);
}

.trend-btn.active {
  background: var(--accent);
  border-color: var(--accent);
}

.info-toggle {
  padding: 5px 12px;
  border-radius: 5px;
  border: 1px solid rgba(255,255,255,0.25);
  background: transparent;
  color: #fff;
  font-size: 0.72rem;
  cursor: pointer;
  transition: all 0.2s;
}

.info-toggle:hover {
  background: rgba(255,255,255,0.15);
}

.info-toggle.active {
  background: #16a34a;
  border-color: #16a34a;
}

/* ============================================================
   LEGEND BAR (shown when trend overlay is active)
   ============================================================ */
.legend-bar {
  display: none;
  padding: 8px 20px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  align-items: center;
  gap: 14px;
  font-size: 0.78rem;
  flex-wrap: wrap;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}

.legend-bar.visible {
  display: flex;
}

.legend-bar strong {
  color: var(--text);
  font-size: 0.82rem;
}

.legend-gradient {
  width: 220px;
  height: 14px;
  border-radius: 4px;
  background: linear-gradient(to right, #4fc3f7, #fff176, #ef5350);
  border: 1px solid var(--border);
}

.legend-labels {
  display: flex;
  justify-content: space-between;
  width: 220px;
  font-size: 0.68rem;
  color: var(--text-muted);
  margin-top: 1px;
}

.legend-note {
  font-size: 0.7rem;
  color: var(--text-light);
  font-style: italic;
}

/* ============================================================
   CATEGORY LEGEND (colour chips above table)
   ============================================================ */
.category-legend {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-bottom: 12px;
  font-size: 0.7rem;
}

.cat-chip {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  border-radius: 4px;
  background: var(--surface);
  border: 1px solid var(--border);
  white-space: nowrap;
}

.cat-dot {
  width: 10px;
  height: 10px;
  border-radius: 2px;
  flex-shrink: 0;
}

/* ============================================================
   MAIN LAYOUT
   ============================================================ */
.main-wrap {
  display: flex;
  gap: 0;
  min-height: calc(100vh - 56px);
}

.table-area {
  flex: 1;
  overflow: auto;
  padding: 16px 20px;
}

/* ============================================================
   PERIODIC TABLE GRID
   ============================================================ */
.ptable {
  display: grid;
  grid-template-columns: repeat(18, minmax(54px, 1fr));
  gap: 2px;
  min-width: 980px;
}

.element-cell {
  position: relative;
  padding: 3px 4px;
  border-radius: 4px;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.15s;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 54px;
  font-size: 0.65rem;
  text-align: center;
  user-select: none;
}

.element-cell:hover {
  border-color: var(--text);
  transform: scale(1.1);
  z-index: 10;
  box-shadow: 0 3px 10px rgba(0,0,0,0.18);
}

.element-cell.selected {
  border-color: var(--accent);
  box-shadow: 0 0 0 2px var(--accent);
  z-index: 11;
}

.element-cell.highlighted {
  border-color: #f59e0b;
  box-shadow: 0 0 0 2px #f59e0b;
  z-index: 9;
}

.element-cell.dimmed {
  opacity: 0.15;
}

.el-number {
  font-size: 0.52rem;
  color: rgba(0,0,0,0.5);
  align-self: flex-start;
  line-height: 1;
}

.el-symbol {
  font-size: 0.95rem;
  font-weight: 700;
  line-height: 1.15;
  color: rgba(0,0,0,0.85);
}

.el-name {
  font-size: 0.46rem;
  line-height: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 100%;
  color: rgba(0,0,0,0.6);
}

.spacer {
  visibility: hidden;
}

.lanthanide-label,
.actinide-label {
  grid-column: 1 / 4;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--text-muted);
  padding-right: 8px;
}

.period-label {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.65rem;
  font-weight: 600;
  color: var(--text-light);
}

/* ============================================================
   SIDE PANEL (element details)
   ============================================================ */
.side-panel {
  width: 350px;
  background: var(--panel-bg);
  border-left: 1px solid var(--border);
  overflow-y: auto;
  padding: 20px;
  transition: transform 0.3s;
  box-shadow: -2px 0 16px rgba(0,0,0,0.06);
}

.side-panel.closed {
  display: none;
}

.panel-close {
  float: right;
  background: none;
  border: none;
  font-size: 1.3rem;
  cursor: pointer;
  color: var(--text-muted);
  padding: 2px 8px;
  border-radius: 4px;
  transition: background 0.15s;
}

.panel-close:hover {
  background: var(--border);
}

.panel-header {
  display: flex;
  align-items: baseline;
  gap: 12px;
  margin-bottom: 8px;
  clear: both;
}

.panel-symbol {
  font-size: 3rem;
  font-weight: 800;
  line-height: 1;
}

.panel-name {
  font-size: 1.15rem;
  font-weight: 600;
}

.panel-number {
  font-size: 0.82rem;
  color: var(--text-muted);
}

.panel-cat {
  display: inline-block;
  padding: 3px 12px;
  border-radius: 12px;
  font-size: 0.72rem;
  font-weight: 600;
  margin-bottom: 16px;
}

.panel-section {
  margin-bottom: 18px;
}

.panel-section h3 {
  font-size: 0.78rem;
  text-transform: uppercase;
  letter-spacing: 0.6px;
  color: var(--text-muted);
  margin-bottom: 8px;
  border-bottom: 1px solid var(--border-light);
  padding-bottom: 4px;
}

.prop-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 5px 14px;
  font-size: 0.8rem;
}

.prop-label {
  color: var(--text-muted);
}

.prop-value {
  font-weight: 600;
  text-align: right;
}

/* ============================================================
   SHELL DIAGRAM (SVG in side panel)
   ============================================================ */
.shell-diagram-wrap {
  display: flex;
  justify-content: center;
  padding: 8px 0;
}

/* ============================================================
   STATE INDICATOR (dot in side panel)
   ============================================================ */
.state-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 0.75rem;
  padding: 2px 10px;
  border-radius: 10px;
  background: var(--border-light);
  margin-left: 6px;
}

.state-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
}

.state-dot.gas { background: #38bdf8; }
.state-dot.liquid { background: #2563eb; }
.state-dot.solid { background: #64748b; }
.state-dot.unknown { background: #d1d5db; }

/* ============================================================
   INFO PANEL (modal overlay)
   ============================================================ */
.info-panel {
  display: none;
  position: fixed;
  top: 60px;
  left: 50%;
  transform: translateX(-50%);
  width: 680px;
  max-width: 94vw;
  max-height: calc(100vh - 80px);
  overflow-y: auto;
  background: var(--panel-bg);
  border-radius: 14px;
  box-shadow: var(--panel-shadow);
  padding: 30px 32px;
  z-index: 200;
  border: 1px solid var(--border);
}

.info-panel.visible {
  display: block;
}

.info-panel h2 {
  font-size: 1.2rem;
  margin-bottom: 12px;
  color: var(--header-bg);
}

.info-panel h3 {
  font-size: 0.95rem;
  margin: 16px 0 8px;
  color: var(--accent);
}

.info-panel p,
.info-panel li {
  font-size: 0.84rem;
  line-height: 1.65;
  color: var(--text);
}

.info-panel ul {
  margin-left: 18px;
  margin-bottom: 8px;
}

.info-panel li {
  margin-bottom: 4px;
}

.info-close {
  float: right;
  background: none;
  border: none;
  font-size: 1.3rem;
  cursor: pointer;
  color: var(--text-muted);
  padding: 2px 8px;
  border-radius: 4px;
}

.info-close:hover {
  background: var(--border);
}

.info-overlay-bg {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.35);
  z-index: 199;
}

.info-overlay-bg.visible {
  display: block;
}

/* ============================================================
   FILTER BUTTONS (category filter)
   ============================================================ */
.filter-wrap {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

.filter-btn {
  padding: 3px 9px;
  border-radius: 4px;
  border: 1px solid var(--border);
  background: var(--surface);
  font-size: 0.68rem;
  cursor: pointer;
  transition: all 0.15s;
  color: var(--text);
}

.filter-btn:hover {
  border-color: var(--accent);
}

.filter-btn.active {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

/* ============================================================
   RESPONSIVE
   ============================================================ */
@media (max-width: 1100px) {
  .side-panel {
    position: fixed;
    right: 0;
    top: 56px;
    bottom: 0;
    z-index: 150;
    width: 330px;
  }
}

@media (max-width: 768px) {
  header { padding: 8px 12px; gap: 10px; }
  header h1 { font-size: 1.05rem; }
  .controls input[type=text] { width: 140px; }
  .side-panel { width: 100%; }
  .ptable { min-width: 920px; }
  .table-area { padding: 10px 8px; }
}
</style>
</head>
<body>

<!-- ============================================================
     HEADER
     ============================================================ -->
<header>
  <div class="header-left">
    <h1>Periodic Table Explorer</h1>
    <div class="subtitle">Interactive periodic table with element details, electron configurations, and trend overlays</div>
  </div>
  <div class="controls">
    <div class="search-wrap">
      <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/></svg>
      <input type="text" id="searchBox" placeholder="Search element..." autocomplete="off">
    </div>
    <div class="trend-btns">
      <button class="trend-btn" data-trend="electronegativity">Electronegativity</button>
      <button class="trend-btn" data-trend="atomicRadius">Atomic Radius</button>
      <button class="trend-btn" data-trend="ionisationEnergy">Ionisation Energy</button>
      <button class="trend-btn" data-trend="meltingPoint">Melting Point</button>
    </div>
    <button class="info-toggle" id="infoToggle">Periodic Trends Info</button>
  </div>
</header>

<!-- ============================================================
     LEGEND BAR
     ============================================================ -->
<div class="legend-bar" id="legendBar">
  <strong id="legendTitle">Electronegativity</strong>
  <div>
    <div class="legend-gradient"></div>
    <div class="legend-labels">
      <span id="legendLow">Low</span>
      <span>Medium</span>
      <span id="legendHigh">High</span>
    </div>
  </div>
  <span class="legend-note" id="legendNote">Grey cells have no data for this property.</span>
</div>

<!-- ============================================================
     MAIN CONTENT
     ============================================================ -->
<div class="main-wrap">
  <div class="table-area">
    <div class="category-legend" id="catLegend"></div>
    <div class="ptable" id="ptable"></div>
  </div>

  <!-- Side panel for element details -->
  <div class="side-panel closed" id="sidePanel">
    <button class="panel-close" id="panelClose" aria-label="Close panel">&times;</button>
    <div id="panelContent"></div>
  </div>
</div>

<!-- ============================================================
     INFO PANEL OVERLAY
     ============================================================ -->
<div class="info-overlay-bg" id="infoOverlayBg"></div>
<div class="info-panel" id="infoPanel">
  <button class="info-close" id="infoClose" aria-label="Close info">&times;</button>
  <h2>Understanding the Periodic Table</h2>

  <p>The periodic table is one of the most important tools in chemistry and science.
  It organises all 118 known chemical elements by their atomic number (the number of
  protons in the nucleus), electron configuration, and recurring chemical properties.
  Elements in the same column share similar chemical behaviour, which is why the
  arrangement is so powerful for predicting reactions and properties.</p>

  <h3>Groups (Columns)</h3>
  <p>There are 18 groups (vertical columns). Elements within the same group have the
  same number of valence (outermost) electrons, which gives them similar chemical
  reactivity. For example:</p>
  <ul>
    <li><strong>Group 1 (Alkali Metals)</strong>: One valence electron; highly reactive,
    especially with water. Reactivity increases down the group (lithium to caesium).</li>
    <li><strong>Group 2 (Alkaline Earth Metals)</strong>: Two valence electrons; reactive
    but less so than Group 1. Includes magnesium and calcium.</li>
    <li><strong>Group 17 (Halogens)</strong>: Seven valence electrons; very reactive
    nonmetals that readily gain one electron to form negative ions.</li>
    <li><strong>Group 18 (Noble Gases)</strong>: Full outer electron shells; extremely
    stable and largely unreactive. Used in lighting and as inert atmospheres.</li>
  </ul>

  <h3>Periods (Rows)</h3>
  <p>There are 7 periods (horizontal rows). Each period corresponds to the highest
  principal energy level (shell) occupied by electrons. Moving across a period from
  left to right, elements gain protons and electrons one at a time, and their
  properties change systematically:</p>
  <ul>
    <li>Metallic character decreases from left to right.</li>
    <li>Elements transition from metals through metalloids to nonmetals.</li>
    <li>Atomic radius generally decreases across a period.</li>
    <li>Ionisation energy and electronegativity generally increase.</li>
  </ul>

  <h3>Periodic Trends</h3>
  <p>Use the trend overlay buttons above the table to visualise these important trends:</p>
  <ul>
    <li><strong>Electronegativity</strong>: A measure of how strongly an atom attracts
    electrons in a bond. Increases across a period (left to right) and decreases down
    a group. Fluorine (3.98) is the most electronegative element. Noble gases are
    typically not assigned values.</li>
    <li><strong>Atomic Radius</strong>: The size of an atom. Decreases across a period
    because the increasing nuclear charge pulls electrons closer. Increases down a group
    because additional electron shells are added further from the nucleus.</li>
    <li><strong>Ionisation Energy</strong>: The energy required to remove the outermost
    electron. Increases across a period (electrons are harder to remove from smaller,
    more positively charged atoms). Decreases down a group (outer electrons are further
    from the nucleus and easier to remove).</li>
    <li><strong>Melting Point</strong>: Varies less predictably than other trends. Transition
    metals generally have high melting points due to strong metallic bonding. Noble gases
    have very low melting points. Carbon (as diamond) and tungsten have among the highest.</li>
  </ul>

  <h3>Element Categories</h3>
  <ul>
    <li><strong>Alkali Metals</strong> (Group 1, excluding H): Very reactive soft metals.
    They react vigorously with water to produce hydrogen gas and hydroxides.</li>
    <li><strong>Alkaline Earth Metals</strong> (Group 2): Reactive metals, harder and
    denser than alkali metals. Includes calcium (in bones) and magnesium.</li>
    <li><strong>Transition Metals</strong> (Groups 3-12): Hard, dense metals with high
    melting points. They often form colourful compounds and have variable oxidation
    states. Includes iron, copper, gold, and platinum.</li>
    <li><strong>Post-transition Metals</strong>: Softer, lower-melting metals found to
    the right of the transition metals. Includes aluminium, tin, and lead.</li>
    <li><strong>Metalloids</strong>: Elements with properties intermediate between metals
    and nonmetals. Silicon and germanium are important semiconductors.</li>
    <li><strong>Nonmetals</strong>: Poor conductors of heat and electricity. Includes
    essential elements like carbon, nitrogen, and oxygen.</li>
    <li><strong>Halogens</strong> (Group 17): Highly reactive nonmetals. They form salts
    when combined with metals (the name means "salt-former").</li>
    <li><strong>Noble Gases</strong> (Group 18): Extremely stable due to their full
    outer electron shells. Helium, neon, argon are common examples.</li>
    <li><strong>Lanthanides</strong>: The 15 elements from lanthanum (57) to lutetium (71).
    Sometimes called "rare earth" elements, though most are not actually rare.</li>
    <li><strong>Actinides</strong>: The 15 elements from actinium (89) to lawrencium (103).
    All are radioactive; uranium and plutonium are the best known.</li>
  </ul>

  <h3>Why This Arrangement?</h3>
  <p>In 1869, Dmitri Mendeleev arranged elements by atomic mass and noticed repeating
  (periodic) patterns in their properties. He even predicted the existence and properties
  of elements not yet discovered. The modern table uses atomic number instead of mass,
  which resolves several anomalies in Mendeleev's original arrangement.</p>
  <p>The table's shape reflects electron orbital filling order. The s-block (Groups 1-2)
  fills s orbitals; the p-block (Groups 13-18) fills p orbitals; the d-block (Groups 3-12)
  fills d orbitals; and the f-block (lanthanides and actinides) fills f orbitals. This
  quantum mechanical basis explains why elements in the same group have similar chemistry.</p>
</div>

<!-- ============================================================
     JAVASCRIPT
     ============================================================ -->
<script>
/* ============================================================
   ELEMENT DATA
   ============================================================ */
const CATEGORIES = {
  'Alkali Metal':'alkali',
  'Alkaline Earth Metal':'alkaline',
  'Transition Metal':'transition',
  'Post-transition Metal':'post-transition',
  'Metalloid':'metalloid',
  'Nonmetal':'nonmetal',
  'Halogen':'halogen',
  'Noble Gas':'noble',
  'Lanthanide':'lanthanide',
  'Actinide':'actinide',
  'Unknown':'unknown'
};

const CAT_COLORS = {
  alkali:'var(--cat-alkali)',
  alkaline:'var(--cat-alkaline)',
  transition:'var(--cat-transition)',
  'post-transition':'var(--cat-post-transition)',
  metalloid:'var(--cat-metalloid)',
  nonmetal:'var(--cat-nonmetal)',
  halogen:'var(--cat-halogen)',
  noble:'var(--cat-noble)',
  lanthanide:'var(--cat-lanthanide)',
  actinide:'var(--cat-actinide)',
  unknown:'var(--cat-unknown)'
};

/*
  Element data array:
  [Z, symbol, name, mass, category, group, period, gridCol, gridRow,
   electronConfig, shells[], state, discoveryYear,
   electronegativity, ionisationEnergy(kJ/mol), atomicRadius(pm), meltingPoint(C)]
*/
const E = [
  // Period 1
  [1,'H','Hydrogen',1.008,'Nonmetal',1,1,1,1,'1s1',[1],'Gas',1766,2.20,1312,53,-259],
  [2,'He','Helium',4.003,'Noble Gas',18,1,18,1,'1s2',[2],'Gas',1868,null,2372,31,-272],
  // Period 2
  [3,'Li','Lithium',6.941,'Alkali Metal',1,2,1,2,'[He] 2s1',[2,1],'Solid',1817,0.98,520,167,181],
  [4,'Be','Beryllium',9.012,'Alkaline Earth Metal',2,2,2,2,'[He] 2s2',[2,2],'Solid',1798,1.57,900,112,1287],
  [5,'B','Boron',10.81,'Metalloid',13,2,13,2,'[He] 2s2 2p1',[2,3],'Solid',1808,2.04,801,87,2076],
  [6,'C','Carbon',12.01,'Nonmetal',14,2,14,2,'[He] 2s2 2p2',[2,4],'Solid',null,2.55,1086,77,3550],
  [7,'N','Nitrogen',14.01,'Nonmetal',15,2,15,2,'[He] 2s2 2p3',[2,5],'Gas',1772,3.04,1402,75,-210],
  [8,'O','Oxygen',16.00,'Nonmetal',16,2,16,2,'[He] 2s2 2p4',[2,6],'Gas',1774,3.44,1314,73,-218],
  [9,'F','Fluorine',19.00,'Halogen',17,2,17,2,'[He] 2s2 2p5',[2,7],'Gas',1886,3.98,1681,71,-220],
  [10,'Ne','Neon',20.18,'Noble Gas',18,2,18,2,'[He] 2s2 2p6',[2,8],'Gas',1898,null,2081,69,-249],
  // Period 3
  [11,'Na','Sodium',22.99,'Alkali Metal',1,3,1,3,'[Ne] 3s1',[2,8,1],'Solid',1807,0.93,496,190,98],
  [12,'Mg','Magnesium',24.31,'Alkaline Earth Metal',2,3,2,3,'[Ne] 3s2',[2,8,2],'Solid',1755,1.31,738,145,650],
  [13,'Al','Aluminium',26.98,'Post-transition Metal',13,3,13,3,'[Ne] 3s2 3p1',[2,8,3],'Solid',1825,1.61,578,118,660],
  [14,'Si','Silicon',28.09,'Metalloid',14,3,14,3,'[Ne] 3s2 3p2',[2,8,4],'Solid',1824,1.90,786,111,1414],
  [15,'P','Phosphorus',30.97,'Nonmetal',15,3,15,3,'[Ne] 3s2 3p3',[2,8,5],'Solid',1669,2.19,1012,98,44],
  [16,'S','Sulfur',32.07,'Nonmetal',16,3,16,3,'[Ne] 3s2 3p4',[2,8,6],'Solid',null,2.58,1000,88,115],
  [17,'Cl','Chlorine',35.45,'Halogen',17,3,17,3,'[Ne] 3s2 3p5',[2,8,7],'Gas',1774,3.16,1251,79,-101],
  [18,'Ar','Argon',39.95,'Noble Gas',18,3,18,3,'[Ne] 3s2 3p6',[2,8,8],'Gas',1894,null,1521,71,-189],
  // Period 4
  [19,'K','Potassium',39.10,'Alkali Metal',1,4,1,4,'[Ar] 4s1',[2,8,8,1],'Solid',1807,0.82,419,243,64],
  [20,'Ca','Calcium',40.08,'Alkaline Earth Metal',2,4,2,4,'[Ar] 4s2',[2,8,8,2],'Solid',1808,1.00,590,194,842],
  [21,'Sc','Scandium',44.96,'Transition Metal',3,4,3,4,'[Ar] 3d1 4s2',[2,8,9,2],'Solid',1879,1.36,633,184,1541],
  [22,'Ti','Titanium',47.87,'Transition Metal',4,4,4,4,'[Ar] 3d2 4s2',[2,8,10,2],'Solid',1791,1.54,659,176,1668],
  [23,'V','Vanadium',50.94,'Transition Metal',5,4,5,4,'[Ar] 3d3 4s2',[2,8,11,2],'Solid',1801,1.63,651,171,1910],
  [24,'Cr','Chromium',52.00,'Transition Metal',6,4,6,4,'[Ar] 3d5 4s1',[2,8,13,1],'Solid',1797,1.66,653,166,1907],
  [25,'Mn','Manganese',54.94,'Transition Metal',7,4,7,4,'[Ar] 3d5 4s2',[2,8,13,2],'Solid',1774,1.55,717,161,1246],
  [26,'Fe','Iron',55.85,'Transition Metal',8,4,8,4,'[Ar] 3d6 4s2',[2,8,14,2],'Solid',null,1.83,762,156,1538],
  [27,'Co','Cobalt',58.93,'Transition Metal',9,4,9,4,'[Ar] 3d7 4s2',[2,8,15,2],'Solid',1735,1.88,760,152,1495],
  [28,'Ni','Nickel',58.69,'Transition Metal',10,4,10,4,'[Ar] 3d8 4s2',[2,8,16,2],'Solid',1751,1.91,737,149,1455],
  [29,'Cu','Copper',63.55,'Transition Metal',11,4,11,4,'[Ar] 3d10 4s1',[2,8,18,1],'Solid',null,1.90,745,145,1085],
  [30,'Zn','Zinc',65.38,'Transition Metal',12,4,12,4,'[Ar] 3d10 4s2',[2,8,18,2],'Solid',null,1.65,906,142,420],
  [31,'Ga','Gallium',69.72,'Post-transition Metal',13,4,13,4,'[Ar] 3d10 4s2 4p1',[2,8,18,3],'Solid',1875,1.81,579,136,30],
  [32,'Ge','Germanium',72.63,'Metalloid',14,4,14,4,'[Ar] 3d10 4s2 4p2',[2,8,18,4],'Solid',1886,2.01,762,125,938],
  [33,'As','Arsenic',74.92,'Metalloid',15,4,15,4,'[Ar] 3d10 4s2 4p3',[2,8,18,5],'Solid',null,2.18,947,114,817],
  [34,'Se','Selenium',78.97,'Nonmetal',16,4,16,4,'[Ar] 3d10 4s2 4p4',[2,8,18,6],'Solid',1817,2.55,941,103,221],
  [35,'Br','Bromine',79.90,'Halogen',17,4,17,4,'[Ar] 3d10 4s2 4p5',[2,8,18,7],'Liquid',1826,2.96,1140,94,-7],
  [36,'Kr','Krypton',83.80,'Noble Gas',18,4,18,4,'[Ar] 3d10 4s2 4p6',[2,8,18,8],'Gas',1898,3.00,1351,88,-157],
  // Period 5
  [37,'Rb','Rubidium',85.47,'Alkali Metal',1,5,1,5,'[Kr] 5s1',[2,8,18,8,1],'Solid',1861,0.82,403,265,39],
  [38,'Sr','Strontium',87.62,'Alkaline Earth Metal',2,5,2,5,'[Kr] 5s2',[2,8,18,8,2],'Solid',1790,0.95,550,219,777],
  [39,'Y','Yttrium',88.91,'Transition Metal',3,5,3,5,'[Kr] 4d1 5s2',[2,8,18,9,2],'Solid',1794,1.22,600,212,1526],
  [40,'Zr','Zirconium',91.22,'Transition Metal',4,5,4,5,'[Kr] 4d2 5s2',[2,8,18,10,2],'Solid',1789,1.33,640,206,1855],
  [41,'Nb','Niobium',92.91,'Transition Metal',5,5,5,5,'[Kr] 4d4 5s1',[2,8,18,12,1],'Solid',1801,1.60,652,198,2477],
  [42,'Mo','Molybdenum',95.95,'Transition Metal',6,5,6,5,'[Kr] 4d5 5s1',[2,8,18,13,1],'Solid',1781,2.16,684,190,2623],
  [43,'Tc','Technetium',98,'Transition Metal',7,5,7,5,'[Kr] 4d5 5s2',[2,8,18,13,2],'Solid',1937,1.90,702,183,2157],
  [44,'Ru','Ruthenium',101.1,'Transition Metal',8,5,8,5,'[Kr] 4d7 5s1',[2,8,18,15,1],'Solid',1844,2.20,710,178,2334],
  [45,'Rh','Rhodium',102.9,'Transition Metal',9,5,9,5,'[Kr] 4d8 5s1',[2,8,18,16,1],'Solid',1803,2.28,720,173,1964],
  [46,'Pd','Palladium',106.4,'Transition Metal',10,5,10,5,'[Kr] 4d10',[2,8,18,18],'Solid',1803,2.20,804,169,1555],
  [47,'Ag','Silver',107.9,'Transition Metal',11,5,11,5,'[Kr] 4d10 5s1',[2,8,18,18,1],'Solid',null,1.93,731,165,962],
  [48,'Cd','Cadmium',112.4,'Transition Metal',12,5,12,5,'[Kr] 4d10 5s2',[2,8,18,18,2],'Solid',1817,1.69,868,161,321],
  [49,'In','Indium',114.8,'Post-transition Metal',13,5,13,5,'[Kr] 4d10 5s2 5p1',[2,8,18,18,3],'Solid',1863,1.78,558,156,157],
  [50,'Sn','Tin',118.7,'Post-transition Metal',14,5,14,5,'[Kr] 4d10 5s2 5p2',[2,8,18,18,4],'Solid',null,1.96,709,145,232],
  [51,'Sb','Antimony',121.8,'Metalloid',15,5,15,5,'[Kr] 4d10 5s2 5p3',[2,8,18,18,5],'Solid',null,2.05,831,133,631],
  [52,'Te','Tellurium',127.6,'Metalloid',16,5,16,5,'[Kr] 4d10 5s2 5p4',[2,8,18,18,6],'Solid',1783,2.10,869,123,450],
  [53,'I','Iodine',126.9,'Halogen',17,5,17,5,'[Kr] 4d10 5s2 5p5',[2,8,18,18,7],'Solid',1811,2.66,1008,115,114],
  [54,'Xe','Xenon',131.3,'Noble Gas',18,5,18,5,'[Kr] 4d10 5s2 5p6',[2,8,18,18,8],'Gas',1898,2.60,1170,108,-112],
  // Period 6 (s-block)
  [55,'Cs','Caesium',132.9,'Alkali Metal',1,6,1,6,'[Xe] 6s1',[2,8,18,18,8,1],'Solid',1860,0.79,376,298,28],
  [56,'Ba','Barium',137.3,'Alkaline Earth Metal',2,6,2,6,'[Xe] 6s2',[2,8,18,18,8,2],'Solid',1808,0.89,503,253,727],
  // Lanthanides (grid row 9, cols 4-18)
  [57,'La','Lanthanum',138.9,'Lanthanide',3,6,4,9,'[Xe] 5d1 6s2',[2,8,18,18,9,2],'Solid',1839,1.10,538,195,920],
  [58,'Ce','Cerium',140.1,'Lanthanide',null,6,5,9,'[Xe] 4f1 5d1 6s2',[2,8,18,19,9,2],'Solid',1803,1.12,534,185,799],
  [59,'Pr','Praseodymium',140.9,'Lanthanide',null,6,6,9,'[Xe] 4f3 6s2',[2,8,18,21,8,2],'Solid',1885,1.13,527,185,931],
  [60,'Nd','Neodymium',144.2,'Lanthanide',null,6,7,9,'[Xe] 4f4 6s2',[2,8,18,22,8,2],'Solid',1885,1.14,533,185,1016],
  [61,'Pm','Promethium',145,'Lanthanide',null,6,8,9,'[Xe] 4f5 6s2',[2,8,18,23,8,2],'Solid',1945,null,540,185,1042],
  [62,'Sm','Samarium',150.4,'Lanthanide',null,6,9,9,'[Xe] 4f6 6s2',[2,8,18,24,8,2],'Solid',1879,1.17,545,185,1072],
  [63,'Eu','Europium',152.0,'Lanthanide',null,6,10,9,'[Xe] 4f7 6s2',[2,8,18,25,8,2],'Solid',1901,null,547,185,822],
  [64,'Gd','Gadolinium',157.3,'Lanthanide',null,6,11,9,'[Xe] 4f7 5d1 6s2',[2,8,18,25,9,2],'Solid',1880,1.20,593,180,1313],
  [65,'Tb','Terbium',158.9,'Lanthanide',null,6,12,9,'[Xe] 4f9 6s2',[2,8,18,27,8,2],'Solid',1843,null,566,175,1356],
  [66,'Dy','Dysprosium',162.5,'Lanthanide',null,6,13,9,'[Xe] 4f10 6s2',[2,8,18,28,8,2],'Solid',1886,1.22,573,175,1412],
  [67,'Ho','Holmium',164.9,'Lanthanide',null,6,14,9,'[Xe] 4f11 6s2',[2,8,18,29,8,2],'Solid',1878,1.23,581,175,1474],
  [68,'Er','Erbium',167.3,'Lanthanide',null,6,15,9,'[Xe] 4f12 6s2',[2,8,18,30,8,2],'Solid',1842,1.24,589,175,1529],
  [69,'Tm','Thulium',168.9,'Lanthanide',null,6,16,9,'[Xe] 4f13 6s2',[2,8,18,31,8,2],'Solid',1879,1.25,597,175,1545],
  [70,'Yb','Ytterbium',173.0,'Lanthanide',null,6,17,9,'[Xe] 4f14 6s2',[2,8,18,32,8,2],'Solid',1878,null,603,175,824],
  [71,'Lu','Lutetium',175.0,'Lanthanide',3,6,18,9,'[Xe] 4f14 5d1 6s2',[2,8,18,32,9,2],'Solid',1907,1.27,524,175,1663],
  // Period 6 d-block
  [72,'Hf','Hafnium',178.5,'Transition Metal',4,6,4,6,'[Xe] 4f14 5d2 6s2',[2,8,18,32,10,2],'Solid',1923,1.30,659,208,2233],
  [73,'Ta','Tantalum',180.9,'Transition Metal',5,6,5,6,'[Xe] 4f14 5d3 6s2',[2,8,18,32,11,2],'Solid',1802,1.50,761,200,3017],
  [74,'W','Tungsten',183.8,'Transition Metal',6,6,6,6,'[Xe] 4f14 5d4 6s2',[2,8,18,32,12,2],'Solid',1783,2.36,770,193,3422],
  [75,'Re','Rhenium',186.2,'Transition Metal',7,6,7,6,'[Xe] 4f14 5d5 6s2',[2,8,18,32,13,2],'Solid',1925,1.90,760,188,3186],
  [76,'Os','Osmium',190.2,'Transition Metal',8,6,8,6,'[Xe] 4f14 5d6 6s2',[2,8,18,32,14,2],'Solid',1803,2.20,840,185,3033],
  [77,'Ir','Iridium',192.2,'Transition Metal',9,6,9,6,'[Xe] 4f14 5d7 6s2',[2,8,18,32,15,2],'Solid',1803,2.20,880,180,2446],
  [78,'Pt','Platinum',195.1,'Transition Metal',10,6,10,6,'[Xe] 4f14 5d9 6s1',[2,8,18,32,17,1],'Solid',1735,2.28,870,177,1768],
  [79,'Au','Gold',197.0,'Transition Metal',11,6,11,6,'[Xe] 4f14 5d10 6s1',[2,8,18,32,18,1],'Solid',null,2.54,890,174,1064],
  [80,'Hg','Mercury',200.6,'Transition Metal',12,6,12,6,'[Xe] 4f14 5d10 6s2',[2,8,18,32,18,2],'Liquid',null,2.00,1007,171,-39],
  // Period 6 p-block
  [81,'Tl','Thallium',204.4,'Post-transition Metal',13,6,13,6,'[Xe] 4f14 5d10 6s2 6p1',[2,8,18,32,18,3],'Solid',1861,1.62,589,156,304],
  [82,'Pb','Lead',207.2,'Post-transition Metal',14,6,14,6,'[Xe] 4f14 5d10 6s2 6p2',[2,8,18,32,18,4],'Solid',null,1.87,716,154,327],
  [83,'Bi','Bismuth',209.0,'Post-transition Metal',15,6,15,6,'[Xe] 4f14 5d10 6s2 6p3',[2,8,18,32,18,5],'Solid',1753,2.02,703,143,271],
  [84,'Po','Polonium',209,'Post-transition Metal',16,6,16,6,'[Xe] 4f14 5d10 6s2 6p4',[2,8,18,32,18,6],'Solid',1898,2.00,812,135,254],
  [85,'At','Astatine',210,'Halogen',17,6,17,6,'[Xe] 4f14 5d10 6s2 6p5',[2,8,18,32,18,7],'Solid',1940,2.20,920,127,302],
  [86,'Rn','Radon',222,'Noble Gas',18,6,18,6,'[Xe] 4f14 5d10 6s2 6p6',[2,8,18,32,18,8],'Gas',1900,null,1037,120,-71],
  // Period 7 (s-block)
  [87,'Fr','Francium',223,'Alkali Metal',1,7,1,7,'[Rn] 7s1',[2,8,18,32,18,8,1],'Solid',1939,0.70,380,348,27],
  [88,'Ra','Radium',226,'Alkaline Earth Metal',2,7,2,7,'[Rn] 7s2',[2,8,18,32,18,8,2],'Solid',1898,0.90,509,283,700],
  // Actinides (grid row 10, cols 4-18)
  [89,'Ac','Actinium',227,'Actinide',3,7,4,10,'[Rn] 6d1 7s2',[2,8,18,32,18,9,2],'Solid',1899,1.10,499,195,1050],
  [90,'Th','Thorium',232.0,'Actinide',null,7,5,10,'[Rn] 6d2 7s2',[2,8,18,32,18,10,2],'Solid',1829,1.30,587,180,1750],
  [91,'Pa','Protactinium',231.0,'Actinide',null,7,6,10,'[Rn] 5f2 6d1 7s2',[2,8,18,32,20,9,2],'Solid',1913,1.50,568,180,1572],
  [92,'U','Uranium',238.0,'Actinide',null,7,7,10,'[Rn] 5f3 6d1 7s2',[2,8,18,32,21,9,2],'Solid',1789,1.38,598,175,1135],
  [93,'Np','Neptunium',237,'Actinide',null,7,8,10,'[Rn] 5f4 6d1 7s2',[2,8,18,32,22,9,2],'Solid',1940,1.36,605,175,644],
  [94,'Pu','Plutonium',244,'Actinide',null,7,9,10,'[Rn] 5f6 7s2',[2,8,18,32,24,8,2],'Solid',1940,1.28,585,175,640],
  [95,'Am','Americium',243,'Actinide',null,7,10,10,'[Rn] 5f7 7s2',[2,8,18,32,25,8,2],'Solid',1944,1.30,578,175,1176],
  [96,'Cm','Curium',247,'Actinide',null,7,11,10,'[Rn] 5f7 6d1 7s2',[2,8,18,32,25,9,2],'Solid',1944,1.30,581,null,1345],
  [97,'Bk','Berkelium',247,'Actinide',null,7,12,10,'[Rn] 5f9 7s2',[2,8,18,32,27,8,2],'Solid',1949,1.30,601,null,1050],
  [98,'Cf','Californium',251,'Actinide',null,7,13,10,'[Rn] 5f10 7s2',[2,8,18,32,28,8,2],'Solid',1950,1.30,608,null,900],
  [99,'Es','Einsteinium',252,'Actinide',null,7,14,10,'[Rn] 5f11 7s2',[2,8,18,32,29,8,2],'Solid',1952,1.30,619,null,860],
  [100,'Fm','Fermium',257,'Actinide',null,7,15,10,'[Rn] 5f12 7s2',[2,8,18,32,30,8,2],'Solid',1952,1.30,627,null,1527],
  [101,'Md','Mendelevium',258,'Actinide',null,7,16,10,'[Rn] 5f13 7s2',[2,8,18,32,31,8,2],'Solid',1955,1.30,635,null,827],
  [102,'No','Nobelium',259,'Actinide',null,7,17,10,'[Rn] 5f14 7s2',[2,8,18,32,32,8,2],'Solid',1958,1.30,642,null,827],
  [103,'Lr','Lawrencium',266,'Actinide',3,7,18,10,'[Rn] 5f14 7s2 7p1',[2,8,18,32,32,8,3],'Solid',1961,null,470,null,1627],
  // Period 7 d-block
  [104,'Rf','Rutherfordium',267,'Transition Metal',4,7,4,7,'[Rn] 5f14 6d2 7s2',[2,8,18,32,32,10,2],'Unknown',1964,null,580,null,null],
  [105,'Db','Dubnium',268,'Transition Metal',5,7,5,7,'[Rn] 5f14 6d3 7s2',[2,8,18,32,32,11,2],'Unknown',1967,null,null,null,null],
  [106,'Sg','Seaborgium',269,'Transition Metal',6,7,6,7,'[Rn] 5f14 6d4 7s2',[2,8,18,32,32,12,2],'Unknown',1974,null,null,null,null],
  [107,'Bh','Bohrium',270,'Transition Metal',7,7,7,7,'[Rn] 5f14 6d5 7s2',[2,8,18,32,32,13,2],'Unknown',1981,null,null,null,null],
  [108,'Hs','Hassium',277,'Transition Metal',8,7,8,7,'[Rn] 5f14 6d6 7s2',[2,8,18,32,32,14,2],'Unknown',1984,null,null,null,null],
  [109,'Mt','Meitnerium',278,'Unknown',9,7,9,7,'[Rn] 5f14 6d7 7s2',[2,8,18,32,32,15,2],'Unknown',1982,null,null,null,null],
  [110,'Ds','Darmstadtium',281,'Unknown',10,7,10,7,'[Rn] 5f14 6d8 7s2',[2,8,18,32,32,16,2],'Unknown',1994,null,null,null,null],
  [111,'Rg','Roentgenium',282,'Unknown',11,7,11,7,'[Rn] 5f14 6d9 7s2',[2,8,18,32,32,17,2],'Unknown',1994,null,null,null,null],
  [112,'Cn','Copernicium',285,'Unknown',12,7,12,7,'[Rn] 5f14 6d10 7s2',[2,8,18,32,32,18,2],'Unknown',1996,null,null,null,null],
  // Period 7 p-block
  [113,'Nh','Nihonium',286,'Unknown',13,7,13,7,'[Rn] 5f14 6d10 7s2 7p1',[2,8,18,32,32,18,3],'Unknown',2003,null,null,null,null],
  [114,'Fl','Flerovium',289,'Unknown',14,7,14,7,'[Rn] 5f14 6d10 7s2 7p2',[2,8,18,32,32,18,4],'Unknown',1998,null,null,null,null],
  [115,'Mc','Moscovium',290,'Unknown',15,7,15,7,'[Rn] 5f14 6d10 7s2 7p3',[2,8,18,32,32,18,5],'Unknown',2003,null,null,null,null],
  [116,'Lv','Livermorium',293,'Unknown',16,7,16,7,'[Rn] 5f14 6d10 7s2 7p4',[2,8,18,32,32,18,6],'Unknown',2000,null,null,null,null],
  [117,'Ts','Tennessine',294,'Unknown',17,7,17,7,'[Rn] 5f14 6d10 7s2 7p5',[2,8,18,32,32,18,7],'Unknown',2010,null,null,null,null],
  [118,'Og','Oganesson',294,'Unknown',18,7,18,7,'[Rn] 5f14 6d10 7s2 7p6',[2,8,18,32,32,18,8],'Unknown',2002,null,null,null,null],
];

/* Parse raw data into element objects */
const elements = E.map(function(e) {
  return {
    z: e[0],
    symbol: e[1],
    name: e[2],
    mass: e[3],
    category: e[4],
    group: e[5],
    period: e[6],
    col: e[7],
    row: e[8],
    config: e[9],
    shells: e[10],
    state: e[11],
    year: e[12],
    en: e[13],      // electronegativity
    ie: e[14],      // ionisation energy (kJ/mol)
    ar: e[15],      // atomic radius (pm)
    mp: e[16]       // melting point (C)
  };
});

/* Get the CSS key for an element's category */
function catKey(el) {
  return CATEGORIES[el.category] || 'unknown';
}

/* ============================================================
   BUILD THE TABLE
   ============================================================ */
var ptable = document.getElementById('ptable');
var catLegend = document.getElementById('catLegend');

/* Render category legend chips */
var catNames = [
  'Alkali Metal', 'Alkaline Earth Metal', 'Transition Metal',
  'Post-transition Metal', 'Metalloid', 'Nonmetal',
  'Halogen', 'Noble Gas', 'Lanthanide', 'Actinide', 'Unknown'
];

catNames.forEach(function(cn) {
  var chip = document.createElement('div');
  chip.className = 'cat-chip';
  var dot = document.createElement('div');
  dot.className = 'cat-dot';
  dot.style.background = CAT_COLORS[CATEGORIES[cn]];
  chip.appendChild(dot);
  chip.appendChild(document.createTextNode(cn));
  catLegend.appendChild(chip);
});

/* Build all cells in the periodic table grid */
function buildTable() {
  /* Placeholder cells for the lanthanide and actinide series
     in the main table body (row 6 col 3 and row 7 col 3) */
  var lanPh = document.createElement('div');
  lanPh.className = 'element-cell';
  lanPh.style.gridColumn = '3';
  lanPh.style.gridRow = '6';
  lanPh.style.background = CAT_COLORS.lanthanide;
  lanPh.style.fontSize = '0.55rem';
  lanPh.style.opacity = '0.7';
  lanPh.style.cursor = 'default';
  lanPh.innerHTML = '<span style="font-weight:600">57-71</span><span class="el-name">Lanthanides</span>';
  ptable.appendChild(lanPh);

  var actPh = document.createElement('div');
  actPh.className = 'element-cell';
  actPh.style.gridColumn = '3';
  actPh.style.gridRow = '7';
  actPh.style.background = CAT_COLORS.actinide;
  actPh.style.fontSize = '0.55rem';
  actPh.style.opacity = '0.7';
  actPh.style.cursor = 'default';
  actPh.innerHTML = '<span style="font-weight:600">89-103</span><span class="el-name">Actinides</span>';
  ptable.appendChild(actPh);

  /* Row labels for lanthanide and actinide series */
  var lanLabel = document.createElement('div');
  lanLabel.className = 'lanthanide-label';
  lanLabel.style.gridColumn = '1 / 4';
  lanLabel.style.gridRow = '9';
  lanLabel.textContent = 'Lanthanides';
  ptable.appendChild(lanLabel);

  var actLabel = document.createElement('div');
  actLabel.className = 'actinide-label';
  actLabel.style.gridColumn = '1 / 4';
  actLabel.style.gridRow = '10';
  actLabel.textContent = 'Actinides';
  ptable.appendChild(actLabel);

  /* Create a cell for each element */
  elements.forEach(function(el) {
    var cell = document.createElement('div');
    cell.className = 'element-cell';
    cell.dataset.z = el.z;
    cell.style.gridColumn = el.col;
    cell.style.gridRow = el.row;
    var ck = catKey(el);
    cell.style.background = CAT_COLORS[ck];

    cell.innerHTML =
      '<span class="el-number">' + el.z + '</span>' +
      '<span class="el-symbol">' + el.symbol + '</span>' +
      '<span class="el-name">' + el.name + '</span>';

    cell.addEventListener('click', function() {
      selectElement(el);
    });

    ptable.appendChild(cell);
  });
}

buildTable();

/* ============================================================
   SIDE PANEL: Element Details
   ============================================================ */
var sidePanel = document.getElementById('sidePanel');
var panelContent = document.getElementById('panelContent');
var panelClose = document.getElementById('panelClose');
var selectedZ = null;

panelClose.addEventListener('click', function() {
  sidePanel.classList.add('closed');
  clearSelection();
});

function clearSelection() {
  selectedZ = null;
  var selected = ptable.querySelectorAll('.element-cell.selected');
  selected.forEach(function(c) { c.classList.remove('selected'); });
}

function selectElement(el) {
  clearSelection();
  selectedZ = el.z;
  var cell = ptable.querySelector('[data-z="' + el.z + '"]');
  if (cell) cell.classList.add('selected');
  sidePanel.classList.remove('closed');
  renderPanel(el);
}

function renderPanel(el) {
  var ck = catKey(el);
  var color = CAT_COLORS[ck];

  /* Format atomic mass */
  var massStr;
  if (typeof el.mass === 'number') {
    if (el.mass % 1 === 0) {
      massStr = '(' + el.mass + ')';  // synthetic elements shown in parentheses
    } else {
      massStr = el.mass.toFixed(el.mass < 10 ? 3 : (el.mass < 100 ? 2 : 1));
    }
  } else {
    massStr = String(el.mass);
  }

  /* State badge */
  var stateClass = (el.state || 'unknown').toLowerCase();
  if (stateClass === 'unknown') stateClass = 'unknown';

  /* Build shell diagram SVG */
  var shellSvg = renderShellDiagram(el);

  panelContent.innerHTML =
    '<div class="panel-header">' +
      '<span class="panel-symbol" style="color:' + color + '">' + el.symbol + '</span>' +
      '<div>' +
        '<div class="panel-name">' + el.name + '</div>' +
        '<div class="panel-number">Atomic Number ' + el.z + '</div>' +
      '</div>' +
    '</div>' +
    '<div class="panel-cat" style="background:' + color + ';color:#1a1a2e">' +
      el.category +
      '<span class="state-badge"><span class="state-dot ' + stateClass + '"></span>' +
      (el.state || 'Unknown') + '</span>' +
    '</div>' +

    '<div class="panel-section">' +
      '<h3>Basic Properties</h3>' +
      '<div class="prop-grid">' +
        '<span class="prop-label">Atomic Mass</span>' +
        '<span class="prop-value">' + massStr + '</span>' +
        '<span class="prop-label">State (Room Temp)</span>' +
        '<span class="prop-value">' + (el.state || 'Unknown') + '</span>' +
        '<span class="prop-label">Group</span>' +
        '<span class="prop-value">' + (el.group || '-') + '</span>' +
        '<span class="prop-label">Period</span>' +
        '<span class="prop-value">' + el.period + '</span>' +
        '<span class="prop-label">Discovered</span>' +
        '<span class="prop-value">' + (el.year || 'Ancient') + '</span>' +
        '<span class="prop-label">Block</span>' +
        '<span class="prop-value">' + getBlock(el) + '</span>' +
      '</div>' +
    '</div>' +

    '<div class="panel-section">' +
      '<h3>Electron Configuration</h3>' +
      '<div style="font-family:monospace;font-size:0.85rem;margin-bottom:8px;' +
        'word-break:break-all;background:var(--border-light);padding:6px 10px;' +
        'border-radius:6px;">' + el.config + '</div>' +
      '<div style="font-size:0.75rem;color:var(--text-muted);margin-bottom:8px;">' +
        'Shells: ' + el.shells.join(', ') +
        ' &nbsp; (Total electrons: ' + el.z + ')' +
      '</div>' +
      '<div class="shell-diagram-wrap">' + shellSvg + '</div>' +
    '</div>' +

    '<div class="panel-section">' +
      '<h3>Key Properties</h3>' +
      '<div class="prop-grid">' +
        '<span class="prop-label">Electronegativity</span>' +
        '<span class="prop-value">' + (el.en != null ? el.en : '-') + '</span>' +
        '<span class="prop-label">Ionisation Energy</span>' +
        '<span class="prop-value">' + (el.ie != null ? el.ie + ' kJ/mol' : '-') + '</span>' +
        '<span class="prop-label">Atomic Radius</span>' +
        '<span class="prop-value">' + (el.ar != null ? el.ar + ' pm' : '-') + '</span>' +
        '<span class="prop-label">Melting Point</span>' +
        '<span class="prop-value">' + (el.mp != null ? el.mp + ' &deg;C' : '-') + '</span>' +
      '</div>' +
    '</div>';
}

/* Determine which block (s, p, d, f) an element belongs to */
function getBlock(el) {
  if (el.category === 'Lanthanide' || el.category === 'Actinide') return 'f';
  if (el.group === 1 || el.group === 2) return 's';
  if (el.group >= 13 && el.group <= 18) return 'p';
  if (el.group >= 3 && el.group <= 12) return 'd';
  if (el.z === 1 || el.z === 2) return 's';
  return '-';
}

/* Render an SVG shell diagram showing electron shells */
function renderShellDiagram(el) {
  var shells = el.shells;
  var n = shells.length;
  if (n === 0) return '';

  var maxR = 56;
  var minR = 14;
  var size = maxR * 2 + 24;
  var cx = size / 2;
  var cy = size / 2;

  var svg = '<svg viewBox="0 0 ' + size + ' ' + size +
    '" width="136" height="136" style="display:block;margin:0 auto;">';

  /* Nucleus */
  svg += '<circle cx="' + cx + '" cy="' + cy +
    '" r="7" fill="var(--accent)" opacity="0.9"/>';
  svg += '<text x="' + cx + '" y="' + (cy + 2) +
    '" text-anchor="middle" fill="#fff" font-size="5.5" font-weight="700">' +
    el.z + '</text>';

  /* Draw each electron shell as a ring with electron dots */
  shells.forEach(function(count, i) {
    var r;
    if (n === 1) {
      r = 24;
    } else {
      r = minR + (maxR - minR) * (i / (n - 1));
    }

    /* Orbit ring */
    svg += '<circle cx="' + cx + '" cy="' + cy + '" r="' + r +
      '" fill="none" stroke="rgba(59,130,246,0.28)" stroke-width="1.2" stroke-dasharray="3,2"/>';

    /* Electron count label at top of ring */
    svg += '<rect x="' + (cx - 6) + '" y="' + (cy - r - 6) +
      '" width="12" height="10" rx="2" fill="var(--panel-bg)"/>';
    svg += '<text x="' + cx + '" y="' + (cy - r + 2) +
      '" text-anchor="middle" fill="var(--accent)" font-size="6.5" font-weight="700">' +
      count + '</text>';

    /* Electron dots distributed around the ring */
    var show = Math.min(count, 12);
    for (var j = 0; j < show; j++) {
      var angle = (2 * Math.PI * j / show) - Math.PI / 2;
      var ex = cx + r * Math.cos(angle);
      var ey = cy + r * Math.sin(angle);
      svg += '<circle cx="' + ex.toFixed(1) + '" cy="' + ey.toFixed(1) +
        '" r="2.2" fill="var(--accent)" opacity="0.65"/>';
    }
  });

  svg += '</svg>';
  return svg;
}

/* ============================================================
   SEARCH FUNCTIONALITY
   ============================================================ */
var searchBox = document.getElementById('searchBox');

searchBox.addEventListener('input', function() {
  var q = searchBox.value.trim().toLowerCase();
  var cells = ptable.querySelectorAll('.element-cell[data-z]');

  if (!q) {
    cells.forEach(function(c) {
      c.classList.remove('highlighted', 'dimmed');
    });
    return;
  }

  /* Find matching elements by name, symbol, or atomic number */
  var matches = elements.filter(function(el) {
    return (
      el.name.toLowerCase().includes(q) ||
      el.symbol.toLowerCase() === q ||
      el.symbol.toLowerCase().startsWith(q) ||
      String(el.z) === q ||
      el.category.toLowerCase().includes(q)
    );
  });

  var matchZ = new Set(matches.map(function(m) { return String(m.z); }));

  cells.forEach(function(c) {
    if (matchZ.has(c.dataset.z)) {
      c.classList.add('highlighted');
      c.classList.remove('dimmed');
    } else {
      c.classList.remove('highlighted');
      c.classList.add('dimmed');
    }
  });
});

/* Allow keyboard shortcut: Escape to clear search */
searchBox.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    searchBox.value = '';
    searchBox.dispatchEvent(new Event('input'));
    searchBox.blur();
  }
});

/* ============================================================
   TREND OVERLAYS
   ============================================================ */
var activeTrend = null;
var trendBtns = document.querySelectorAll('.trend-btn');
var legendBar = document.getElementById('legendBar');
var legendTitle = document.getElementById('legendTitle');
var legendLow = document.getElementById('legendLow');
var legendHigh = document.getElementById('legendHigh');
var legendNote = document.getElementById('legendNote');

var trendConfig = {
  electronegativity: {
    key: 'en',
    label: 'Electronegativity (Pauling Scale)',
    low: '0.7 (Fr)',
    high: '4.0 (F)',
    unit: '',
    note: 'Noble gases typically have no electronegativity value assigned.'
  },
  atomicRadius: {
    key: 'ar',
    label: 'Atomic Radius',
    low: '31 pm (He)',
    high: '348 pm (Fr)',
    unit: ' pm',
    note: 'Values shown are empirical or calculated atomic radii in picometres.'
  },
  ionisationEnergy: {
    key: 'ie',
    label: 'First Ionisation Energy',
    low: '376 kJ/mol (Cs)',
    high: '2372 kJ/mol (He)',
    unit: ' kJ/mol',
    note: 'Energy needed to remove the first electron from a gaseous atom.'
  },
  meltingPoint: {
    key: 'mp',
    label: 'Melting Point',
    low: '-272 C (He)',
    high: '3550 C (C)',
    unit: ' C',
    note: 'Melting points vary widely and do not follow a simple periodic trend.'
  }
};

trendBtns.forEach(function(btn) {
  btn.addEventListener('click', function() {
    var trend = btn.dataset.trend;

    /* Toggle off if same button clicked again */
    if (activeTrend === trend) {
      activeTrend = null;
      btn.classList.remove('active');
      clearTrendOverlay();
      legendBar.classList.remove('visible');
      return;
    }

    /* Activate new trend */
    trendBtns.forEach(function(b) { b.classList.remove('active'); });
    activeTrend = trend;
    btn.classList.add('active');
    applyTrendOverlay(trend);
  });
});

function clearTrendOverlay() {
  var cells = ptable.querySelectorAll('.element-cell[data-z]');
  cells.forEach(function(c) {
    var el = elements.find(function(e) { return String(e.z) === c.dataset.z; });
    if (el) c.style.background = CAT_COLORS[catKey(el)];
  });
}

function applyTrendOverlay(trend) {
  var cfg = trendConfig[trend];

  /* Update legend bar */
  legendTitle.textContent = cfg.label;
  legendLow.textContent = cfg.low;
  legendHigh.textContent = cfg.high;
  legendNote.textContent = cfg.note;
  legendBar.classList.add('visible');

  /* Calculate min and max values for normalisation */
  var vals = elements
    .map(function(el) { return el[cfg.key]; })
    .filter(function(v) { return v != null; });
  var min = Math.min.apply(null, vals);
  var max = Math.max.apply(null, vals);

  /* Apply colour gradient to each cell */
  var cells = ptable.querySelectorAll('.element-cell[data-z]');
  cells.forEach(function(c) {
    var el = elements.find(function(e) { return String(e.z) === c.dataset.z; });
    if (!el) return;
    var v = el[cfg.key];
    if (v == null) {
      c.style.background = '#e9ecef';
      return;
    }
    var t = (v - min) / ((max - min) || 1);
    c.style.background = trendColor(t);
  });
}

/* Generate a colour from a 3-stop gradient (blue -> yellow -> red)
   based on a normalised value t (0 to 1) */
function trendColor(t) {
  var r, g, b;
  if (t < 0.5) {
    var s = t / 0.5;
    r = Math.round(79 + (255 - 79) * s);
    g = Math.round(195 + (241 - 195) * s);
    b = Math.round(247 + (118 - 247) * s);
  } else {
    var s = (t - 0.5) / 0.5;
    r = Math.round(255 + (239 - 255) * s);
    g = Math.round(241 + (83 - 241) * s);
    b = Math.round(118 + (80 - 118) * s);
  }
  return 'rgb(' + r + ',' + g + ',' + b + ')';
}

/* ============================================================
   INFO PANEL (modal)
   ============================================================ */
var infoToggle = document.getElementById('infoToggle');
var infoPanel = document.getElementById('infoPanel');
var infoOverlayBg = document.getElementById('infoOverlayBg');
var infoClose = document.getElementById('infoClose');

function toggleInfo() {
  var isOpen = infoPanel.classList.toggle('visible');
  infoOverlayBg.classList.toggle('visible', isOpen);
  infoToggle.classList.toggle('active', isOpen);
}

function closeInfo() {
  infoPanel.classList.remove('visible');
  infoOverlayBg.classList.remove('visible');
  infoToggle.classList.remove('active');
}

infoToggle.addEventListener('click', toggleInfo);
infoOverlayBg.addEventListener('click', closeInfo);
infoClose.addEventListener('click', closeInfo);

/* Close info panel on Escape key */
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    if (infoPanel.classList.contains('visible')) {
      closeInfo();
    }
  }
});
</script>
</body>
</html>
