<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sentence Complexity Ladder | MFL</title>
<style>
:root {
  --purple-900: #2d1b4e;
  --purple-800: #3d2466;
  --purple-700: #4c2d80;
  --purple-600: #5e3a9a;
  --purple-500: #7c4dff;
  --purple-400: #9e7aff;
  --purple-300: #b89eff;
  --purple-200: #d4c4ff;
  --purple-100: #ede5ff;
  --purple-50: #f6f2ff;
  --adj-colour: #e85d75;
  --adv-colour: #f59e42;
  --conn-colour: #3bb4c1;
  --opinion-colour: #6bcf63;
  --sub-colour: #c97bdb;
  --rel-colour: #e6a819;
  --simple-colour: #7c8fa6;
  --bg: #f8f6fb;
  --card: #ffffff;
  --text: #1a1a2e;
  --text-muted: #5c5c7a;
  --border: #e0dbe8;
  --shadow: 0 2px 12px rgba(45,27,78,0.08);
  --radius: 10px;
  --header-h: 64px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  line-height: 1.5;
}
header {
  position: sticky; top: 0; z-index: 100;
  background: linear-gradient(135deg, var(--purple-800), var(--purple-600));
  color: #fff;
  height: var(--header-h);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 24px;
  box-shadow: 0 2px 16px rgba(45,27,78,0.18);
}
header h1 { font-size: 1.25rem; font-weight: 700; letter-spacing: -0.02em; }
header h1 span { opacity: 0.7; font-weight: 400; margin-left: 6px; font-size: 0.9rem; }
.header-actions { display: flex; gap: 8px; align-items: center; }
.btn-info {
  background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25);
  color: #fff; border-radius: 6px; padding: 6px 14px; font-size: 0.82rem;
  cursor: pointer; transition: background 0.2s;
}
.btn-info:hover { background: rgba(255,255,255,0.25); }
.btn-reset {
  background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
  color: #fff; border-radius: 6px; padding: 6px 14px; font-size: 0.82rem;
  cursor: pointer; transition: background 0.2s;
}
.btn-reset:hover { background: rgba(255,80,80,0.3); }
main {
  max-width: 1280px; margin: 0 auto; padding: 24px 20px 60px;
}
/* Language tabs */
.lang-tabs {
  display: flex; gap: 4px; margin-bottom: 20px;
  background: var(--card); border-radius: var(--radius); padding: 4px;
  box-shadow: var(--shadow); width: fit-content;
}
.lang-tab {
  padding: 8px 22px; border-radius: 7px; border: none;
  font-size: 0.88rem; font-weight: 600; cursor: pointer;
  background: transparent; color: var(--text-muted);
  transition: all 0.2s;
}
.lang-tab.active {
  background: var(--purple-600); color: #fff;
}
.lang-tab:hover:not(.active) { background: var(--purple-50); }
/* Starter sentences */
.starter-panel {
  background: var(--card); border-radius: var(--radius); padding: 18px 22px;
  box-shadow: var(--shadow); margin-bottom: 20px;
}
.starter-panel h3 { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.05em; }
.starter-list { display: flex; flex-wrap: wrap; gap: 8px; }
.starter-btn {
  padding: 8px 16px; border-radius: 20px; border: 2px solid var(--purple-200);
  background: var(--purple-50); color: var(--purple-700); font-size: 0.88rem;
  cursor: pointer; transition: all 0.2s; font-weight: 500;
}
.starter-btn:hover { border-color: var(--purple-500); background: var(--purple-100); }
.starter-btn.active { border-color: var(--purple-600); background: var(--purple-600); color: #fff; }
/* Main grid */
.app-grid {
  display: grid;
  grid-template-columns: 200px 1fr 280px;
  gap: 20px;
  align-items: start;
}
/* Ladder column */
.ladder-col {
  background: var(--card); border-radius: var(--radius); padding: 20px 16px;
  box-shadow: var(--shadow); position: sticky; top: calc(var(--header-h) + 20px);
}
.ladder-col h3 {
  font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.06em;
  color: var(--text-muted); margin-bottom: 16px; text-align: center;
}
.ladder-svg { width: 100%; }
/* Centre column */
.centre-col { display: flex; flex-direction: column; gap: 20px; }
/* Sentence workspace */
.workspace {
  background: var(--card); border-radius: var(--radius); padding: 24px;
  box-shadow: var(--shadow); min-height: 140px;
}
.workspace h3 {
  font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.06em;
  color: var(--text-muted); margin-bottom: 12px;
}
.sentence-display {
  font-size: 1.3rem; line-height: 1.8; min-height: 48px;
  padding: 12px 0; border-bottom: 2px dashed var(--border);
  margin-bottom: 16px;
}
.sentence-display .word-group {
  display: inline; padding: 2px 6px; border-radius: 4px; margin: 0 1px;
  transition: background 0.2s;
}
.sentence-display .word-group[data-type="adjective"] { background: rgba(232,93,117,0.15); color: #b83d55; }
.sentence-display .word-group[data-type="adverb"] { background: rgba(245,158,66,0.15); color: #c07520; }
.sentence-display .word-group[data-type="connective"] { background: rgba(59,180,193,0.15); color: #27838c; }
.sentence-display .word-group[data-type="opinion"] { background: rgba(107,207,99,0.15); color: #3a8a34; }
.sentence-display .word-group[data-type="subordinate"] { background: rgba(201,123,219,0.15); color: #8a4a9e; }
.sentence-display .word-group[data-type="relative"] { background: rgba(230,168,25,0.15); color: #9e7a0d; }
.sentence-display .word-group[data-type="simple"] { background: rgba(124,143,166,0.1); }
.translation-line {
  font-size: 0.9rem; color: var(--text-muted); font-style: italic;
  min-height: 24px;
}
/* Additions palette */
.additions-panel {
  background: var(--card); border-radius: var(--radius); padding: 20px 22px;
  box-shadow: var(--shadow);
}
.additions-panel h3 {
  font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.06em;
  color: var(--text-muted); margin-bottom: 14px;
}
.addition-groups { display: flex; flex-direction: column; gap: 14px; }
.addition-group-label {
  font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
  letter-spacing: 0.05em; margin-bottom: 4px; display: flex; align-items: center; gap: 6px;
}
.addition-group-label .dot {
  width: 10px; height: 10px; border-radius: 50%; display: inline-block;
}
.addition-chips { display: flex; flex-wrap: wrap; gap: 6px; }
.addition-chip {
  padding: 6px 14px; border-radius: 18px; font-size: 0.84rem;
  cursor: grab; border: 2px solid transparent; font-weight: 500;
  transition: all 0.2s; user-select: none; position: relative;
}
.addition-chip:active { cursor: grabbing; }
.addition-chip.used { opacity: 0.35; cursor: default; pointer-events: none; }
.addition-chip[data-type="adjective"] { background: rgba(232,93,117,0.12); color: #b83d55; border-color: rgba(232,93,117,0.3); }
.addition-chip[data-type="adverb"] { background: rgba(245,158,66,0.12); color: #c07520; border-color: rgba(245,158,66,0.3); }
.addition-chip[data-type="connective"] { background: rgba(59,180,193,0.12); color: #27838c; border-color: rgba(59,180,193,0.3); }
.addition-chip[data-type="opinion"] { background: rgba(107,207,99,0.12); color: #3a8a34; border-color: rgba(107,207,99,0.3); }
.addition-chip[data-type="subordinate"] { background: rgba(201,123,219,0.12); color: #8a4a9e; border-color: rgba(201,123,219,0.3); }
.addition-chip[data-type="relative"] { background: rgba(230,168,25,0.12); color: #9e7a0d; border-color: rgba(230,168,25,0.3); }
.addition-chip:hover:not(.used) { transform: translateY(-2px); box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
/* Drop zones */
.drop-zone {
  display: inline-block; min-width: 60px; min-height: 32px;
  border: 2px dashed var(--purple-300); border-radius: 6px;
  padding: 2px 8px; margin: 0 4px; vertical-align: middle;
  transition: all 0.2s; background: var(--purple-50);
  font-size: 0.82rem; color: var(--purple-400); line-height: 28px;
}
.drop-zone.drag-over {
  border-color: var(--purple-500); background: var(--purple-100);
  box-shadow: 0 0 12px rgba(124,77,255,0.2);
}
/* Sentence tree */
.tree-panel {
  background: var(--card); border-radius: var(--radius); padding: 20px 22px;
  box-shadow: var(--shadow);
}
.tree-panel h3 {
  font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.06em;
  color: var(--text-muted); margin-bottom: 12px;
}
.tree-view { font-size: 0.82rem; line-height: 1.8; }
.tree-node { padding-left: 18px; border-left: 2px solid var(--border); margin-left: 4px; }
.tree-label {
  font-weight: 600; font-size: 0.72rem; text-transform: uppercase;
  letter-spacing: 0.04em; padding: 1px 8px; border-radius: 4px;
  display: inline-block; margin-right: 6px;
}
.tree-label[data-type="simple"] { background: rgba(124,143,166,0.15); color: var(--simple-colour); }
.tree-label[data-type="adjective"] { background: rgba(232,93,117,0.15); color: var(--adj-colour); }
.tree-label[data-type="adverb"] { background: rgba(245,158,66,0.15); color: var(--adv-colour); }
.tree-label[data-type="connective"] { background: rgba(59,180,193,0.15); color: var(--conn-colour); }
.tree-label[data-type="opinion"] { background: rgba(107,207,99,0.15); color: var(--opinion-colour); }
.tree-label[data-type="subordinate"] { background: rgba(201,123,219,0.15); color: var(--sub-colour); }
.tree-label[data-type="relative"] { background: rgba(230,168,25,0.15); color: var(--rel-colour); }
/* Right column: grade + info */
.right-col {
  display: flex; flex-direction: column; gap: 20px;
  position: sticky; top: calc(var(--header-h) + 20px);
}
.grade-panel {
  background: var(--card); border-radius: var(--radius); padding: 24px 20px;
  box-shadow: var(--shadow); text-align: center;
}
.grade-panel h3 {
  font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.06em;
  color: var(--text-muted); margin-bottom: 16px;
}
.grade-ring {
  width: 120px; height: 120px; margin: 0 auto 16px; position: relative;
}
.grade-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
.grade-ring .bg-ring { fill: none; stroke: var(--purple-100); stroke-width: 8; }
.grade-ring .fg-ring { fill: none; stroke: var(--purple-500); stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 0.6s ease; }
.grade-number {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  font-size: 2.4rem; font-weight: 800; color: var(--purple-700);
}
.grade-descriptor {
  font-size: 0.88rem; color: var(--text-muted); margin-bottom: 14px;
}
.score-breakdown { text-align: left; font-size: 0.8rem; }
.score-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 5px 0; border-bottom: 1px solid var(--border);
}
.score-row:last-child { border-bottom: none; }
.score-dot {
  width: 8px; height: 8px; border-radius: 50%; display: inline-block;
  margin-right: 6px; vertical-align: middle;
}
/* Info modal */
.modal-overlay {
  display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5);
  z-index: 200; align-items: center; justify-content: center;
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--card); border-radius: 14px; padding: 32px;
  max-width: 560px; width: 90%; max-height: 80vh; overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,0.2);
}
.modal h2 { font-size: 1.15rem; margin-bottom: 16px; color: var(--purple-800); }
.modal h4 { font-size: 0.9rem; margin: 14px 0 6px; color: var(--purple-700); }
.modal p, .modal li { font-size: 0.88rem; color: var(--text-muted); line-height: 1.6; }
.modal ul { padding-left: 20px; margin-bottom: 10px; }
.modal-close {
  float: right; background: none; border: none; font-size: 1.4rem;
  cursor: pointer; color: var(--text-muted); padding: 0 4px;
}
.modal-close:hover { color: var(--text); }
/* Responsive */
@media (max-width: 1024px) {
  .app-grid { grid-template-columns: 1fr 260px; }
  .ladder-col { display: none; }
}
@media (max-width: 768px) {
  .app-grid { grid-template-columns: 1fr; }
  .right-col { position: static; flex-direction: row; flex-wrap: wrap; }
  .grade-panel { flex: 1; min-width: 200px; }
  header { padding: 0 14px; }
  header h1 { font-size: 1.05rem; }
  header h1 span { display: none; }
  main { padding: 16px 12px 40px; }
  .sentence-display { font-size: 1.1rem; }
}
/* Drag ghost */
.drag-ghost {
  position: fixed; pointer-events: none; z-index: 300;
  padding: 6px 14px; border-radius: 18px; font-size: 0.84rem;
  font-weight: 600; opacity: 0.9; box-shadow: 0 4px 16px rgba(0,0,0,0.15);
}
/* Undo strip */
.undo-strip {
  display: flex; gap: 6px; flex-wrap: wrap; margin-top: 10px;
}
.undo-chip {
  font-size: 0.75rem; padding: 3px 10px; border-radius: 12px;
  border: 1px solid var(--border); background: var(--bg);
  cursor: pointer; color: var(--text-muted); transition: all 0.15s;
  display: flex; align-items: center; gap: 4px;
}
.undo-chip:hover { border-color: #e55; color: #c33; background: #fff0f0; }
.undo-chip .x { font-weight: 700; }
</style>
</head>
<body>

<header>
  <h1>Sentence Complexity Ladder <span>MFL</span></h1>
  <div class="header-actions">
    <button class="btn-info" onclick="toggleModal()">Mark Scheme Info</button>
    <button class="btn-reset" onclick="resetSentence()">Reset</button>
  </div>
</header>

<main>
  <div class="lang-tabs" id="langTabs"></div>
  <div class="starter-panel">
    <h3>Choose a Starter Sentence</h3>
    <div class="starter-list" id="starterList"></div>
  </div>

  <div class="app-grid">
    <!-- Ladder -->
    <div class="ladder-col">
      <h3>Complexity Ladder</h3>
      <svg class="ladder-svg" id="ladderSvg" viewBox="0 0 160 420" xmlns="http://www.w3.org/2000/svg"></svg>
    </div>

    <!-- Centre -->
    <div class="centre-col">
      <div class="workspace">
        <h3>Your Sentence</h3>
        <div class="sentence-display" id="sentenceDisplay"></div>
        <div class="translation-line" id="translationLine"></div>
        <div class="undo-strip" id="undoStrip"></div>
      </div>

      <div class="additions-panel">
        <h3>Drag Additions onto the Drop Zones</h3>
        <div class="addition-groups" id="additionGroups"></div>
      </div>

      <div class="tree-panel">
        <h3>Sentence Structure</h3>
        <div class="tree-view" id="treeView"></div>
      </div>
    </div>

    <!-- Right -->
    <div class="right-col">
      <div class="grade-panel">
        <h3>GCSE Grade Indicator</h3>
        <div class="grade-ring">
          <svg viewBox="0 0 120 120">
            <circle class="bg-ring" cx="60" cy="60" r="50"/>
            <circle class="fg-ring" id="gradeRing" cx="60" cy="60" r="50" stroke-dasharray="314.16" stroke-dashoffset="314.16"/>
          </svg>
          <div class="grade-number" id="gradeNumber">1</div>
        </div>
        <div class="grade-descriptor" id="gradeDescriptor">Basic single-clause sentence</div>
        <div class="score-breakdown" id="scoreBreakdown"></div>
      </div>
    </div>
  </div>
</main>

<!-- Info Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <button class="modal-close" onclick="toggleModal()">&times;</button>
    <h2>GCSE Writing Mark Scheme Guide</h2>
    <p>This tool maps sentence complexity features to GCSE MFL writing descriptors. The grade indicator reflects how the structural features of your sentence align with assessment criteria.</p>
    <h4>Grade 1-2: Limited</h4>
    <p>Short, simple sentences. Isolated words or phrases. Limited range of vocabulary and structures.</p>
    <h4>Grade 3-4: Basic</h4>
    <p>Simple sentences with some adjectives or adverbs. Occasional use of connectives. Mostly present tense.</p>
    <h4>Grade 5-6: Good</h4>
    <p>Sentences linked with connectives. Use of opinion phrases and some varied structures. Developing complexity.</p>
    <h4>Grade 7-8: Very Good</h4>
    <p>Subordinate clauses used confidently. Complex sentence structures with relative clauses. A range of vocabulary including higher-level items.</p>
    <h4>Grade 9: Exceptional</h4>
    <p>Highly complex sentences demonstrating sophisticated structures. Confident use of subordination, relative clauses, and varied connectives. Reads naturally and fluently.</p>
    <h4>Complexity Features Scored</h4>
    <ul>
      <li><strong>Simple sentence</strong> (base): The starting point. A single main clause.</li>
      <li><strong>Adjective</strong> (+1): Adds description and detail to nouns.</li>
      <li><strong>Adverb</strong> (+1): Modifies verbs, adding nuance to actions.</li>
      <li><strong>Connective</strong> (+1.5): Links ideas, extends the sentence logically.</li>
      <li><strong>Opinion phrase</strong> (+1.5): Demonstrates personal response, valued at GCSE.</li>
      <li><strong>Subordinate clause</strong> (+2): Shows grammatical control and complexity.</li>
      <li><strong>Relative clause</strong> (+2): Embeds additional information within the sentence.</li>
    </ul>
  </div>
</div>

<script>
/* ======= DATA ======= */
const LANGS = {
  french: {
    label: 'French',
    starters: [
      { sentence: 'Je mange une pizza.', translation: 'I eat a pizza.', base: 'Je mange une pizza' },
      { sentence: 'J\'habite dans une maison.', translation: 'I live in a house.', base: 'J\'habite dans une maison' },
      { sentence: 'Je joue au football.', translation: 'I play football.', base: 'Je joue au football' },
      { sentence: 'Ma soeur regarde la television.', translation: 'My sister watches television.', base: 'Ma soeur regarde la television' },
      { sentence: 'Nous allons au college.', translation: 'We go to school.', base: 'Nous allons au college' },
      { sentence: 'Il fait ses devoirs.', translation: 'He does his homework.', base: 'Il fait ses devoirs' }
    ],
    additions: {
      adjective: [
        { text: 'delicieuse', translation: 'delicious', insert: 'after-noun' },
        { text: 'grande', translation: 'big', insert: 'after-noun' },
        { text: 'petit(e)', translation: 'small', insert: 'after-noun' },
        { text: 'interessant(e)', translation: 'interesting', insert: 'after-noun' },
        { text: 'nouveau/nouvelle', translation: 'new', insert: 'before-noun' }
      ],
      adverb: [
        { text: 'souvent', translation: 'often', insert: 'after-verb' },
        { text: 'toujours', translation: 'always', insert: 'after-verb' },
        { text: 'rapidement', translation: 'quickly', insert: 'after-verb' },
        { text: 'normalement', translation: 'normally', insert: 'before-verb' },
        { text: 'vraiment', translation: 'really', insert: 'before-adj' }
      ],
      connective: [
        { text: 'et aussi', translation: 'and also', insert: 'extend' },
        { text: 'mais', translation: 'but', insert: 'extend' },
        { text: 'car', translation: 'because', insert: 'extend' },
        { text: 'donc', translation: 'therefore', insert: 'extend' },
        { text: 'puis', translation: 'then', insert: 'extend' }
      ],
      opinion: [
        { text: 'A mon avis,', translation: 'In my opinion,', insert: 'prepend' },
        { text: 'Je pense que', translation: 'I think that', insert: 'prepend' },
        { text: 'Je trouve que', translation: 'I find that', insert: 'prepend' },
        { text: 'Il me semble que', translation: 'It seems to me that', insert: 'prepend' }
      ],
      subordinate: [
        { text: 'quand il fait beau', translation: 'when the weather is nice', insert: 'clause-end' },
        { text: 'si j\'ai le temps', translation: 'if I have time', insert: 'clause-end' },
        { text: 'bien que ce soit difficile', translation: 'although it is difficult', insert: 'clause-end' },
        { text: 'parce que c\'est amusant', translation: 'because it is fun', insert: 'clause-end' }
      ],
      relative: [
        { text: 'qui est pres du parc', translation: 'which is near the park', insert: 'relative' },
        { text: 'que j\'adore', translation: 'which I love', insert: 'relative' },
        { text: 'ou j\'ai grandi', translation: 'where I grew up', insert: 'relative' },
        { text: 'dont je suis fier/fiere', translation: 'of which I am proud', insert: 'relative' }
      ]
    }
  },
  german: {
    label: 'German',
    starters: [
      { sentence: 'Ich esse eine Pizza.', translation: 'I eat a pizza.', base: 'Ich esse eine Pizza' },
      { sentence: 'Ich wohne in einem Haus.', translation: 'I live in a house.', base: 'Ich wohne in einem Haus' },
      { sentence: 'Ich spiele Fussball.', translation: 'I play football.', base: 'Ich spiele Fussball' },
      { sentence: 'Meine Schwester sieht fern.', translation: 'My sister watches television.', base: 'Meine Schwester sieht fern' },
      { sentence: 'Wir gehen in die Schule.', translation: 'We go to school.', base: 'Wir gehen in die Schule' }
    ],
    additions: {
      adjective: [
        { text: 'leckere', translation: 'delicious', insert: 'before-noun' },
        { text: 'grosse', translation: 'big', insert: 'before-noun' },
        { text: 'kleine', translation: 'small', insert: 'before-noun' },
        { text: 'interessante', translation: 'interesting', insert: 'before-noun' },
        { text: 'neue', translation: 'new', insert: 'before-noun' }
      ],
      adverb: [
        { text: 'oft', translation: 'often', insert: 'after-verb' },
        { text: 'immer', translation: 'always', insert: 'after-verb' },
        { text: 'schnell', translation: 'quickly', insert: 'after-verb' },
        { text: 'normalerweise', translation: 'normally', insert: 'before-verb' },
        { text: 'sehr', translation: 'very', insert: 'before-adj' }
      ],
      connective: [
        { text: 'und auch', translation: 'and also', insert: 'extend' },
        { text: 'aber', translation: 'but', insert: 'extend' },
        { text: 'denn', translation: 'because', insert: 'extend' },
        { text: 'deshalb', translation: 'therefore', insert: 'extend' },
        { text: 'dann', translation: 'then', insert: 'extend' }
      ],
      opinion: [
        { text: 'Meiner Meinung nach', translation: 'In my opinion', insert: 'prepend' },
        { text: 'Ich denke, dass', translation: 'I think that', insert: 'prepend' },
        { text: 'Ich finde, dass', translation: 'I find that', insert: 'prepend' },
        { text: 'Es scheint mir, dass', translation: 'It seems to me that', insert: 'prepend' }
      ],
      subordinate: [
        { text: 'wenn das Wetter schon ist', translation: 'when the weather is nice', insert: 'clause-end' },
        { text: 'wenn ich Zeit habe', translation: 'if I have time', insert: 'clause-end' },
        { text: 'obwohl es schwierig ist', translation: 'although it is difficult', insert: 'clause-end' },
        { text: 'weil es Spass macht', translation: 'because it is fun', insert: 'clause-end' }
      ],
      relative: [
        { text: 'das in der Nahe des Parks ist', translation: 'which is near the park', insert: 'relative' },
        { text: 'das ich sehr mag', translation: 'which I really like', insert: 'relative' },
        { text: 'wo ich aufgewachsen bin', translation: 'where I grew up', insert: 'relative' },
        { text: 'worauf ich stolz bin', translation: 'of which I am proud', insert: 'relative' }
      ]
    }
  },
  spanish: {
    label: 'Spanish',
    starters: [
      { sentence: 'Yo como una pizza.', translation: 'I eat a pizza.', base: 'Yo como una pizza' },
      { sentence: 'Yo vivo en una casa.', translation: 'I live in a house.', base: 'Yo vivo en una casa' },
      { sentence: 'Yo juego al futbol.', translation: 'I play football.', base: 'Yo juego al futbol' },
      { sentence: 'Mi hermana ve la television.', translation: 'My sister watches television.', base: 'Mi hermana ve la television' },
      { sentence: 'Nosotros vamos al colegio.', translation: 'We go to school.', base: 'Nosotros vamos al colegio' },
      { sentence: 'El hace sus deberes.', translation: 'He does his homework.', base: 'El hace sus deberes' }
    ],
    additions: {
      adjective: [
        { text: 'deliciosa', translation: 'delicious', insert: 'after-noun' },
        { text: 'grande', translation: 'big', insert: 'after-noun' },
        { text: 'pequena', translation: 'small', insert: 'after-noun' },
        { text: 'interesante', translation: 'interesting', insert: 'after-noun' },
        { text: 'nueva', translation: 'new', insert: 'before-noun' }
      ],
      adverb: [
        { text: 'a menudo', translation: 'often', insert: 'after-verb' },
        { text: 'siempre', translation: 'always', insert: 'before-verb' },
        { text: 'rapidamente', translation: 'quickly', insert: 'after-verb' },
        { text: 'normalmente', translation: 'normally', insert: 'before-verb' },
        { text: 'muy', translation: 'very', insert: 'before-adj' }
      ],
      connective: [
        { text: 'y tambien', translation: 'and also', insert: 'extend' },
        { text: 'pero', translation: 'but', insert: 'extend' },
        { text: 'porque', translation: 'because', insert: 'extend' },
        { text: 'por lo tanto', translation: 'therefore', insert: 'extend' },
        { text: 'luego', translation: 'then', insert: 'extend' }
      ],
      opinion: [
        { text: 'En mi opinion,', translation: 'In my opinion,', insert: 'prepend' },
        { text: 'Yo pienso que', translation: 'I think that', insert: 'prepend' },
        { text: 'Yo creo que', translation: 'I believe that', insert: 'prepend' },
        { text: 'Me parece que', translation: 'It seems to me that', insert: 'prepend' }
      ],
      subordinate: [
        { text: 'cuando hace buen tiempo', translation: 'when the weather is nice', insert: 'clause-end' },
        { text: 'si tengo tiempo', translation: 'if I have time', insert: 'clause-end' },
        { text: 'aunque es dificil', translation: 'although it is difficult', insert: 'clause-end' },
        { text: 'porque es divertido', translation: 'because it is fun', insert: 'clause-end' }
      ],
      relative: [
        { text: 'que esta cerca del parque', translation: 'which is near the park', insert: 'relative' },
        { text: 'que me encanta', translation: 'which I love', insert: 'relative' },
        { text: 'donde creci', translation: 'where I grew up', insert: 'relative' },
        { text: 'del que estoy orgulloso/a', translation: 'of which I am proud', insert: 'relative' }
      ]
    }
  }
};

const TYPE_META = {
  adjective:    { label: 'Adjective', colour: 'var(--adj-colour)', score: 1 },
  adverb:       { label: 'Adverb', colour: 'var(--adv-colour)', score: 1 },
  connective:   { label: 'Connective', colour: 'var(--conn-colour)', score: 1.5 },
  opinion:      { label: 'Opinion Phrase', colour: 'var(--opinion-colour)', score: 1.5 },
  subordinate:  { label: 'Subordinate Clause', colour: 'var(--sub-colour)', score: 2 },
  relative:     { label: 'Relative Clause', colour: 'var(--rel-colour)', score: 2 }
};

const GRADE_MAP = [
  { min: 0, grade: 1, desc: 'Basic single-clause sentence' },
  { min: 1, grade: 2, desc: 'Some description added' },
  { min: 2, grade: 3, desc: 'Simple structures with detail' },
  { min: 3, grade: 4, desc: 'Developing use of connectives' },
  { min: 4.5, grade: 5, desc: 'Good range of structures' },
  { min: 6, grade: 6, desc: 'Confident use of varied structures' },
  { min: 7.5, grade: 7, desc: 'Complex sentences with subordination' },
  { min: 9, grade: 8, desc: 'Highly developed complexity' },
  { min: 10, grade: 9, desc: 'Exceptional sophistication and fluency' }
];

const LADDER_RUNGS = [
  { type: 'simple', label: 'Simple Sentence' },
  { type: 'adjective', label: 'Adjective' },
  { type: 'adverb', label: 'Adverb' },
  { type: 'connective', label: 'Connective' },
  { type: 'opinion', label: 'Opinion Phrase' },
  { type: 'subordinate', label: 'Subordinate Clause' },
  { type: 'relative', label: 'Relative Clause' }
];

/* ======= STATE ======= */
let currentLang = 'french';
let currentStarter = null;
let appliedAdditions = []; // { type, text, translation, id }
let additionIdCounter = 0;
let dragData = null;

/* ======= INIT ======= */
function init() {
  renderLangTabs();
  renderStarters();
  renderAdditions();
  renderLadder();
  renderSentence();
  updateGrade();
}

/* ======= LANG TABS ======= */
function renderLangTabs() {
  const container = document.getElementById('langTabs');
  container.innerHTML = '';
  Object.keys(LANGS).forEach(key => {
    const btn = document.createElement('button');
    btn.className = 'lang-tab' + (key === currentLang ? ' active' : '');
    btn.textContent = LANGS[key].label;
    btn.onclick = () => switchLang(key);
    container.appendChild(btn);
  });
}

function switchLang(lang) {
  currentLang = lang;
  currentStarter = null;
  appliedAdditions = [];
  renderLangTabs();
  renderStarters();
  renderAdditions();
  renderSentence();
  renderTree();
  updateGrade();
  renderLadder();
}

/* ======= STARTERS ======= */
function renderStarters() {
  const container = document.getElementById('starterList');
  container.innerHTML = '';
  LANGS[currentLang].starters.forEach((s, i) => {
    const btn = document.createElement('button');
    btn.className = 'starter-btn' + (currentStarter === i ? ' active' : '');
    btn.textContent = s.sentence;
    btn.onclick = () => selectStarter(i);
    container.appendChild(btn);
  });
}

function selectStarter(idx) {
  currentStarter = idx;
  appliedAdditions = [];
  renderStarters();
  renderAdditions();
  renderSentence();
  renderTree();
  updateGrade();
  renderLadder();
}

/* ======= ADDITIONS ======= */
function renderAdditions() {
  const container = document.getElementById('additionGroups');
  container.innerHTML = '';
  const additions = LANGS[currentLang].additions;
  const usedTexts = new Set(appliedAdditions.map(a => a.text));

  Object.keys(additions).forEach(type => {
    const meta = TYPE_META[type];
    const groupDiv = document.createElement('div');

    const label = document.createElement('div');
    label.className = 'addition-group-label';
    label.innerHTML = `<span class="dot" style="background:${meta.colour}"></span>${meta.label} (+${meta.score})`;
    groupDiv.appendChild(label);

    const chips = document.createElement('div');
    chips.className = 'addition-chips';

    additions[type].forEach(item => {
      const chip = document.createElement('div');
      chip.className = 'addition-chip' + (usedTexts.has(item.text) ? ' used' : '');
      chip.setAttribute('data-type', type);
      chip.textContent = item.text;
      chip.title = item.translation;
      chip.draggable = !usedTexts.has(item.text);
      chip.addEventListener('dragstart', e => onDragStart(e, type, item));
      chip.addEventListener('dragend', onDragEnd);
      chips.appendChild(chip);
    });

    groupDiv.appendChild(chips);
    container.appendChild(groupDiv);
  });
}

/* ======= DRAG AND DROP ======= */
function onDragStart(e, type, item) {
  dragData = { type, text: item.text, translation: item.translation, insert: item.insert };
  e.dataTransfer.effectAllowed = 'copy';
  e.dataTransfer.setData('text/plain', item.text);
  // Highlight drop zones
  setTimeout(() => {
    document.querySelectorAll('.drop-zone').forEach(z => z.style.borderColor = TYPE_META[type].colour);
  }, 0);
}

function onDragEnd() {
  dragData = null;
  document.querySelectorAll('.drop-zone').forEach(z => {
    z.classList.remove('drag-over');
    z.style.borderColor = '';
  });
}

function onDropZoneDragOver(e) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'copy';
  e.currentTarget.classList.add('drag-over');
}

function onDropZoneDragLeave(e) {
  e.currentTarget.classList.remove('drag-over');
}

function onDrop(e, zoneId) {
  e.preventDefault();
  e.currentTarget.classList.remove('drag-over');
  if (!dragData) return;

  additionIdCounter++;
  appliedAdditions.push({
    type: dragData.type,
    text: dragData.text,
    translation: dragData.translation,
    insert: dragData.insert,
    id: additionIdCounter,
    zoneId: zoneId
  });

  dragData = null;
  renderAdditions();
  renderSentence();
  renderTree();
  updateGrade();
  renderLadder();
}

/* ======= SENTENCE RENDERING ======= */
function renderSentence() {
  const display = document.getElementById('sentenceDisplay');
  const transLine = document.getElementById('translationLine');
  const undoStrip = document.getElementById('undoStrip');

  if (currentStarter === null) {
    display.innerHTML = '<span style="color:var(--text-muted);font-size:0.95rem;">Select a starter sentence above to begin.</span>';
    transLine.textContent = '';
    undoStrip.innerHTML = '';
    return;
  }

  const starter = LANGS[currentLang].starters[currentStarter];
  const parts = buildSentenceParts(starter);

  let html = '';
  parts.forEach(p => {
    if (p.type === 'drop') {
      html += `<span class="drop-zone" data-zone="${p.zoneId}"
        ondragover="onDropZoneDragOver(event)"
        ondragleave="onDropZoneDragLeave(event)"
        ondrop="onDrop(event,'${p.zoneId}')">${p.label}</span>`;
    } else {
      html += `<span class="word-group" data-type="${p.type}">${p.text}</span>`;
    }
  });

  display.innerHTML = html;

  // Translation
  const transParts = buildTranslationParts(starter);
  transLine.textContent = transParts;

  // Undo strip
  undoStrip.innerHTML = '';
  appliedAdditions.forEach(a => {
    const chip = document.createElement('span');
    chip.className = 'undo-chip';
    chip.innerHTML = `${a.text} <span class="x">&times;</span>`;
    chip.title = 'Remove this addition';
    chip.onclick = () => removeAddition(a.id);
    undoStrip.appendChild(chip);
  });
}

function buildSentenceParts(starter) {
  const parts = [];
  const applied = [...appliedAdditions];

  // Separate by insert type
  const prepends = applied.filter(a => a.insert === 'prepend');
  const beforeVerb = applied.filter(a => a.insert === 'before-verb');
  const afterVerb = applied.filter(a => a.insert === 'after-verb');
  const beforeNoun = applied.filter(a => a.insert === 'before-noun');
  const afterNoun = applied.filter(a => a.insert === 'after-noun');
  const beforeAdj = applied.filter(a => a.insert === 'before-adj');
  const extensions = applied.filter(a => a.insert === 'extend');
  const clauseEnd = applied.filter(a => a.insert === 'clause-end');
  const relatives = applied.filter(a => a.insert === 'relative');

  // Opinion/prepend zone
  if (prepends.length > 0) {
    prepends.forEach(p => parts.push({ type: p.type, text: p.text }));
    parts.push({ type: 'simple', text: ' ' });
  }
  const hasPrependSlot = !prepends.length;
  if (hasPrependSlot) {
    parts.push({ type: 'drop', zoneId: 'prepend', label: '+ opinion' });
    parts.push({ type: 'simple', text: ' ' });
  }

  // Before-verb adverbs
  beforeVerb.forEach(a => {
    parts.push({ type: a.type, text: a.text });
    parts.push({ type: 'simple', text: ' ' });
  });

  // Main sentence base
  parts.push({ type: 'simple', text: starter.base });

  // Before-adj intensifier
  if (beforeAdj.length) {
    parts.push({ type: 'simple', text: ' ' });
    beforeAdj.forEach(a => parts.push({ type: a.type, text: a.text }));
  }

  // Before-noun adjective (German style)
  if (beforeNoun.length) {
    parts.push({ type: 'simple', text: ' ' });
    beforeNoun.forEach(a => parts.push({ type: a.type, text: a.text }));
  }

  // After-noun adjective
  if (afterNoun.length) {
    parts.push({ type: 'simple', text: ' ' });
    afterNoun.forEach(a => parts.push({ type: a.type, text: a.text }));
  }

  // Relative clause
  if (relatives.length) {
    parts.push({ type: 'simple', text: ' ' });
    relatives.forEach(r => parts.push({ type: r.type, text: r.text }));
  }

  // After-verb adverbs
  if (afterVerb.length) {
    parts.push({ type: 'simple', text: ' ' });
    afterVerb.forEach(a => parts.push({ type: a.type, text: a.text }));
  }

  // Drop zones for missing types
  const usedTypes = new Set(applied.map(a => a.type));
  const mainDrops = [];
  if (!usedTypes.has('adjective')) mainDrops.push({ zoneId: 'adj', label: '+ adj' });
  if (!usedTypes.has('adverb')) mainDrops.push({ zoneId: 'adv', label: '+ adverb' });
  if (!usedTypes.has('relative')) mainDrops.push({ zoneId: 'rel', label: '+ relative' });

  mainDrops.forEach(d => {
    parts.push({ type: 'simple', text: ' ' });
    parts.push({ type: 'drop', zoneId: d.zoneId, label: d.label });
  });

  // Connective + extension
  if (extensions.length) {
    parts.push({ type: 'simple', text: ' ' });
    extensions.forEach(a => {
      parts.push({ type: a.type, text: a.text });
      parts.push({ type: 'simple', text: ' ...' });
    });
  } else {
    parts.push({ type: 'simple', text: ' ' });
    parts.push({ type: 'drop', zoneId: 'conn', label: '+ connective' });
  }

  // Subordinate clauses
  if (clauseEnd.length) {
    parts.push({ type: 'simple', text: ' ' });
    clauseEnd.forEach(c => parts.push({ type: c.type, text: c.text }));
  } else {
    parts.push({ type: 'simple', text: ' ' });
    parts.push({ type: 'drop', zoneId: 'sub', label: '+ clause' });
  }

  parts.push({ type: 'simple', text: '.' });
  return parts;
}

function buildTranslationParts(starter) {
  const applied = [...appliedAdditions];
  const prepends = applied.filter(a => a.insert === 'prepend');
  const others = applied.filter(a => a.insert !== 'prepend');

  let trans = '';
  if (prepends.length) trans += prepends.map(p => p.translation).join(' ') + ' ';
  trans += starter.translation.replace('.', '');
  others.forEach(a => {
    if (a.insert === 'extend') trans += ' ' + a.translation + ' ...';
    else trans += ' ' + a.translation;
  });
  trans += '.';
  return trans;
}

function removeAddition(id) {
  appliedAdditions = appliedAdditions.filter(a => a.id !== id);
  renderAdditions();
  renderSentence();
  renderTree();
  updateGrade();
  renderLadder();
}

function resetSentence() {
  appliedAdditions = [];
  renderAdditions();
  renderSentence();
  renderTree();
  updateGrade();
  renderLadder();
}

/* ======= GRADE ======= */
function updateGrade() {
  let score = 0;
  const typeCounts = {};
  appliedAdditions.forEach(a => {
    const s = TYPE_META[a.type].score;
    score += s;
    typeCounts[a.type] = (typeCounts[a.type] || 0) + 1;
  });

  let gradeInfo = GRADE_MAP[0];
  for (let i = GRADE_MAP.length - 1; i >= 0; i--) {
    if (score >= GRADE_MAP[i].min) { gradeInfo = GRADE_MAP[i]; break; }
  }

  const ring = document.getElementById('gradeRing');
  const circumference = 314.16;
  const progress = Math.min(score / 10, 1);
  ring.setAttribute('stroke-dashoffset', circumference * (1 - progress));

  document.getElementById('gradeNumber').textContent = gradeInfo.grade;
  document.getElementById('gradeDescriptor').textContent = gradeInfo.desc;

  // Score breakdown
  const breakdown = document.getElementById('scoreBreakdown');
  let html = '';
  if (currentStarter !== null) {
    html += `<div class="score-row"><span><span class="score-dot" style="background:var(--simple-colour)"></span>Base sentence</span><span>0</span></div>`;
  }
  Object.keys(TYPE_META).forEach(type => {
    if (typeCounts[type]) {
      const meta = TYPE_META[type];
      const pts = typeCounts[type] * meta.score;
      html += `<div class="score-row"><span><span class="score-dot" style="background:${meta.colour}"></span>${meta.label} x${typeCounts[type]}</span><span>+${pts}</span></div>`;
    }
  });
  if (score > 0) {
    html += `<div class="score-row" style="font-weight:700;border-top:2px solid var(--border);padding-top:8px;"><span>Total</span><span>${score}</span></div>`;
  }
  breakdown.innerHTML = html;
}

/* ======= SENTENCE TREE ======= */
function renderTree() {
  const container = document.getElementById('treeView');
  if (currentStarter === null) {
    container.innerHTML = '<span style="color:var(--text-muted);font-size:0.85rem;">Select a starter to see the structure.</span>';
    return;
  }

  const starter = LANGS[currentLang].starters[currentStarter];
  const applied = [...appliedAdditions];

  let html = '';
  html += `<div><span class="tree-label" data-type="simple">Main Clause</span>${escHtml(starter.base)}</div>`;

  const grouped = {};
  applied.forEach(a => {
    if (!grouped[a.type]) grouped[a.type] = [];
    grouped[a.type].push(a);
  });

  Object.keys(grouped).forEach(type => {
    const meta = TYPE_META[type];
    grouped[type].forEach(a => {
      html += `<div class="tree-node"><span class="tree-label" data-type="${type}">${meta.label}</span>${escHtml(a.text)} <span style="color:var(--text-muted);font-size:0.78rem;">(${escHtml(a.translation)})</span></div>`;
    });
  });

  container.innerHTML = html;
}

function escHtml(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

/* ======= SVG LADDER ======= */
function renderLadder() {
  const svg = document.getElementById('ladderSvg');
  const rungs = LADDER_RUNGS;
  const rungCount = rungs.length;
  const topPad = 30;
  const bottomPad = 20;
  const usable = 420 - topPad - bottomPad;
  const spacing = usable / (rungCount - 1);
  const railX1 = 35;
  const railX2 = 125;

  const usedTypes = new Set(appliedAdditions.map(a => a.type));
  if (currentStarter !== null) usedTypes.add('simple');

  // Determine highest active rung
  let highestActive = -1;
  rungs.forEach((r, i) => { if (usedTypes.has(r.type)) highestActive = i; });

  let content = '';

  // Rails
  content += `<line x1="${railX1}" y1="${topPad - 10}" x2="${railX1}" y2="${topPad + usable + 10}" stroke="var(--purple-300)" stroke-width="4" stroke-linecap="round"/>`;
  content += `<line x1="${railX2}" y1="${topPad - 10}" x2="${railX2}" y2="${topPad + usable + 10}" stroke="var(--purple-300)" stroke-width="4" stroke-linecap="round"/>`;

  // Rungs (bottom to top)
  rungs.forEach((r, i) => {
    const y = topPad + usable - i * spacing;
    const isActive = usedTypes.has(r.type);
    const colour = r.type === 'simple' ? 'var(--simple-colour)' : (TYPE_META[r.type] ? TYPE_META[r.type].colour : 'var(--simple-colour)');
    const strokeColour = isActive ? colour : 'var(--purple-200)';
    const fillOpacity = isActive ? 0.15 : 0;

    content += `<line x1="${railX1}" y1="${y}" x2="${railX2}" y2="${y}" stroke="${strokeColour}" stroke-width="${isActive ? 4 : 3}" stroke-linecap="round"/>`;

    // Label
    const labelX = railX2 + 8;
    const labelColour = isActive ? colour : 'var(--text-muted)';
    const fontWeight = isActive ? '700' : '400';
    content += `<text x="${railX1 - 4}" y="${y - 8}" font-size="9" fill="${labelColour}" font-weight="${fontWeight}" text-anchor="end">${r.label}</text>`;

    // Active dot
    if (isActive) {
      content += `<circle cx="${(railX1 + railX2) / 2}" cy="${y}" r="6" fill="${colour}" opacity="0.9"/>`;
      content += `<circle cx="${(railX1 + railX2) / 2}" cy="${y}" r="3" fill="#fff"/>`;
    }
  });

  // Climber indicator at highest active rung
  if (highestActive >= 0) {
    const climbY = topPad + usable - highestActive * spacing;
    content += `<polygon points="${railX1 - 18},${climbY - 6} ${railX1 - 18},${climbY + 6} ${railX1 - 8},${climbY}" fill="var(--purple-600)" opacity="0.8"/>`;
  }

  svg.innerHTML = content;
}

/* ======= MODAL ======= */
function toggleModal() {
  const overlay = document.getElementById('modalOverlay');
  overlay.classList.toggle('open');
}
document.getElementById('modalOverlay').addEventListener('click', function(e) {
  if (e.target === this) toggleModal();
});

/* ======= GLOBAL DROP HANDLER ======= */
// Allow drops on any drop zone, mapping zone IDs to accepted types
document.addEventListener('drop', function(e) {
  // Handled by individual drop zone handlers
});

/* ======= START ======= */
init();
</script>
</body>
</html>