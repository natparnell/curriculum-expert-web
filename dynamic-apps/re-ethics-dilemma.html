<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ethics Dilemma Analyser</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --purple-deep:#2d1b4e;--purple-mid:#4a2d7a;--purple-light:#7b5ea7;
  --teal-deep:#0d4f4f;--teal-mid:#1a8a8a;--teal-light:#2ec4b6;
  --gold-soft:#d4a853;--gold-light:#f0d48a;--gold-pale:#faf0d7;
  --bg:#1a1128;--bg-card:#251a3a;--bg-card2:#2f2248;
  --text:#e8e0f0;--text-muted:#a898c0;--text-dim:#776a90;
  --border:#3d2d5c;--border-light:#5a4580;
  --optA:#2ec4b6;--optB:#e07b54;
  --radius:12px;--radius-sm:8px;
  --shadow:0 4px 24px rgba(0,0,0,.35);
  --transition:all .3s ease;
}
html{font-size:16px;scroll-behavior:smooth}
body{
  font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
  background:var(--bg);color:var(--text);
  line-height:1.65;min-height:100vh;
  background-image:radial-gradient(ellipse at 20% 50%,rgba(45,27,78,.6) 0%,transparent 60%),
                    radial-gradient(ellipse at 80% 20%,rgba(13,79,79,.4) 0%,transparent 50%);
}
h1,h2,h3,h4{font-weight:600;line-height:1.3}
button{cursor:pointer;font-family:inherit;font-size:inherit}
.container{max-width:1100px;margin:0 auto;padding:0 24px}

/* Header */
.site-header{
  text-align:center;padding:48px 24px 32px;
  border-bottom:1px solid var(--border);
}
.site-header h1{
  font-size:clamp(2rem,5vw,3.2rem);
  background:linear-gradient(135deg,var(--teal-light),var(--gold-soft));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-clip:text;letter-spacing:-.5px;
}
.site-header p{color:var(--text-muted);font-size:1.05rem;margin-top:8px;font-style:italic}
.site-header .subtitle{display:flex;align-items:center;justify-content:center;gap:12px;margin-top:4px}
.site-header .dot{width:6px;height:6px;border-radius:50%;background:var(--gold-soft);opacity:.6}

/* Sections */
section{padding:32px 0}

/* Dilemma Selector */
.dilemma-grid{
  display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:16px;margin-top:24px;
}
.dilemma-card{
  background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--radius);padding:24px;cursor:pointer;
  transition:var(--transition);position:relative;overflow:hidden;
}
.dilemma-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,var(--teal-light),var(--purple-light));
  opacity:0;transition:var(--transition);
}
.dilemma-card:hover,.dilemma-card.active{
  border-color:var(--teal-light);transform:translateY(-2px);
  box-shadow:0 8px 32px rgba(46,196,182,.15);
}
.dilemma-card:hover::before,.dilemma-card.active::before{opacity:1}
.dilemma-card h3{font-size:1.1rem;margin-bottom:8px;color:var(--gold-soft)}
.dilemma-card p{font-size:.9rem;color:var(--text-muted);line-height:1.5}
.dilemma-card .card-num{
  position:absolute;top:16px;right:16px;
  font-size:.75rem;font-weight:700;color:var(--teal-light);
  background:rgba(46,196,182,.12);padding:4px 10px;border-radius:20px;
}

/* Active Dilemma Area */
#dilemma-workspace{display:none}
.scenario-box{
  background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--radius);padding:32px;margin-bottom:24px;
  position:relative;
}
.scenario-box h2{font-size:1.5rem;margin-bottom:16px;color:var(--gold-soft)}
.scenario-box .scenario-text{font-size:1.08rem;line-height:1.8;color:var(--text)}
.scenario-box .decision-prompt{
  margin-top:20px;padding-top:16px;border-top:1px solid var(--border);
  font-weight:600;color:var(--teal-light);font-size:1.05rem;
}
.back-btn{
  display:inline-flex;align-items:center;gap:8px;
  background:none;border:1px solid var(--border);color:var(--text-muted);
  padding:8px 18px;border-radius:var(--radius-sm);font-size:.9rem;
  margin-bottom:20px;transition:var(--transition);
}
.back-btn:hover{border-color:var(--teal-light);color:var(--teal-light)}

/* Gut Decision */
.gut-decision{
  display:flex;gap:16px;margin-top:20px;flex-wrap:wrap;
}
.gut-btn{
  flex:1;min-width:200px;padding:20px 24px;
  border-radius:var(--radius);border:2px solid var(--border);
  background:var(--bg-card2);color:var(--text);
  font-size:1rem;text-align:left;transition:var(--transition);
}
.gut-btn:hover{transform:translateY(-2px)}
.gut-btn.opt-a:hover,.gut-btn.opt-a.selected{
  border-color:var(--optA);background:rgba(46,196,182,.1);
}
.gut-btn.opt-b:hover,.gut-btn.opt-b.selected{
  border-color:var(--optB);background:rgba(224,123,84,.1);
}
.gut-btn .opt-label{
  font-size:.8rem;font-weight:700;text-transform:uppercase;
  letter-spacing:1px;margin-bottom:6px;
}
.gut-btn.opt-a .opt-label{color:var(--optA)}
.gut-btn.opt-b .opt-label{color:var(--optB)}
.gut-btn .opt-text{color:var(--text-muted);font-size:.95rem}
.gut-btn.selected{box-shadow:0 0 20px rgba(46,196,182,.15)}

/* Tabs */
.lens-tabs{
  display:flex;gap:4px;margin-top:32px;flex-wrap:wrap;
  border-bottom:2px solid var(--border);padding-bottom:0;
}
.lens-tab{
  padding:14px 22px;background:none;border:none;
  color:var(--text-muted);font-size:.95rem;font-weight:500;
  border-bottom:3px solid transparent;margin-bottom:-2px;
  transition:var(--transition);white-space:nowrap;
}
.lens-tab:hover{color:var(--text)}
.lens-tab.active{
  color:var(--gold-soft);border-bottom-color:var(--gold-soft);
}
.lens-panel{
  display:none;background:var(--bg-card);border:1px solid var(--border);
  border-top:none;border-radius:0 0 var(--radius) var(--radius);
  padding:32px;animation:fadeIn .3s ease;
}
.lens-panel.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* Philosopher Quote */
.quote-box{
  background:linear-gradient(135deg,rgba(45,27,78,.5),rgba(13,79,79,.3));
  border-left:4px solid var(--gold-soft);border-radius:0 var(--radius-sm) var(--radius-sm) 0;
  padding:20px 24px;margin:20px 0;font-style:italic;
  color:var(--gold-light);line-height:1.7;
}
.quote-box .quote-author{
  display:block;margin-top:8px;font-style:normal;
  font-size:.85rem;color:var(--gold-soft);font-weight:600;
}

/* Utilitarianism Panel */
.stakeholder-row{
  display:flex;align-items:center;gap:16px;padding:14px 0;
  border-bottom:1px solid rgba(61,45,92,.5);flex-wrap:wrap;
}
.stakeholder-name{min-width:160px;font-weight:500;color:var(--text)}
.stakeholder-inputs{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.stakeholder-inputs label{font-size:.85rem;color:var(--text-muted)}
.num-input{
  width:70px;padding:8px 10px;border-radius:var(--radius-sm);
  border:1px solid var(--border);background:var(--bg);color:var(--text);
  font-size:.95rem;text-align:center;
}
.num-input:focus{outline:none;border-color:var(--teal-light)}
.util-result{
  margin-top:24px;padding:20px;border-radius:var(--radius-sm);
  background:var(--bg-card2);border:1px solid var(--border);
  text-align:center;
}
.util-result .score{font-size:2rem;font-weight:700;margin:8px 0}
.util-result .score.positive{color:var(--optA)}
.util-result .score.negative{color:var(--optB)}
.calc-btn{
  margin-top:16px;padding:12px 32px;border-radius:var(--radius-sm);
  border:none;background:linear-gradient(135deg,var(--teal-deep),var(--teal-mid));
  color:white;font-weight:600;font-size:1rem;transition:var(--transition);
}
.calc-btn:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(26,138,138,.3)}

/* Kantian Panel */
.kant-checklist{list-style:none;margin-top:16px}
.kant-checklist li{
  padding:16px;margin-bottom:12px;
  background:var(--bg-card2);border-radius:var(--radius-sm);
  border:1px solid var(--border);
}
.kant-checklist li label{
  display:flex;align-items:flex-start;gap:12px;cursor:pointer;
}
.kant-checklist li .principle-name{font-weight:600;color:var(--teal-light);display:block}
.kant-checklist li .principle-desc{font-size:.9rem;color:var(--text-muted);margin-top:4px;display:block}
.kant-check{
  width:22px;height:22px;min-width:22px;margin-top:2px;
  accent-color:var(--teal-light);cursor:pointer;
}
.kant-result{
  margin-top:20px;padding:20px;background:var(--bg-card2);
  border-radius:var(--radius-sm);border:1px solid var(--border);
}
.kant-toggle{
  display:flex;gap:8px;margin-top:10px;
}
.kant-toggle button{
  padding:10px 20px;border-radius:var(--radius-sm);border:2px solid var(--border);
  background:var(--bg);color:var(--text-muted);font-weight:500;
  transition:var(--transition);flex:1;
}
.kant-toggle button.sel-a{border-color:var(--optA);color:var(--optA);background:rgba(46,196,182,.08)}
.kant-toggle button.sel-b{border-color:var(--optB);color:var(--optB);background:rgba(224,123,84,.08)}

/* Virtue Ethics Panel */
.virtue-sliders{margin-top:20px}
.virtue-row{
  display:grid;grid-template-columns:120px 1fr 50px 1fr 50px;
  gap:12px;align-items:center;padding:12px 0;
  border-bottom:1px solid rgba(61,45,92,.3);
}
.virtue-label{font-weight:500;color:var(--gold-soft);font-size:.95rem}
.virtue-opt-label{font-size:.75rem;text-align:center;font-weight:600}
.virtue-opt-label.a-label{color:var(--optA)}
.virtue-opt-label.b-label{color:var(--optB)}
input[type="range"]{
  -webkit-appearance:none;width:100%;height:6px;
  border-radius:3px;background:var(--border);outline:none;
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;width:20px;height:20px;border-radius:50%;
  cursor:pointer;border:2px solid var(--gold-soft);
}
input[type="range"].range-a::-webkit-slider-thumb{background:var(--optA)}
input[type="range"].range-b::-webkit-slider-thumb{background:var(--optB)}
.radar-container{
  display:flex;justify-content:center;align-items:center;
  margin-top:24px;position:relative;
}
.radar-container canvas{max-width:100%;border-radius:var(--radius)}
.radar-legend{
  display:flex;gap:24px;justify-content:center;margin-top:12px;font-size:.9rem;
}
.radar-legend span{display:flex;align-items:center;gap:6px}
.radar-legend .dot-a{width:12px;height:12px;border-radius:50%;background:var(--optA)}
.radar-legend .dot-b{width:12px;height:12px;border-radius:50%;background:var(--optB)}

/* Religious Ethics Panel */
.religion-selector{
  display:flex;gap:8px;flex-wrap:wrap;margin:16px 0;
}
.religion-btn{
  padding:10px 18px;border-radius:20px;border:1px solid var(--border);
  background:var(--bg-card2);color:var(--text-muted);font-size:.9rem;
  transition:var(--transition);
}
.religion-btn:hover{border-color:var(--gold-soft);color:var(--gold-soft)}
.religion-btn.active{
  background:linear-gradient(135deg,rgba(212,168,83,.15),rgba(212,168,83,.05));
  border-color:var(--gold-soft);color:var(--gold-soft);
}
.religion-content{
  background:var(--bg-card2);border-radius:var(--radius-sm);
  padding:24px;border:1px solid var(--border);min-height:120px;
}
.religion-content h4{color:var(--gold-soft);margin-bottom:12px;font-size:1.1rem}
.religion-content .teaching{
  background:rgba(212,168,83,.08);border-left:3px solid var(--gold-soft);
  padding:12px 16px;margin:12px 0;border-radius:0 var(--radius-sm) var(--radius-sm) 0;
  font-style:italic;color:var(--gold-light);
}
.religion-content .analysis{color:var(--text-muted);margin-top:12px;line-height:1.7}

/* Final Reflection */
#reflection-section{display:none;margin-top:32px}
.spectrum-row{
  display:flex;align-items:center;gap:16px;padding:16px 0;
  border-bottom:1px solid rgba(61,45,92,.3);
}
.spectrum-label{min-width:140px;font-weight:500;color:var(--text-muted);font-size:.9rem}
.spectrum-track{flex:1;position:relative}
.spectrum-endpoints{
  display:flex;justify-content:space-between;font-size:.75rem;
  margin-bottom:4px;
}
.spectrum-endpoints .ep-a{color:var(--optA)}
.spectrum-endpoints .ep-b{color:var(--optB)}
input[type="range"].spectrum-slider{
  width:100%;background:linear-gradient(90deg,var(--optA),var(--border) 50%,var(--optB));
}
input[type="range"].spectrum-slider::-webkit-slider-thumb{
  background:var(--gold-soft);border-color:var(--gold-light);
}
.reflection-textarea{
  width:100%;min-height:160px;padding:16px;border-radius:var(--radius-sm);
  border:1px solid var(--border);background:var(--bg);color:var(--text);
  font-family:inherit;font-size:1rem;line-height:1.7;resize:vertical;
  margin-top:16px;
}
.reflection-textarea:focus{outline:none;border-color:var(--teal-light)}
.reflection-textarea::placeholder{color:var(--text-dim)}
.submit-btn{
  margin-top:20px;padding:14px 40px;border-radius:var(--radius-sm);
  border:none;font-weight:600;font-size:1.05rem;
  background:linear-gradient(135deg,var(--purple-mid),var(--teal-deep));
  color:white;transition:var(--transition);
}
.submit-btn:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(45,27,78,.4)}

/* Change Visualisation */
#change-viz{display:none;margin-top:24px}
.change-card{
  background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--radius);padding:32px;text-align:center;
}
.change-card h3{color:var(--gold-soft);margin-bottom:20px;font-size:1.3rem}
.change-arrows{
  display:flex;justify-content:center;align-items:center;gap:32px;
  margin:20px 0;flex-wrap:wrap;
}
.change-box{
  padding:20px 28px;border-radius:var(--radius-sm);
  min-width:160px;
}
.change-box.gut{background:rgba(46,196,182,.1);border:2px solid var(--optA)}
.change-box.final{background:rgba(212,168,83,.1);border:2px solid var(--gold-soft)}
.change-box .label{font-size:.8rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);margin-bottom:6px}
.change-box .value{font-size:1.1rem;font-weight:600}
.change-arrow{font-size:2rem;color:var(--gold-soft)}
.change-msg{font-size:1.05rem;color:var(--text-muted);margin-top:16px;font-style:italic}

/* Class Vote */
#class-vote-section{
  margin-top:32px;padding:32px;
  background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--radius);
}
#class-vote-section h3{color:var(--gold-soft);margin-bottom:20px;font-size:1.2rem;text-align:center}
.vote-bar-container{margin:16px 0}
.vote-bar-label{
  display:flex;justify-content:space-between;font-size:.9rem;
  margin-bottom:6px;color:var(--text-muted);
}
.vote-bar{
  height:36px;border-radius:18px;overflow:hidden;
  display:flex;background:var(--bg);border:1px solid var(--border);
}
.vote-bar .bar-a{
  background:linear-gradient(90deg,var(--optA),rgba(46,196,182,.6));
  transition:width .5s ease;display:flex;align-items:center;
  justify-content:center;font-size:.85rem;font-weight:600;color:var(--bg);
  min-width:0;
}
.vote-bar .bar-b{
  background:linear-gradient(90deg,rgba(224,123,84,.6),var(--optB));
  transition:width .5s ease;display:flex;align-items:center;
  justify-content:center;font-size:.85rem;font-weight:600;color:var(--bg);
  min-width:0;
}
.vote-total{text-align:center;font-size:.85rem;color:var(--text-dim);margin-top:8px}
.clear-votes-btn{
  display:block;margin:16px auto 0;padding:8px 20px;
  border-radius:var(--radius-sm);border:1px solid var(--border);
  background:none;color:var(--text-dim);font-size:.85rem;
  transition:var(--transition);
}
.clear-votes-btn:hover{border-color:var(--optB);color:var(--optB)}

/* Responsive */
@media(max-width:768px){
  .virtue-row{grid-template-columns:1fr;gap:6px}
  .virtue-row .virtue-opt-label{text-align:left}
  .stakeholder-row{flex-direction:column;align-items:flex-start}
  .dilemma-grid{grid-template-columns:1fr}
  .change-arrows{flex-direction:column}
}
/* Projector mode - larger fonts */
@media(min-width:1400px){
  html{font-size:18px}
}

/* Section titles */
.section-title{
  font-size:1.4rem;margin-bottom:20px;
  display:flex;align-items:center;gap:12px;
}
.section-title::before{
  content:'';width:4px;height:28px;border-radius:2px;
  background:linear-gradient(180deg,var(--teal-light),var(--purple-light));
}

/* Scroll indicator */
.explore-prompt{
  text-align:center;padding:20px;color:var(--text-dim);
  font-size:.9rem;animation:pulse 2s ease-in-out infinite;
}
@keyframes pulse{0%,100%{opacity:.5}50%{opacity:1}}

/* Print styling */
@media print{
  body{background:white;color:black}
  .back-btn,.gut-decision,.lens-tabs,.calc-btn,.submit-btn,.clear-votes-btn,.religion-selector{display:none}
}
</style>
</head>
<body>

<header class="site-header">
  <h1>Ethics Dilemma Analyser</h1>
  <div class="subtitle">
    <span class="dot"></span>
    <p>Explore moral choices through the lens of philosophy</p>
    <span class="dot"></span>
  </div>
</header>

<main class="container">

<!-- Dilemma Selection -->
<section id="dilemma-selection">
  <h2 class="section-title">Choose a Dilemma</h2>
  <div class="dilemma-grid" id="dilemma-grid"></div>
</section>

<!-- Workspace -->
<section id="dilemma-workspace">
  <button class="back-btn" onclick="goBack()">&#8592; Back to Dilemmas</button>

  <div class="scenario-box">
    <h2 id="ws-title"></h2>
    <div class="scenario-text" id="ws-scenario"></div>
    <div class="decision-prompt" id="ws-prompt"></div>
  </div>

  <!-- Gut Decision -->
  <div id="gut-section">
    <h3 class="section-title">Your Gut Reaction</h3>
    <p style="color:var(--text-muted);margin-bottom:8px;">Before analysing, what does your instinct tell you?</p>
    <div class="gut-decision">
      <button class="gut-btn opt-a" onclick="selectGut('A')">
        <div class="opt-label">Option A</div>
        <div class="opt-text" id="gut-opt-a-text"></div>
      </button>
      <button class="gut-btn opt-b" onclick="selectGut('B')">
        <div class="opt-label">Option B</div>
        <div class="opt-text" id="gut-opt-b-text"></div>
      </button>
    </div>
  </div>

  <!-- Ethical Lenses (shown after gut) -->
  <div id="lenses-section" style="display:none">
    <div class="explore-prompt">Explore the dilemma through four ethical lenses below</div>

    <div class="lens-tabs">
      <button class="lens-tab active" onclick="switchTab('util')">Utilitarianism</button>
      <button class="lens-tab" onclick="switchTab('kant')">Kantian Ethics</button>
      <button class="lens-tab" onclick="switchTab('virtue')">Virtue Ethics</button>
      <button class="lens-tab" onclick="switchTab('religion')">Religious Ethics</button>
    </div>

    <!-- Utilitarianism Panel -->
    <div class="lens-panel active" id="panel-util">
      <h3 style="color:var(--teal-light);margin-bottom:8px;">Utilitarianism</h3>
      <p style="color:var(--text-muted);margin-bottom:16px;">The greatest good for the greatest number. Weigh up the total happiness and suffering each option creates.</p>
      <div class="quote-box">
        "It is the greatest happiness of the greatest number that is the measure of right and wrong."
        <span class="quote-author">-- Jeremy Bentham</span>
      </div>
      <div class="quote-box" style="border-left-color:var(--teal-light);">
        "Actions are right in proportion as they tend to promote happiness, wrong as they tend to produce the reverse of happiness."
        <span class="quote-author">-- John Stuart Mill</span>
      </div>
      <h4 style="margin:20px 0 10px;color:var(--gold-soft);">Happiness Calculator</h4>
      <p style="color:var(--text-muted);font-size:.9rem;margin-bottom:16px;">For each stakeholder, assign happiness (+) or suffering (-) points (scale: -10 to +10) for each option.</p>
      <div id="util-stakeholders"></div>
      <button class="calc-btn" onclick="calculateUtil()">Calculate Utilitarian Answer</button>
      <div class="util-result" id="util-result" style="display:none">
        <div style="font-size:.9rem;color:var(--text-muted)">Net Happiness Scores</div>
        <div style="display:flex;justify-content:center;gap:40px;margin-top:10px;">
          <div>
            <div style="font-size:.8rem;color:var(--optA);font-weight:600;">OPTION A</div>
            <div class="score" id="util-score-a">0</div>
          </div>
          <div>
            <div style="font-size:.8rem;color:var(--optB);font-weight:600;">OPTION B</div>
            <div class="score" id="util-score-b">0</div>
          </div>
        </div>
        <div id="util-verdict" style="margin-top:12px;font-weight:600;font-size:1.05rem;"></div>
      </div>
    </div>

    <!-- Kantian Panel -->
    <div class="lens-panel" id="panel-kant">
      <h3 style="color:var(--teal-light);margin-bottom:8px;">Kantian Ethics (Duty-Based)</h3>
      <p style="color:var(--text-muted);margin-bottom:16px;">Immanuel Kant argued that morality is about following rational duties, not consequences.</p>
      <div class="quote-box">
        "Act only according to that maxim whereby you can at the same time will that it should become a universal law."
        <span class="quote-author">-- Immanuel Kant, Groundwork of the Metaphysics of Morals</span>
      </div>
      <div class="quote-box" style="border-left-color:var(--teal-light);">
        "Act in such a way that you treat humanity, whether in your own person or in the person of any other, never merely as a means to an end, but always at the same time as an end."
        <span class="quote-author">-- Immanuel Kant</span>
      </div>
      <h4 style="margin:20px 0 12px;color:var(--gold-soft);">Test Each Option Against Kant's Principles</h4>
      <div id="kant-options-area"></div>
    </div>

    <!-- Virtue Ethics Panel -->
    <div class="lens-panel" id="panel-virtue">
      <h3 style="color:var(--teal-light);margin-bottom:8px;">Virtue Ethics</h3>
      <p style="color:var(--text-muted);margin-bottom:16px;">Aristotle asked: "What would a virtuous person do?" Focus on character, not rules or outcomes.</p>
      <div class="quote-box">
        "We are what we repeatedly do. Excellence, then, is not an act, but a habit."
        <span class="quote-author">-- Aristotle (attributed), Nicomachean Ethics</span>
      </div>
      <div class="quote-box" style="border-left-color:var(--teal-light);">
        "The function of man is to live a certain kind of life, and this activity implies a rational principle, and the function of a good man is the good and noble performance of these."
        <span class="quote-author">-- Aristotle</span>
      </div>
      <h4 style="margin:20px 0 12px;color:var(--gold-soft);">Rate Each Option on Key Virtues (1-10)</h4>
      <div class="virtue-sliders" id="virtue-sliders"></div>
      <button class="calc-btn" style="margin-top:20px;" onclick="drawRadar()">Generate Virtue Profile</button>
      <div class="radar-container" id="radar-container" style="display:none">
        <canvas id="radar-canvas" width="420" height="420"></canvas>
      </div>
      <div class="radar-legend" id="radar-legend" style="display:none">
        <span><span class="dot-a"></span> Option A</span>
        <span><span class="dot-b"></span> Option B</span>
      </div>
    </div>

    <!-- Religious Ethics Panel -->
    <div class="lens-panel" id="panel-religion">
      <h3 style="color:var(--teal-light);margin-bottom:8px;">Religious Ethics</h3>
      <p style="color:var(--text-muted);margin-bottom:16px;">Explore what different religious traditions teach about this type of dilemma.</p>
      <div class="quote-box">
        "Do unto others as you would have them do unto you."
        <span class="quote-author">-- The Golden Rule (found in many traditions)</span>
      </div>
      <div class="religion-selector" id="religion-selector"></div>
      <div class="religion-content" id="religion-content">
        <p style="color:var(--text-dim);font-style:italic;">Select a religious tradition above to explore its perspective.</p>
      </div>
    </div>
  </div>

  <!-- Final Reflection -->
  <div id="reflection-section">
    <h3 class="section-title">Final Reflection</h3>
    <p style="color:var(--text-muted);margin-bottom:20px;">Now that you have explored the dilemma through all four ethical lenses, record your considered position.</p>

    <h4 style="color:var(--gold-soft);margin-bottom:12px;">Position Yourself on Each Lens</h4>
    <div id="spectrum-area"></div>

    <h4 style="color:var(--gold-soft);margin:24px 0 8px;">Your Justified Response</h4>
    <p style="color:var(--text-muted);font-size:.9rem;margin-bottom:4px;">Explain your final decision. Reference at least two ethical theories in your reasoning.</p>
    <textarea class="reflection-textarea" id="final-response" placeholder="I believe the right course of action is... because from a utilitarian perspective... However, Kant would argue... On balance, I think..."></textarea>

    <button class="submit-btn" onclick="submitReflection()">Submit My Analysis</button>
  </div>

  <!-- Change Visualisation -->
  <div id="change-viz">
    <div class="change-card">
      <h3>Did Your View Change?</h3>
      <div class="change-arrows">
        <div class="change-box gut">
          <div class="label">Gut Reaction</div>
          <div class="value" id="viz-gut"></div>
        </div>
        <div class="change-arrow" id="viz-arrow">&#8594;</div>
        <div class="change-box final">
          <div class="label">Final Position</div>
          <div class="value" id="viz-final"></div>
        </div>
      </div>
      <div class="change-msg" id="viz-msg"></div>
    </div>

    <!-- Class Vote -->
    <div id="class-vote-section">
      <h3>Class Results</h3>
      <div id="class-vote-bars"></div>
      <div class="vote-total" id="vote-total"></div>
      <button class="clear-votes-btn" onclick="clearVotes()">Clear Class Votes</button>
    </div>
  </div>

</section>

</main>

<script>
// ===== DATA =====
const dilemmas = [
  {
    id:'trolley',
    title:'The Trolley Problem',
    short:'A runaway trolley is heading towards five people. You can pull a lever to divert it, but it will kill one person on the other track.',
    scenario:'A runaway trolley is hurtling down the tracks towards five workers who cannot escape. You are standing next to a lever. If you pull the lever, the trolley will be diverted onto a side track where only one worker is standing. That one worker will certainly be killed, but the five will be saved. If you do nothing, the five workers will die. There is no other option available to you.',
    prompt:'Do you pull the lever?',
    optA:'Pull the lever (save five, sacrifice one)',
    optB:'Do nothing (let the trolley continue towards the five)',
    stakeholders:['The 5 workers on the main track','The 1 worker on the side track','You (the decision-maker)','The families of all workers','Society / onlookers'],
    virtues:['Courage','Compassion','Justice','Prudence','Responsibility'],
    kantChecks:{
      A:['Could "divert harm to save more lives" be a universal law?','Are you treating the one worker merely as a means to save the five?','Does the one worker consent to being sacrificed?','Is pulling the lever fulfilling a duty of care?'],
      B:['Could "never actively cause someone\'s death" be a universal law?','Does inaction respect everyone\'s right to life equally?','Are you treating anyone merely as a means by doing nothing?','Is there a moral difference between killing and letting die?']
    },
    religious:{
      Christianity:{
        teaching:'"Greater love has no one than this: to lay down one\'s life for one\'s friends." (John 15:13)',
        analysis:'Christianity emphasises the sanctity of all human life. Catholic Natural Law teaching holds that deliberately killing an innocent person is always wrong (the principle of double effect may apply here). However, Jesus also taught sacrificial love for others. Many Christians would struggle with this dilemma, as both options result in death. The doctrine of double effect suggests that if the death of the one is a foreseen but unintended side effect of saving the five, pulling the lever may be morally permissible.'
      },
      Islam:{
        teaching:'"Whoever saves a life, it is as if he has saved all of humanity." (Quran 5:32)',
        analysis:'In Islam, every life is sacred and created by Allah. The principle of the lesser of two evils (akhaf al-dararayn) is recognised in Islamic jurisprudence: when faced with two harmful options, one should choose the less harmful. Most Islamic scholars would consider the loss of five lives a greater harm than one. However, actively causing someone\'s death raises serious concerns under Sharia. The intention (niyyah) behind the act matters greatly.'
      },
      Buddhism:{
        teaching:'"Hatred does not cease by hatred, but only by love; this is the eternal rule." (Dhammapada 1:5)',
        analysis:'Buddhism teaches compassion (karuna) for all living beings and follows the precept of not taking life (ahimsa). A Buddhist might focus on the intention behind the action -- is it motivated by compassion for the five, or is there attachment to being a hero? The doctrine of dependent origination suggests the situation has complex causes. Some Mahayana Buddhists might argue that a bodhisattva would act to save the greater number, accepting the karmic consequences with compassion.'
      },
      Hinduism:{
        teaching:'"Whenever there is a decline in righteousness and rise in unrighteousness, I manifest myself." (Bhagavad Gita 4:7)',
        analysis:'Hindu ethics draws on concepts of dharma (duty), karma (consequences of actions), and ahimsa (non-violence). The Bhagavad Gita presents Arjuna facing a similar dilemma about taking lives. Krishna teaches that one must follow one\'s dharma even when it is painful. If your dharma in this moment is to act as protector, pulling the lever may be justified. However, the karma of taking a life, even to save others, will have consequences that must be accepted.'
      },
      Judaism:{
        teaching:'"Whoever destroys a single life is considered as if he destroyed the whole world; and whoever saves a single life is as if he saved the whole world." (Talmud, Sanhedrin 37a)',
        analysis:'Jewish law (halakha) generally holds that one may not sacrifice one life to save others -- "whose blood is redder?" (Talmud). The principle of pikuach nefesh (saving life) is paramount but cannot override the prohibition on murder. However, some rabbinical authorities distinguish between actively killing and redirecting an existing threat. This remains one of the most debated scenarios in Jewish medical ethics.'
      },
      Sikhism:{
        teaching:'"Recognise the whole human race as one." (Guru Gobind Singh)',
        analysis:'Sikhism teaches the equal value of all human life and the importance of seva (selfless service). Sikh ethics emphasise acting with courage and compassion. The concept of hukam (divine will) acknowledges that suffering exists in the world. A Sikh might consider which action best serves the community while maintaining personal integrity. The principle of standing up against injustice and protecting the vulnerable would weigh heavily in this decision.'
      }
    }
  },
  {
    id:'wallet',
    title:'The Lost Wallet',
    short:'A student finds a wallet containing \u00A3200 and an ID card. Their family is struggling financially. What should they do?',
    scenario:'You are walking home from school and find a wallet on the pavement. Inside is \u00A3200 in cash and an ID card with the owner\'s name and address. Your family has been struggling financially -- your mum recently lost her job and you are behind on bills. The \u00A3200 would make a real difference at home. The ID shows the owner lives in a large house in an affluent area. Nobody saw you pick it up.',
    prompt:'What do you do with the wallet?',
    optA:'Return the wallet with all the money intact',
    optB:'Keep the money (you could post the wallet and ID back without the cash)',
    stakeholders:['You','Your family','The wallet owner','Your own sense of self','Society / community trust'],
    virtues:['Honesty','Compassion','Justice','Integrity','Temperance'],
    kantChecks:{
      A:['Could "always return lost property" work as a universal law?','Are you treating the wallet owner as an end in themselves (respecting their property)?','Is returning property a moral duty regardless of circumstances?','Does this action respect human dignity?'],
      B:['Could "keep found money when you need it more" work as a universal law?','Are you treating the wallet owner merely as a means to solve your financial problems?','Would a world where everyone kept found money be functional?','Does your financial need create a moral exception?']
    },
    religious:{
      Christianity:{
        teaching:'"Do not steal." (Exodus 20:15) / "Do to others as you would have them do to you." (Luke 6:31)',
        analysis:'Christian teaching is clear that stealing is wrong, even when motivated by need. Jesus taught honesty and the Golden Rule. However, Christianity also teaches compassion for the poor and the duty of the wealthy to share. While keeping the money would be considered theft, some liberation theologians might explore whether the social structures that created such inequality are themselves sinful. Most Christian traditions would urge returning the wallet and trusting in God\'s provision.'
      },
      Islam:{
        teaching:'"And do not consume one another\'s wealth unjustly." (Quran 2:188)',
        analysis:'Islam strictly prohibits taking what belongs to others. The concept of amanah (trust) is central -- found property should be returned to its rightful owner. The Prophet Muhammad (PBUH) was known as Al-Amin (the trustworthy). However, Islam also addresses poverty through zakat (charitable giving) and acknowledges that extreme need can affect moral judgement. A Muslim would be encouraged to return the wallet and trust in Allah\'s provision (tawakkul).'
      },
      Buddhism:{
        teaching:'"Take nothing that is not freely given." (Second Precept)',
        analysis:'The second precept of Buddhism clearly prohibits taking what is not given. Buddhism teaches that acting from greed or attachment leads to suffering. Keeping the money might provide temporary relief but would create negative karma and inner conflict. A Buddhist would seek the Middle Way -- returning the wallet while perhaps finding other, ethical solutions to financial hardship. The practice of right livelihood encourages honest dealing in all things.'
      },
      Hinduism:{
        teaching:'"Non-stealing (asteya) is one of the five yamas." (Yoga Sutras of Patanjali)',
        analysis:'Asteya (non-stealing) is one of the fundamental ethical principles in Hindu philosophy. The concept of karma teaches that dishonest actions will bring negative consequences. Dharma requires honest conduct regardless of personal circumstances. However, Hindu thought also recognises that dharma can be contextual (apad dharma -- ethics in times of distress). While most Hindu teachings would favour returning the wallet, the tension between personal dharma and family duty is acknowledged.'
      },
      Judaism:{
        teaching:'"You shall not steal." (Exodus 20:13) / "Justice, justice shall you pursue." (Deuteronomy 16:20)',
        analysis:'The Torah\'s commandment against stealing is unambiguous. Jewish law includes specific rules about returning lost property (hashavat aveidah) -- it is a positive commandment to return what is found. The Talmud discusses various scenarios of found objects in detail. While Judaism acknowledges the suffering of poverty, it does not permit theft as a solution. The community has obligations to support those in need through tzedakah (righteous giving).'
      },
      Sikhism:{
        teaching:'"Those who steal others\' wealth are like pigs and dogs." (Guru Granth Sahib, Ang 1286)',
        analysis:'Sikhism teaches kirat karni -- earning an honest living. Taking what belongs to another violates this fundamental principle. Guru Nanak emphasised truthful living above all else. The Sikh principle of vand chakko (sharing with others) applies to one\'s own earnings, not to taking from others. A Sikh would return the wallet, and the Sikh community (sangat) would be expected to support the family through their difficulty via langar and mutual aid.'
      }
    }
  },
  {
    id:'organs',
    title:'The Transplant Dilemma',
    short:'A doctor has 5 dying patients each needing a different organ. A healthy visitor arrives for a check-up...',
    scenario:'You are a doctor in a hospital. Five of your patients will die within 24 hours unless they each receive a specific organ transplant: one needs a heart, one needs a liver, one needs a kidney, one needs lungs, and one needs a pancreas. A perfectly healthy person comes in for a routine check-up. Their organs are a perfect match for all five patients. If you were to (secretly) harvest this person\'s organs, they would die but the five patients would all survive.',
    prompt:'Do you harvest the healthy visitor\'s organs to save the five patients?',
    optA:'No -- refuse to harm the healthy visitor',
    optB:'Yes -- sacrifice the one to save the five patients',
    stakeholders:['The healthy visitor','The 5 dying patients','The families of all six people','You (the doctor)','Public trust in medicine','Other hospital patients and staff'],
    virtues:['Justice','Compassion','Integrity','Courage','Prudence'],
    kantChecks:{
      A:['Could "never kill an innocent person for others\' benefit" be a universal law?','Does refusing protect the visitor\'s dignity as an end in themselves?','Is there a duty to "first do no harm" (medical ethics)?','Does this uphold the trust patients place in doctors?'],
      B:['Could "sacrifice one to save many" work as a universal law for doctors?','Are you treating the visitor purely as a means (an organ supply)?','Would you want this rule applied if you were the healthy visitor?','Does a doctor\'s duty to save lives override the duty not to harm?']
    },
    religious:{
      Christianity:{
        teaching:'"You shall not murder." (Exodus 20:13) / "The body is a temple of the Holy Spirit." (1 Corinthians 6:19)',
        analysis:'Christian teaching upholds the sanctity of life. Deliberately killing an innocent person is a grave sin, regardless of the intended outcome. The principle of double effect would not apply here because the visitor\'s death is not a side effect but the direct means of saving the others. Catholic moral theology is particularly clear: one may never do evil that good may come of it (Romans 3:8). Most Christian ethicists would firmly oppose harvesting the visitor\'s organs.'
      },
      Islam:{
        teaching:'"Do not kill a soul which Allah has made sacred except by right." (Quran 6:151)',
        analysis:'Islamic law (Sharia) strictly prohibits taking innocent life. The principle of necessity (darurah) does allow some flexibility in extreme circumstances, but scholars are clear that it does not extend to killing one person to save others. Islamic medical ethics, guided by the principle of "la darar wa la dirar" (no harm and no reciprocal harm), would prohibit a doctor from harming a healthy patient. Organ donation after natural death is generally accepted, but killing for organs is unanimously forbidden.'
      },
      Buddhism:{
        teaching:'"All tremble at violence; all fear death. Putting oneself in the place of another, one should not kill nor cause another to kill." (Dhammapada 129)',
        analysis:'Buddhism\'s first precept is non-killing (ahimsa). The intention behind an action is crucial in Buddhism -- killing with the intention of saving others is still killing, and the negative karma remains. A Buddhist would seek a path that minimises harm without actively causing death. The concept of right action requires that we not cause suffering to any being. A Buddhist doctor would care for all patients compassionately while accepting impermanence.'
      },
      Hinduism:{
        teaching:'"Ahimsa (non-violence) is the highest dharma." (Mahabharata 13.117.37)',
        analysis:'Hindu ethics places ahimsa (non-violence) as a supreme virtue. While the Bhagavad Gita does discuss situations where violence may be necessary (as in Arjuna\'s duty as a warrior), the deliberate killing of an innocent person for utilitarian purposes would be considered deeply adharmic (against righteous duty). A doctor\'s dharma is to heal, not to harm. The law of karma would ensure severe consequences for such an act, regardless of the good intentions behind it.'
      },
      Judaism:{
        teaching:'"You shall not stand idly by the blood of your neighbour." (Leviticus 19:16) / But also: "Whose blood is redder?" (Talmud, Sanhedrin 74a)',
        analysis:'Jewish law engages deeply with this exact type of dilemma. The Talmudic principle "whose blood is redder?" means we cannot judge one life as more valuable than another. The rule of ein dochin nefesh mipnei nefesh (we do not push aside one life for another) clearly applies. Even to save five lives, actively killing one innocent person is prohibited. Judaism distinguishes sharply between killing (which is always wrong) and allowing death (which may sometimes be unavoidable).'
      },
      Sikhism:{
        teaching:'"God\'s Light shines in every heart." (Guru Granth Sahib)',
        analysis:'Sikhism teaches that every person carries the divine light (jot) of Waheguru. Taking an innocent life deliberately would be a profound violation of this belief. Sikh ethics emphasise protecting the vulnerable and standing against injustice. A Sikh doctor would see their duty as serving all patients with compassion while refusing to harm any. The Sikh martial tradition permits fighting to defend the defenceless, but this is fundamentally different from killing an innocent person for others\' benefit.'
      }
    }
  },
  {
    id:'cheating',
    title:'The Best Friend\'s Secret',
    short:'Your best friend confesses they cheated on an important exam that determines university places.',
    scenario:'Your best friend tells you, in confidence, that they cheated on a crucial end-of-year exam. The results of this exam determine university offers. They used hidden notes on their phone. They scored very highly and have been offered a place at a competitive university. You know that another student -- someone kind and hardworking who studied honestly -- narrowly missed out on that same university place. If you report your friend, they will lose their place and face serious consequences. Your friend begs you to keep quiet.',
    prompt:'Do you report your friend or keep their secret?',
    optA:'Keep quiet -- protect your friend\'s secret',
    optB:'Report it -- uphold fairness and academic honesty',
    stakeholders:['Your best friend','You','The student who missed out','Other students who played fair','The school / institution','The university','Future employers who trust qualifications'],
    virtues:['Loyalty','Honesty','Justice','Courage','Compassion'],
    kantChecks:{
      A:['Could "always cover for a friend who cheats" be a universal law?','Are you treating the honest student fairly by staying silent?','Is loyalty to a friend a moral duty that overrides honesty?','Would the exam system work if everyone covered for cheaters?'],
      B:['Could "always report cheating regardless of friendship" be a universal law?','Are you treating your friend as an end (holding them accountable)?','Is there a duty to uphold fairness even at personal cost?','Does reporting respect everyone\'s dignity and right to fair treatment?']
    },
    religious:{
      Christianity:{
        teaching:'"The truth will set you free." (John 8:32) / "Speak the truth to each other." (Zechariah 8:16)',
        analysis:'Christianity values both truth and forgiveness. Jesus taught the importance of honesty and justice, but also mercy and reconciliation. A Christian might first encourage their friend to confess voluntarily (Matthew 18:15 -- "go and point out their fault, just between the two of you"). The commandment not to bear false witness applies to concealing the truth as well. However, Christian love also means wanting what is truly best for your friend, which may mean helping them face consequences and grow.'
      },
      Islam:{
        teaching:'"O you who believe, be persistently standing firm in justice, witnesses to Allah, even if it be against yourselves or parents and relatives." (Quran 4:135)',
        analysis:'Islam places enormous emphasis on justice (adl) and truthfulness (sidq). The Quran commands believers to uphold justice even against their own interests. Cheating is considered haram (forbidden), and concealing wrongdoing that harms others goes against Islamic principles. However, Islam also values covering the faults of others (satr) when the wrongdoing affects only the sinner. Since this cheating has directly harmed another student, the duty to justice is likely stronger. A Muslim might first advise the friend to confess.'
      },
      Buddhism:{
        teaching:'"One is not called noble who harms living beings. By not harming living beings one is called noble." (Dhammapada 270)',
        analysis:'Buddhism teaches right speech (part of the Eightfold Path), which includes truthfulness and speech that promotes harmony. Cheating arises from attachment and greed. A Buddhist would consider the harm caused by both silence and reporting. The Middle Way might suggest speaking honestly with the friend about the karmic consequences of their actions and encouraging them to make things right. Compassion (karuna) extends to the honest student who was harmed as well.'
      },
      Hinduism:{
        teaching:'"Truth alone triumphs, not falsehood." (Mundaka Upanishad 3.1.6, also India\'s national motto: Satyameva Jayate)',
        analysis:'Satya (truth) is one of the foundational principles of Hindu ethics. The dharma of a student is to learn honestly. Your friend has violated their dharma, creating negative karma. Hindu ethics also values loyalty in friendship, but not when it requires participating in adharma (unrighteousness). The Mahabharata explores complex situations where loyalties conflict. A Hindu might consider: what serves dharma overall? Protecting dishonesty ultimately harms everyone, including the friend.'
      },
      Judaism:{
        teaching:'"Justice, justice shall you pursue." (Deuteronomy 16:20) / "Do not stand idly by the blood of your neighbour." (Leviticus 19:16)',
        analysis:'Jewish law takes justice and honesty very seriously. The prohibition on theft extends to "stealing" a qualification through cheating. Standing by while an innocent person is harmed (the honest student) violates the principle of not standing idly by. However, Jewish tradition also values lashon hara (guarding against harmful speech) and encourages giving the wrongdoer a chance to repent (teshuvah). Ideally, one would urge the friend to confess while making clear that the injustice cannot stand.'
      },
      Sikhism:{
        teaching:'"Truth is the highest virtue, but higher still is truthful living." (Guru Nanak, Guru Granth Sahib)',
        analysis:'Sikh ethics prioritise truth (sat) and justice. Guru Nanak taught that truthful living is even more important than knowing the truth. Concealing cheating would violate the principle of honest living (kirat karni). Sikhism also values standing up against injustice, even when it is difficult. However, compassion and forgiveness are also important. A Sikh might urge their friend to confess, supporting them through the process, while being prepared to speak the truth if the friend refuses.'
      }
    }
  },
  {
    id:'car',
    title:'The Self-Driving Car',
    short:'A self-driving car must choose: hit 1 pedestrian who stepped out, or swerve and injure its 3 passengers.',
    scenario:'A self-driving car is carrying three passengers (including a child) when a single pedestrian suddenly steps into the road from behind a parked van. The car\'s AI calculates two possible outcomes with certainty: Option A -- brake and swerve left, hitting a barrier, causing serious injuries to all three passengers. Option B -- continue straight, hitting and likely killing the pedestrian, but keeping the passengers safe. The car must decide in milliseconds. As the programmer who wrote this algorithm, which instruction do you code?',
    prompt:'What should the car be programmed to do?',
    optA:'Swerve and injure the 3 passengers (protect the pedestrian)',
    optB:'Continue straight and hit the pedestrian (protect the passengers)',
    stakeholders:['The pedestrian','The 3 passengers (including a child)','The car manufacturer','The programmer','Future passengers of self-driving cars','Society (pedestrians and drivers alike)','Insurance companies and regulators'],
    virtues:['Justice','Responsibility','Compassion','Prudence','Courage'],
    kantChecks:{
      A:['Could "always protect pedestrians over passengers" be a universal law?','Does this treat all human lives as having equal worth?','Would people buy self-driving cars programmed to sacrifice them?','Is there a duty to protect those outside the vehicle who didn\'t choose the risk?'],
      B:['Could "always protect passengers over pedestrians" be a universal law?','Does this treat the pedestrian merely as less important?','Do passengers have a special claim because they trusted the car?','Would pedestrians accept a world where cars prioritise their occupants?']
    },
    religious:{
      Christianity:{
        teaching:'"Love your neighbour as yourself." (Mark 12:31)',
        analysis:'This dilemma challenges Christians to consider who counts as "neighbour." Christian ethics would affirm the equal worth of all lives, making programming a preference deeply problematic. The Catholic principle of double effect might apply differently depending on the scenario. Some Christian thinkers argue that the car has a special duty of care to its passengers (analogous to a ship captain\'s duty). Others note that choosing to endanger innocent bystanders violates the commandment to love one\'s neighbour.'
      },
      Islam:{
        teaching:'"No soul shall bear the burden of another." (Quran 6:164)',
        analysis:'Islamic ethics must grapple with the concept of amanah (trust) -- the passengers trusted the car with their safety. However, the pedestrian is also entitled to protection of life. In Islamic jurisprudence, the concept of maslaha (public interest) and preventing harm (dar al-mafasid) are relevant. Most scholars would argue that the car should try to minimise overall harm while recognising that no human or machine has the right to pre-determine who lives and who dies -- this is ultimately in Allah\'s hands (qadr).'
      },
      Buddhism:{
        teaching:'"In whom there is no sympathy for living beings: know him as an outcast." (Sutta Nipata 1.7)',
        analysis:'Buddhism would find the very premise of this dilemma troubling, as it requires valuing some lives over others. Buddhist ethics would focus on the intention behind the programming and the systemic conditions that created the situation. The concept of interdependence (pratityasamutpada) reminds us that the programmer, passengers, pedestrian, and society are all connected. A Buddhist approach might focus on minimising total suffering while questioning whether such absolute choices are truly necessary.'
      },
      Hinduism:{
        teaching:'"For one who has conquered the mind, the mind is the best of friends; but for one who has failed to do so, his mind will remain the greatest enemy." (Bhagavad Gita 6:6)',
        analysis:'Hindu ethics would consider the dharma (duty) of the car/programmer. The concept of svadharma (one\'s own duty) suggests the programmer has a responsibility to all people affected. The Bhagavad Gita\'s teaching about performing one\'s duty without attachment to outcomes is relevant but difficult to apply when programming specific outcomes. Hindu thought might question whether reducing life-and-death decisions to algorithms respects the divine nature (atman) present in all beings.'
      },
      Judaism:{
        teaching:'"You shall not murder." (Exodus 20:13) / "Whose blood is redder? Perhaps his blood is redder." (Talmud, Sanhedrin 74a)',
        analysis:'Jewish law struggles with this dilemma because the Talmudic principle of "whose blood is redder?" means we cannot value one life over another. The principle that one may not sacrifice one life for another (ein dochin nefesh mipnei nefesh) applies. However, some modern rabbinical authorities distinguish between active killing and programming a machine. The rodef (pursuer) principle might be relevant if the pedestrian stepped into the road, but this is highly debatable. Jewish ethics would likely resist any predetermined algorithm for choosing who lives.'
      },
      Sikhism:{
        teaching:'"See the brotherhood of all mankind as the highest order of Yogis." (Guru Gobind Singh)',
        analysis:'Sikhism\'s emphasis on the equality and divine nature of all people makes this dilemma particularly challenging. Every life carries the light of Waheguru. The Sikh concept of hukam (divine will) suggests that life and death are ultimately in God\'s hands, making human (or algorithmic) pre-determination problematic. Sikh ethics would likely focus on systemic solutions -- making cars safer for everyone rather than programming whom to sacrifice. The emphasis on community welfare (sarbat da bhala) would seek to protect all.'
      }
    }
  },
  {
    id:'pollution',
    title:'Jobs vs. Environment',
    short:'A company can save 1,000 jobs by polluting a river that a small village of 200 people depends on.',
    scenario:'You are the CEO of a large manufacturing company in a struggling region. The company employs 1,000 workers and is the main employer in the area. To remain competitive and avoid closure, you need to adopt a cheaper production process that will discharge waste chemicals into a nearby river. A small village of 200 people downstream depends on this river for their drinking water and fishing livelihood. They will have to relocate at significant cost and disruption. If you don\'t adopt the new process, the factory closes and 1,000 people lose their jobs in an area with no other employment.',
    prompt:'Do you adopt the polluting process or close the factory?',
    optA:'Close the factory (protect the village and river)',
    optB:'Adopt the polluting process (save the 1,000 jobs)',
    stakeholders:['The 1,000 workers and their families','The 200 villagers','The river ecosystem and wildlife','Future generations','The local economy','Your shareholders','The broader community'],
    virtues:['Justice','Responsibility','Compassion','Prudence','Courage'],
    kantChecks:{
      A:['Could "close a business rather than pollute" be a universal law?','Does closing protect the villagers\' right to clean water and livelihood?','Is there a duty to protect the environment even at economic cost?','Are you treating the villagers as ends, not means?'],
      B:['Could "pollute to save jobs" be a universal law?','Are you treating the villagers merely as acceptable collateral damage?','Would you accept being one of the displaced villagers?','Does the greater number of workers override the villagers\' rights?']
    },
    religious:{
      Christianity:{
        teaching:'"The earth is the Lord\'s, and everything in it." (Psalm 24:1) / "Love your neighbour as yourself." (Matthew 22:39)',
        analysis:'Christianity teaches stewardship of God\'s creation. Deliberately polluting a river violates this responsibility. Pope Francis\' encyclical Laudato Si\' specifically addresses environmental destruction that disproportionately affects the poor. However, Christianity also emphasises the dignity of work and providing for one\'s family. A Christian approach might seek creative alternatives: could the company invest in cleaner technology? Could the community find transitional solutions? The preferential option for the poor (a key Catholic social teaching) would protect the vulnerable villagers.'
      },
      Islam:{
        teaching:'"Do not cause corruption on the earth after it has been set in order." (Quran 7:56)',
        analysis:'Islam teaches that humans are khalifah (stewards/trustees) of the earth. Deliberately polluting a water source violates this sacred trust. Water has special significance in Islam -- it is considered a gift from Allah. The principle of la darar (no harm) prohibits causing damage to others. However, the welfare of the community (maslaha) and the right to work are also important. Islamic economics encourages seeking solutions that balance economic needs with environmental protection (mizan -- balance).'
      },
      Buddhism:{
        teaching:'"As a bee gathering nectar does not harm or disturb the colour and fragrance of the flower; so do the wise move through the world." (Dhammapada 49)',
        analysis:'Buddhism\'s principle of non-harm (ahimsa) extends to all living beings, including the river ecosystem. The concept of interdependence (pratityasamutpada) teaches that harming the environment ultimately harms everyone. Right livelihood, part of the Eightfold Path, prohibits work that causes harm. A Buddhist approach would question the false binary: is pollution really the only option? Could mindful innovation find a Middle Way? The focus would be on reducing suffering for all beings, present and future.'
      },
      Hinduism:{
        teaching:'"This earth is the mother of all beings, and all beings have an equal right to her resources." (Atharva Veda 12.1)',
        analysis:'Hindu teachings revere rivers as sacred (the Ganges is worshipped as a goddess). Polluting a river would be considered a grave sin (papa). The concept of dharma includes ecological responsibility. However, the dharma of a ruler/leader also includes ensuring the welfare of their people. Modern Hindu environmentalism draws on concepts like vasudhaiva kutumbakam (the world is one family) to argue for solutions that protect both jobs and the environment. Simply choosing pollution would violate the principle of ahimsa.'
      },
      Judaism:{
        teaching:'"When God created Adam, He took him around the Garden of Eden and said: Look at My works! See how beautiful they are! Take care not to spoil or destroy My world." (Ecclesiastes Rabbah 7:13)',
        analysis:'Jewish law includes the principle of bal tashchit (do not destroy), which prohibits needless environmental destruction. The Torah specifically prohibits polluting water sources. However, piku\'ach nefesh (saving life) is a paramount value, and the livelihoods of 1,000 families are at stake. Jewish ethics would likely seek a creative solution through communal responsibility. The concept of tikkun olam (repairing the world) suggests working towards a solution that heals rather than harms.'
      },
      Sikhism:{
        teaching:'"Creating the world, God has made it a place to practise spirituality." (Guru Granth Sahib, Ang 1035)',
        analysis:'Sikhism teaches that the natural world is a divine creation deserving of respect and care. Air, water, and earth are considered the three teachers given by God. Polluting a river would be disrespecting God\'s creation. However, Sikh ethics also strongly emphasise community welfare (sarbat da bhala -- the well-being of all). The Sikh approach would likely seek a solution that protects both the workers and the villagers, perhaps through community action, innovation, or shared sacrifice. Simply accepting the pollution would violate the principle of living in harmony with nature.'
      }
    }
  }
];

// ===== STATE =====
let currentDilemma = null;
let gutChoice = null;
let finalSpectra = {};
let virtueScores = {A:{},B:{}};

// ===== INIT =====
function init(){
  const grid = document.getElementById('dilemma-grid');
  dilemmas.forEach((d,i) => {
    const card = document.createElement('div');
    card.className = 'dilemma-card';
    card.innerHTML = `<span class="card-num">${i+1} / ${dilemmas.length}</span><h3>${d.title}</h3><p>${d.short}</p>`;
    card.onclick = () => loadDilemma(d);
    grid.appendChild(card);
  });
}

function goBack(){
  document.getElementById('dilemma-selection').style.display = 'block';
  document.getElementById('dilemma-workspace').style.display = 'none';
  currentDilemma = null; gutChoice = null; finalSpectra = {}; virtueScores = {A:{},B:{}};
}

function loadDilemma(d){
  currentDilemma = d; gutChoice = null; finalSpectra = {}; virtueScores = {A:{},B:{}};
  document.getElementById('dilemma-selection').style.display = 'none';
  document.getElementById('dilemma-workspace').style.display = 'block';
  document.getElementById('ws-title').textContent = d.title;
  document.getElementById('ws-scenario').textContent = d.scenario;
  document.getElementById('ws-prompt').textContent = d.prompt;
  document.getElementById('gut-opt-a-text').textContent = d.optA;
  document.getElementById('gut-opt-b-text').textContent = d.optB;

  // Reset
  document.querySelectorAll('.gut-btn').forEach(b=>b.classList.remove('selected'));
  document.getElementById('lenses-section').style.display = 'none';
  document.getElementById('reflection-section').style.display = 'none';
  document.getElementById('change-viz').style.display = 'none';
  document.getElementById('util-result').style.display = 'none';
  document.getElementById('radar-container').style.display = 'none';
  document.getElementById('radar-legend').style.display = 'none';
  switchTab('util');

  buildUtilPanel(d);
  buildKantPanel(d);
  buildVirtuePanel(d);
  buildReligionPanel(d);
  buildSpectrumArea(d);

  window.scrollTo({top:0,behavior:'smooth'});
}

// ===== GUT REACTION =====
function selectGut(choice){
  gutChoice = choice;
  document.querySelectorAll('.gut-btn').forEach(b=>b.classList.remove('selected'));
  document.querySelector(`.gut-btn.opt-${choice.toLowerCase()}`).classList.add('selected');
  document.getElementById('lenses-section').style.display = 'block';
  document.getElementById('reflection-section').style.display = 'block';
  setTimeout(()=>{
    document.getElementById('lenses-section').scrollIntoView({behavior:'smooth',block:'start'});
  },200);
}

// ===== TABS =====
function switchTab(id){
  document.querySelectorAll('.lens-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.lens-panel').forEach(p=>p.classList.remove('active'));
  document.querySelector(`.lens-tab[onclick="switchTab('${id}')"]`).classList.add('active');
  document.getElementById('panel-'+id).classList.add('active');
}

// ===== UTILITARIANISM =====
function buildUtilPanel(d){
  const container = document.getElementById('util-stakeholders');
  container.innerHTML = '';
  d.stakeholders.forEach((s,i) => {
    const row = document.createElement('div');
    row.className = 'stakeholder-row';
    row.innerHTML = `
      <div class="stakeholder-name">${s}</div>
      <div class="stakeholder-inputs">
        <label style="color:var(--optA);">Option A:</label>
        <input type="number" class="num-input util-a" data-idx="${i}" min="-10" max="10" value="0">
        <label style="color:var(--optB);margin-left:12px;">Option B:</label>
        <input type="number" class="num-input util-b" data-idx="${i}" min="-10" max="10" value="0">
      </div>`;
    container.appendChild(row);
  });
  document.getElementById('util-result').style.display = 'none';
}

function calculateUtil(){
  let scoreA=0, scoreB=0;
  document.querySelectorAll('.util-a').forEach(inp=>{ scoreA += parseInt(inp.value)||0; });
  document.querySelectorAll('.util-b').forEach(inp=>{ scoreB += parseInt(inp.value)||0; });
  const elA = document.getElementById('util-score-a');
  const elB = document.getElementById('util-score-b');
  elA.textContent = (scoreA>=0?'+':'')+scoreA;
  elB.textContent = (scoreB>=0?'+':'')+scoreB;
  elA.className = 'score '+(scoreA>=0?'positive':'negative');
  elB.className = 'score '+(scoreB>=0?'positive':'negative');
  const verdict = document.getElementById('util-verdict');
  if(scoreA > scoreB) verdict.innerHTML = '<span style="color:var(--optA);">Option A</span> produces more overall happiness according to your calculation.';
  else if(scoreB > scoreA) verdict.innerHTML = '<span style="color:var(--optB);">Option B</span> produces more overall happiness according to your calculation.';
  else verdict.innerHTML = 'Both options produce <span style="color:var(--gold-soft);">equal happiness</span> according to your calculation.';
  document.getElementById('util-result').style.display = 'block';
}

// ===== KANTIAN =====
function buildKantPanel(d){
  const area = document.getElementById('kant-options-area');
  area.innerHTML = '';
  ['A','B'].forEach(opt => {
    const color = opt==='A'?'var(--optA)':'var(--optB)';
    let html = `<h4 style="color:${color};margin:20px 0 8px;">Testing Option ${opt}: ${opt==='A'?d.optA:d.optB}</h4>`;
    html += `<ul class="kant-checklist">`;
    d.kantChecks[opt].forEach((check,i) => {
      const uid = `kant-${opt}-${i}`;
      html += `<li>
        <label>
          <input type="checkbox" class="kant-check" id="${uid}" data-opt="${opt}">
          <span>
            <span class="principle-name">${['Universalisability Test','Humanity Formula','Consistency Check','Duty Assessment'][i]}</span>
            <span class="principle-desc">${check}</span>
          </span>
        </label>
      </li>`;
    });
    html += `</ul>`;
    area.innerHTML += html;
  });
  area.innerHTML += `
    <div class="kant-result">
      <div style="color:var(--text-muted);font-size:.9rem;">Based on Kantian principles, which option better fulfils your moral duty?</div>
      <div class="kant-toggle">
        <button onclick="selectKant('A',this)">Option A</button>
        <button onclick="selectKant('B',this)">Option B</button>
      </div>
    </div>`;
}

function selectKant(opt,btn){
  document.querySelectorAll('.kant-toggle button').forEach(b=>{b.classList.remove('sel-a','sel-b');});
  btn.classList.add(opt==='A'?'sel-a':'sel-b');
}

// ===== VIRTUE ETHICS =====
function buildVirtuePanel(d){
  const container = document.getElementById('virtue-sliders');
  container.innerHTML = '';
  d.virtues.forEach(v => {
    virtueScores.A[v] = 5;
    virtueScores.B[v] = 5;
    const row = document.createElement('div');
    row.className = 'virtue-row';
    row.innerHTML = `
      <div class="virtue-label">${v}</div>
      <input type="range" class="range-a" min="1" max="10" value="5" oninput="updateVirtue('A','${v}',this.value);this.nextElementSibling.textContent=this.value">
      <div class="virtue-opt-label a-label">5</div>
      <input type="range" class="range-b" min="1" max="10" value="5" oninput="updateVirtue('B','${v}',this.value);this.nextElementSibling.textContent=this.value">
      <div class="virtue-opt-label b-label">5</div>`;
    container.appendChild(row);
  });
  document.getElementById('radar-container').style.display = 'none';
  document.getElementById('radar-legend').style.display = 'none';
}

function updateVirtue(opt,virtue,val){
  virtueScores[opt][virtue] = parseInt(val);
}

function drawRadar(){
  const canvas = document.getElementById('radar-canvas');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  const cx = W/2, cy = H/2, R = Math.min(W,H)/2 - 50;
  const virtues = currentDilemma.virtues;
  const n = virtues.length;

  ctx.clearRect(0,0,W,H);

  // Background rings
  for(let ring=1;ring<=5;ring++){
    const r = R * ring/5;
    ctx.beginPath();
    for(let i=0;i<n;i++){
      const angle = (Math.PI*2*i/n) - Math.PI/2;
      const x = cx + r*Math.cos(angle);
      const y = cy + r*Math.sin(angle);
      i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
    }
    ctx.closePath();
    ctx.strokeStyle = 'rgba(90,69,128,'+(0.15+ring*0.05)+')';
    ctx.lineWidth = 1;
    ctx.stroke();
  }

  // Axes & labels
  for(let i=0;i<n;i++){
    const angle = (Math.PI*2*i/n) - Math.PI/2;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.lineTo(cx + R*Math.cos(angle), cy + R*Math.sin(angle));
    ctx.strokeStyle = 'rgba(90,69,128,0.3)';
    ctx.stroke();
    // Label
    const lx = cx + (R+25)*Math.cos(angle);
    const ly = cy + (R+25)*Math.sin(angle);
    ctx.fillStyle = '#d4a853';
    ctx.font = '13px Segoe UI, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(virtues[i], lx, ly);
  }

  // Draw data
  function drawShape(scores,color,fillColor){
    ctx.beginPath();
    virtues.forEach((v,i) => {
      const val = scores[v]/10;
      const angle = (Math.PI*2*i/n) - Math.PI/2;
      const x = cx + R*val*Math.cos(angle);
      const y = cy + R*val*Math.sin(angle);
      i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
    });
    ctx.closePath();
    ctx.fillStyle = fillColor;
    ctx.fill();
    ctx.strokeStyle = color;
    ctx.lineWidth = 2.5;
    ctx.stroke();
    // Dots
    virtues.forEach((v,i) => {
      const val = scores[v]/10;
      const angle = (Math.PI*2*i/n) - Math.PI/2;
      const x = cx + R*val*Math.cos(angle);
      const y = cy + R*val*Math.sin(angle);
      ctx.beginPath();
      ctx.arc(x,y,4,0,Math.PI*2);
      ctx.fillStyle = color;
      ctx.fill();
    });
  }

  drawShape(virtueScores.A,'#2ec4b6','rgba(46,196,182,0.15)');
  drawShape(virtueScores.B,'#e07b54','rgba(224,123,84,0.15)');

  document.getElementById('radar-container').style.display = 'flex';
  document.getElementById('radar-legend').style.display = 'flex';
}

// ===== RELIGIOUS ETHICS =====
const religions = ['Christianity','Islam','Buddhism','Hinduism','Judaism','Sikhism'];

function buildReligionPanel(d){
  const selector = document.getElementById('religion-selector');
  selector.innerHTML = '';
  religions.forEach(r => {
    const btn = document.createElement('button');
    btn.className = 'religion-btn';
    btn.textContent = r;
    btn.onclick = () => showReligion(r,btn);
    selector.appendChild(btn);
  });
  document.getElementById('religion-content').innerHTML = '<p style="color:var(--text-dim);font-style:italic;">Select a religious tradition above to explore its perspective.</p>';
}

function showReligion(r,btn){
  document.querySelectorAll('.religion-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const data = currentDilemma.religious[r];
  document.getElementById('religion-content').innerHTML = `
    <h4>${r}</h4>
    <div class="teaching">${data.teaching}</div>
    <div class="analysis">${data.analysis}</div>`;
}

// ===== SPECTRUM / REFLECTION =====
function buildSpectrumArea(d){
  const area = document.getElementById('spectrum-area');
  area.innerHTML = '';
  const lenses = ['Utilitarian','Kantian','Virtue Ethics','Religious Ethics'];
  lenses.forEach(lens => {
    finalSpectra[lens] = 50;
    const row = document.createElement('div');
    row.className = 'spectrum-row';
    row.innerHTML = `
      <div class="spectrum-label">${lens}</div>
      <div class="spectrum-track">
        <div class="spectrum-endpoints">
          <span class="ep-a">Strongly Option A</span>
          <span class="ep-b">Strongly Option B</span>
        </div>
        <input type="range" class="spectrum-slider" min="0" max="100" value="50"
          oninput="finalSpectra['${lens}']=parseInt(this.value)">
      </div>`;
    area.appendChild(row);
  });
}

function submitReflection(){
  const response = document.getElementById('final-response').value.trim();
  if(!response){
    alert('Please write your justified response before submitting.');
    return;
  }

  // Determine final leaning
  let avgSpectrum = 0;
  const keys = Object.keys(finalSpectra);
  keys.forEach(k => avgSpectrum += finalSpectra[k]);
  avgSpectrum /= keys.length;
  const finalChoice = avgSpectrum < 45 ? 'A' : avgSpectrum > 55 ? 'B' : 'Balanced';

  // Show change viz
  document.getElementById('change-viz').style.display = 'block';
  const gutText = gutChoice === 'A' ? currentDilemma.optA : currentDilemma.optB;
  let finalText;
  if(finalChoice === 'A') finalText = currentDilemma.optA;
  else if(finalChoice === 'B') finalText = currentDilemma.optB;
  else finalText = 'Balanced / Undecided';

  document.getElementById('viz-gut').textContent = 'Option ' + gutChoice + ': ' + gutText;
  document.getElementById('viz-gut').parentElement.style.borderColor = gutChoice==='A'?'var(--optA)':'var(--optB)';

  if(finalChoice === 'Balanced'){
    document.getElementById('viz-final').textContent = 'Balanced position';
    document.getElementById('viz-final').parentElement.style.borderColor = 'var(--gold-soft)';
  } else {
    document.getElementById('viz-final').textContent = 'Option ' + finalChoice + ': ' + finalText;
    document.getElementById('viz-final').parentElement.style.borderColor = finalChoice==='A'?'var(--optA)':'var(--optB)';
  }

  const changed = (gutChoice !== finalChoice && finalChoice !== 'Balanced');
  const msg = document.getElementById('viz-msg');
  if(changed){
    msg.textContent = 'Your view shifted after ethical analysis! This shows the value of examining dilemmas through multiple philosophical lenses.';
    document.getElementById('viz-arrow').textContent = '\u27A1';
    document.getElementById('viz-arrow').style.color = 'var(--optB)';
  } else if(finalChoice === 'Balanced'){
    msg.textContent = 'After analysis, you find yourself balanced between both options. This reflects the genuine complexity of ethical dilemmas.';
    document.getElementById('viz-arrow').textContent = '\u2194';
    document.getElementById('viz-arrow').style.color = 'var(--gold-soft)';
  } else {
    msg.textContent = 'Your considered view aligns with your gut reaction. However, you can now justify it with philosophical reasoning!';
    document.getElementById('viz-arrow').textContent = '\u2713';
    document.getElementById('viz-arrow').style.color = 'var(--optA)';
  }

  // Save class vote
  saveVote(currentDilemma.id, gutChoice, finalChoice, avgSpectrum);
  displayClassVotes();

  setTimeout(()=>{
    document.getElementById('change-viz').scrollIntoView({behavior:'smooth',block:'start'});
  },200);
}

// ===== CLASS VOTE =====
function getVotesKey(){
  return 'ethics_votes_' + currentDilemma.id;
}

function saveVote(dilemmaId, gut, final, spectrum){
  const key = 'ethics_votes_' + dilemmaId;
  let votes = JSON.parse(localStorage.getItem(key) || '[]');
  votes.push({
    gut: gut,
    final: final,
    spectrum: spectrum,
    timestamp: Date.now()
  });
  localStorage.setItem(key, JSON.stringify(votes));
}

function displayClassVotes(){
  const key = getVotesKey();
  const votes = JSON.parse(localStorage.getItem(key) || '[]');
  const container = document.getElementById('class-vote-bars');
  container.innerHTML = '';

  if(votes.length === 0){
    container.innerHTML = '<p style="text-align:center;color:var(--text-dim);">No votes yet.</p>';
    document.getElementById('vote-total').textContent = '';
    return;
  }

  // Gut votes
  let gutA = votes.filter(v=>v.gut==='A').length;
  let gutB = votes.filter(v=>v.gut==='B').length;
  let gutTotal = gutA+gutB;
  let gutAp = gutTotal?Math.round(gutA/gutTotal*100):50;
  let gutBp = 100-gutAp;

  // Final votes
  let finA = votes.filter(v=>v.final==='A').length;
  let finB = votes.filter(v=>v.final==='B').length;
  let finBal = votes.filter(v=>v.final==='Balanced').length;
  let finTotal = votes.length;
  let finAp = finTotal?Math.round(finA/finTotal*100):0;
  let finBp = finTotal?Math.round(finB/finTotal*100):0;
  let finBalp = 100-finAp-finBp;

  container.innerHTML = `
    <div class="vote-bar-container">
      <div class="vote-bar-label">
        <span style="color:var(--optA)">Option A: ${gutA} (${gutAp}%)</span>
        <span style="font-weight:600;color:var(--text-muted)">Gut Reactions</span>
        <span style="color:var(--optB)">Option B: ${gutB} (${gutBp}%)</span>
      </div>
      <div class="vote-bar">
        <div class="bar-a" style="width:${gutAp}%">${gutAp>10?gutAp+'%':''}</div>
        <div class="bar-b" style="width:${gutBp}%">${gutBp>10?gutBp+'%':''}</div>
      </div>
    </div>
    <div class="vote-bar-container" style="margin-top:16px;">
      <div class="vote-bar-label">
        <span style="color:var(--optA)">Option A: ${finA} (${finAp}%)</span>
        <span style="font-weight:600;color:var(--text-muted)">Final Positions</span>
        <span style="color:var(--optB)">Option B: ${finB} (${finBp}%)</span>
      </div>
      <div class="vote-bar">
        <div class="bar-a" style="width:${finAp}%">${finAp>10?finAp+'%':''}</div>
        <div class="bar-b" style="width:${finBp}%">${finBp>10?finBp+'%':''}</div>
      </div>
    </div>
    ${finBal > 0 ? `<div style="text-align:center;margin-top:8px;color:var(--gold-soft);font-size:.9rem;">${finBal} student${finBal>1?'s':''} (${finBalp}%) ended with a balanced position</div>` : ''}
  `;

  // Changed minds
  let changed = votes.filter(v => v.gut !== v.final && v.final !== 'Balanced').length;
  let changedPct = Math.round(changed/finTotal*100);
  document.getElementById('vote-total').innerHTML = `
    Total responses: <strong>${finTotal}</strong> &nbsp;|&nbsp;
    Changed their mind: <strong>${changed} (${changedPct}%)</strong>`;
}

function clearVotes(){
  if(!currentDilemma) return;
  if(confirm('Clear all class votes for this dilemma?')){
    localStorage.removeItem(getVotesKey());
    displayClassVotes();
  }
}

// ===== START =====
init();
</script>

</body>
</html>
