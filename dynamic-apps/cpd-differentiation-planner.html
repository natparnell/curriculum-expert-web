<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Differentiation Planner</title>
<style>
:root {
  --bg: #ffffff;
  --bg-subtle: #f8f9fa;
  --bg-panel: #f1f3f5;
  --border: #dee2e6;
  --border-light: #e9ecef;
  --text: #212529;
  --text-muted: #6c757d;
  --text-light: #adb5bd;
  --higher: #2b8a3e;
  --higher-bg: #ebfbee;
  --higher-border: #b2f2bb;
  --middle: #e67700;
  --middle-bg: #fff9db;
  --middle-border: #ffe066;
  --lower: #1971c2;
  --lower-bg: #e7f5ff;
  --lower-border: #a5d8ff;
  --eal: #9c36b5;
  --eal-bg: #f8f0fc;
  --eal-border: #e599f7;
  --accent: #1971c2;
  --accent-hover: #1864ab;
  --success: #2b8a3e;
  --header-bg: #1e293b;
  --header-text: #f1f5f9;
  --radius: 6px;
  --shadow: 0 1px 3px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: var(--bg-subtle);
  color: var(--text);
  line-height: 1.5;
  min-height: 100vh;
}
header {
  position: sticky; top: 0; z-index: 100;
  background: var(--header-bg);
  color: var(--header-text);
  padding: 14px 24px;
  box-shadow: var(--shadow-md);
}
header h1 { font-size: 1.35rem; font-weight: 700; letter-spacing: -0.02em; }
header p { font-size: 0.82rem; opacity: 0.75; margin-top: 2px; }
.container { max-width: 1360px; margin: 0 auto; padding: 20px; }
.controls {
  display: flex; flex-wrap: wrap; gap: 12px; align-items: end;
  background: var(--bg); border: 1px solid var(--border-light);
  border-radius: var(--radius); padding: 16px; margin-bottom: 20px;
  box-shadow: var(--shadow);
}
.control-group { display: flex; flex-direction: column; gap: 4px; }
.control-group label { font-size: 0.75rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.04em; }
.control-group select, .control-group input[type="text"] {
  padding: 8px 12px; border: 1px solid var(--border);
  border-radius: var(--radius); font-size: 0.88rem;
  background: var(--bg); color: var(--text); min-width: 200px;
}
.control-group select:focus, .control-group input:focus {
  outline: none; border-color: var(--accent); box-shadow: 0 0 0 2px rgba(25,113,194,0.15);
}
.objective-group { flex: 1; min-width: 280px; }
.objective-group input { width: 100%; }
.btn-row { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin-left: auto; }
button {
  padding: 8px 16px; border: none; border-radius: var(--radius);
  font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.15s;
}
.btn-primary { background: var(--accent); color: #fff; }
.btn-primary:hover { background: var(--accent-hover); }
.btn-success { background: var(--success); color: #fff; }
.btn-success:hover { background: #237032; }
.btn-outline { background: var(--bg); color: var(--text); border: 1px solid var(--border); }
.btn-outline:hover { background: var(--bg-panel); }
.btn-sm { padding: 5px 10px; font-size: 0.78rem; }

/* Matrix grid */
.matrix-wrap {
  overflow-x: auto; background: var(--bg);
  border: 1px solid var(--border-light);
  border-radius: var(--radius); box-shadow: var(--shadow);
  margin-bottom: 24px;
}
.matrix { width: 100%; border-collapse: collapse; min-width: 780px; }
.matrix th, .matrix td { border: 1px solid var(--border-light); padding: 0; text-align: left; vertical-align: top; }
.matrix thead th {
  padding: 12px 14px; font-size: 0.82rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.03em;
  position: sticky; top: 0; z-index: 2;
}
.matrix thead th:first-child { background: var(--bg-panel); color: var(--text-muted); width: 130px; }
.col-higher { background: var(--higher-bg); color: var(--higher); border-bottom: 3px solid var(--higher) !important; }
.col-middle { background: var(--middle-bg); color: var(--middle); border-bottom: 3px solid var(--middle) !important; }
.col-lower { background: var(--lower-bg); color: var(--lower); border-bottom: 3px solid var(--lower) !important; }
.col-eal { background: var(--eal-bg); color: var(--eal); border-bottom: 3px solid var(--eal) !important; }
.matrix tbody th {
  padding: 10px 12px; font-size: 0.82rem; font-weight: 600;
  background: var(--bg-panel); color: var(--text); vertical-align: middle;
  position: sticky; left: 0; z-index: 1;
}
.matrix-cell { position: relative; min-height: 80px; padding: 8px; }
.cell-content {
  min-height: 40px; padding: 6px 8px; border-radius: 4px;
  font-size: 0.84rem; line-height: 1.45; cursor: text;
  border: 1px dashed transparent; transition: border-color 0.15s;
  white-space: pre-wrap; word-break: break-word;
}
.cell-content:hover { border-color: var(--border); }
.cell-content:focus {
  outline: none; border-color: var(--accent);
  border-style: solid; background: rgba(25,113,194,0.03);
}
.cell-content:empty::before {
  content: "Click to type or use suggestions...";
  color: var(--text-light); font-style: italic; font-size: 0.8rem;
}
.suggestion-toggle {
  display: inline-block; margin-top: 4px; font-size: 0.72rem;
  color: var(--accent); cursor: pointer; font-weight: 500;
}
.suggestion-toggle:hover { text-decoration: underline; }
.suggestions {
  display: none; margin-top: 6px; padding: 6px;
  background: var(--bg-subtle); border-radius: 4px;
  border: 1px solid var(--border-light);
}
.suggestions.open { display: block; }
.suggestion-chip {
  display: inline-block; padding: 3px 8px; margin: 2px;
  background: var(--bg); border: 1px solid var(--border);
  border-radius: 12px; font-size: 0.73rem; cursor: pointer;
  transition: all 0.15s; color: var(--text);
}
.suggestion-chip:hover { background: var(--accent); color: #fff; border-color: var(--accent); }

/* Panels below grid */
.panels { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
.panel {
  background: var(--bg); border: 1px solid var(--border-light);
  border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow);
}
.panel h2 { font-size: 1rem; font-weight: 700; margin-bottom: 12px; color: var(--text); }
.panel h3 { font-size: 0.88rem; font-weight: 600; margin: 12px 0 6px; color: var(--text); }
.panel p, .panel li { font-size: 0.84rem; color: var(--text-muted); line-height: 1.55; }
.panel ul { padding-left: 18px; }
.panel li { margin-bottom: 4px; }

/* Scaffold ladder */
.scaffold-ladder { display: flex; flex-direction: column; gap: 0; }
.scaffold-rung {
  display: flex; align-items: stretch; border: 1px solid var(--border-light);
  border-bottom: none; overflow: hidden;
}
.scaffold-rung:first-child { border-radius: var(--radius) var(--radius) 0 0; }
.scaffold-rung:last-child { border-bottom: 1px solid var(--border-light); border-radius: 0 0 var(--radius) var(--radius); }
.scaffold-level {
  width: 140px; min-width: 140px; padding: 10px 12px;
  font-size: 0.78rem; font-weight: 700; display: flex;
  align-items: center; justify-content: center; text-align: center;
}
.scaffold-desc { flex: 1; padding: 10px 14px; font-size: 0.82rem; color: var(--text-muted); background: var(--bg); }
.level-full { background: var(--lower-bg); color: var(--lower); }
.level-heavy { background: #dbe4ff; color: #364fc7; }
.level-moderate { background: var(--middle-bg); color: var(--middle); }
.level-light { background: #d3f9d8; color: #2b8a3e; }
.level-independent { background: var(--higher-bg); color: var(--higher); }

/* Info toggles */
.info-section { margin-bottom: 10px; }
.info-toggle {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 0; cursor: pointer; font-size: 0.86rem; font-weight: 600;
  border-bottom: 1px solid var(--border-light); user-select: none;
}
.info-toggle .arrow { transition: transform 0.2s; font-size: 0.7rem; color: var(--text-muted); }
.info-toggle.active .arrow { transform: rotate(90deg); }
.info-body { display: none; padding: 8px 0; }
.info-body.open { display: block; }

/* Toast notification */
.toast {
  position: fixed; bottom: 24px; right: 24px; background: var(--header-bg);
  color: #fff; padding: 10px 20px; border-radius: var(--radius);
  font-size: 0.85rem; box-shadow: var(--shadow-md);
  opacity: 0; transform: translateY(10px);
  transition: all 0.25s; z-index: 200; pointer-events: none;
}
.toast.show { opacity: 1; transform: translateY(0); }

@media (max-width: 900px) {
  .panels { grid-template-columns: 1fr; }
  .controls { flex-direction: column; align-items: stretch; }
  .btn-row { margin-left: 0; }
  .control-group select, .control-group input[type="text"] { min-width: 0; width: 100%; }
}
@media print {
  header { position: static; }
  .controls, .suggestion-toggle, .suggestions, .btn-row, .panels { break-inside: avoid; }
  .suggestion-toggle, .suggestions { display: none !important; }
  .matrix-wrap { overflow: visible; }
  .matrix { min-width: 0; }
  body { background: #fff; }
}
</style>
</head>
<body>

<header>
  <h1>Differentiation Planner</h1>
  <p>Plan differentiation strategies across ability groups using a research-informed matrix grid</p>
</header>

<div class="container">
  <div class="controls">
    <div class="control-group">
      <label>Subject</label>
      <select id="subjectSelect">
        <option value="general">General</option>
        <option value="english">English</option>
        <option value="maths">Maths</option>
        <option value="science">Science</option>
        <option value="history">History</option>
        <option value="geography">Geography</option>
        <option value="mfl">Modern Foreign Languages</option>
        <option value="art">Art and Design</option>
        <option value="pe">Physical Education</option>
        <option value="computing">Computing</option>
        <option value="re">Religious Education</option>
        <option value="dt">Design and Technology</option>
        <option value="music">Music</option>
      </select>
    </div>
    <div class="control-group objective-group">
      <label>Lesson Objective</label>
      <input type="text" id="objectiveInput" placeholder="e.g. Analyse how Shakespeare uses imagery to convey conflict">
    </div>
    <div class="btn-row">
      <button class="btn-success" onclick="populateAll()">Populate All</button>
      <button class="btn-outline" onclick="clearAll()">Clear All</button>
      <button class="btn-primary" onclick="copyPlan()">Copy Plan</button>
      <button class="btn-outline" onclick="window.print()">Print</button>
    </div>
  </div>

  <div class="matrix-wrap">
    <table class="matrix" id="matrixTable">
      <thead>
        <tr>
          <th></th>
          <th class="col-higher">Higher Ability</th>
          <th class="col-middle">Middle Ability</th>
          <th class="col-lower">Lower Ability / SEN</th>
          <th class="col-eal">EAL Learners</th>
        </tr>
      </thead>
      <tbody id="matrixBody"></tbody>
    </table>
  </div>

  <div class="panels">
    <div class="panel">
      <h2>Scaffolding Strategies</h2>
      <p style="margin-bottom:12px;">A graduated approach to support: from full scaffolding to independent learning. Adjust the level of support according to each learner's current position within their Zone of Proximal Development.</p>
      <div class="scaffold-ladder">
        <div class="scaffold-rung">
          <div class="scaffold-level level-independent">Independent</div>
          <div class="scaffold-desc">Learner works autonomously. Open-ended tasks, self-directed research, peer teaching roles. Minimal teacher input needed.</div>
        </div>
        <div class="scaffold-rung">
          <div class="scaffold-level level-light">Light Scaffold</div>
          <div class="scaffold-desc">Brief prompts or checklists provided. Learner self-monitors with success criteria. Teacher checks in periodically.</div>
        </div>
        <div class="scaffold-rung">
          <div class="scaffold-level level-moderate">Moderate Scaffold</div>
          <div class="scaffold-desc">Structured frameworks (e.g. writing frames, worked examples). Key vocabulary highlighted. Regular teacher check-ins.</div>
        </div>
        <div class="scaffold-rung">
          <div class="scaffold-level level-heavy">Heavy Scaffold</div>
          <div class="scaffold-desc">Partially completed models, sentence starters, word banks, visual supports. Guided practice with frequent feedback loops.</div>
        </div>
        <div class="scaffold-rung">
          <div class="scaffold-level level-full">Fully Guided</div>
          <div class="scaffold-desc">Direct instruction with modelling. Step-by-step task breakdowns. 1:1 or small-group support. Multi-sensory approaches.</div>
        </div>
      </div>
    </div>

    <div class="panel">
      <h2>Research and Guidance</h2>

      <div class="info-section">
        <div class="info-toggle" onclick="toggleInfo(this)">
          Types of Differentiation <span class="arrow">&#9654;</span>
        </div>
        <div class="info-body">
          <ul>
            <li><strong>By Task:</strong> Different activities targeting the same learning objective at varying levels of challenge.</li>
            <li><strong>By Outcome:</strong> Same task with different expectations for depth, detail, or sophistication of response.</li>
            <li><strong>By Support:</strong> Varying the level of scaffolding, adult support, or peer assistance available.</li>
            <li><strong>By Resource:</strong> Providing different texts, materials, or tools suited to learner needs.</li>
            <li><strong>By Pace:</strong> Allowing flexible timing so learners can consolidate or extend at their own speed.</li>
            <li><strong>By Questioning:</strong> Tailoring question complexity using Bloom's taxonomy to stretch or support thinking.</li>
            <li><strong>By Grouping:</strong> Strategic use of mixed-ability, similar-ability, or flexible groupings.</li>
          </ul>
        </div>
      </div>

      <div class="info-section">
        <div class="info-toggle" onclick="toggleInfo(this)">
          Vygotsky's Zone of Proximal Development <span class="arrow">&#9654;</span>
        </div>
        <div class="info-body">
          <p>Vygotsky proposed that learners develop most effectively when working within their ZPD: the gap between what they can do independently and what they can achieve with expert guidance. Effective differentiation positions tasks within each learner's ZPD, providing enough challenge to promote growth while ensuring sufficient support to prevent frustration. The goal is to gradually remove scaffolding (fading) as competence develops.</p>
        </div>
      </div>

      <div class="info-section">
        <div class="info-toggle" onclick="toggleInfo(this)">
          Adaptive Teaching (EEF Guidance) <span class="arrow">&#9654;</span>
        </div>
        <div class="info-body">
          <p>The Education Endowment Foundation recommends adaptive teaching as a core strategy. Key principles include:</p>
          <ul>
            <li>Use assessment to identify learning needs and adjust teaching in real time.</li>
            <li>Provide targeted support rather than permanent ability groupings.</li>
            <li>Maintain high expectations for all learners while flexing the route to success.</li>
            <li>Use flexible groupings that change according to the task and learning objective.</li>
            <li>Build metacognitive skills so learners can self-regulate and identify their own next steps.</li>
          </ul>
        </div>
      </div>

      <div class="info-section">
        <div class="info-toggle" onclick="toggleInfo(this)">
          Inclusive Practice <span class="arrow">&#9654;</span>
        </div>
        <div class="info-body">
          <p>Inclusive differentiation ensures every learner can access, engage with, and demonstrate understanding of the curriculum:</p>
          <ul>
            <li>Universal Design for Learning (UDL): offer multiple means of engagement, representation, and expression.</li>
            <li>Pre-teaching key vocabulary benefits SEN and EAL learners without stigma.</li>
            <li>Visual supports, dual-coding, and concrete-pictorial-abstract approaches support diverse learning profiles.</li>
            <li>Avoid ceiling effects: always provide routes for further challenge and depth.</li>
            <li>Celebrate diverse responses and encourage learner voice in demonstrating understanding.</li>
          </ul>
        </div>
      </div>

      <div class="info-section">
        <div class="info-toggle" onclick="toggleInfo(this)">
          Bloom's Taxonomy and Questioning <span class="arrow">&#9654;</span>
        </div>
        <div class="info-body">
          <p>Bloom's taxonomy provides a hierarchy of cognitive demand that supports differentiated questioning:</p>
          <ul>
            <li><strong>Remember:</strong> Recall facts and basic concepts (who, what, when, where). Useful as entry-level questions for lower-attaining pupils.</li>
            <li><strong>Understand:</strong> Explain ideas or concepts (describe, summarise, paraphrase). Builds confidence before moving to higher-order thinking.</li>
            <li><strong>Apply:</strong> Use information in new situations (how would you use...? what would happen if...?). Good for middle-attaining pupils.</li>
            <li><strong>Analyse:</strong> Draw connections among ideas (compare, contrast, examine). Stretches thinking by requiring breakdown of component parts.</li>
            <li><strong>Evaluate:</strong> Justify a position or decision (do you agree? to what extent?). Encourages critical thinking and reasoned judgement.</li>
            <li><strong>Create:</strong> Produce new or original work (design, construct, develop). Highest cognitive demand; ideal for extending higher-attaining pupils.</li>
          </ul>
          <p style="margin-top:8px;">Effective differentiation uses a mix of question levels, gradually increasing demand while ensuring all learners experience success.</p>
        </div>
      </div>

      <div class="info-section">
        <div class="info-toggle" onclick="toggleInfo(this)">
          Supporting EAL Learners <span class="arrow">&#9654;</span>
        </div>
        <div class="info-body">
          <p>English as an Additional Language learners benefit from strategies that maintain cognitive challenge while supporting language development:</p>
          <ul>
            <li>Pre-teach tier 2 (academic) and tier 3 (subject-specific) vocabulary before the lesson.</li>
            <li>Provide sentence stems and talk frames to scaffold academic language.</li>
            <li>Use visuals, realia, and gesture to support comprehension alongside verbal instruction.</li>
            <li>Allow processing time and opportunities to rehearse responses with a partner before whole-class sharing.</li>
            <li>Value and use the home language as a cognitive resource, not a barrier.</li>
            <li>Pair with a strong English-language model for collaborative tasks.</li>
          </ul>
        </div>
      </div>

      <div class="info-section">
        <div class="info-toggle" onclick="toggleInfo(this)">
          Metacognition and Self-Regulation <span class="arrow">&#9654;</span>
        </div>
        <div class="info-body">
          <p>The EEF identifies metacognition and self-regulation as high-impact, low-cost strategies. Differentiation should build pupils' capacity to monitor and direct their own learning:</p>
          <ul>
            <li>Teach pupils to plan, monitor, and evaluate their own learning strategies.</li>
            <li>Model your own thinking process aloud when demonstrating tasks.</li>
            <li>Provide self-assessment checklists matched to the success criteria.</li>
            <li>Encourage pupils to identify which scaffold or support they need, promoting agency.</li>
            <li>Use reflection prompts: "What strategy did you use? What would you do differently next time?"</li>
            <li>Gradually transfer responsibility from teacher to learner as competence grows.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const STRATEGIES = ['Task', 'Resource', 'Outcome', 'Support', 'Pace', 'Questioning', 'Grouping'];
const GROUPS = ['higher', 'middle', 'lower', 'eal'];

const SUGGESTIONS = {
  general: {
    Task: {
      higher: ['Open-ended extension task', 'Leadership role in group', 'Independent research project', 'Create assessment questions for peers'],
      middle: ['Core task with extension option', 'Structured challenge activity', 'Apply skill to new context', 'Problem-solving with guided steps'],
      lower: ['Scaffolded step-by-step task', 'Simplified version of core task', 'Concrete/practical activity', 'Pre-taught vocabulary task'],
      eal: ['Task with visual instructions', 'Bilingual glossary supported task', 'Picture-based activity option', 'Paired task with talk partner']
    },
    Resource: {
      higher: ['Advanced-level source texts', 'Wider reading beyond curriculum', 'Access to academic journals', 'Self-selected resource bank'],
      middle: ['Differentiated resource pack', 'Highlighted key information text', 'Worked example alongside task', 'Graphic organiser template'],
      lower: ['Simplified text with images', 'Word bank and key term cards', 'Audio/video alternative to text', 'Manipulatives and concrete resources'],
      eal: ['Dual-language dictionary', 'Visual glossary with images', 'First-language support materials', 'Captioned video resources']
    },
    Outcome: {
      higher: ['Extended analytical response', 'Evaluate and synthesise multiple sources', 'Create original work demonstrating mastery', 'Justify and critique alternative viewpoints'],
      middle: ['Explain with supporting evidence', 'Compare two perspectives', 'Apply knowledge to a scenario', 'Structured extended response'],
      lower: ['Complete structured framework', 'Demonstrate understanding with support', 'Match/sort/label key concepts', 'Verbal explanation with prompts'],
      eal: ['Annotated diagram or visual response', 'Key vocabulary used in sentences', 'Oral response with sentence stems', 'Graphic representation of learning']
    },
    Support: {
      higher: ['Minimal teacher intervention', 'Peer mentoring role', 'Self-assessment against criteria', 'Extension challenge cards'],
      middle: ['Periodic teacher check-ins', 'Success criteria checklist', 'Guided practice before independent work', 'Peer collaboration opportunities'],
      lower: ['Guided small group with TA/teacher', 'Pre-teaching of key concepts', '1:1 check-ins at key points', 'Multi-sensory approach to content'],
      eal: ['Bilingual support partner', 'Pre-teaching subject vocabulary', 'Visual sentence stems displayed', 'Additional processing time built in']
    },
    Pace: {
      higher: ['Fast-track core content, extend depth', 'Self-paced with enrichment tasks', 'Compact curriculum to allow exploration', 'Independent time management'],
      middle: ['Structured pace with checkpoints', 'Time targets for task sections', 'Consolidation before extension', 'Flexible timing for complex tasks'],
      lower: ['Extended time for core tasks', 'Chunked tasks with breaks', 'Revisit and consolidate regularly', 'Reduced quantity, maintained quality'],
      eal: ['Additional processing time', 'Pre-reading time before discussion', 'Rehearsal time for verbal responses', 'Flexible deadlines with support plan']
    },
    Questioning: {
      higher: ['Evaluate: To what extent do you agree?', 'Synthesise: How do these ideas connect?', 'Challenge assumptions in the material', 'Create: What would happen if...?'],
      middle: ['Analyse: Why does this happen?', 'Compare: What is similar/different?', 'Apply: How could you use this?', 'Explain: What does this tell us?'],
      lower: ['Recall: What is...? Who...? When...?', 'Describe: What can you see?', 'Identify: Which one shows...?', 'Closed then scaffolded to open'],
      eal: ['Visual prompt with question stem', 'Yes/no then Why? scaffolding', 'Vocabulary-rich question display', 'Dual-language question cards']
    },
    Grouping: {
      higher: ['Similar-ability for depth discussions', 'Cross-class enrichment group', 'Independent study pairs', 'Expert groups teaching others'],
      middle: ['Flexible mixed groups for collaboration', 'Paired work with shared role cards', 'Structured group discussion roles', 'Jigsaw groups for shared learning'],
      lower: ['Targeted small intervention group', 'Paired with supportive peer', 'Teacher-led focus group', 'Structured talk partner work'],
      eal: ['Paired with strong English model', 'Home-language discussion group', 'Mixed group with defined talk roles', 'Collaborative group with visual supports']
    }
  }
};

function getSubjectSuggestions(subject) {
  const subjectData = {
    english: {
      Task: {
        higher: ['Write in the style of the author', 'Comparative essay across texts', 'Create a critical review', 'Craft an alternative ending with analysis'],
        middle: ['Structured analytical paragraph (PEE)', 'Character comparison table', 'Annotate a passage with guided focus', 'Re-write scene from another perspective'],
        lower: ['Fill-in-the-blank character profile', 'Sequencing events with images', 'Vocabulary matching activity', 'Cloze passage with word bank'],
        eal: ['Bilingual vocabulary log for key terms', 'Pictorial storyboard of plot', 'Sentence-level translation and discussion', 'Drama/role-play to explore character']
      },
      Resource: {
        higher: ['Original unabridged text extracts', 'Critical essays and secondary sources', 'Contextual source documents', 'Wider reading suggestions list'],
        middle: ['Annotated text with margin prompts', 'Model paragraph to deconstruct', 'Key quotation bank', 'Writing frame with sentence starters'],
        lower: ['Simplified text/graphic novel version', 'Audio recording of text', 'Picture glossary of archaic terms', 'Colour-coded sentence structure guide'],
        eal: ['Dual-language text edition', 'Visual vocabulary flashcards', 'Translated key quotations', 'Audio with subtitles/transcript']
      }
    },
    maths: {
      Task: {
        higher: ['Multi-step problem with proof', 'Open-ended investigation task', 'Create and solve own problems', 'Real-world application challenge'],
        middle: ['Graduated difficulty problem set', 'Apply method to unfamiliar context', 'Error-spotting and correction task', 'Structured problem with extension'],
        lower: ['Step-by-step worked method to follow', 'Concrete manipulative-based task', 'Reduced-step version of core problem', 'Practice with visual number line/grid'],
        eal: ['Maths task with visual diagrams', 'Key operation vocabulary cards', 'Number-focused (reduced reading load)', 'Bilingual maths dictionary task']
      },
      Resource: {
        higher: ['UKMT challenge problems', 'Nrich investigation cards', 'Past paper extension questions', 'Cross-topic linking resources'],
        middle: ['Worked example beside practice', 'Formula reference sheet', 'Step-by-step method card', 'Graphical calculator access'],
        lower: ['Place value charts and grids', 'Multiplication square', 'Counters/base-ten blocks', 'Number line with key values marked'],
        eal: ['Visual step-by-step guide', 'Key vocabulary illustrated poster', 'Symbol-focused instruction sheet', 'Translated formula glossary']
      }
    },
    science: {
      Task: {
        higher: ['Design own investigation', 'Evaluate method and suggest improvements', 'Link to unfamiliar scientific context', 'Write a scientific paper abstract'],
        middle: ['Guided practical with analysis questions', 'Graph plotting and interpretation', 'Apply concept to real-world example', 'Complete a structured lab report'],
        lower: ['Follow step-by-step practical guide', 'Labelling and matching diagrams', 'Supported data recording table', 'True/false with corrections'],
        eal: ['Practical with visual method cards', 'Diagram-first approach with labels', 'Picture glossary of equipment', 'Sentence stems for conclusions']
      },
      Resource: {
        higher: ['Scientific journal extracts', 'Data sets for independent analysis', 'University-level extension reading', 'Exam board stretch questions'],
        middle: ['Revision guide excerpts', 'Pre-labelled diagram to annotate', 'Key equation reference card', 'Structured results table'],
        lower: ['Simplified diagram with labels', 'Video explanation of concept', 'Physical model or simulation', 'Word bank of scientific terms'],
        eal: ['Dual-language science glossary', 'Visual experiment guide', 'Labelled equipment photographs', 'Animated process videos']
      }
    },
    history: {
      Task: {
        higher: ['Evaluate interpretations and reach a judgement', 'Extended essay with historiography', 'Cross-period comparison analysis', 'Source provenance and reliability critique'],
        middle: ['Structured source analysis (NOP)', 'Causation ranking and justification', 'Timeline with explanatory annotations', 'Compare two historical interpretations'],
        lower: ['Sorting causes into categories', 'Matching events to dates', 'Guided source questions with stems', 'Fill-in chronological summary'],
        eal: ['Visual timeline with images', 'Key term cards with definitions', 'Paired discussion before writing', 'Simplified source with glossary']
      },
      Questioning: {
        higher: ['How far do you agree with this interpretation?', 'What are the limitations of this source?', 'Can you link this to a broader historical theme?', 'Why might historians disagree about this?'],
        middle: ['What caused this event?', 'How useful is this source for studying...?', 'What changed as a result of...?', 'Can you identify bias in this source?'],
        lower: ['What happened first?', 'Who was involved?', 'Can you match the event to its date?', 'What does this picture show about life in...?'],
        eal: ['Point to the evidence in the source', 'What can you see in this image?', 'Use the word bank to describe...', 'Tell your partner one fact about...']
      },
      Resource: {
        higher: ['Primary source document packs', 'Historiographical essay extracts', 'Statistical data for analysis', 'Archive material and photographs'],
        middle: ['Annotated source with guiding questions', 'Key vocabulary and context sheet', 'Structured timeline template', 'Model analytical paragraph'],
        lower: ['Simplified source with glossary', 'Picture-based evidence cards', 'Colour-coded cause and consequence cards', 'Audio narration of key events'],
        eal: ['Visual timeline with bilingual labels', 'Translated key terms sheet', 'Image-rich source material', 'Dual-language historical glossary']
      }
    },
    geography: {
      Task: {
        higher: ['Evaluate management strategies', 'Independent fieldwork analysis', 'Synoptic links across topics', 'Data interpretation and critique'],
        middle: ['Guided case study analysis', 'Annotate map/diagram with support', 'Compare two contrasting locations', 'Structured data interpretation task'],
        lower: ['Label diagram from word bank', 'Matching key terms to definitions', 'Simplified case study summary', 'Photo analysis with prompt questions'],
        eal: ['Map-based activity (reduced text)', 'Visual glossary of geographical terms', 'Diagram-first approach with labels', 'Photo evidence discussion with stems']
      },
      Resource: {
        higher: ['OS maps for independent analysis', 'Raw census or climate data sets', 'Academic geography journal extracts', 'GIS software or digital mapping tools'],
        middle: ['Simplified data tables with annotations', 'Labelled map with focus areas highlighted', 'Case study fact file template', 'Graph interpretation scaffold sheet'],
        lower: ['Pre-labelled diagram to complete', 'Photo evidence cards with prompts', 'Simplified map with colour coding', 'Key vocabulary cards with images'],
        eal: ['Visual map legend with translations', 'Photo-based comparison resources', 'Bilingual geography glossary', 'Infographic-style summary sheets']
      },
      Outcome: {
        higher: ['Evaluate the effectiveness of strategies with evidence', 'Write a balanced argument using data', 'Propose an alternative management plan', 'Produce an annotated field sketch with analysis'],
        middle: ['Describe and explain patterns in data', 'Compare two locations using a framework', 'Annotated map with explanatory labels', 'Structured paragraph explaining a process'],
        lower: ['Complete a labelled diagram', 'Fill in a guided comparison table', 'Match descriptions to photographs', 'Sequence the stages of a process'],
        eal: ['Annotated photograph with key terms', 'Labelled map using word bank', 'Sentence stems for describing patterns', 'Visual process diagram with labels']
      }
    },
    mfl: {
      Task: {
        higher: ['Extended writing with varied tenses', 'Spontaneous role-play dialogue', 'Translation into target language', 'Creative writing in target language'],
        middle: ['Structured sentence building task', 'Gap-fill with verb conjugation', 'Guided conversation practice', 'Reading comprehension with questions'],
        lower: ['Word-level matching and copying', 'Picture-word association activity', 'Repetition and pronunciation drill', 'Supported sentence building with model'],
        eal: ['Cognate identification activity', 'Cross-linguistic comparison task', 'Home language as bridge to target', 'Visual vocabulary with three languages']
      },
      Questioning: {
        higher: ['Justify your opinion in the target language', 'What would you say differently in a formal register?', 'How does this grammar rule compare to English?', 'Can you rephrase this using a different tense?'],
        middle: ['Can you form a sentence using this structure?', 'What does this word mean in context?', 'How do you conjugate this verb?', 'Can you spot the pattern in these examples?'],
        lower: ['What does this word mean?', 'Can you repeat after me?', 'Point to the correct picture', 'Which word matches this image?'],
        eal: ['How do you say this in your home language?', 'Can you spot any cognates?', 'What is similar between these two languages?', 'Use the picture to help you guess the meaning']
      }
    },
    computing: {
      Task: {
        higher: ['Optimise and refactor code', 'Design algorithm for novel problem', 'Peer code review and improvement', 'Independent project with chosen language'],
        middle: ['Modify existing code to add features', 'Debug and fix provided program', 'Follow and extend tutorial project', 'Structured pseudocode-to-code task'],
        lower: ['Block-based coding activity', 'Code completion with scaffolding', 'Follow step-by-step tutorial', 'Unplugged computational thinking task'],
        eal: ['Visual programming environment', 'Code with commented translations', 'Paired programming with discussion', 'Flowchart-based algorithm design']
      },
      Resource: {
        higher: ['API documentation for self-directed learning', 'Code repository for independent exploration', 'Advanced tutorial with extension challenges', 'Real-world data sets for projects'],
        middle: ['Partially completed code with comments', 'Step-by-step tutorial with screenshots', 'Debugging checklist and error glossary', 'Worked example with annotations'],
        lower: ['Block-based coding platform (Scratch)', 'Printed code snippets to arrange', 'Visual flowchart templates', 'Colour-coded syntax reference sheet'],
        eal: ['Visual programming environment', 'Annotated code with translated comments', 'Icon-based instruction cards', 'Video tutorial with subtitles']
      }
    },
    art: {
      Task: {
        higher: ['Independent artist study and personal response', 'Develop original composition from theme', 'Experiment with mixed media independently', 'Critical analysis of contemporary artwork'],
        middle: ['Guided artist study with structured response', 'Develop work using a given technique', 'Experiment within set parameters', 'Annotate own work using key vocabulary'],
        lower: ['Step-by-step guided technique practice', 'Colour mixing with template support', 'Trace and adapt from visual reference', 'Complete a partially started composition'],
        eal: ['Visual demonstration with labelled steps', 'Image-based artist study with key terms', 'Colour and material vocabulary cards', 'Paired work with visual instruction sheet']
      }
    },
    pe: {
      Task: {
        higher: ['Design and lead a warm-up routine', 'Analyse performance using video', 'Officiate a game applying full rules', 'Coach peers using technical feedback'],
        middle: ['Practise skill in conditioned game', 'Self-assess against criteria card', 'Apply tactic in modified game', 'Peer observation with feedback sheet'],
        lower: ['Simplified version of core skill', 'Guided practice with visual cue cards', 'Modified rules or equipment', 'Paired practice with demonstration'],
        eal: ['Visual demonstration of technique', 'Picture-based rule cards', 'Key vocabulary with action images', 'Paired practice with modelling']
      }
    },
    re: {
      Task: {
        higher: ['Evaluate contrasting theological perspectives', 'Extended argument with scholarly references', 'Compare across religious traditions', 'Assess the impact of belief on ethical decision'],
        middle: ['Explain a belief with supporting evidence', 'Compare two religious viewpoints', 'Apply ethical theory to a scenario', 'Structured response using PEE framework'],
        lower: ['Match beliefs to religions', 'Complete a guided comparison table', 'Illustrate a key belief with support', 'Sequence a religious narrative'],
        eal: ['Visual concept map of key beliefs', 'Key terms with simple definitions', 'Image-based exploration of practices', 'Sentence stems for expressing viewpoints']
      }
    },
    dt: {
      Task: {
        higher: ['Design for a specific user need independently', 'Evaluate and iterate prototype', 'Use CAD software for precision design', 'Research and apply sustainable materials'],
        middle: ['Design with guided specification', 'Follow a structured making process', 'Evaluate against criteria checklist', 'Modify an existing design to improve it'],
        lower: ['Assemble from pre-cut components', 'Follow step-by-step making guide', 'Use templates for marking out', 'Guided evaluation with sentence starters'],
        eal: ['Visual step-by-step instruction cards', 'Labelled tool and material glossary', 'Demonstration before independent work', 'Paired work with visual safety reminders']
      }
    },
    music: {
      Task: {
        higher: ['Compose using complex structures and harmony', 'Improvise over a chord progression', 'Arrange an existing piece for ensemble', 'Analyse and compare musical features across genres'],
        middle: ['Compose using a given structure', 'Perform with expression and dynamics', 'Identify musical features in a listening task', 'Collaborate on a group composition'],
        lower: ['Play a simplified melody or ostinato', 'Follow colour-coded notation', 'Clap rhythmic patterns from notation', 'Use digital tools with guided input'],
        eal: ['Visual rhythm cards with symbols', 'Listening task with picture responses', 'Paired performance with modelling', 'Key musical vocabulary with audio examples']
      }
    }
  };
  return subjectData[subject] || null;
}

function getMergedSuggestions(strategy, group) {
  const subject = document.getElementById('subjectSelect').value;
  const general = SUGGESTIONS.general[strategy]?.[group] || [];
  if (subject === 'general') return general;
  const subjectSpecific = getSubjectSuggestions(subject);
  if (subjectSpecific && subjectSpecific[strategy] && subjectSpecific[strategy][group]) {
    return subjectSpecific[strategy][group];
  }
  return general;
}

function buildMatrix() {
  const tbody = document.getElementById('matrixBody');
  tbody.innerHTML = '';
  STRATEGIES.forEach(strategy => {
    const tr = document.createElement('tr');
    const th = document.createElement('th');
    th.textContent = strategy;
    tr.appendChild(th);
    GROUPS.forEach(group => {
      const td = document.createElement('td');
      td.innerHTML = buildCell(strategy, group);
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

function buildCell(strategy, group) {
  const id = `cell-${strategy}-${group}`;
  return `
    <div class="matrix-cell">
      <div class="cell-content" contenteditable="true" id="${id}" data-strategy="${strategy}" data-group="${group}"></div>
      <span class="suggestion-toggle" onclick="toggleSuggestions('${id}-sug')">Show suggestions</span>
      <div class="suggestions" id="${id}-sug" data-strategy="${strategy}" data-group="${group}"></div>
    </div>`;
}

function loadSuggestions(sugId) {
  const el = document.getElementById(sugId);
  if (!el) return;
  const strategy = el.dataset.strategy;
  const group = el.dataset.group;
  const items = getMergedSuggestions(strategy, group);
  const cellId = sugId.replace('-sug', '');
  el.innerHTML = items.map(s =>
    `<span class="suggestion-chip" onclick="applySuggestion('${cellId}', this)">${s}</span>`
  ).join('');
}

function toggleSuggestions(sugId) {
  const el = document.getElementById(sugId);
  if (!el) return;
  const isOpen = el.classList.contains('open');
  if (!isOpen) loadSuggestions(sugId);
  el.classList.toggle('open');
  const toggle = el.previousElementSibling;
  if (toggle) toggle.textContent = isOpen ? 'Show suggestions' : 'Hide suggestions';
}

function applySuggestion(cellId, chip) {
  const cell = document.getElementById(cellId);
  if (!cell) return;
  const current = cell.textContent.trim();
  if (current && !current.endsWith('\n')) {
    cell.textContent = current + '\n' + chip.textContent;
  } else {
    cell.textContent = (current ? current : '') + chip.textContent;
  }
}

function populateAll() {
  STRATEGIES.forEach(strategy => {
    GROUPS.forEach(group => {
      const cell = document.getElementById(`cell-${strategy}-${group}`);
      if (!cell) return;
      const items = getMergedSuggestions(strategy, group);
      if (items.length > 0) {
        const pick = items[Math.floor(Math.random() * items.length)];
        const pick2 = items.filter(i => i !== pick);
        const second = pick2.length > 0 ? pick2[Math.floor(Math.random() * pick2.length)] : '';
        cell.textContent = second ? pick + '\n' + second : pick;
      }
    });
  });
  showToast('Grid populated with suggestions');
}

function clearAll() {
  STRATEGIES.forEach(strategy => {
    GROUPS.forEach(group => {
      const cell = document.getElementById(`cell-${strategy}-${group}`);
      if (cell) cell.textContent = '';
    });
  });
  showToast('Grid cleared');
}

function copyPlan() {
  const subject = document.getElementById('subjectSelect').value;
  const objective = document.getElementById('objectiveInput').value;
  let text = 'DIFFERENTIATION PLAN\n';
  text += '====================\n';
  if (subject !== 'general') text += 'Subject: ' + document.getElementById('subjectSelect').selectedOptions[0].text + '\n';
  if (objective) text += 'Objective: ' + objective + '\n';
  text += '\n';
  const labels = { higher: 'Higher Ability', middle: 'Middle Ability', lower: 'Lower Ability / SEN', eal: 'EAL Learners' };
  STRATEGIES.forEach(strategy => {
    text += strategy.toUpperCase() + '\n';
    text += '-'.repeat(strategy.length) + '\n';
    GROUPS.forEach(group => {
      const cell = document.getElementById(`cell-${strategy}-${group}`);
      const content = cell ? cell.textContent.trim() : '';
      if (content) {
        text += '  ' + labels[group] + ': ' + content.replace(/\n/g, '; ') + '\n';
      }
    });
    text += '\n';
  });
  navigator.clipboard.writeText(text).then(() => {
    showToast('Plan copied to clipboard');
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showToast('Plan copied to clipboard');
  });
}

function toggleInfo(el) {
  el.classList.toggle('active');
  const body = el.nextElementSibling;
  body.classList.toggle('open');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

// Rebuild suggestions when subject changes
document.getElementById('subjectSelect').addEventListener('change', () => {
  document.querySelectorAll('.suggestions.open').forEach(el => {
    loadSuggestions(el.id);
  });
});

// Init
buildMatrix();
</script>
</body>
</html>
