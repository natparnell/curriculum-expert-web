<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Significance & Confidence Intervals</title>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #2b44c7;
            --orange: #f59e0b;
            --orange-light: #fef3c7;
            --blue: #3b82f6;
            --blue-light: #dbeafe;
            --green: #10b981;
            --green-light: #d1fae5;
            --red: #ef4444;
            --red-light: #fee2e2;
            --purple: #8b5cf6;
            --purple-light: #ede9fe;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --radius: 12px;
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2.5rem 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 0.3rem;
            position: relative;
        }
        .header p {
            font-size: 1.15rem;
            opacity: 0.9;
            position: relative;
        }

        /* Main layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Section styling */
        .section {
            margin-bottom: 2rem;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .section-title .icon {
            font-size: 1.3rem;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--radius);
            border: 1px solid var(--gray-200);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: box-shadow 0.25s ease;
        }
        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        /* Intuition section */
        .intuition-text {
            font-size: 1.05rem;
            color: var(--gray-700);
        }
        .intuition-text .highlight {
            background: linear-gradient(120deg, #fef3c7 0%, #fde68a 100%);
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
        }
        .intuition-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }
        @media (max-width: 700px) {
            .intuition-grid { grid-template-columns: 1fr; }
        }
        .intuition-card {
            padding: 1.25rem;
            border-radius: var(--radius);
            text-align: center;
        }
        .intuition-card.small {
            background: var(--orange-light);
            border: 2px solid var(--orange);
        }
        .intuition-card.large {
            background: var(--blue-light);
            border: 2px solid var(--blue);
        }
        .intuition-card .big-num {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1.2;
        }
        .intuition-card.small .big-num { color: var(--orange); }
        .intuition-card.large .big-num { color: var(--blue); }
        .intuition-card .label {
            font-size: 0.95rem;
            color: var(--gray-600);
            margin-top: 0.25rem;
        }
        .intuition-card .verdict {
            margin-top: 0.5rem;
            font-weight: 700;
            font-size: 1rem;
        }

        /* Formula cards */
        .formula-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1rem;
        }
        .formula-card {
            background: white;
            border-radius: var(--radius);
            border: 1px solid var(--gray-200);
            padding: 1.25rem;
            box-shadow: var(--shadow);
        }
        .formula-card h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        .formula {
            font-family: 'Cambria Math', 'Times New Roman', serif;
            font-size: 1.4rem;
            text-align: center;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: 8px;
            margin: 0.5rem 0;
            color: var(--primary-dark);
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .formula-card .explanation {
            font-size: 0.88rem;
            color: var(--gray-600);
            line-height: 1.5;
        }
        .formula-card .explanation strong {
            color: var(--gray-800);
        }

        /* Bell curve section */
        .bell-section {
            text-align: center;
        }
        .bell-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        .bell-controls label {
            font-weight: 600;
            color: var(--gray-700);
        }
        .bell-controls input[type="range"] {
            width: 200px;
        }
        .bell-controls .conf-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--primary);
            min-width: 50px;
        }
        .bell-info {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }
        .bell-info .info-item {
            font-size: 0.95rem;
            color: var(--gray-600);
        }
        .bell-info .info-item strong {
            color: var(--gray-900);
        }
        canvas {
            display: block;
            margin: 0 auto;
            max-width: 100%;
        }

        /* School comparison */
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        @media (max-width: 800px) {
            .comparison-grid { grid-template-columns: 1fr; }
        }
        .school-card {
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 2px solid;
        }
        .school-card.primary {
            border-color: var(--orange);
            background: linear-gradient(135deg, white 0%, var(--orange-light) 100%);
        }
        .school-card.secondary {
            border-color: var(--blue);
            background: linear-gradient(135deg, white 0%, var(--blue-light) 100%);
        }
        .school-card h3 {
            font-size: 1.15rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .school-card.primary h3 { color: #b45309; }
        .school-card.secondary h3 { color: #1d4ed8; }

        .slider-group {
            margin-bottom: 0.75rem;
        }
        .slider-group label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
        }
        .slider-group label .val {
            color: var(--primary);
            font-weight: 700;
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--gray-200);
            border-radius: 3px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .school-card.primary input[type="range"]::-webkit-slider-thumb {
            background: var(--orange);
        }
        .school-card.secondary input[type="range"]::-webkit-slider-thumb {
            background: var(--blue);
        }

        /* Stats output */
        .stats-output {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 0.3rem 0;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-row .stat-label { color: var(--gray-600); }
        .stat-row .stat-value { font-weight: 700; color: var(--gray-900); }

        /* CI bar */
        .ci-bar-container {
            margin-top: 1rem;
            position: relative;
            height: 50px;
            background: var(--gray-100);
            border-radius: 8px;
            overflow: hidden;
        }
        .ci-bar-track {
            position: absolute;
            top: 0;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
            min-width: 2px;
        }
        .school-card.primary .ci-bar-track { background: rgba(245, 158, 11, 0.3); border: 2px solid var(--orange); }
        .school-card.secondary .ci-bar-track { background: rgba(59, 130, 246, 0.3); border: 2px solid var(--blue); }
        .ci-bar-label {
            font-size: 0.75rem;
            font-weight: 700;
            white-space: nowrap;
            color: var(--gray-700);
        }
        .ci-national-line {
            position: absolute;
            top: 0;
            height: 100%;
            width: 2px;
            background: var(--red);
            z-index: 2;
        }
        .ci-national-label {
            position: absolute;
            top: -18px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--red);
            transform: translateX(-50%);
            white-space: nowrap;
        }

        /* Significance badge */
        .sig-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 1rem;
            border-radius: 100px;
            font-weight: 700;
            font-size: 0.95rem;
            margin-top: 0.75rem;
            transition: all 0.3s ease;
        }
        .sig-badge.significant {
            background: var(--green-light);
            color: #065f46;
            border: 2px solid var(--green);
        }
        .sig-badge.not-significant {
            background: var(--red-light);
            color: #991b1b;
            border: 2px solid var(--red);
        }

        /* Shared national slider */
        .shared-controls {
            background: var(--purple-light);
            border: 2px solid var(--purple);
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
        }
        .shared-controls h3 {
            font-size: 1rem;
            font-weight: 700;
            color: #5b21b6;
            margin-bottom: 0.5rem;
        }
        .shared-controls input[type="range"]::-webkit-slider-thumb {
            background: var(--purple);
        }
        .shared-controls .slider-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 700px) {
            .shared-controls .slider-row { grid-template-columns: 1fr; }
        }

        /* Calculator */
        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        @media (max-width: 700px) {
            .calc-grid { grid-template-columns: 1fr; }
        }
        .calc-inputs label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
            margin-top: 0.75rem;
        }
        .calc-inputs label:first-child { margin-top: 0; }
        .calc-inputs input[type="number"],
        .calc-inputs select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
        }
        .calc-inputs input[type="number"]:focus,
        .calc-inputs select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        .calc-results {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: 1.25rem;
        }
        .calc-result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.95rem;
        }
        .calc-result-item:last-child { border-bottom: none; }
        .calc-result-item .label { color: var(--gray-600); }
        .calc-result-item .value { font-weight: 700; }

        /* Implications */
        .implications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        .implication-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.25rem;
            border: 1px solid var(--gray-200);
            box-shadow: var(--shadow);
        }
        .implication-card h4 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--gray-900);
        }
        .implication-card p {
            font-size: 0.9rem;
            color: var(--gray-600);
            line-height: 1.5;
        }

        /* Detectable difference table */
        .det-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        .det-table th, .det-table td {
            padding: 0.6rem 0.75rem;
            text-align: center;
            border-bottom: 1px solid var(--gray-200);
        }
        .det-table th {
            background: var(--gray-100);
            font-weight: 700;
            color: var(--gray-700);
            font-size: 0.85rem;
        }
        .det-table tr:hover { background: var(--gray-50); }
        .det-table .highlight-row { background: var(--orange-light); font-weight: 600; }
        .det-table .highlight-row-blue { background: var(--blue-light); font-weight: 600; }

        /* Footer */
        .footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--gray-500);
            font-size: 0.85rem;
            border-top: 1px solid var(--gray-200);
            margin-top: 2rem;
        }
    </style>
</head>
<body>

<!-- HEADER -->
<div class="header">
    <h1>Significance &amp; Confidence Intervals</h1>
    <p>Why sample size changes everything</p>
</div>

<div class="container">

    <!-- 1. INTUITION -->
    <div class="section">
        <div class="section-title"><span class="icon">üí°</span> Start with the Intuition</div>
        <div class="card">
            <p class="intuition-text">
                Imagine you suspect a coin is biased. You flip it and count the heads.
                The question is: <span class="highlight">how many flips do you need before you can trust the result?</span>
            </p>
            <div class="intuition-grid">
                <div class="intuition-card small">
                    <div class="big-num">7 / 10</div>
                    <div class="label">70% heads from 10 flips</div>
                    <div class="verdict">Could easily be luck. ü§∑</div>
                </div>
                <div class="intuition-card large">
                    <div class="big-num">700 / 1,000</div>
                    <div class="label">70% heads from 1,000 flips</div>
                    <div class="verdict">Almost certainly biased. ‚úÖ</div>
                </div>
            </div>
            <p class="intuition-text" style="margin-top: 1rem;">
                The result is the same (70%), but our <span class="highlight">confidence</span> is completely different.
                This is the heart of statistical significance: <strong>more data means less uncertainty</strong>.
                In schools, this matters hugely. A primary school with 30 children in Year 6 and a secondary school
                with 420 GCSE students can both score 70%, but the meaning is very different.
            </p>
        </div>
    </div>

    <!-- 2. THE MATHS -->
    <div class="section">
        <div class="section-title"><span class="icon">üìê</span> The Maths Behind It</div>
        <div class="formula-grid">
            <div class="formula-card">
                <h3>Standard Error (SE)</h3>
                <div class="formula">SE = ‚àö( p(1‚àíp) / n )</div>
                <div class="explanation">
                    <strong>p</strong> = proportion (e.g. 0.65 for 65%)<br>
                    <strong>n</strong> = sample size (number of pupils)<br><br>
                    The SE measures how much a result might vary by chance. Because <strong>n</strong> is under the square root,
                    you need <strong>4√ó as many pupils to halve the uncertainty</strong>.
                </div>
            </div>
            <div class="formula-card">
                <h3>Confidence Interval (CI)</h3>
                <div class="formula">CI = p ¬± z √ó SE</div>
                <div class="explanation">
                    <strong>z</strong> = number of standard errors for your confidence level<br><br>
                    At <strong>95%</strong> confidence: z = 1.96<br>
                    At <strong>99%</strong> confidence: z = 2.576<br><br>
                    The CI is the range where the <strong>true value</strong> probably lies.
                    Wider interval = more uncertainty.
                </div>
            </div>
            <div class="formula-card">
                <h3>Z-Score (Test Statistic)</h3>
                <div class="formula">z = (p ‚àí p‚ÇÄ) / SE</div>
                <div class="explanation">
                    <strong>p</strong> = your school's result<br>
                    <strong>p‚ÇÄ</strong> = national average (baseline)<br><br>
                    The z-score tells you how many standard errors your result is from the national average.
                    If |z| > 1.96, the difference is <strong>significant at the 95% level</strong>.
                </div>
            </div>
            <div class="formula-card">
                <h3>P-Value</h3>
                <div class="formula">P(seeing this result by chance)</div>
                <div class="explanation">
                    The p-value answers: "If there were <em>no real difference</em>, what is the probability of seeing a result this extreme?"<br><br>
                    <strong>p &lt; 0.05</strong> ‚Üí significant at 95% level<br>
                    <strong>p &lt; 0.01</strong> ‚Üí significant at 99% level<br><br>
                    A small p-value means the result is unlikely to be just chance.
                </div>
            </div>
        </div>
    </div>

    <!-- 3. INTERACTIVE BELL CURVE -->
    <div class="section">
        <div class="section-title"><span class="icon">üìä</span> The Normal Distribution</div>
        <div class="card bell-section">
            <p style="color: var(--gray-600); margin-bottom: 0.5rem;">
                The bell curve shows how results are distributed. The shaded area is where values fall within your chosen confidence level.
                The tails (unshaded) represent the "significance zone" ‚Äî results extreme enough to be considered statistically significant.
            </p>
            <div class="bell-controls">
                <label for="confSlider">Confidence Level:</label>
                <input type="range" id="confSlider" min="80" max="99.9" step="0.1" value="95">
                <span class="conf-value" id="confValue">95%</span>
            </div>
            <canvas id="bellCanvas" width="700" height="300"></canvas>
            <div class="bell-info">
                <div class="info-item">z-value: <strong id="bellZ">¬±1.960</strong></div>
                <div class="info-item">Each tail: <strong id="bellTail">2.50%</strong></div>
                <div class="info-item">Shaded area: <strong id="bellArea">95.00%</strong></div>
            </div>
        </div>
    </div>

    <!-- 4. SCHOOL COMPARISON -->
    <div class="section">
        <div class="section-title"><span class="icon">üè´</span> School Comparison: The Big Reveal</div>

        <div class="shared-controls">
            <h3>Shared Settings</h3>
            <div class="slider-row">
                <div class="slider-group">
                    <label>National Average <span class="val" id="natVal">65%</span></label>
                    <input type="range" id="natSlider" min="20" max="90" step="1" value="65">
                </div>
                <div class="slider-group">
                    <label>Confidence Level <span class="val" id="compConfVal">95%</span></label>
                    <input type="range" id="compConfSlider" min="80" max="99" step="1" value="95">
                </div>
            </div>
        </div>

        <div class="comparison-grid">
            <!-- Primary school -->
            <div class="school-card primary">
                <h3>üü† Primary School (KS2)</h3>
                <div class="slider-group">
                    <label>Cohort Size <span class="val" id="primNVal">30</span></label>
                    <input type="range" id="primNSlider" min="10" max="90" step="1" value="30">
                </div>
                <div class="slider-group">
                    <label>School Result <span class="val" id="primResVal">72%</span></label>
                    <input type="range" id="primResSlider" min="20" max="100" step="1" value="72">
                </div>
                <div class="stats-output" id="primStats"></div>
                <div style="position: relative; margin-top: 1rem;">
                    <div class="ci-national-label" id="primNatLabel">National: 65%</div>
                    <div class="ci-national-line" id="primNatLine"></div>
                    <div class="ci-bar-container">
                        <div class="ci-bar-track" id="primCIBar">
                            <span class="ci-bar-label" id="primCILabel"></span>
                        </div>
                    </div>
                </div>
                <div style="text-align: center;">
                    <div class="sig-badge" id="primBadge"></div>
                </div>
            </div>

            <!-- Secondary school -->
            <div class="school-card secondary">
                <h3>üîµ Secondary School (GCSE)</h3>
                <div class="slider-group">
                    <label>Cohort Size <span class="val" id="secNVal">420</span></label>
                    <input type="range" id="secNSlider" min="50" max="800" step="5" value="420">
                </div>
                <div class="slider-group">
                    <label>School Result <span class="val" id="secResVal">72%</span></label>
                    <input type="range" id="secResSlider" min="20" max="100" step="1" value="72">
                </div>
                <div class="stats-output" id="secStats"></div>
                <div style="position: relative; margin-top: 1rem;">
                    <div class="ci-national-label" id="secNatLabel">National: 65%</div>
                    <div class="ci-national-line" id="secNatLine"></div>
                    <div class="ci-bar-container">
                        <div class="ci-bar-track" id="secCIBar">
                            <span class="ci-bar-label" id="secCILabel"></span>
                        </div>
                    </div>
                </div>
                <div style="text-align: center;">
                    <div class="sig-badge" id="secBadge"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. CALCULATOR -->
    <div class="section">
        <div class="section-title"><span class="icon">üßÆ</span> Try Your Own School</div>
        <div class="card">
            <div class="calc-grid">
                <div class="calc-inputs">
                    <label for="calcN">Number of Pupils</label>
                    <input type="number" id="calcN" min="5" max="2000" value="120">
                    <label for="calcSchool">School Result (%)</label>
                    <input type="number" id="calcSchool" min="0" max="100" value="68" step="0.1">
                    <label for="calcNat">National Average (%)</label>
                    <input type="number" id="calcNat" min="0" max="100" value="65" step="0.1">
                    <label for="calcConf">Confidence Level</label>
                    <select id="calcConf">
                        <option value="90">90%</option>
                        <option value="95" selected>95%</option>
                        <option value="99">99%</option>
                    </select>
                </div>
                <div class="calc-results" id="calcResults">
                    <!-- filled by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- 6. WHAT THIS MEANS -->
    <div class="section">
        <div class="section-title"><span class="icon">üéØ</span> What This Means for Schools</div>
        <div class="implications-grid">
            <div class="implication-card">
                <h4>Small Cohorts Need Big Differences</h4>
                <p>With 30 pupils, a school needs to be roughly <strong>18 percentage points</strong> above the national average
                   before the difference is statistically significant at 95%. Random variation in a class of 30 can easily
                   produce swings of 10-15% either way.</p>
            </div>
            <div class="implication-card">
                <h4>Large Cohorts Detect Small Shifts</h4>
                <p>With 420 pupils, a difference of just <strong>5 percentage points</strong> above national is statistically
                   significant. The larger sample dramatically reduces the margin of error, making real effects visible.</p>
            </div>
            <div class="implication-card">
                <h4>Not Significant ‚â† Not Good</h4>
                <p>A primary school scoring 75% against a 65% national average is doing well. The lack of statistical
                   significance simply means we <strong>cannot rule out chance</strong> ‚Äî it does not mean the school is average.
                   Small cohorts make it harder to prove differences, not that differences do not exist.</p>
            </div>
        </div>

        <div class="card" style="margin-top: 1rem;">
            <h4 style="font-size: 1rem; font-weight: 700; margin-bottom: 0.5rem;">Minimum Detectable Difference (95% confidence, national average = 65%)</h4>
            <p style="font-size: 0.85rem; color: var(--gray-500); margin-bottom: 0.5rem;">
                How far above or below the national average must a school be for the difference to be statistically significant?
            </p>
            <table class="det-table">
                <thead>
                    <tr>
                        <th>Cohort Size</th>
                        <th>Standard Error</th>
                        <th>Margin of Error (¬±)</th>
                        <th>Must Score Above</th>
                        <th>Must Score Below</th>
                        <th>Context</th>
                    </tr>
                </thead>
                <tbody id="detTableBody">
                    <!-- filled by JS -->
                </tbody>
            </table>
        </div>
    </div>

</div>

<div class="footer">
    Built to support school leaders in understanding statistical significance.
</div>

<script>
    // ===== UTILITY FUNCTIONS =====

    // Standard normal PDF
    function normalPDF(x) {
        return Math.exp(-0.5 * x * x) / Math.sqrt(2 * Math.PI);
    }

    // Approximate inverse normal (Beasley-Springer-Moro algorithm)
    function invNorm(p) {
        // For p in (0,1), returns z such that Phi(z) = p
        const a = [0, -3.969683028665376e+01, 2.209460984245205e+02,
            -2.759285104469687e+02, 1.383577518672690e+02,
            -3.066479806614716e+01, 2.506628277459239e+00];
        const b = [0, -5.447609879822406e+01, 1.615858368580409e+02,
            -1.556989798598866e+02, 6.680131188771972e+01,
            -1.328068155288572e+01];
        const c = [0, -7.784894002430293e-03, -3.223964580411365e-01,
            -2.400758277161838e+00, -2.549732539343734e+00,
            4.374664141464968e+00, 2.938163982698783e+00];
        const d = [0, 7.784695709041462e-03, 3.224671290700398e-01,
            2.445134137142996e+00, 3.754408661907416e+00];

        const pLow = 0.02425;
        const pHigh = 1 - pLow;
        let q, r;

        if (p < pLow) {
            q = Math.sqrt(-2 * Math.log(p));
            return (((((c[1]*q+c[2])*q+c[3])*q+c[4])*q+c[5])*q+c[6]) /
                   ((((d[1]*q+d[2])*q+d[3])*q+d[4])*q+1);
        } else if (p <= pHigh) {
            q = p - 0.5;
            r = q * q;
            return (((((a[1]*r+a[2])*r+a[3])*r+a[4])*r+a[5])*r+a[6])*q /
                   (((((b[1]*r+b[2])*r+b[3])*r+b[4])*r+b[5])*r+1);
        } else {
            q = Math.sqrt(-2 * Math.log(1 - p));
            return -(((((c[1]*q+c[2])*q+c[3])*q+c[4])*q+c[5])*q+c[6]) /
                    ((((d[1]*q+d[2])*q+d[3])*q+d[4])*q+1);
        }
    }

    // Approximate normal CDF (Abramowitz & Stegun)
    function normalCDF(x) {
        const t = 1 / (1 + 0.2316419 * Math.abs(x));
        const d = 0.3989422804014327; // 1/sqrt(2*pi)
        const p = d * Math.exp(-x * x / 2) *
            (t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.8212560 + t * 1.3302744)))));
        return x > 0 ? 1 - p : p;
    }

    // Get z-value for a given confidence level (as fraction, e.g. 0.95)
    function getZ(confidence) {
        return invNorm(1 - (1 - confidence) / 2);
    }

    // Calculate SE for a proportion
    function calcSE(p, n) {
        return Math.sqrt(p * (1 - p) / n);
    }

    // ===== BELL CURVE =====
    const bellCanvas = document.getElementById('bellCanvas');
    const bellCtx = bellCanvas.getContext('2d');

    function drawBellCurve() {
        const conf = parseFloat(document.getElementById('confSlider').value) / 100;
        const z = getZ(conf);
        document.getElementById('confValue').textContent = (conf * 100).toFixed(1) + '%';
        document.getElementById('bellZ').textContent = '¬±' + z.toFixed(3);
        document.getElementById('bellTail').textContent = ((1 - conf) / 2 * 100).toFixed(2) + '%';
        document.getElementById('bellArea').textContent = (conf * 100).toFixed(2) + '%';

        const W = bellCanvas.width;
        const H = bellCanvas.height;
        const pad = { top: 20, bottom: 40, left: 30, right: 30 };
        const plotW = W - pad.left - pad.right;
        const plotH = H - pad.top - pad.bottom;

        bellCtx.clearRect(0, 0, W, H);

        const xMin = -4, xMax = 4;
        const yMax = 0.42;

        function toCanvasX(x) { return pad.left + (x - xMin) / (xMax - xMin) * plotW; }
        function toCanvasY(y) { return pad.top + (1 - y / yMax) * plotH; }

        // Shaded confidence region
        bellCtx.beginPath();
        bellCtx.moveTo(toCanvasX(-z), toCanvasY(0));
        for (let x = -z; x <= z; x += 0.02) {
            bellCtx.lineTo(toCanvasX(x), toCanvasY(normalPDF(x)));
        }
        bellCtx.lineTo(toCanvasX(z), toCanvasY(0));
        bellCtx.closePath();
        bellCtx.fillStyle = 'rgba(67, 97, 238, 0.2)';
        bellCtx.fill();

        // Left tail shading
        bellCtx.beginPath();
        bellCtx.moveTo(toCanvasX(xMin), toCanvasY(0));
        for (let x = xMin; x <= -z; x += 0.02) {
            bellCtx.lineTo(toCanvasX(x), toCanvasY(normalPDF(x)));
        }
        bellCtx.lineTo(toCanvasX(-z), toCanvasY(0));
        bellCtx.closePath();
        bellCtx.fillStyle = 'rgba(239, 68, 68, 0.25)';
        bellCtx.fill();

        // Right tail shading
        bellCtx.beginPath();
        bellCtx.moveTo(toCanvasX(z), toCanvasY(0));
        for (let x = z; x <= xMax; x += 0.02) {
            bellCtx.lineTo(toCanvasX(x), toCanvasY(normalPDF(x)));
        }
        bellCtx.lineTo(toCanvasX(xMax), toCanvasY(0));
        bellCtx.closePath();
        bellCtx.fillStyle = 'rgba(239, 68, 68, 0.25)';
        bellCtx.fill();

        // Bell curve line
        bellCtx.beginPath();
        for (let x = xMin; x <= xMax; x += 0.02) {
            const cx = toCanvasX(x);
            const cy = toCanvasY(normalPDF(x));
            if (x === xMin) bellCtx.moveTo(cx, cy);
            else bellCtx.lineTo(cx, cy);
        }
        bellCtx.strokeStyle = 'var(--primary)';
        bellCtx.lineWidth = 2.5;
        bellCtx.stroke();

        // Z lines
        bellCtx.setLineDash([5, 4]);
        bellCtx.strokeStyle = '#ef4444';
        bellCtx.lineWidth = 1.5;
        [-z, z].forEach(zv => {
            const cx = toCanvasX(zv);
            bellCtx.beginPath();
            bellCtx.moveTo(cx, toCanvasY(0));
            bellCtx.lineTo(cx, toCanvasY(normalPDF(zv)));
            bellCtx.stroke();
        });
        bellCtx.setLineDash([]);

        // Axis
        bellCtx.strokeStyle = '#9ca3af';
        bellCtx.lineWidth = 1;
        bellCtx.beginPath();
        bellCtx.moveTo(pad.left, toCanvasY(0));
        bellCtx.lineTo(W - pad.right, toCanvasY(0));
        bellCtx.stroke();

        // Labels
        bellCtx.fillStyle = '#374151';
        bellCtx.font = '12px Segoe UI, system-ui, sans-serif';
        bellCtx.textAlign = 'center';
        for (let i = -3; i <= 3; i++) {
            bellCtx.fillText(i.toString(), toCanvasX(i), toCanvasY(0) + 18);
        }
        bellCtx.fillText('z-score', W / 2, H - 4);

        // z annotation labels
        bellCtx.fillStyle = '#ef4444';
        bellCtx.font = 'bold 11px Segoe UI, system-ui, sans-serif';
        bellCtx.fillText('‚àí' + z.toFixed(2), toCanvasX(-z), toCanvasY(0) + 32);
        bellCtx.fillText('+' + z.toFixed(2), toCanvasX(z), toCanvasY(0) + 32);

        // Centre label
        bellCtx.fillStyle = 'rgba(67, 97, 238, 0.8)';
        bellCtx.font = 'bold 13px Segoe UI, system-ui, sans-serif';
        bellCtx.fillText((conf * 100).toFixed(1) + '%', toCanvasX(0), toCanvasY(normalPDF(0)) - 8);

        // Tail labels
        bellCtx.fillStyle = 'rgba(239, 68, 68, 0.8)';
        bellCtx.font = 'bold 11px Segoe UI, system-ui, sans-serif';
        const tailPct = ((1 - conf) / 2 * 100).toFixed(1) + '%';
        bellCtx.fillText(tailPct, toCanvasX(-3), toCanvasY(normalPDF(-3)) - 10);
        bellCtx.fillText(tailPct, toCanvasX(3), toCanvasY(normalPDF(3)) - 10);
    }

    document.getElementById('confSlider').addEventListener('input', drawBellCurve);
    drawBellCurve();

    // ===== SCHOOL COMPARISON =====
    function updateSchoolComparison() {
        const nat = parseInt(document.getElementById('natSlider').value) / 100;
        const conf = parseInt(document.getElementById('compConfSlider').value) / 100;
        const z = getZ(conf);

        document.getElementById('natVal').textContent = Math.round(nat * 100) + '%';
        document.getElementById('compConfVal').textContent = Math.round(conf * 100) + '%';

        // Primary
        const primN = parseInt(document.getElementById('primNSlider').value);
        const primRes = parseInt(document.getElementById('primResSlider').value) / 100;
        document.getElementById('primNVal').textContent = primN;
        document.getElementById('primResVal').textContent = Math.round(primRes * 100) + '%';

        const primSE = calcSE(primRes, primN);
        const primCI_lo = Math.max(0, primRes - z * primSE);
        const primCI_hi = Math.min(1, primRes + z * primSE);
        const primZscore = (primRes - nat) / primSE;
        const primPval = 2 * (1 - normalCDF(Math.abs(primZscore)));
        const primSig = (primCI_lo > nat) || (primCI_hi < nat);

        updateSchoolUI('prim', primN, primRes, nat, primSE, primCI_lo, primCI_hi, primZscore, primPval, primSig, conf);

        // Secondary
        const secN = parseInt(document.getElementById('secNSlider').value);
        const secRes = parseInt(document.getElementById('secResSlider').value) / 100;
        document.getElementById('secNVal').textContent = secN;
        document.getElementById('secResVal').textContent = Math.round(secRes * 100) + '%';

        const secSE = calcSE(secRes, secN);
        const secCI_lo = Math.max(0, secRes - z * secSE);
        const secCI_hi = Math.min(1, secRes + z * secSE);
        const secZscore = (secRes - nat) / secSE;
        const secPval = 2 * (1 - normalCDF(Math.abs(secZscore)));
        const secSig = (secCI_lo > nat) || (secCI_hi < nat);

        updateSchoolUI('sec', secN, secRes, nat, secSE, secCI_lo, secCI_hi, secZscore, secPval, secSig, conf);
    }

    function updateSchoolUI(prefix, n, res, nat, se, ciLo, ciHi, zScore, pVal, significant, conf) {
        // Stats text
        const statsEl = document.getElementById(prefix + 'Stats');
        statsEl.innerHTML = `
            <div class="stat-row"><span class="stat-label">Standard Error</span><span class="stat-value">${(se * 100).toFixed(2)}%</span></div>
            <div class="stat-row"><span class="stat-label">Confidence Interval</span><span class="stat-value">${(ciLo * 100).toFixed(1)}% ‚Äì ${(ciHi * 100).toFixed(1)}%</span></div>
            <div class="stat-row"><span class="stat-label">CI Width</span><span class="stat-value">${((ciHi - ciLo) * 100).toFixed(1)} percentage points</span></div>
            <div class="stat-row"><span class="stat-label">Z-Score</span><span class="stat-value">${zScore.toFixed(3)}</span></div>
            <div class="stat-row"><span class="stat-label">P-Value</span><span class="stat-value">${pVal < 0.0001 ? '< 0.0001' : pVal.toFixed(4)}</span></div>
        `;

        // CI bar ‚Äî map 0-100% onto bar width
        const barContainer = document.getElementById(prefix + 'CIBar').parentElement;
        const containerWidth = barContainer.offsetWidth || 300;

        // Use a display range of 0% to 100%
        const displayMin = 0;
        const displayMax = 1;
        const range = displayMax - displayMin;

        const leftPct = ((ciLo - displayMin) / range) * 100;
        const widthPct = ((ciHi - ciLo) / range) * 100;

        const ciBar = document.getElementById(prefix + 'CIBar');
        ciBar.style.left = leftPct + '%';
        ciBar.style.width = Math.max(widthPct, 0.5) + '%';

        const ciLabel = document.getElementById(prefix + 'CILabel');
        ciLabel.textContent = `${(ciLo * 100).toFixed(1)}% ‚Äì ${(ciHi * 100).toFixed(1)}%`;

        // National line
        const natLinePct = ((nat - displayMin) / range) * 100;
        document.getElementById(prefix + 'NatLine').style.left = natLinePct + '%';
        document.getElementById(prefix + 'NatLabel').style.left = natLinePct + '%';
        document.getElementById(prefix + 'NatLabel').textContent = 'National: ' + Math.round(nat * 100) + '%';

        // Badge
        const badge = document.getElementById(prefix + 'Badge');
        if (significant) {
            badge.className = 'sig-badge significant';
            badge.innerHTML = '‚úÖ Statistically Significant (p = ' + (pVal < 0.0001 ? '< 0.0001' : pVal.toFixed(4)) + ')';
        } else {
            badge.className = 'sig-badge not-significant';
            badge.innerHTML = '‚ùå Not Statistically Significant (p = ' + pVal.toFixed(4) + ')';
        }
    }

    // Wire up all comparison sliders
    ['natSlider', 'compConfSlider', 'primNSlider', 'primResSlider', 'secNSlider', 'secResSlider'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateSchoolComparison);
    });
    updateSchoolComparison();

    // ===== CALCULATOR =====
    function updateCalculator() {
        const n = parseInt(document.getElementById('calcN').value) || 30;
        const schoolPct = parseFloat(document.getElementById('calcSchool').value) / 100;
        const natPct = parseFloat(document.getElementById('calcNat').value) / 100;
        const confLevel = parseInt(document.getElementById('calcConf').value) / 100;

        const z = getZ(confLevel);
        const se = calcSE(schoolPct, n);
        const ciLo = Math.max(0, schoolPct - z * se);
        const ciHi = Math.min(1, schoolPct + z * se);
        const zScore = (schoolPct - natPct) / se;
        const pVal = 2 * (1 - normalCDF(Math.abs(zScore)));
        const sig = (ciLo > natPct) || (ciHi < natPct);

        const resultsEl = document.getElementById('calcResults');
        resultsEl.innerHTML = `
            <h4 style="font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; color: var(--gray-900);">Results</h4>
            <div class="calc-result-item"><span class="label">Standard Error</span><span class="value">${(se * 100).toFixed(2)}%</span></div>
            <div class="calc-result-item"><span class="label">Confidence Interval</span><span class="value">${(ciLo * 100).toFixed(1)}% ‚Äì ${(ciHi * 100).toFixed(1)}%</span></div>
            <div class="calc-result-item"><span class="label">Margin of Error (¬±)</span><span class="value">${(z * se * 100).toFixed(1)} pp</span></div>
            <div class="calc-result-item"><span class="label">Z-Score</span><span class="value">${zScore.toFixed(3)}</span></div>
            <div class="calc-result-item"><span class="label">P-Value</span><span class="value">${pVal < 0.0001 ? '< 0.0001' : pVal.toFixed(4)}</span></div>
            <div class="calc-result-item">
                <span class="label">Significant?</span>
                <span class="value" style="color: ${sig ? 'var(--green)' : 'var(--red)'};">
                    ${sig ? '‚úÖ Yes' : '‚ùå No'}
                </span>
            </div>
            <div style="margin-top: 0.75rem; padding: 0.75rem; background: ${sig ? 'var(--green-light)' : 'var(--red-light)'}; border-radius: 8px; font-size: 0.88rem; color: var(--gray-700);">
                ${sig
                    ? `The school's result of ${(schoolPct*100).toFixed(1)}% is statistically significantly ${schoolPct > natPct ? 'above' : 'below'} the national average of ${(natPct*100).toFixed(1)}% at the ${(confLevel*100).toFixed(0)}% confidence level.`
                    : `The difference between the school's ${(schoolPct*100).toFixed(1)}% and the national ${(natPct*100).toFixed(1)}% could plausibly be due to chance. With ${n} pupils, the margin of error (¬±${(z*se*100).toFixed(1)}pp) is too large to be sure.`
                }
            </div>
        `;
    }

    ['calcN', 'calcSchool', 'calcNat', 'calcConf'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateCalculator);
        document.getElementById(id).addEventListener('change', updateCalculator);
    });
    updateCalculator();

    // ===== DETECTABLE DIFFERENCE TABLE =====
    function buildDetTable() {
        const nat = 0.65;
        const z = 1.96; // 95%
        const cohorts = [
            { n: 15, context: 'Tiny primary class', cls: 'highlight-row' },
            { n: 30, context: 'Typical primary Y6', cls: 'highlight-row' },
            { n: 60, context: 'Two-form primary', cls: 'highlight-row' },
            { n: 90, context: 'Three-form primary', cls: '' },
            { n: 150, context: 'Small secondary', cls: '' },
            { n: 250, context: 'Medium secondary', cls: 'highlight-row-blue' },
            { n: 420, context: 'Large secondary', cls: 'highlight-row-blue' },
            { n: 600, context: 'Very large secondary', cls: 'highlight-row-blue' },
        ];

        const tbody = document.getElementById('detTableBody');
        tbody.innerHTML = cohorts.map(c => {
            const se = calcSE(nat, c.n);
            const moe = z * se;
            return `<tr class="${c.cls}">
                <td>${c.n}</td>
                <td>${(se * 100).toFixed(2)}%</td>
                <td>¬±${(moe * 100).toFixed(1)}pp</td>
                <td>${Math.min(100, (nat + moe) * 100).toFixed(1)}%</td>
                <td>${Math.max(0, (nat - moe) * 100).toFixed(1)}%</td>
                <td>${c.context}</td>
            </tr>`;
        }).join('');
    }
    buildDetTable();

</script>
</body>
</html>
