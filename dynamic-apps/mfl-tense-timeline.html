<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tense Timeline</title>
<style>
:root {
  --bg: #0f0a1a;
  --card: #1a1230;
  --card2: #251c3e;
  --card3: #2f2450;
  --text: #f0eaf8;
  --text2: #a89cc4;
  --border: #3d2e66;
  --accent: #9b59b6;
  --accent-light: #c39bd3;
  --passe-compose: #e74c3c;
  --imparfait: #e67e22;
  --plus-que-parfait: #d35400;
  --present: #2ecc71;
  --futur-proche: #3498db;
  --futur-simple: #9b59b6;
  --conditionnel: #8e44ad;
  --past-bg: rgba(231,76,60,.12);
  --present-bg: rgba(46,204,113,.12);
  --future-bg: rgba(52,152,219,.12);
  --success: #2ecc71;
  --error: #e74c3c;
  --gold: #f1c40f;
  --radius: 10px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 20% 30%,rgba(155,89,182,.1) 0%,transparent 50%),radial-gradient(ellipse at 80% 70%,rgba(52,152,219,.08) 0%,transparent 50%);z-index:0;pointer-events:none;}

/* HEADER */
.sticky-header{position:sticky;top:0;z-index:100;background:linear-gradient(135deg,#1a0f2e 0%,#2d1b4e 100%);border-bottom:2px solid var(--border);padding:14px 20px;text-align:center;}
.sticky-header h1{font-size:1.6rem;color:var(--text);letter-spacing:.5px;}
.sticky-header p{font-size:.85rem;color:var(--text2);margin-top:2px;}

/* APP */
.app{position:relative;z-index:1;max-width:1300px;margin:0 auto;padding:16px 16px 40px;}

/* TABS */
.tab-bar{display:flex;gap:6px;margin-bottom:16px;flex-wrap:wrap;}
.tab-btn{padding:8px 18px;border:1px solid var(--border);background:var(--card);color:var(--text2);border-radius:20px;cursor:pointer;font-size:.85rem;transition:all .2s;}
.tab-btn:hover{border-color:var(--accent);color:var(--text);}
.tab-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);}

/* PANELS */
.panel{display:none;}
.panel.active{display:block;}

/* TIMELINE */
.timeline-section{margin-bottom:20px;}
.timeline-container{position:relative;background:var(--card);border-radius:var(--radius);padding:30px 20px 20px;border:1px solid var(--border);}
.time-labels{display:flex;justify-content:space-between;margin-bottom:12px;font-size:.8rem;color:var(--text2);font-weight:600;text-transform:uppercase;letter-spacing:1px;}
.timeline-track{position:relative;height:6px;background:linear-gradient(90deg,var(--passe-compose),var(--present),var(--futur-simple));border-radius:3px;margin:0 0 16px;}
.timeline-zones{display:flex;height:100%;border-radius:3px;overflow:hidden;}
.timeline-zones div{flex:1;}
.tense-nodes{display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px;padding:0 4px;}
.tense-node{padding:8px 14px;border-radius:8px;cursor:pointer;font-size:.8rem;font-weight:600;transition:all .25s;border:2px solid transparent;text-align:center;flex:1;min-width:110px;}
.tense-node:hover{transform:translateY(-2px);box-shadow:0 4px 15px rgba(0,0,0,.3);}
.tense-node.selected{transform:translateY(-3px);box-shadow:0 6px 20px rgba(0,0,0,.4);}
.tense-node[data-tense="passe-compose"]{background:rgba(231,76,60,.15);border-color:var(--passe-compose);color:var(--passe-compose);}
.tense-node[data-tense="passe-compose"].selected{background:rgba(231,76,60,.3);}
.tense-node[data-tense="imparfait"]{background:rgba(230,126,34,.15);border-color:var(--imparfait);color:var(--imparfait);}
.tense-node[data-tense="imparfait"].selected{background:rgba(230,126,34,.3);}
.tense-node[data-tense="plus-que-parfait"]{background:rgba(211,84,0,.15);border-color:var(--plus-que-parfait);color:var(--plus-que-parfait);}
.tense-node[data-tense="plus-que-parfait"].selected{background:rgba(211,84,0,.3);}
.tense-node[data-tense="present"]{background:rgba(46,204,113,.15);border-color:var(--present);color:var(--present);}
.tense-node[data-tense="present"].selected{background:rgba(46,204,113,.3);}
.tense-node[data-tense="futur-proche"]{background:rgba(52,152,219,.15);border-color:var(--futur-proche);color:var(--futur-proche);}
.tense-node[data-tense="futur-proche"].selected{background:rgba(52,152,219,.3);}
.tense-node[data-tense="futur-simple"]{background:rgba(155,89,182,.15);border-color:var(--futur-simple);color:var(--futur-simple);}
.tense-node[data-tense="futur-simple"].selected{background:rgba(155,89,182,.3);}
.tense-node[data-tense="conditionnel"]{background:rgba(142,68,173,.15);border-color:var(--conditionnel);color:var(--conditionnel);}
.tense-node[data-tense="conditionnel"].selected{background:rgba(142,68,173,.3);}

/* TENSE DETAIL */
.tense-detail{background:var(--card);border-radius:var(--radius);border:1px solid var(--border);padding:24px;margin-bottom:20px;animation:slideIn .3s ease;}
@keyframes slideIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.tense-detail h2{font-size:1.3rem;margin-bottom:4px;}
.tense-detail .tense-period{font-size:.85rem;color:var(--text2);margin-bottom:16px;}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.detail-box{background:var(--card2);border-radius:8px;padding:16px;border:1px solid var(--border);}
.detail-box h3{font-size:.9rem;color:var(--accent-light);margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px;}
.detail-box ul{list-style:none;font-size:.88rem;line-height:1.7;}
.detail-box li{padding:2px 0;}
.formation-rule{background:var(--card3);padding:10px 14px;border-radius:6px;font-size:.88rem;margin-bottom:8px;font-family:'Courier New',monospace;line-height:1.6;}
.formation-rule .stem{color:var(--gold);}
.formation-rule .ending{color:var(--accent-light);font-weight:700;}
.formation-rule .aux{color:var(--futur-proche);font-weight:600;}
.example-fr{font-weight:600;color:var(--text);}
.example-en{color:var(--text2);font-style:italic;font-size:.84rem;}
.trigger-word{display:inline-block;background:var(--card3);border:1px solid var(--border);padding:2px 8px;border-radius:4px;margin:2px;font-size:.82rem;}
.irregular-verb{font-weight:600;color:var(--gold);}

/* CONJUGATION TABLE */
.conj-section{margin-bottom:20px;}
.verb-selector{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;}
.verb-btn{padding:6px 16px;border-radius:6px;border:1px solid var(--border);background:var(--card);color:var(--text2);cursor:pointer;font-size:.84rem;transition:all .2s;}
.verb-btn:hover{border-color:var(--accent);color:var(--text);}
.verb-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);}
.conj-table-wrap{overflow-x:auto;}
.conj-table{width:100%;border-collapse:collapse;font-size:.84rem;background:var(--card);border-radius:var(--radius);overflow:hidden;}
.conj-table th,.conj-table td{padding:9px 12px;text-align:left;border:1px solid var(--border);}
.conj-table thead th{background:var(--card2);color:var(--text);font-weight:600;position:sticky;top:0;}
.conj-table thead th:first-child{min-width:80px;}
.conj-table tbody td:first-child{font-weight:600;color:var(--text2);white-space:nowrap;}
.conj-table tbody tr:hover{background:var(--card2);}
.conj-highlight{font-weight:600;}

/* QUIZ */
.quiz-container{background:var(--card);border-radius:var(--radius);border:1px solid var(--border);padding:24px;}
.quiz-score{display:flex;gap:16px;align-items:center;margin-bottom:16px;font-size:.9rem;}
.quiz-score span{color:var(--text2);}
.quiz-score .score-val{color:var(--gold);font-weight:700;font-size:1.1rem;}
.quiz-sentence{font-size:1.15rem;margin-bottom:6px;line-height:1.5;}
.quiz-sentence .blank{color:var(--gold);font-weight:700;border-bottom:2px dashed var(--gold);}
.quiz-english{color:var(--text2);font-size:.9rem;margin-bottom:16px;font-style:italic;}
.quiz-options{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.quiz-opt{padding:12px 16px;border-radius:8px;border:2px solid var(--border);background:var(--card2);color:var(--text);cursor:pointer;font-size:.9rem;transition:all .2s;text-align:center;}
.quiz-opt:hover{border-color:var(--accent);background:var(--card3);}
.quiz-opt.correct{border-color:var(--success);background:rgba(46,204,113,.15);color:var(--success);}
.quiz-opt.wrong{border-color:var(--error);background:rgba(231,76,60,.15);color:var(--error);}
.quiz-opt.disabled{pointer-events:none;opacity:.6;}
.quiz-feedback{padding:12px 16px;border-radius:8px;margin-bottom:14px;font-size:.88rem;line-height:1.5;display:none;}
.quiz-feedback.show{display:block;}
.quiz-feedback.correct-fb{background:rgba(46,204,113,.12);border:1px solid var(--success);color:var(--success);}
.quiz-feedback.wrong-fb{background:rgba(231,76,60,.12);border:1px solid var(--error);color:var(--error);}
.quiz-next{padding:10px 24px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer;font-size:.9rem;font-weight:600;display:none;}
.quiz-next:hover{opacity:.85;}
.quiz-next.show{display:inline-block;}
.quiz-progress{height:4px;background:var(--card3);border-radius:2px;margin-bottom:16px;overflow:hidden;}
.quiz-progress-fill{height:100%;background:var(--accent);transition:width .3s;border-radius:2px;}

/* INFO PANEL */
.info-section{display:flex;flex-direction:column;gap:16px;}
.info-card{background:var(--card);border-radius:var(--radius);border:1px solid var(--border);padding:20px;}
.info-card h2{font-size:1.1rem;color:var(--accent-light);margin-bottom:10px;}
.info-card p,.info-card li{font-size:.88rem;line-height:1.7;color:var(--text2);}
.info-card ul{list-style:disc;padding-left:20px;}
.info-card li{margin-bottom:4px;}
.comparison-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px;}
.comparison-box{background:var(--card2);border-radius:8px;padding:14px;border-left:3px solid;}
.comparison-box.pc-box{border-color:var(--passe-compose);}
.comparison-box.imp-box{border-color:var(--imparfait);}
.comparison-box h4{font-size:.88rem;margin-bottom:6px;}
.comparison-box p{font-size:.82rem;}

/* TIMELINE INDICATOR BAR */
.timeline-indicator{position:relative;height:12px;background:var(--card3);border-radius:6px;margin-top:16px;overflow:hidden;}
.timeline-indicator-fill{position:absolute;height:100%;border-radius:6px;transition:all .4s ease;}
.timeline-indicator-labels{display:flex;justify-content:space-between;font-size:.7rem;color:var(--text2);margin-top:4px;}

/* MINI CONJUGATION IN DETAIL */
.mini-conj{margin-top:12px;}
.mini-conj-title{font-size:.82rem;color:var(--accent-light);margin-bottom:6px;font-weight:600;}
.mini-conj-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;}
.mini-conj-cell{background:var(--card3);padding:4px 8px;border-radius:4px;font-size:.78rem;text-align:center;}
.mini-conj-cell .pronoun{color:var(--text2);font-size:.72rem;}
.mini-conj-cell .form{font-weight:600;}

/* ETRE VERBS LIST */
.etre-list{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px;}
.etre-verb{display:inline-block;background:var(--card3);border:1px solid var(--border);padding:2px 8px;border-radius:4px;font-size:.78rem;color:var(--futur-proche);}

/* QUIZ DIFFICULTY BADGE */
.quiz-difficulty{display:inline-block;padding:2px 8px;border-radius:10px;font-size:.72rem;font-weight:600;margin-left:8px;}
.quiz-difficulty.easy{background:rgba(46,204,113,.15);color:var(--success);}
.quiz-difficulty.medium{background:rgba(241,196,15,.15);color:var(--gold);}
.quiz-difficulty.hard{background:rgba(231,76,60,.15);color:var(--error);}

/* SCROLL HINT */
.scroll-hint{text-align:center;padding:8px;font-size:.78rem;color:var(--text2);opacity:.6;}

/* PULSE ANIMATION FOR UNSELECTED NODES */
@keyframes subtlePulse{0%{box-shadow:0 0 0 0 rgba(155,89,182,.3)}70%{box-shadow:0 0 0 6px rgba(155,89,182,0)}100%{box-shadow:0 0 0 0 rgba(155,89,182,0)}}
.tense-node:not(.selected){animation:subtlePulse 2.5s infinite;}
.tense-node.selected{animation:none;}

/* NO SELECTION PROMPT */
.no-selection{text-align:center;padding:30px 20px;color:var(--text2);font-size:.9rem;background:var(--card);border-radius:var(--radius);border:1px dashed var(--border);}
.no-selection span{display:block;font-size:1.4rem;margin-bottom:8px;}

/* TABLE CAPTION */
.conj-caption{font-size:.82rem;color:var(--text2);margin-top:10px;text-align:center;}

/* RESPONSIVE */
@media(max-width:768px){
  .detail-grid{grid-template-columns:1fr;}
  .quiz-options{grid-template-columns:1fr;}
  .comparison-row{grid-template-columns:1fr;}
  .sticky-header h1{font-size:1.3rem;}
  .tense-nodes{gap:6px;}
  .tense-node{min-width:90px;font-size:.72rem;padding:6px 8px;}
  .conj-table{font-size:.76rem;}
  .conj-table th,.conj-table td{padding:6px 8px;}
}
@media(max-width:480px){
  .app{padding:10px 8px 30px;}
  .tense-detail{padding:16px;}
  .tab-btn{padding:6px 12px;font-size:.78rem;}
}
</style>
</head>
<body>
<div class="sticky-header">
  <h1>Tense Timeline</h1>
  <p>Visual timeline of French verb tenses: when, how, and why</p>
</div>
<div class="app">
  <div class="tab-bar">
    <button class="tab-btn active" data-tab="timeline">Timeline</button>
    <button class="tab-btn" data-tab="conjugation">Conjugation Table</button>
    <button class="tab-btn" data-tab="quiz">Quiz Mode</button>
    <button class="tab-btn" data-tab="info">Tense Guide</button>
  </div>

  <!-- TIMELINE PANEL -->
  <div class="panel active" id="panel-timeline">
    <div style="background:var(--card);border-radius:var(--radius);border:1px solid var(--border);padding:14px 18px;margin-bottom:14px;">
      <p style="font-size:.88rem;color:var(--text2);line-height:1.5;">Click any tense on the timeline below to explore when it is used, how to form it, see example sentences, and discover key trigger words. The coloured bar shows where each tense sits on the past/present/future spectrum.</p>
    </div>
    <div class="timeline-section">
      <div class="timeline-container">
        <div class="time-labels">
          <span>Past</span>
          <span>Present</span>
          <span>Future</span>
        </div>
        <div class="timeline-track"><div class="timeline-zones"><div></div><div></div><div></div></div></div>
        <div class="tense-nodes" id="tenseNodes"></div>
      </div>
    </div>
    <div id="tenseDetail"></div>
  </div>

  <!-- CONJUGATION PANEL -->
  <div class="panel" id="panel-conjugation">
    <div class="conj-section">
      <p style="font-size:.88rem;color:var(--text2);margin-bottom:12px;">Select a verb to see its full conjugation across all seven tenses. These are the ten most important irregular verbs in French.</p>
      <div class="verb-selector" id="verbSelector"></div>
      <div id="verbMeaning" style="font-size:.88rem;color:var(--text2);margin-bottom:12px;"></div>
      <div class="conj-table-wrap">
        <table class="conj-table" id="conjTable">
          <thead id="conjHead"></thead>
          <tbody id="conjBody"></tbody>
        </table>
      </div>
      <div id="verbNotes" style="margin-top:14px;background:var(--card);border-radius:var(--radius);border:1px solid var(--border);padding:16px;"></div>
    </div>
  </div>

  <!-- QUIZ PANEL -->
  <div class="panel" id="panel-quiz">
    <div class="quiz-container">
      <div class="quiz-score">
        <span>Score: <span class="score-val" id="quizScore">0</span> / <span id="quizTotal">0</span></span>
        <button class="tab-btn" id="quizReset" style="margin-left:auto;">Reset Quiz</button>
      </div>
      <div class="quiz-progress"><div class="quiz-progress-fill" id="quizProgress"></div></div>
      <div class="quiz-sentence" id="quizSentence"></div>
      <div class="quiz-english" id="quizEnglish"></div>
      <div class="quiz-options" id="quizOptions"></div>
      <div class="quiz-feedback" id="quizFeedback"></div>
      <button class="quiz-next" id="quizNext">Next Question</button>
    </div>
  </div>

  <!-- INFO PANEL -->
  <div class="panel" id="panel-info">
    <div class="info-section" id="infoSection"></div>
  </div>
</div>

<script>
/* ==================== DATA ==================== */
const TENSES = {
  "passe-compose": {
    name: "Passe Compose",
    accent: "Pass\u00e9 Compos\u00e9",
    period: "Past (completed actions)",
    zone: "past",
    color: "var(--passe-compose)",
    usage: [
      "A completed, one-off action in the past",
      "A sequence of past events",
      "An action with a clear start/end",
      "Something that happened at a specific time"
    ],
    formation: {
      rule: "Subject + <span class='aux'>avoir/\u00eatre</span> (present) + <span class='ending'>past participle</span>",
      notes: "Use \u00eatre with 16 movement/state verbs (aller, venir, etc.) and all reflexives. With \u00eatre, the past participle agrees in gender/number."
    },
    examples: [
      {fr:"J'<b>ai mang\u00e9</b> une pomme.", en:"I ate an apple."},
      {fr:"Elle <b>est all\u00e9e</b> au cin\u00e9ma.", en:"She went to the cinema."},
      {fr:"Nous <b>avons fini</b> nos devoirs.", en:"We finished our homework."},
      {fr:"Ils <b>se sont lev\u00e9s</b> t\u00f4t.", en:"They got up early."}
    ],
    triggers: ["hier","la semaine derni\u00e8re","il y a (deux jours)","soudain","tout \u00e0 coup","d'abord","puis","ensuite","enfin"],
    irregulars: {
      "avoir":"eu","etre":"\u00e9t\u00e9","faire":"fait","prendre":"pris",
      "pouvoir":"pu","vouloir":"voulu","devoir":"d\u00fb","savoir":"su","venir":"venu"
    }
  },
  "imparfait": {
    name: "Imparfait",
    accent: "Imparfait",
    period: "Past (ongoing / habitual)",
    zone: "past",
    color: "var(--imparfait)",
    usage: [
      "Describing ongoing past situations or states",
      "Habitual or repeated past actions",
      "Setting the scene (weather, time, feelings)",
      "Background action interrupted by another event"
    ],
    formation: {
      rule: "<span class='stem'>Nous-stem</span> (present tense, drop -ons) + <span class='ending'>-ais, -ais, -ait, -ions, -iez, -aient</span>",
      notes: "Only one irregular stem: \u00eatre = \u00e9t- (j'\u00e9tais, tu \u00e9tais...). All other verbs follow the nous-stem rule."
    },
    examples: [
      {fr:"Il <b>faisait</b> beau.", en:"The weather was nice."},
      {fr:"Je <b>jouais</b> au foot chaque samedi.", en:"I used to play football every Saturday."},
      {fr:"Nous <b>habitions</b> \u00e0 Paris.", en:"We were living in Paris."},
      {fr:"Elle <b>lisait</b> quand le t\u00e9l\u00e9phone <b>a sonn\u00e9</b>.", en:"She was reading when the phone rang."}
    ],
    triggers: ["d'habitude","chaque jour/semaine","toujours","souvent","autrefois","quand j'\u00e9tais jeune","tous les jours","pendant que"],
    irregulars: {
      "etre":"\u00e9t- (j'\u00e9tais)"
    }
  },
  "plus-que-parfait": {
    name: "Plus-que-parfait",
    accent: "Plus-que-parfait",
    period: "Past (before another past action)",
    zone: "past",
    color: "var(--plus-que-parfait)",
    usage: [
      "An action completed before another past action",
      "The 'past of the past'",
      "Explaining a cause that came earlier",
      "Often paired with pass\u00e9 compos\u00e9 or imparfait"
    ],
    formation: {
      rule: "Subject + <span class='aux'>avoir/\u00eatre</span> (imparfait) + <span class='ending'>past participle</span>",
      notes: "Same past participle rules as pass\u00e9 compos\u00e9. Same \u00eatre verbs and agreement rules apply."
    },
    examples: [
      {fr:"J'<b>avais d\u00e9j\u00e0 mang\u00e9</b> quand il est arriv\u00e9.", en:"I had already eaten when he arrived."},
      {fr:"Elle <b>\u00e9tait partie</b> avant nous.", en:"She had left before us."},
      {fr:"Nous <b>avions fini</b> le travail.", en:"We had finished the work."}
    ],
    triggers: ["d\u00e9j\u00e0","avant","apr\u00e8s que","quand (+ another past)","parce que (+ earlier cause)"],
    irregulars: {
      "Same past participles as pass\u00e9 compos\u00e9": ""
    }
  },
  "present": {
    name: "Present",
    accent: "Pr\u00e9sent",
    period: "Now / general truths",
    zone: "present",
    color: "var(--present)",
    usage: [
      "What is happening right now",
      "General truths and facts",
      "Habitual present actions",
      "Near future (with context)"
    ],
    formation: {
      rule: "Remove -er/-ir/-re ending, add: <br><span class='ending'>-er: -e, -es, -e, -ons, -ez, -ent</span><br><span class='ending'>-ir: -is, -is, -it, -issons, -issez, -issent</span><br><span class='ending'>-re: -s, -s, -, -ons, -ez, -ent</span>",
      notes: "Many common verbs are irregular in the present tense. Learn the most frequent ones by heart."
    },
    examples: [
      {fr:"Je <b>parle</b> fran\u00e7ais.", en:"I speak French."},
      {fr:"Nous <b>finissons</b> \u00e0 trois heures.", en:"We finish at three o'clock."},
      {fr:"Il <b>fait</b> froid aujourd'hui.", en:"It is cold today."},
      {fr:"Elles <b>vont</b> au coll\u00e8ge.", en:"They go to school."}
    ],
    triggers: ["maintenant","aujourd'hui","en ce moment","d'habitude","normalement","chaque jour","toujours","g\u00e9n\u00e9ralement"],
    irregulars: {
      "avoir":"ai, as, a, avons, avez, ont",
      "etre":"suis, es, est, sommes, \u00eates, sont",
      "aller":"vais, vas, va, allons, allez, vont",
      "faire":"fais, fais, fait, faisons, faites, font"
    }
  },
  "futur-proche": {
    name: "Futur Proche",
    accent: "Futur Proche",
    period: "Near future (about to happen)",
    zone: "future",
    color: "var(--futur-proche)",
    usage: [
      "Something about to happen soon",
      "Plans and intentions",
      "Predictions based on current evidence",
      "The most common way to express future in speech"
    ],
    formation: {
      rule: "<span class='aux'>Aller</span> (present) + <span class='ending'>infinitive</span>",
      notes: "The simplest future tense. Just conjugate aller in the present and add the full infinitive. Similar to English 'going to'."
    },
    examples: [
      {fr:"Je <b>vais manger</b>.", en:"I am going to eat."},
      {fr:"Il <b>va pleuvoir</b>.", en:"It is going to rain."},
      {fr:"Nous <b>allons partir</b> demain.", en:"We are going to leave tomorrow."},
      {fr:"Elles <b>vont faire</b> du shopping.", en:"They are going to go shopping."}
    ],
    triggers: ["bient\u00f4t","demain","ce soir","la semaine prochaine","dans cinq minutes","tout \u00e0 l'heure"],
    irregulars: {
      "No irregular forms": "Just conjugate aller correctly"
    }
  },
  "futur-simple": {
    name: "Futur Simple",
    accent: "Futur Simple",
    period: "Future (will happen)",
    zone: "future",
    color: "var(--futur-simple)",
    usage: [
      "Events that will happen in the future",
      "Formal predictions and promises",
      "Future plans in writing",
      "Hypothetical results (si + present, ... futur)"
    ],
    formation: {
      rule: "<span class='stem'>Infinitive</span> (or irregular stem) + <span class='ending'>-ai, -as, -a, -ons, -ez, -ont</span>",
      notes: "For -re verbs, drop the final -e before adding endings. Many common verbs have irregular stems but use the same endings."
    },
    examples: [
      {fr:"Je <b>parlerai</b> fran\u00e7ais.", en:"I will speak French."},
      {fr:"Nous <b>finirons</b> demain.", en:"We will finish tomorrow."},
      {fr:"Si tu \u00e9tudies, tu <b>r\u00e9ussiras</b>.", en:"If you study, you will succeed."},
      {fr:"Ils <b>viendront</b> samedi.", en:"They will come on Saturday."}
    ],
    triggers: ["demain","l'ann\u00e9e prochaine","dans l'avenir","un jour","quand (+ future meaning)","si (+ present tense)"],
    irregulars: {
      "avoir":"aur-","etre":"ser-","aller":"ir-","faire":"fer-",
      "pouvoir":"pourr-","vouloir":"voudr-","devoir":"devr-","savoir":"saur-","venir":"viendr-","prendre":"prendr-"
    }
  },
  "conditionnel": {
    name: "Conditionnel",
    accent: "Conditionnel",
    period: "Hypothetical / would",
    zone: "future",
    color: "var(--conditionnel)",
    usage: [
      "Hypothetical situations (would)",
      "Polite requests",
      "Wishes and desires",
      "Si + imparfait, ... conditionnel"
    ],
    formation: {
      rule: "<span class='stem'>Futur simple stem</span> + <span class='ending'>-ais, -ais, -ait, -ions, -iez, -aient</span>",
      notes: "Same stems as the futur simple, but with imparfait endings. If you know both, the conditionnel is easy."
    },
    examples: [
      {fr:"Je <b>voudrais</b> un caf\u00e9.", en:"I would like a coffee."},
      {fr:"Si j'avais de l'argent, j'<b>ach\u00e8terais</b> une voiture.", en:"If I had money, I would buy a car."},
      {fr:"Nous <b>irions</b> en France.", en:"We would go to France."},
      {fr:"<b>Pourriez</b>-vous m'aider?", en:"Could you help me?"}
    ],
    triggers: ["si (+ imparfait)","je voudrais","il/elle aimerait","on pourrait","\u00e0 ta place"],
    irregulars: {
      "Same stems as futur simple": "avoir=aur-, etre=ser-, aller=ir-, faire=fer-, etc."
    }
  }
};

const VERBS = {
  avoir: {
    present: ["ai","as","a","avons","avez","ont"],
    "passe-compose": ["ai eu","as eu","a eu","avons eu","avez eu","ont eu"],
    imparfait: ["avais","avais","avait","avions","aviez","avaient"],
    "plus-que-parfait": ["avais eu","avais eu","avait eu","avions eu","aviez eu","avaient eu"],
    "futur-proche": ["vais avoir","vas avoir","va avoir","allons avoir","allez avoir","vont avoir"],
    "futur-simple": ["aurai","auras","aura","aurons","aurez","auront"],
    conditionnel: ["aurais","aurais","aurait","aurions","auriez","auraient"]
  },
  etre: {
    present: ["suis","es","est","sommes","\u00eates","sont"],
    "passe-compose": ["ai \u00e9t\u00e9","as \u00e9t\u00e9","a \u00e9t\u00e9","avons \u00e9t\u00e9","avez \u00e9t\u00e9","ont \u00e9t\u00e9"],
    imparfait: ["\u00e9tais","\u00e9tais","\u00e9tait","\u00e9tions","\u00e9tiez","\u00e9taient"],
    "plus-que-parfait": ["avais \u00e9t\u00e9","avais \u00e9t\u00e9","avait \u00e9t\u00e9","avions \u00e9t\u00e9","aviez \u00e9t\u00e9","avaient \u00e9t\u00e9"],
    "futur-proche": ["vais \u00eatre","vas \u00eatre","va \u00eatre","allons \u00eatre","allez \u00eatre","vont \u00eatre"],
    "futur-simple": ["serai","seras","sera","serons","serez","seront"],
    conditionnel: ["serais","serais","serait","serions","seriez","seraient"]
  },
  aller: {
    present: ["vais","vas","va","allons","allez","vont"],
    "passe-compose": ["suis all\u00e9(e)","es all\u00e9(e)","est all\u00e9(e)","sommes all\u00e9(e)s","\u00eates all\u00e9(e)s","sont all\u00e9(e)s"],
    imparfait: ["allais","allais","allait","allions","alliez","allaient"],
    "plus-que-parfait": ["\u00e9tais all\u00e9(e)","\u00e9tais all\u00e9(e)","\u00e9tait all\u00e9(e)","\u00e9tions all\u00e9(e)s","\u00e9tiez all\u00e9(e)s","\u00e9taient all\u00e9(e)s"],
    "futur-proche": ["vais aller","vas aller","va aller","allons aller","allez aller","vont aller"],
    "futur-simple": ["irai","iras","ira","irons","irez","iront"],
    conditionnel: ["irais","irais","irait","irions","iriez","iraient"]
  },
  faire: {
    present: ["fais","fais","fait","faisons","faites","font"],
    "passe-compose": ["ai fait","as fait","a fait","avons fait","avez fait","ont fait"],
    imparfait: ["faisais","faisais","faisait","faisions","faisiez","faisaient"],
    "plus-que-parfait": ["avais fait","avais fait","avait fait","avions fait","aviez fait","avaient fait"],
    "futur-proche": ["vais faire","vas faire","va faire","allons faire","allez faire","vont faire"],
    "futur-simple": ["ferai","feras","fera","ferons","ferez","feront"],
    conditionnel: ["ferais","ferais","ferait","ferions","feriez","feraient"]
  },
  pouvoir: {
    present: ["peux","peux","peut","pouvons","pouvez","peuvent"],
    "passe-compose": ["ai pu","as pu","a pu","avons pu","avez pu","ont pu"],
    imparfait: ["pouvais","pouvais","pouvait","pouvions","pouviez","pouvaient"],
    "plus-que-parfait": ["avais pu","avais pu","avait pu","avions pu","aviez pu","avaient pu"],
    "futur-proche": ["vais pouvoir","vas pouvoir","va pouvoir","allons pouvoir","allez pouvoir","vont pouvoir"],
    "futur-simple": ["pourrai","pourras","pourra","pourrons","pourrez","pourront"],
    conditionnel: ["pourrais","pourrais","pourrait","pourrions","pourriez","pourraient"]
  },
  vouloir: {
    present: ["veux","veux","veut","voulons","voulez","veulent"],
    "passe-compose": ["ai voulu","as voulu","a voulu","avons voulu","avez voulu","ont voulu"],
    imparfait: ["voulais","voulais","voulait","voulions","vouliez","voulaient"],
    "plus-que-parfait": ["avais voulu","avais voulu","avait voulu","avions voulu","aviez voulu","avaient voulu"],
    "futur-proche": ["vais vouloir","vas vouloir","va vouloir","allons vouloir","allez vouloir","vont vouloir"],
    "futur-simple": ["voudrai","voudras","voudra","voudrons","voudrez","voudront"],
    conditionnel: ["voudrais","voudrais","voudrait","voudrions","voudriez","voudraient"]
  },
  devoir: {
    present: ["dois","dois","doit","devons","devez","doivent"],
    "passe-compose": ["ai d\u00fb","as d\u00fb","a d\u00fb","avons d\u00fb","avez d\u00fb","ont d\u00fb"],
    imparfait: ["devais","devais","devait","devions","deviez","devaient"],
    "plus-que-parfait": ["avais d\u00fb","avais d\u00fb","avait d\u00fb","avions d\u00fb","aviez d\u00fb","avaient d\u00fb"],
    "futur-proche": ["vais devoir","vas devoir","va devoir","allons devoir","allez devoir","vont devoir"],
    "futur-simple": ["devrai","devras","devra","devrons","devrez","devront"],
    conditionnel: ["devrais","devrais","devrait","devrions","devriez","devraient"]
  },
  savoir: {
    present: ["sais","sais","sait","savons","savez","savent"],
    "passe-compose": ["ai su","as su","a su","avons su","avez su","ont su"],
    imparfait: ["savais","savais","savait","savions","saviez","savaient"],
    "plus-que-parfait": ["avais su","avais su","avait su","avions su","aviez su","avaient su"],
    "futur-proche": ["vais savoir","vas savoir","va savoir","allons savoir","allez savoir","vont savoir"],
    "futur-simple": ["saurai","sauras","saura","saurons","saurez","sauront"],
    conditionnel: ["saurais","saurais","saurait","saurions","sauriez","sauraient"]
  },
  venir: {
    present: ["viens","viens","vient","venons","venez","viennent"],
    "passe-compose": ["suis venu(e)","es venu(e)","est venu(e)","sommes venu(e)s","\u00eates venu(e)s","sont venu(e)s"],
    imparfait: ["venais","venais","venait","venions","veniez","venaient"],
    "plus-que-parfait": ["\u00e9tais venu(e)","\u00e9tais venu(e)","\u00e9tait venu(e)","\u00e9tions venu(e)s","\u00e9tiez venu(e)s","\u00e9taient venu(e)s"],
    "futur-proche": ["vais venir","vas venir","va venir","allons venir","allez venir","vont venir"],
    "futur-simple": ["viendrai","viendras","viendra","viendrons","viendrez","viendront"],
    conditionnel: ["viendrais","viendrais","viendrait","viendrions","viendriez","viendraient"]
  },
  prendre: {
    present: ["prends","prends","prend","prenons","prenez","prennent"],
    "passe-compose": ["ai pris","as pris","a pris","avons pris","avez pris","ont pris"],
    imparfait: ["prenais","prenais","prenait","prenions","preniez","prenaient"],
    "plus-que-parfait": ["avais pris","avais pris","avait pris","avions pris","aviez pris","avaient pris"],
    "futur-proche": ["vais prendre","vas prendre","va prendre","allons prendre","allez prendre","vont prendre"],
    "futur-simple": ["prendrai","prendras","prendra","prendrons","prendrez","prendront"],
    conditionnel: ["prendrais","prendrais","prendrait","prendrions","prendriez","prendraient"]
  }
};

const VERB_INFO = {
  avoir: {meaning:"to have", group:"3rd (irregular)", notes:"The most common auxiliary verb. Used to form compound tenses for most verbs. Also used in many expressions: avoir faim (to be hungry), avoir peur (to be afraid), avoir besoin de (to need)."},
  etre: {meaning:"to be", group:"3rd (irregular)", notes:"The second auxiliary verb. Used with 16 movement/state verbs and all reflexives. Key expressions: \u00eatre en train de (to be in the process of), \u00eatre d'accord (to agree)."},
  aller: {meaning:"to go", group:"3rd (irregular)", notes:"Essential for futur proche (aller + infinitive). An \u00eatre verb in pass\u00e9 compos\u00e9. Common: aller bien (to be well), s'en aller (to go away)."},
  faire: {meaning:"to do / to make", group:"3rd (irregular)", notes:"Extremely versatile. Used for weather (il fait beau), sport (faire du sport), and many fixed expressions: faire attention (to pay attention), faire la cuisine (to cook)."},
  pouvoir: {meaning:"to be able to / can", group:"3rd (irregular)", notes:"Modal verb followed by an infinitive. Je peux partir (I can leave). Polite form: pourrais (could). Never takes a direct object."},
  vouloir: {meaning:"to want", group:"3rd (irregular)", notes:"Modal verb followed by an infinitive. Je veux manger (I want to eat). Polite: je voudrais (I would like). Key for exam role-plays and transactions."},
  devoir: {meaning:"to have to / must", group:"3rd (irregular)", notes:"Modal verb expressing obligation. Je dois partir (I must leave). Conditionnel: je devrais (I should). Can also mean 'to owe'."},
  savoir: {meaning:"to know (a fact / how to)", group:"3rd (irregular)", notes:"Knowing facts or skills: Je sais nager (I know how to swim). Do not confuse with conna\u00eetre (to know/be familiar with a person or place)."},
  venir: {meaning:"to come", group:"3rd (irregular)", notes:"An \u00eatre verb in pass\u00e9 compos\u00e9. Venir de + infinitive = to have just done something (recent past). Compounds: devenir (to become), revenir (to come back)."},
  prendre: {meaning:"to take", group:"3rd (irregular)", notes:"Irregular in present (prennent) and past participle (pris). Compounds: apprendre (to learn), comprendre (to understand), surprendre (to surprise)."}
};

const PRONOUNS = ["je","tu","il/elle/on","nous","vous","ils/elles"];
const TENSE_ORDER = ["passe-compose","imparfait","plus-que-parfait","present","futur-proche","futur-simple","conditionnel"];
const TENSE_LABELS = {
  "passe-compose":"Pass\u00e9 Compos\u00e9","imparfait":"Imparfait","plus-que-parfait":"Plus-que-parfait",
  "present":"Pr\u00e9sent","futur-proche":"Futur Proche","futur-simple":"Futur Simple","conditionnel":"Conditionnel"
};

const QUIZ_QUESTIONS = [
  {sentence:"Hier, j'___ au cin\u00e9ma.",en:"Yesterday, I went to the cinema.",answer:"passe-compose",explanation:"Hier (yesterday) signals a completed past action, so use the pass\u00e9 compos\u00e9."},
  {sentence:"Quand j'\u00e9tais petit, je ___ au foot tous les jours.",en:"When I was little, I used to play football every day.",answer:"imparfait",explanation:"'Quand j'\u00e9tais petit' and 'tous les jours' signal a habitual past action: imparfait."},
  {sentence:"Demain, nous ___ en France.",en:"Tomorrow, we will go to France.",answer:"futur-simple",explanation:"Demain (tomorrow) indicates the future. In writing, futur simple is the standard choice."},
  {sentence:"En ce moment, elle ___ un livre.",en:"Right now, she is reading a book.",answer:"present",explanation:"'En ce moment' (right now) clearly indicates the present tense."},
  {sentence:"Ce soir, je ___ manger une pizza.",en:"Tonight, I am going to eat a pizza.",answer:"futur-proche",explanation:"A near-future plan best expressed with futur proche (aller + infinitive)."},
  {sentence:"Si j'avais plus de temps, je ___ plus.",en:"If I had more time, I would travel more.",answer:"conditionnel",explanation:"'Si + imparfait' triggers the conditionnel for the hypothetical result."},
  {sentence:"Il ___ d\u00e9j\u00e0 parti quand je suis arriv\u00e9.",en:"He had already left when I arrived.",answer:"plus-que-parfait",explanation:"An action completed before another past action requires the plus-que-parfait."},
  {sentence:"D'habitude, je ___ du th\u00e9 le matin.",en:"Usually, I drink tea in the morning.",answer:"present",explanation:"'D'habitude' (usually) with a current habit uses the present tense."},
  {sentence:"Il ___ beau et les oiseaux chantaient.",en:"The weather was nice and the birds were singing.",answer:"imparfait",explanation:"Setting a scene and describing ongoing background: imparfait."},
  {sentence:"J'___ fini mes devoirs avant le d\u00eener.",en:"I had finished my homework before dinner.",answer:"plus-que-parfait",explanation:"An action completed before another past event: plus-que-parfait."},
  {sentence:"L'ann\u00e9e prochaine, ils ___ \u00e0 l'universit\u00e9.",en:"Next year, they will go to university.",answer:"futur-simple",explanation:"'L'ann\u00e9e prochaine' signals the future; futur simple for a formal/written context."},
  {sentence:"Je ___ un caf\u00e9, s'il vous pla\u00eet.",en:"I would like a coffee, please.",answer:"conditionnel",explanation:"Polite requests use the conditionnel (je voudrais)."},
  {sentence:"Soudain, le t\u00e9l\u00e9phone ___.",en:"Suddenly, the phone rang.",answer:"passe-compose",explanation:"'Soudain' signals a sudden, completed action in the past: pass\u00e9 compos\u00e9."},
  {sentence:"Bient\u00f4t, nous ___ d\u00e9m\u00e9nager.",en:"Soon, we are going to move.",answer:"futur-proche",explanation:"'Bient\u00f4t' (soon) with an imminent plan: futur proche."},
  {sentence:"Autrefois, on ___ sans Internet.",en:"In the old days, people lived without the Internet.",answer:"imparfait",explanation:"'Autrefois' (in the old days) signals a habitual past state: imparfait.",difficulty:"easy"},
  {sentence:"Si nous avions le temps, nous ___ au mus\u00e9e.",en:"If we had the time, we would go to the museum.",answer:"conditionnel",explanation:"'Si + imparfait' triggers the conditionnel for the hypothetical result.",difficulty:"medium"},
  {sentence:"Elle ___ d\u00e9j\u00e0 mang\u00e9 quand nous sommes arriv\u00e9s.",en:"She had already eaten when we arrived.",answer:"plus-que-parfait",explanation:"An action completed before another past event: plus-que-parfait.",difficulty:"hard"},
  {sentence:"Chaque \u00e9t\u00e9, nous ___ en Espagne.",en:"Every summer, we used to go to Spain.",answer:"imparfait",explanation:"'Chaque \u00e9t\u00e9' (every summer) signals a repeated past habit: imparfait.",difficulty:"easy"},
  {sentence:"Dans cinq minutes, le cours ___ commencer.",en:"In five minutes, the lesson is going to start.",answer:"futur-proche",explanation:"'Dans cinq minutes' signals an imminent action: futur proche.",difficulty:"easy"},
  {sentence:"Quand j'\u00e9tais petit, je ___ peur du noir.",en:"When I was little, I was afraid of the dark.",answer:"imparfait",explanation:"'Quand j'\u00e9tais petit' describes an ongoing past state: imparfait.",difficulty:"easy"},
  {sentence:"Un jour, je ___ le tour du monde.",en:"One day, I will travel around the world.",answer:"futur-simple",explanation:"'Un jour' with a future ambition calls for the futur simple.",difficulty:"medium"},
  {sentence:"Il ___ beau, alors j'ai d\u00e9cid\u00e9 de sortir.",en:"The weather was nice, so I decided to go out.",answer:"imparfait",explanation:"Background description (weather was nice) uses imparfait; the decision uses pass\u00e9 compos\u00e9.",difficulty:"medium"},
  {sentence:"___ -vous m'aider, s'il vous pla\u00eet?",en:"Could you help me, please?",answer:"conditionnel",explanation:"A polite request uses the conditionnel (pourriez-vous).",difficulty:"medium"},
  {sentence:"Tout \u00e0 coup, il ___ \u00e0 pleuvoir.",en:"All of a sudden, it started to rain.",answer:"passe-compose",explanation:"'Tout \u00e0 coup' signals a sudden completed event: pass\u00e9 compos\u00e9.",difficulty:"easy"}
];

/* ==================== STATE ==================== */
let selectedTense = null;
let selectedVerb = "avoir";
let quizState = {score:0, total:0, current:0, questions:[], answered:false};

/* ==================== INIT ==================== */
document.addEventListener("DOMContentLoaded", () => {
  renderTenseNodes();
  renderNoSelection();
  renderVerbSelector();
  renderConjTable();
  renderInfoPanel();
  initQuiz();
  setupTabs();
});

/* ==================== TABS ==================== */
function setupTabs() {
  document.querySelectorAll(".tab-btn[data-tab]").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tab-btn[data-tab]").forEach(b => b.classList.remove("active"));
      document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById("panel-" + btn.dataset.tab).classList.add("active");
    });
  });
}

/* ==================== TIMELINE ==================== */
function renderTenseNodes() {
  const container = document.getElementById("tenseNodes");
  container.innerHTML = "";
  TENSE_ORDER.forEach(key => {
    const t = TENSES[key];
    const node = document.createElement("div");
    node.className = "tense-node";
    node.dataset.tense = key;
    node.textContent = t.accent;
    node.addEventListener("click", () => selectTense(key));
    container.appendChild(node);
  });
}

function renderNoSelection() {
  document.getElementById("tenseDetail").innerHTML = `
    <div class="no-selection">
      <span>&#8593;</span>
      Click a tense above to explore its usage, formation, examples, and trigger words.
    </div>`;
}

function selectTense(key) {
  selectedTense = key;
  document.querySelectorAll(".tense-node").forEach(n => n.classList.toggle("selected", n.dataset.tense === key));
  renderTenseDetail(key);
}

function renderTenseDetail(key) {
  const t = TENSES[key];
  const el = document.getElementById("tenseDetail");
  const triggersHTML = t.triggers.map(w => `<span class="trigger-word">${w}</span>`).join(" ");
  let irregHTML = "";
  for (const [v, form] of Object.entries(t.irregulars)) {
    irregHTML += `<li><span class="irregular-verb">${v}</span>${form ? ": " + form : ""}</li>`;
  }
  const exHTML = t.examples.map(e => `<li><span class="example-fr">${e.fr}</span><br><span class="example-en">${e.en}</span></li>`).join("");

  // Timeline indicator positioning
  const zoneMap = {past:{left:"0%",width:"38%"},present:{left:"38%",width:"24%"},future:{left:"62%",width:"38%"}};
  const zone = zoneMap[t.zone];

  // Mini conjugation for "faire" in this tense
  const miniVerb = VERBS.faire[key];
  const miniHTML = PRONOUNS.map((p,i) => `<div class="mini-conj-cell"><span class="pronoun">${p}</span><br><span class="form" style="color:${t.color}">${miniVerb[i]}</span></div>`).join("");

  el.innerHTML = `
    <div class="tense-detail" style="border-left:4px solid ${t.color}">
      <h2 style="color:${t.color}">${t.accent}</h2>
      <div class="tense-period">${t.period}</div>
      <div class="timeline-indicator">
        <div class="timeline-indicator-fill" style="left:${zone.left};width:${zone.width};background:${t.color};opacity:.6"></div>
      </div>
      <div class="timeline-indicator-labels">
        <span>Past</span><span>Present</span><span>Future</span>
      </div>
      <div class="detail-grid" style="margin-top:14px">
        <div class="detail-box">
          <h3>When to use</h3>
          <ul>${t.usage.map(u => "<li>" + u + "</li>").join("")}</ul>
        </div>
        <div class="detail-box">
          <h3>Formation</h3>
          <div class="formation-rule">${t.formation.rule}</div>
          <p style="font-size:.84rem;color:var(--text2);line-height:1.5">${t.formation.notes}</p>
          <div class="mini-conj">
            <div class="mini-conj-title">Example: faire (to do/make)</div>
            <div class="mini-conj-grid">${miniHTML}</div>
          </div>
        </div>
        <div class="detail-box">
          <h3>Examples</h3>
          <ul>${exHTML}</ul>
        </div>
        <div class="detail-box">
          <h3>Trigger words</h3>
          <div style="margin-bottom:10px">${triggersHTML}</div>
          <h3 style="margin-top:8px">Key irregular verbs</h3>
          <ul>${irregHTML}</ul>
        </div>
      </div>
    </div>`;
}

/* ==================== CONJUGATION TABLE ==================== */
function renderVerbSelector() {
  const container = document.getElementById("verbSelector");
  container.innerHTML = "";
  Object.keys(VERBS).forEach(v => {
    const btn = document.createElement("button");
    btn.className = "verb-btn" + (v === selectedVerb ? " active" : "");
    btn.textContent = v;
    btn.addEventListener("click", () => {
      selectedVerb = v;
      document.querySelectorAll(".verb-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderConjTable();
    });
    container.appendChild(btn);
  });
}

function renderConjTable() {
  const verb = VERBS[selectedVerb];
  const info = VERB_INFO[selectedVerb];
  const headRow = "<tr><th>Pronoun</th>" + TENSE_ORDER.map(k => `<th style="color:${TENSES[k].color}">${TENSE_LABELS[k]}</th>`).join("") + "</tr>";
  document.getElementById("conjHead").innerHTML = headRow;

  document.getElementById("verbMeaning").innerHTML = `<b style="color:var(--text)">${selectedVerb}</b> = ${info.meaning} (${info.group})`;

  let bodyHTML = "";
  PRONOUNS.forEach((p, i) => {
    bodyHTML += "<tr><td>" + p + "</td>";
    TENSE_ORDER.forEach(k => {
      bodyHTML += `<td class="conj-highlight" style="color:${TENSES[k].color}">${verb[k][i]}</td>`;
    });
    bodyHTML += "</tr>";
  });
  document.getElementById("conjBody").innerHTML = bodyHTML;

  document.getElementById("verbNotes").innerHTML = `
    <h3 style="font-size:.9rem;color:var(--accent-light);margin-bottom:6px;">Notes on ${selectedVerb}</h3>
    <p style="font-size:.86rem;color:var(--text2);line-height:1.6">${info.notes}</p>`;
}

/* ==================== QUIZ ==================== */
function initQuiz() {
  quizState = {score:0, total:0, current:0, questions: shuffle([...QUIZ_QUESTIONS]).slice(0,10), answered:false};
  renderQuizQuestion();
  document.getElementById("quizScore").textContent = "0";
  document.getElementById("quizTotal").textContent = "0";
  document.getElementById("quizNext").addEventListener("click", nextQuizQuestion);
  document.getElementById("quizReset").addEventListener("click", initQuiz);
}

function renderQuizQuestion() {
  const q = quizState.questions[quizState.current];
  if (!q) { showQuizEnd(); return; }
  quizState.answered = false;
  const qNum = `<span style="color:var(--text2);font-size:.82rem">Question ${quizState.current + 1} of ${quizState.questions.length}</span>`;
  const diffLabel = q.difficulty || "medium";
  const diffBadge = `<span class="quiz-difficulty ${diffLabel}">${diffLabel}</span>`;
  document.getElementById("quizSentence").innerHTML = qNum + diffBadge + "<br>" + q.sentence.replace("___", '<span class="blank">______</span>');
  document.getElementById("quizEnglish").textContent = q.en;
  document.getElementById("quizFeedback").className = "quiz-feedback";
  document.getElementById("quizFeedback").textContent = "";
  document.getElementById("quizNext").className = "quiz-next";
  document.getElementById("quizProgress").style.width = ((quizState.current / quizState.questions.length) * 100) + "%";

  const options = generateOptions(q.answer);
  const container = document.getElementById("quizOptions");
  container.innerHTML = "";
  options.forEach(opt => {
    const btn = document.createElement("div");
    btn.className = "quiz-opt";
    btn.textContent = TENSE_LABELS[opt];
    btn.addEventListener("click", () => checkQuizAnswer(opt, q.answer, q.explanation, btn));
    container.appendChild(btn);
  });
}

function generateOptions(correct) {
  const others = TENSE_ORDER.filter(t => t !== correct);
  const shuffled = shuffle(others).slice(0, 3);
  shuffled.push(correct);
  return shuffle(shuffled);
}

function checkQuizAnswer(chosen, correct, explanation, btn) {
  if (quizState.answered) return;
  quizState.answered = true;
  quizState.total++;
  const fb = document.getElementById("quizFeedback");

  document.querySelectorAll(".quiz-opt").forEach(o => o.classList.add("disabled"));

  if (chosen === correct) {
    quizState.score++;
    btn.classList.add("correct");
    fb.className = "quiz-feedback show correct-fb";
    fb.textContent = "Correct! " + explanation;
  } else {
    btn.classList.add("wrong");
    document.querySelectorAll(".quiz-opt").forEach(o => {
      if (o.textContent === TENSE_LABELS[correct]) o.classList.add("correct");
    });
    fb.className = "quiz-feedback show wrong-fb";
    fb.textContent = "Not quite. The answer is " + TENSE_LABELS[correct] + ". " + explanation;
  }
  document.getElementById("quizScore").textContent = quizState.score;
  document.getElementById("quizTotal").textContent = quizState.total;
  document.getElementById("quizNext").className = "quiz-next show";
}

function nextQuizQuestion() {
  quizState.current++;
  if (quizState.current >= quizState.questions.length) {
    showQuizEnd();
  } else {
    renderQuizQuestion();
  }
}

function showQuizEnd() {
  const pct = Math.round((quizState.score / quizState.questions.length) * 100);
  document.getElementById("quizSentence").innerHTML = `Quiz complete! You scored <b>${quizState.score}/${quizState.questions.length}</b> (${pct}%)`;
  document.getElementById("quizEnglish").textContent = pct >= 80 ? "Excellent work!" : pct >= 50 ? "Good effort, keep practising!" : "Keep revising the tenses and try again.";
  document.getElementById("quizOptions").innerHTML = "";
  document.getElementById("quizFeedback").className = "quiz-feedback";
  document.getElementById("quizNext").className = "quiz-next";
  document.getElementById("quizProgress").style.width = "100%";
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* ==================== INFO PANEL ==================== */
function renderInfoPanel() {
  document.getElementById("infoSection").innerHTML = `
    <div class="info-card">
      <h2>Why Do Tenses Matter?</h2>
      <p>Tenses tell us <b>when</b> something happens. In French, choosing the right tense is essential for clear communication. Using the wrong tense can change the meaning of a sentence entirely. At GCSE, demonstrating control of multiple tenses is one of the most effective ways to improve your writing and speaking marks.</p>
      <ul>
        <li><b>Past tenses</b> let you narrate events and describe experiences.</li>
        <li><b>Present tense</b> covers current habits, facts, and descriptions.</li>
        <li><b>Future tenses</b> express plans, predictions, and ambitions.</li>
        <li><b>Conditionnel</b> adds sophistication through hypothetical scenarios and politeness.</li>
      </ul>
      <p style="margin-top:8px">Aim to use at least <b>three different tenses</b> in every extended piece of writing.</p>
    </div>

    <div class="info-card">
      <h2>Pass\u00e9 Compos\u00e9 vs Imparfait: The Key Distinction</h2>
      <p>This is one of the trickiest choices in French. Both are past tenses, but they serve very different purposes.</p>
      <div class="comparison-row">
        <div class="comparison-box pc-box">
          <h4 style="color:var(--passe-compose)">Pass\u00e9 Compos\u00e9</h4>
          <p>Completed, one-off actions. Something that happened once, at a specific moment, with a clear beginning and end.</p>
          <p style="margin-top:6px"><b>Think:</b> What happened? What did someone do?</p>
          <p style="margin-top:4px;font-style:italic">J'ai mang\u00e9 une pizza. (I ate a pizza.)</p>
        </div>
        <div class="comparison-box imp-box">
          <h4 style="color:var(--imparfait)">Imparfait</h4>
          <p>Ongoing states, repeated habits, scene-setting. No definite beginning or end. Describes how things were.</p>
          <p style="margin-top:6px"><b>Think:</b> What was happening? What used to happen?</p>
          <p style="margin-top:4px;font-style:italic">Je mangeais une pizza (quand...). (I was eating a pizza when...)</p>
        </div>
      </div>
      <p style="margin-top:12px"><b>Together:</b> The imparfait sets the scene; the pass\u00e9 compos\u00e9 interrupts it with an event.<br>
      <i>Je regardais la t\u00e9l\u00e9 (imparfait) quand le t\u00e9l\u00e9phone a sonn\u00e9 (pass\u00e9 compos\u00e9).</i><br>
      I was watching TV when the phone rang.</p>
    </div>

    <div class="info-card">
      <h2>Tense Agreement and Other Rules</h2>
      <ul>
        <li><b>\u00catre verbs in pass\u00e9 compos\u00e9:</b> The past participle must agree with the subject in gender and number. Elle est all\u00e9<b>e</b>; Ils sont parti<b>s</b>.</li>
        <li><b>Reflexive verbs:</b> Always use \u00eatre as the auxiliary. Agreement applies if the reflexive pronoun is the direct object.</li>
        <li><b>Si clauses:</b> Si + pr\u00e9sent = futur simple. Si + imparfait = conditionnel. Si + plus-que-parfait = conditionnel pass\u00e9 (beyond GCSE).</li>
        <li><b>Negation:</b> In compound tenses, ne...pas wraps around the auxiliary: Je <b>n'</b>ai <b>pas</b> mang\u00e9. In futur proche: Je <b>ne</b> vais <b>pas</b> manger.</li>
        <li><b>Question formation:</b> Works the same in all tenses. Inversion swaps subject and auxiliary in compound tenses: <b>As-tu</b> mang\u00e9?</li>
      </ul>
    </div>

    <div class="info-card">
      <h2>Quick Reference: Choosing the Right Tense</h2>
      <ul>
        <li>Talking about what you <b>did</b> (once)? <b>Pass\u00e9 compos\u00e9</b></li>
        <li>Describing what things <b>were like</b> or what you <b>used to do</b>? <b>Imparfait</b></li>
        <li>Something that <b>had already happened</b> before another past event? <b>Plus-que-parfait</b></li>
        <li>What is happening <b>now</b> or <b>generally true</b>? <b>Pr\u00e9sent</b></li>
        <li>What you are <b>going to do</b> (plan/soon)? <b>Futur proche</b></li>
        <li>What <b>will</b> happen (formal/written)? <b>Futur simple</b></li>
        <li>What <b>would</b> happen / polite request? <b>Conditionnel</b></li>
      </ul>
    </div>

    <div class="info-card">
      <h2>The 16 \u00catre Verbs (DR MRS VANDERTRAMP)</h2>
      <p>In the pass\u00e9 compos\u00e9 and plus-que-parfait, these verbs use <b>\u00eatre</b> as the auxiliary instead of avoir. The past participle must agree with the subject.</p>
      <div class="etre-list" style="margin-top:8px">
        <span class="etre-verb">Devenir (devenu)</span>
        <span class="etre-verb">Revenir (revenu)</span>
        <span class="etre-verb">Monter (mont\u00e9)</span>
        <span class="etre-verb">Rester (rest\u00e9)</span>
        <span class="etre-verb">Sortir (sorti)</span>
        <span class="etre-verb">Venir (venu)</span>
        <span class="etre-verb">Aller (all\u00e9)</span>
        <span class="etre-verb">Na\u00eetre (n\u00e9)</span>
        <span class="etre-verb">Descendre (descendu)</span>
        <span class="etre-verb">Entrer (entr\u00e9)</span>
        <span class="etre-verb">Retourner (retourn\u00e9)</span>
        <span class="etre-verb">Tomber (tomb\u00e9)</span>
        <span class="etre-verb">Rentrer (rentr\u00e9)</span>
        <span class="etre-verb">Arriver (arriv\u00e9)</span>
        <span class="etre-verb">Mourir (mort)</span>
        <span class="etre-verb">Partir (parti)</span>
      </div>
      <p style="margin-top:10px"><b>Agreement rule:</b> Add <b>-e</b> for feminine, <b>-s</b> for plural, <b>-es</b> for feminine plural.<br>
      Elle est all\u00e9<b>e</b>. Ils sont all\u00e9<b>s</b>. Elles sont all\u00e9<b>es</b>.</p>
    </div>

    <div class="info-card">
      <h2>Futur Proche vs Futur Simple</h2>
      <p>Both express the future, but they differ in tone and usage.</p>
      <div class="comparison-row">
        <div class="comparison-box" style="border-color:var(--futur-proche)">
          <h4 style="color:var(--futur-proche)">Futur Proche</h4>
          <p>Near, planned, or certain future. Common in everyday speech. Formed with aller + infinitive.</p>
          <p style="margin-top:4px;font-style:italic">Je vais partir. (I am going to leave.)</p>
        </div>
        <div class="comparison-box" style="border-color:var(--futur-simple)">
          <h4 style="color:var(--futur-simple)">Futur Simple</h4>
          <p>More distant, formal, or uncertain future. Preferred in writing and formal speech. Uses special stems + endings.</p>
          <p style="margin-top:4px;font-style:italic">Je partirai. (I will leave.)</p>
        </div>
      </div>
      <p style="margin-top:10px"><b>Tip for GCSE:</b> Using futur simple in your writing shows a higher level of grammatical control than futur proche alone. Try to include both where appropriate.</p>
    </div>

    <div class="info-card">
      <h2>Exam Tips for Tenses</h2>
      <ul>
        <li><b>Writing:</b> Aim to include past, present, and future tenses in every extended answer. Adding conditionnel earns extra credit for complexity.</li>
        <li><b>Speaking:</b> Prepare a memorised phrase in each tense that you can adapt to any topic. For example: "L'ann\u00e9e derni\u00e8re, j'ai visit\u00e9..." / "D'habitude, je..." / "L'ann\u00e9e prochaine, je vais..."</li>
        <li><b>Reading:</b> Look for trigger words to identify the tense being used. This helps you understand the timeline of events.</li>
        <li><b>Listening:</b> Train your ear to recognise auxiliary verbs (ai/suis for pass\u00e9 compos\u00e9, avais/\u00e9tais for plus-que-parfait) and tense endings (-ais for imparfait, -ai/-as/-a for futur simple).</li>
        <li><b>Common mistakes:</b> Forgetting the past participle agreement with \u00eatre verbs. Confusing pass\u00e9 compos\u00e9 and imparfait. Using futur proche when futur simple would be more appropriate in formal writing.</li>
      </ul>
    </div>`;
}
</script>
</body>
</html>