<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trigonometric Functions Explorer</title>
<style>
  :root {
    --bg-primary: #f0f6fc;
    --bg-secondary: #ffffff;
    --bg-card: #ffffff;
    --text-primary: #0d1b2a;
    --text-secondary: #3d5a80;
    --text-muted: #6b7f99;
    --border-color: #d0dbe8;
    --sin-color: #2563eb;
    --cos-color: #dc2626;
    --tan-color: #16a34a;
    --accent: #1e40af;
    --accent-light: #dbeafe;
    --highlight-bg: #fef3c7;
    --highlight-border: #f59e0b;
    --canvas-bg: #fafcff;
    --grid-color: #e2e8f0;
    --axis-color: #94a3b8;
    --header-bg: #0d1b2a;
    --header-text: #f0f6fc;
    --shadow: 0 2px 8px rgba(13,27,42,0.08);
    --shadow-lg: 0 4px 16px rgba(13,27,42,0.12);
    --radius: 10px;
    --radius-sm: 6px;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
  }

  header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--header-bg);
    color: var(--header-text);
    padding: 16px 24px;
    box-shadow: var(--shadow-lg);
  }

  header h1 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.02em;
  }

  header p {
    font-size: 0.875rem;
    opacity: 0.8;
    margin-top: 2px;
  }

  .main-container {
    max-width: 1360px;
    margin: 0 auto;
    padding: 20px;
  }

  .explorer-grid {
    display: grid;
    grid-template-columns: 440px 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  .card {
    background: var(--bg-card);
    border-radius: var(--radius);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow);
    overflow: hidden;
  }

  .card-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-color);
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--text-secondary);
    background: var(--bg-primary);
  }

  .card-body { padding: 16px; }

  /* Unit Circle Panel */
  .unit-circle-panel { display: flex; flex-direction: column; }

  .canvas-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 12px;
  }

  canvas {
    display: block;
    cursor: crosshair;
    border-radius: var(--radius-sm);
  }

  .angle-readout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    padding: 0 16px 12px;
  }

  .readout-box {
    background: var(--bg-primary);
    border-radius: var(--radius-sm);
    padding: 8px 12px;
    text-align: center;
    border: 1px solid var(--border-color);
  }

  .readout-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin-bottom: 2px;
  }

  .readout-value {
    font-size: 1.1rem;
    font-weight: 700;
    font-family: 'Courier New', monospace;
    color: var(--text-primary);
  }

  .trig-values {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 8px;
    padding: 0 16px 16px;
  }

  .trig-val {
    text-align: center;
    padding: 8px;
    border-radius: var(--radius-sm);
    border: 2px solid;
  }

  .trig-val.sin { border-color: var(--sin-color); background: #eff6ff; }
  .trig-val.cos { border-color: var(--cos-color); background: #fef2f2; }
  .trig-val.tan { border-color: var(--tan-color); background: #f0fdf4; }

  .trig-val .fn-name {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }

  .trig-val.sin .fn-name { color: var(--sin-color); }
  .trig-val.cos .fn-name { color: var(--cos-color); }
  .trig-val.tan .fn-name { color: var(--tan-color); }

  .trig-val .fn-value {
    font-size: 1.05rem;
    font-weight: 700;
    font-family: 'Courier New', monospace;
    color: var(--text-primary);
  }

  /* Graph Panel */
  .graph-panel { display: flex; flex-direction: column; }
  .graph-canvas-wrap { padding: 12px; flex: 1; }
  #graphCanvas { width: 100%; background: var(--canvas-bg); }

  /* Controls */
  .controls-row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    align-items: center;
    margin-bottom: 20px;
  }

  .toggle-group {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .toggle-group label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 20px;
    border: 2px solid var(--border-color);
    transition: all 0.15s;
    user-select: none;
  }

  .toggle-group label:has(input:checked).sin-toggle {
    border-color: var(--sin-color);
    background: #eff6ff;
    color: var(--sin-color);
  }
  .toggle-group label:has(input:checked).cos-toggle {
    border-color: var(--cos-color);
    background: #fef2f2;
    color: var(--cos-color);
  }
  .toggle-group label:has(input:checked).tan-toggle {
    border-color: var(--tan-color);
    background: #f0fdf4;
    color: var(--tan-color);
  }

  .toggle-group input[type="checkbox"] {
    accent-color: var(--accent);
    width: 16px;
    height: 16px;
  }

  .angle-slider-group {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
    min-width: 200px;
  }

  .angle-slider-group label {
    font-weight: 500;
    font-size: 0.9rem;
    white-space: nowrap;
  }

  .angle-slider-group input[type="range"] {
    flex: 1;
    accent-color: var(--accent);
    height: 6px;
  }

  .angle-slider-group .slider-value {
    font-family: 'Courier New', monospace;
    font-weight: 700;
    min-width: 42px;
    text-align: right;
  }

  /* Special Angles Table */
  .bottom-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  .angles-table-wrap { overflow-x: auto; }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }

  th, td {
    padding: 8px 10px;
    text-align: center;
    border-bottom: 1px solid var(--border-color);
  }

  th {
    background: var(--bg-primary);
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    position: sticky;
    top: 0;
  }

  td { font-family: 'Courier New', monospace; font-size: 0.82rem; }

  tr.highlighted {
    background: var(--highlight-bg);
    outline: 2px solid var(--highlight-border);
    outline-offset: -1px;
  }

  tr.highlighted td { font-weight: 700; }

  /* Info Panel */
  .info-panel h3 {
    font-size: 1rem;
    color: var(--accent);
    margin: 16px 0 6px;
  }

  .info-panel h3:first-child { margin-top: 0; }

  .info-panel p {
    font-size: 0.88rem;
    color: var(--text-secondary);
    margin-bottom: 8px;
  }

  .mnemonic {
    display: inline-block;
    background: var(--accent-light);
    border: 1px solid var(--accent);
    border-radius: var(--radius-sm);
    padding: 6px 14px;
    font-weight: 700;
    font-size: 1rem;
    color: var(--accent);
    letter-spacing: 0.02em;
    margin: 4px 0 8px;
  }

  .formula-row {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    margin: 8px 0;
  }

  .formula-box {
    padding: 6px 14px;
    border-radius: var(--radius-sm);
    font-family: 'Courier New', monospace;
    font-weight: 600;
    font-size: 0.9rem;
  }

  .formula-box.sin-f { background: #eff6ff; color: var(--sin-color); border: 1px solid var(--sin-color); }
  .formula-box.cos-f { background: #fef2f2; color: var(--cos-color); border: 1px solid var(--cos-color); }
  .formula-box.tan-f { background: #f0fdf4; color: var(--tan-color); border: 1px solid var(--tan-color); }

  .asymptote-note {
    background: #fefce8;
    border-left: 3px solid var(--highlight-border);
    padding: 10px 14px;
    border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    margin: 8px 0;
    font-size: 0.85rem;
    color: var(--text-secondary);
  }

  /* Responsive */
  @media (max-width: 960px) {
    .explorer-grid {
      grid-template-columns: 1fr;
    }
    .bottom-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 520px) {
    header { padding: 12px 16px; }
    header h1 { font-size: 1.2rem; }
    .main-container { padding: 12px; }
    .trig-values { grid-template-columns: 1fr; }
    .angle-readout { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<header>
  <h1>Trigonometric Functions Explorer</h1>
  <p>Interactive unit circle linked to sine, cosine and tangent graphs. Drag the point or use the slider.</p>
</header>

<div class="main-container">

  <!-- Controls -->
  <div class="controls-row">
    <div class="toggle-group">
      <label class="sin-toggle">
        <input type="checkbox" id="chkSin" checked> sin(x)
      </label>
      <label class="cos-toggle">
        <input type="checkbox" id="chkCos" checked> cos(x)
      </label>
      <label class="tan-toggle">
        <input type="checkbox" id="chkTan" checked> tan(x)
      </label>
    </div>
    <div class="angle-slider-group">
      <label for="angleSlider">Angle:</label>
      <input type="range" id="angleSlider" min="0" max="360" value="45" step="1">
      <span class="slider-value" id="sliderValue">45&#176;</span>
    </div>
  </div>

  <!-- Main grid: unit circle + graph -->
  <div class="explorer-grid">

    <!-- Unit Circle -->
    <div class="card unit-circle-panel">
      <div class="card-header">Unit Circle</div>
      <div class="canvas-wrapper">
        <canvas id="unitCircle" width="400" height="400"></canvas>
      </div>
      <div class="angle-readout">
        <div class="readout-box">
          <div class="readout-label">Degrees</div>
          <div class="readout-value" id="degValue">45&#176;</div>
        </div>
        <div class="readout-box">
          <div class="readout-label">Radians</div>
          <div class="readout-value" id="radValue">&pi;/4</div>
        </div>
      </div>
      <div class="trig-values">
        <div class="trig-val sin">
          <div class="fn-name">sin</div>
          <div class="fn-value" id="sinVal">0.7071</div>
        </div>
        <div class="trig-val cos">
          <div class="fn-name">cos</div>
          <div class="fn-value" id="cosVal">0.7071</div>
        </div>
        <div class="trig-val tan">
          <div class="fn-name">tan</div>
          <div class="fn-value" id="tanVal">1.0000</div>
        </div>
      </div>
    </div>

    <!-- Graph -->
    <div class="card graph-panel">
      <div class="card-header">Function Graphs (0 to 360 degrees)</div>
      <div class="graph-canvas-wrap">
        <canvas id="graphCanvas" width="800" height="400"></canvas>
      </div>
    </div>

  </div>

  <!-- Bottom: table + info -->
  <div class="bottom-grid">

    <!-- Special Angles Table -->
    <div class="card">
      <div class="card-header">Special Angle Values</div>
      <div class="card-body angles-table-wrap">
        <table id="anglesTable">
          <thead>
            <tr>
              <th>Deg</th><th>Rad</th><th>sin</th><th>cos</th><th>tan</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Info Panel -->
    <div class="card">
      <div class="card-header">Key Concepts</div>
      <div class="card-body info-panel">
        <h3>SOH-CAH-TOA</h3>
        <p>The classic mnemonic for remembering the three basic trigonometric ratios in a right-angled triangle:</p>
        <div class="mnemonic">SOH - CAH - TOA</div>
        <div class="formula-row">
          <div class="formula-box sin-f">sin = Opp / Hyp</div>
          <div class="formula-box cos-f">cos = Adj / Hyp</div>
          <div class="formula-box tan-f">tan = Opp / Adj</div>
        </div>

        <h3>The Unit Circle</h3>
        <p>On a circle with radius 1 centred at the origin, any point on the circumference can be written as (cos&thinsp;&theta;, sin&thinsp;&theta;). The hypotenuse is always 1, so the adjacent side equals cos&thinsp;&theta; and the opposite side equals sin&thinsp;&theta; directly.</p>
        <p>This means sin and cos always lie between -1 and +1. As the angle sweeps around the full circle, sin and cos trace smooth wave patterns.</p>

        <h3>Why Tangent Has Asymptotes</h3>
        <div class="asymptote-note">
          Since tan&thinsp;&theta; = sin&thinsp;&theta; / cos&thinsp;&theta;, whenever cos&thinsp;&theta; = 0 (at 90 and 270 degrees), the division is undefined. The tangent value shoots off towards positive or negative infinity, creating vertical asymptotes. These are the breaks you see in the tan graph.
        </div>
        <p>Between asymptotes, tangent increases continuously from negative infinity to positive infinity, passing through zero at every multiple of 180 degrees.</p>
      </div>
    </div>

  </div>

</div>

<script>
(function () {
  'use strict';

  /* ── State ── */
  let angleDeg = 45;
  let isDragging = false;
  let showSin = true, showCos = true, showTan = true;

  /* ── DOM refs ── */
  const ucCanvas = document.getElementById('unitCircle');
  const ucCtx = ucCanvas.getContext('2d');
  const grCanvas = document.getElementById('graphCanvas');
  const grCtx = grCanvas.getContext('2d');

  const degEl = document.getElementById('degValue');
  const radEl = document.getElementById('radValue');
  const sinEl = document.getElementById('sinVal');
  const cosEl = document.getElementById('cosVal');
  const tanEl = document.getElementById('tanVal');
  const slider = document.getElementById('angleSlider');
  const sliderVal = document.getElementById('sliderValue');

  const chkSin = document.getElementById('chkSin');
  const chkCos = document.getElementById('chkCos');
  const chkTan = document.getElementById('chkTan');

  /* ── Constants ── */
  const PI = Math.PI;
  const TWO_PI = 2 * PI;
  const DEG_TO_RAD = PI / 180;

  /* Unit circle layout */
  const UC_CX = 200, UC_CY = 200, UC_R = 150;
  /* Graph layout */
  const GR_PAD_L = 50, GR_PAD_R = 20, GR_PAD_T = 20, GR_PAD_B = 40;

  /* ── Special angles ── */
  const SPECIAL = [0, 30, 45, 60, 90, 120, 135, 150, 180, 210, 225, 240, 270, 300, 315, 330, 360];

  const FRAC_MAP = {
    0: '0', 30: '\u03C0/6', 45: '\u03C0/4', 60: '\u03C0/3',
    90: '\u03C0/2', 120: '2\u03C0/3', 135: '3\u03C0/4', 150: '5\u03C0/6',
    180: '\u03C0', 210: '7\u03C0/6', 225: '5\u03C0/4', 240: '4\u03C0/3',
    270: '3\u03C0/2', 300: '5\u03C0/3', 315: '7\u03C0/4', 330: '11\u03C0/6',
    360: '2\u03C0'
  };

  /* Exact symbolic values for the table */
  function exactVal(deg, fn) {
    var r = deg * DEG_TO_RAD;
    var v;
    if (fn === 'sin') v = Math.sin(r);
    else if (fn === 'cos') v = Math.cos(r);
    else v = Math.cos(r) === 0 ? undefined : Math.tan(r);

    /* Known exact strings */
    var abs = Math.abs(v);
    if (v === undefined || !isFinite(v)) return 'undef';
    if (Math.abs(v) < 1e-10) return '0';
    if (Math.abs(abs - 1) < 1e-10) return v > 0 ? '1' : '-1';
    if (Math.abs(abs - 0.5) < 1e-10) return v > 0 ? '1/2' : '-1/2';
    var sq2h = Math.SQRT2 / 2;
    if (Math.abs(abs - sq2h) < 1e-10) return (v > 0 ? '' : '-') + '\u221A2/2';
    var sq3h = Math.sqrt(3) / 2;
    if (Math.abs(abs - sq3h) < 1e-10) return (v > 0 ? '' : '-') + '\u221A3/2';
    var sq3o3 = Math.sqrt(3) / 3;
    if (Math.abs(abs - sq3o3) < 1e-10) return (v > 0 ? '' : '-') + '\u221A3/3';
    if (Math.abs(abs - Math.sqrt(3)) < 1e-10) return (v > 0 ? '' : '-') + '\u221A3';
    return v.toFixed(4);
  }

  /* ── Build special angles table ── */
  function buildTable() {
    var tbody = document.querySelector('#anglesTable tbody');
    tbody.innerHTML = '';
    SPECIAL.forEach(function (d) {
      var tr = document.createElement('tr');
      tr.dataset.deg = d;
      tr.innerHTML =
        '<td>' + d + '\u00B0</td>' +
        '<td>' + (FRAC_MAP[d] || (d * DEG_TO_RAD).toFixed(2)) + '</td>' +
        '<td>' + exactVal(d, 'sin') + '</td>' +
        '<td>' + exactVal(d, 'cos') + '</td>' +
        '<td>' + exactVal(d, 'tan') + '</td>';
      tbody.appendChild(tr);
    });
  }
  buildTable();

  /* ── Radian display ── */
  function radianStr(deg) {
    var d = ((deg % 360) + 360) % 360;
    if (FRAC_MAP[d] !== undefined) return FRAC_MAP[d];
    return (d * DEG_TO_RAD).toFixed(3);
  }

  /* ── Highlight nearest special angle ── */
  function highlightRow() {
    var rows = document.querySelectorAll('#anglesTable tbody tr');
    var best = null, bestDist = 999;
    rows.forEach(function (tr) {
      tr.classList.remove('highlighted');
      var rd = parseInt(tr.dataset.deg);
      var dist = Math.abs(rd - angleDeg);
      if (dist < bestDist) { bestDist = dist; best = tr; }
    });
    if (best && bestDist <= 5) best.classList.add('highlighted');
  }

  /* ── Draw Unit Circle ── */
  function drawUnitCircle() {
    var ctx = ucCtx;
    var w = ucCanvas.width, h = ucCanvas.height;
    ctx.clearRect(0, 0, w, h);

    var rad = angleDeg * DEG_TO_RAD;
    var sinV = Math.sin(rad);
    var cosV = Math.cos(rad);
    var px = UC_CX + UC_R * cosV;
    var py = UC_CY - UC_R * sinV;

    /* Grid */
    ctx.strokeStyle = '#e8edf3';
    ctx.lineWidth = 1;
    for (var i = -1; i <= 1; i += 0.5) {
      if (i === 0) continue;
      var gx = UC_CX + UC_R * i;
      ctx.beginPath(); ctx.moveTo(gx, UC_CY - UC_R - 10); ctx.lineTo(gx, UC_CY + UC_R + 10); ctx.stroke();
      var gy = UC_CY - UC_R * i;
      ctx.beginPath(); ctx.moveTo(UC_CX - UC_R - 10, gy); ctx.lineTo(UC_CX + UC_R + 10, gy); ctx.stroke();
    }

    /* Axes */
    ctx.strokeStyle = '#94a3b8';
    ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(UC_CX - UC_R - 20, UC_CY); ctx.lineTo(UC_CX + UC_R + 20, UC_CY); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(UC_CX, UC_CY - UC_R - 20); ctx.lineTo(UC_CX, UC_CY + UC_R + 20); ctx.stroke();

    /* Axis labels */
    ctx.fillStyle = '#94a3b8';
    ctx.font = '11px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('1', UC_CX + UC_R + 2, UC_CY + 14);
    ctx.fillText('-1', UC_CX - UC_R - 2, UC_CY + 14);
    ctx.fillText('1', UC_CX + 12, UC_CY - UC_R - 4);
    ctx.fillText('-1', UC_CX + 14, UC_CY + UC_R + 14);

    /* Circle */
    ctx.strokeStyle = '#b0bfd0';
    ctx.lineWidth = 2;
    ctx.beginPath(); ctx.arc(UC_CX, UC_CY, UC_R, 0, TWO_PI); ctx.stroke();

    /* Angle arc */
    ctx.strokeStyle = var_accent();
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(UC_CX, UC_CY, 30, 0, -rad, rad > 0);
    ctx.stroke();

    /* Angle label */
    var labelRad = rad / 2;
    var lx = UC_CX + 42 * Math.cos(labelRad);
    var ly = UC_CY - 42 * Math.sin(labelRad);
    ctx.fillStyle = var_accent();
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(Math.round(angleDeg) + '\u00B0', lx, ly);

    /* Reference triangle fill */
    ctx.fillStyle = 'rgba(30, 64, 175, 0.06)';
    ctx.beginPath();
    ctx.moveTo(UC_CX, UC_CY);
    ctx.lineTo(px, UC_CY);
    ctx.lineTo(px, py);
    ctx.closePath();
    ctx.fill();

    /* cos line (horizontal, red) */
    if (showCos) {
      ctx.strokeStyle = '#dc2626';
      ctx.lineWidth = 3;
      ctx.beginPath(); ctx.moveTo(UC_CX, UC_CY); ctx.lineTo(px, UC_CY); ctx.stroke();
      ctx.fillStyle = '#dc2626';
      ctx.font = 'bold 12px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.fillText('cos', (UC_CX + px) / 2, UC_CY + 4);
    }

    /* sin line (vertical, blue) */
    if (showSin) {
      ctx.strokeStyle = '#2563eb';
      ctx.lineWidth = 3;
      ctx.beginPath(); ctx.moveTo(px, UC_CY); ctx.lineTo(px, py); ctx.stroke();
      ctx.fillStyle = '#2563eb';
      ctx.font = 'bold 12px sans-serif';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'middle';
      ctx.fillText('sin', px + 6, (UC_CY + py) / 2);
    }

    /* tan line (green) */
    if (showTan && Math.abs(cosV) > 0.01) {
      var tanV = sinV / cosV;
      var tanLen = tanV * UC_R;
      /* tan is the segment from (1,0) up to the extended radius line on the unit circle tangent */
      var tx = UC_CX + UC_R * (cosV > 0 ? 1 : -1);
      var ty = UC_CY - tanLen * (cosV > 0 ? 1 : -1);
      /* Clamp for display */
      var maxTanPx = UC_R * 2.5;
      var drawTanLen = Math.min(Math.abs(tanLen), maxTanPx) * Math.sign(tanLen);
      ty = UC_CY - drawTanLen * (cosV > 0 ? 1 : -1);

      ctx.strokeStyle = '#16a34a';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(tx, UC_CY);
      ctx.lineTo(tx, ty);
      ctx.stroke();

      ctx.fillStyle = '#16a34a';
      ctx.font = 'bold 12px sans-serif';
      ctx.textAlign = cosV > 0 ? 'left' : 'right';
      ctx.textBaseline = 'middle';
      var labelOffset = cosV > 0 ? 6 : -6;
      ctx.fillText('tan', tx + labelOffset, (UC_CY + ty) / 2);

      /* Dashed line from point to tan point */
      ctx.setLineDash([4, 4]);
      ctx.strokeStyle = '#94a3b8';
      ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(UC_CX, UC_CY); ctx.lineTo(tx, ty); ctx.stroke();
      ctx.setLineDash([]);
    }

    /* Hypotenuse / radius line */
    ctx.strokeStyle = var_accent();
    ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(UC_CX, UC_CY); ctx.lineTo(px, py); ctx.stroke();

    /* Right angle marker */
    var markerSize = 10;
    if (Math.abs(cosV) > 0.05 && Math.abs(sinV) > 0.05) {
      ctx.strokeStyle = '#94a3b8';
      ctx.lineWidth = 1;
      var sx = sinV > 0 ? -1 : 1;
      ctx.beginPath();
      ctx.moveTo(px, UC_CY + sx * markerSize * -1);
      /* We draw the small square */
      var rmx = px - markerSize * Math.sign(cosV);
      ctx.moveTo(px, UC_CY - markerSize * Math.sign(sinV));
      ctx.lineTo(rmx, UC_CY - markerSize * Math.sign(sinV));
      ctx.lineTo(rmx, UC_CY);
      ctx.stroke();
    }

    /* Draggable point */
    ctx.fillStyle = var_accent();
    ctx.beginPath(); ctx.arc(px, py, 8, 0, TWO_PI); ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.beginPath(); ctx.arc(px, py, 4, 0, TWO_PI); ctx.fill();

    /* Coordinate label */
    ctx.fillStyle = var_accent();
    ctx.font = '11px monospace';
    ctx.textAlign = cosV >= 0 ? 'left' : 'right';
    ctx.textBaseline = sinV >= 0 ? 'top' : 'bottom';
    var offX = cosV >= 0 ? 14 : -14;
    var offY = sinV >= 0 ? -14 : 14;
    ctx.fillText('(' + cosV.toFixed(2) + ', ' + sinV.toFixed(2) + ')', px + offX, py + offY);
  }

  function var_accent() { return '#1e40af'; }

  /* ── Draw Graph ── */
  function drawGraph() {
    var ctx = grCtx;
    var w = grCanvas.width, h = grCanvas.height;
    ctx.clearRect(0, 0, w, h);

    var plotW = w - GR_PAD_L - GR_PAD_R;
    var plotH = h - GR_PAD_T - GR_PAD_B;
    var midY = GR_PAD_T + plotH / 2;

    /* Scale: y from -2 to 2 (to accommodate tan somewhat) */
    var yScale = plotH / 4; /* 4 units total (-2 to 2) */

    function xToPx(deg) { return GR_PAD_L + (deg / 360) * plotW; }
    function yToPx(val) { return midY - val * yScale; }

    /* Grid lines */
    ctx.strokeStyle = '#e8edf3';
    ctx.lineWidth = 1;
    /* Horizontal */
    for (var yv = -2; yv <= 2; yv += 0.5) {
      var gy = yToPx(yv);
      ctx.beginPath(); ctx.moveTo(GR_PAD_L, gy); ctx.lineTo(w - GR_PAD_R, gy); ctx.stroke();
    }
    /* Vertical every 30 degrees */
    for (var dg = 0; dg <= 360; dg += 30) {
      var gx = xToPx(dg);
      ctx.beginPath(); ctx.moveTo(gx, GR_PAD_T); ctx.lineTo(gx, h - GR_PAD_B); ctx.stroke();
    }

    /* Axes */
    ctx.strokeStyle = '#94a3b8';
    ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(GR_PAD_L, midY); ctx.lineTo(w - GR_PAD_R, midY); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(GR_PAD_L, GR_PAD_T); ctx.lineTo(GR_PAD_L, h - GR_PAD_B); ctx.stroke();

    /* X-axis labels */
    ctx.fillStyle = '#6b7f99';
    ctx.font = '11px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    [0, 90, 180, 270, 360].forEach(function (d) {
      ctx.fillText(d + '\u00B0', xToPx(d), h - GR_PAD_B + 6);
    });

    /* Y-axis labels */
    ctx.textAlign = 'right';
    ctx.textBaseline = 'middle';
    [-2, -1, 0, 1, 2].forEach(function (v) {
      ctx.fillText(v.toString(), GR_PAD_L - 8, yToPx(v));
    });

    /* Clip region for curves */
    ctx.save();
    ctx.beginPath();
    ctx.rect(GR_PAD_L, GR_PAD_T, plotW, plotH);
    ctx.clip();

    var step = 0.5; /* half-degree steps for smoothness */

    /* Draw tan first (behind) */
    if (showTan) {
      ctx.strokeStyle = '#16a34a';
      ctx.lineWidth = 2;
      ctx.beginPath();
      var tanStarted = false;
      for (var d = 0; d <= 360; d += step) {
        var r = d * DEG_TO_RAD;
        var cv = Math.cos(r);
        if (Math.abs(cv) < 0.005) { tanStarted = false; continue; }
        var tv = Math.tan(r);
        if (Math.abs(tv) > 5) { tanStarted = false; continue; }
        var tx = xToPx(d), ty = yToPx(tv);
        if (!tanStarted) { ctx.moveTo(tx, ty); tanStarted = true; }
        else ctx.lineTo(tx, ty);
      }
      ctx.stroke();
    }

    /* Draw cos */
    if (showCos) {
      ctx.strokeStyle = '#dc2626';
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      for (var d = 0; d <= 360; d += step) {
        var r = d * DEG_TO_RAD;
        var v = Math.cos(r);
        var gx = xToPx(d), gy = yToPx(v);
        if (d === 0) ctx.moveTo(gx, gy); else ctx.lineTo(gx, gy);
      }
      ctx.stroke();
    }

    /* Draw sin */
    if (showSin) {
      ctx.strokeStyle = '#2563eb';
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      for (var d = 0; d <= 360; d += step) {
        var r = d * DEG_TO_RAD;
        var v = Math.sin(r);
        var gx = xToPx(d), gy = yToPx(v);
        if (d === 0) ctx.moveTo(gx, gy); else ctx.lineTo(gx, gy);
      }
      ctx.stroke();
    }

    /* Asymptote dashed lines for tan */
    if (showTan) {
      ctx.setLineDash([6, 4]);
      ctx.strokeStyle = 'rgba(22,163,74,0.35)';
      ctx.lineWidth = 1.5;
      [90, 270].forEach(function (ad) {
        var ax = xToPx(ad);
        ctx.beginPath(); ctx.moveTo(ax, GR_PAD_T); ctx.lineTo(ax, h - GR_PAD_B); ctx.stroke();
      });
      ctx.setLineDash([]);
    }

    ctx.restore(); /* remove clip */

    /* Vertical marker at current angle */
    var mx = xToPx(angleDeg);
    ctx.setLineDash([4, 3]);
    ctx.strokeStyle = 'rgba(13,27,42,0.5)';
    ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(mx, GR_PAD_T); ctx.lineTo(mx, h - GR_PAD_B); ctx.stroke();
    ctx.setLineDash([]);

    /* Dots on curves at current angle */
    var cRad = angleDeg * DEG_TO_RAD;
    if (showSin) {
      var sv = Math.sin(cRad);
      ctx.fillStyle = '#2563eb';
      ctx.beginPath(); ctx.arc(mx, yToPx(sv), 5, 0, TWO_PI); ctx.fill();
    }
    if (showCos) {
      var cv = Math.cos(cRad);
      ctx.fillStyle = '#dc2626';
      ctx.beginPath(); ctx.arc(mx, yToPx(cv), 5, 0, TWO_PI); ctx.fill();
    }
    if (showTan) {
      var cosA = Math.cos(cRad);
      if (Math.abs(cosA) > 0.02) {
        var tVal = Math.tan(cRad);
        if (Math.abs(tVal) <= 4) {
          ctx.fillStyle = '#16a34a';
          ctx.beginPath(); ctx.arc(mx, yToPx(tVal), 5, 0, TWO_PI); ctx.fill();
        }
      }
    }

    /* Legend */
    var lx = w - GR_PAD_R - 10;
    var ly = GR_PAD_T + 14;
    ctx.textAlign = 'right';
    ctx.font = 'bold 12px sans-serif';
    if (showSin) { ctx.fillStyle = '#2563eb'; ctx.fillText('sin(x)', lx, ly); ly += 16; }
    if (showCos) { ctx.fillStyle = '#dc2626'; ctx.fillText('cos(x)', lx, ly); ly += 16; }
    if (showTan) { ctx.fillStyle = '#16a34a'; ctx.fillText('tan(x)', lx, ly); }
  }

  /* ── Update all ── */
  function update() {
    var rad = angleDeg * DEG_TO_RAD;
    var sv = Math.sin(rad);
    var cv = Math.cos(rad);
    var tv = Math.abs(cv) < 1e-10 ? undefined : sv / cv;

    degEl.textContent = Math.round(angleDeg) + '\u00B0';
    radEl.textContent = radianStr(Math.round(angleDeg));
    sinEl.textContent = sv.toFixed(4);
    cosEl.textContent = cv.toFixed(4);
    tanEl.textContent = tv === undefined ? 'undef' : tv.toFixed(4);
    slider.value = Math.round(angleDeg);
    sliderVal.textContent = Math.round(angleDeg) + '\u00B0';

    highlightRow();
    drawUnitCircle();
    drawGraph();
  }

  /* ── Interaction: drag on unit circle ── */
  function getAngleFromMouse(e) {
    var rect = ucCanvas.getBoundingClientRect();
    var sx = ucCanvas.width / rect.width;
    var sy = ucCanvas.height / rect.height;
    var mx = (e.clientX - rect.left) * sx;
    var my = (e.clientY - rect.top) * sy;
    var dx = mx - UC_CX;
    var dy = -(my - UC_CY);
    var a = Math.atan2(dy, dx) / DEG_TO_RAD;
    if (a < 0) a += 360;
    return a;
  }

  ucCanvas.addEventListener('mousedown', function (e) {
    isDragging = true;
    angleDeg = getAngleFromMouse(e);
    update();
    e.preventDefault();
  });

  window.addEventListener('mousemove', function (e) {
    if (!isDragging) return;
    angleDeg = getAngleFromMouse(e);
    update();
  });

  window.addEventListener('mouseup', function () { isDragging = false; });

  /* Touch support */
  ucCanvas.addEventListener('touchstart', function (e) {
    isDragging = true;
    var t = e.touches[0];
    angleDeg = getAngleFromMouse(t);
    update();
    e.preventDefault();
  }, { passive: false });

  ucCanvas.addEventListener('touchmove', function (e) {
    if (!isDragging) return;
    var t = e.touches[0];
    angleDeg = getAngleFromMouse(t);
    update();
    e.preventDefault();
  }, { passive: false });

  ucCanvas.addEventListener('touchend', function () { isDragging = false; });

  /* Slider */
  slider.addEventListener('input', function () {
    angleDeg = parseInt(this.value);
    update();
  });

  /* Checkboxes */
  chkSin.addEventListener('change', function () { showSin = this.checked; update(); });
  chkCos.addEventListener('change', function () { showCos = this.checked; update(); });
  chkTan.addEventListener('change', function () { showTan = this.checked; update(); });

  /* ── Resize handling for graph canvas ── */
  function resizeGraphCanvas() {
    var wrap = document.querySelector('.graph-canvas-wrap');
    var w = wrap.clientWidth - 24;
    var h = Math.max(320, Math.min(440, w * 0.5));
    grCanvas.width = w;
    grCanvas.height = h;
    drawGraph();
  }

  var resizeTimer;
  window.addEventListener('resize', function () {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function () {
      resizeGraphCanvas();
      update();
    }, 80);
  });

  /* ── Init ── */
  resizeGraphCanvas();
  update();

})();
</script>

</body>
</html>