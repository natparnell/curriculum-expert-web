<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bias &amp; Perspective Spectrum</title>
    <style>
        :root {
            --colour-bg: #faf6f0;
            --colour-bg-alt: #f3ece1;
            --colour-surface: #ffffff;
            --colour-header: #5c3d2e;
            --colour-header-text: #faf6f0;
            --colour-primary: #8b5e3c;
            --colour-primary-light: #c49a6c;
            --colour-primary-lighter: #e8d5b7;
            --colour-accent: #b8860b;
            --colour-accent-light: #daa520;
            --colour-text: #3e2a1c;
            --colour-text-muted: #7a6555;
            --colour-border: #d4c4a8;
            --colour-border-light: #e8dcc8;
            --colour-quadrant-ps: #e8f5e9;
            --colour-quadrant-os: #e3f2fd;
            --colour-quadrant-pc: #fce4ec;
            --colour-quadrant-oc: #fff3e0;
            --colour-card-hover: #fff8e1;
            --colour-cluster-a: #c62828;
            --colour-cluster-b: #1565c0;
            --colour-cluster-c: #2e7d32;
            --colour-cluster-d: #6a1b9a;
            --font-heading: Georgia, 'Times New Roman', serif;
            --font-body: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --radius: 8px;
            --shadow: 0 2px 8px rgba(92, 61, 46, 0.12);
            --shadow-lg: 0 4px 16px rgba(92, 61, 46, 0.18);
            --transition: 0.2s ease;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-body);
            background: var(--colour-bg);
            color: var(--colour-text);
            line-height: 1.6;
            min-height: 100vh;
        }

        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--colour-header);
            color: var(--colour-header-text);
            padding: 12px 24px;
            box-shadow: var(--shadow-lg);
        }

        header h1 {
            font-family: var(--font-heading);
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 2px;
        }

        header p {
            font-size: 0.82rem;
            opacity: 0.85;
        }

        .topic-bar {
            display: flex;
            gap: 8px;
            padding: 12px 24px;
            background: var(--colour-bg-alt);
            border-bottom: 1px solid var(--colour-border);
            flex-wrap: wrap;
            align-items: center;
        }

        .topic-bar label {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--colour-text-muted);
            margin-right: 4px;
        }

        .topic-btn {
            padding: 6px 16px;
            border: 2px solid var(--colour-border);
            border-radius: 20px;
            background: var(--colour-surface);
            color: var(--colour-text);
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
        }

        .topic-btn:hover { border-color: var(--colour-primary-light); background: var(--colour-primary-lighter); }
        .topic-btn.active { background: var(--colour-primary); color: #fff; border-color: var(--colour-primary); }

        .main-layout {
            display: grid;
            grid-template-columns: 260px 1fr 300px;
            gap: 0;
            min-height: calc(100vh - 110px);
        }

        .source-panel {
            background: var(--colour-bg-alt);
            border-right: 1px solid var(--colour-border);
            padding: 16px;
            overflow-y: auto;
            max-height: calc(100vh - 110px);
        }

        .source-panel h2 {
            font-family: var(--font-heading);
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--colour-primary);
        }

        .source-panel .instructions {
            font-size: 0.78rem;
            color: var(--colour-text-muted);
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--colour-border-light);
        }

        .source-card {
            background: var(--colour-surface);
            border: 2px solid var(--colour-border);
            border-radius: var(--radius);
            padding: 10px 12px;
            margin-bottom: 8px;
            cursor: grab;
            font-size: 0.8rem;
            transition: all var(--transition);
            user-select: none;
            position: relative;
        }

        .source-card:hover { border-color: var(--colour-accent); background: var(--colour-card-hover); box-shadow: var(--shadow); }
        .source-card:active { cursor: grabbing; }
        .source-card.placed { opacity: 0.45; border-style: dashed; }

        .source-card .card-label {
            font-weight: 700;
            font-size: 0.75rem;
            color: var(--colour-primary);
            display: block;
            margin-bottom: 2px;
        }

        .source-card .card-author {
            font-size: 0.72rem;
            color: var(--colour-text-muted);
            font-style: italic;
        }

        .grid-area {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px;
            overflow: hidden;
        }

        .grid-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .grid-controls button {
            padding: 5px 14px;
            border: 1px solid var(--colour-border);
            border-radius: var(--radius);
            background: var(--colour-surface);
            font-size: 0.78rem;
            cursor: pointer;
            transition: all var(--transition);
            font-weight: 600;
        }

        .grid-controls button:hover { background: var(--colour-primary-lighter); }
        .grid-controls button.active-toggle { background: var(--colour-accent); color: #fff; border-color: var(--colour-accent); }

        .grid-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            aspect-ratio: 1;
            background: var(--colour-surface);
            border: 2px solid var(--colour-border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: visible;
        }

        .grid-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .placed-card {
            position: absolute;
            background: var(--colour-surface);
            border: 2px solid var(--colour-primary);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.7rem;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            transform: translate(-50%, -50%);
            box-shadow: var(--shadow);
            z-index: 10;
            transition: box-shadow var(--transition);
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .placed-card:hover { box-shadow: var(--shadow-lg); z-index: 20; }
        .placed-card.selected { border-color: var(--colour-accent); box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.3); }

        .info-panel {
            background: var(--colour-bg-alt);
            border-left: 1px solid var(--colour-border);
            padding: 16px;
            overflow-y: auto;
            max-height: calc(100vh - 110px);
        }

        .info-panel h2 {
            font-family: var(--font-heading);
            font-size: 1rem;
            color: var(--colour-primary);
            margin-bottom: 10px;
        }

        .info-section {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--colour-border-light);
        }

        .info-section h3 {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--colour-header);
            margin-bottom: 4px;
        }

        .info-section p, .info-section li {
            font-size: 0.8rem;
            color: var(--colour-text-muted);
            line-height: 1.5;
        }

        .info-section ul { padding-left: 16px; }
        .info-section li { margin-bottom: 4px; }

        .source-detail { display: none; }
        .source-detail.visible { display: block; }

        .source-detail .detail-title {
            font-family: var(--font-heading);
            font-size: 1rem;
            color: var(--colour-header);
            margin-bottom: 6px;
        }

        .source-detail .detail-meta {
            font-size: 0.78rem;
            color: var(--colour-text-muted);
            margin-bottom: 10px;
        }

        .detail-field {
            margin-bottom: 10px;
        }

        .detail-field label {
            display: block;
            font-size: 0.72rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--colour-primary);
            margin-bottom: 2px;
        }

        .detail-field p {
            font-size: 0.8rem;
            color: var(--colour-text);
        }

        .detail-field blockquote {
            font-size: 0.8rem;
            font-style: italic;
            color: var(--colour-text);
            border-left: 3px solid var(--colour-accent);
            padding-left: 10px;
            margin: 4px 0;
        }

        .bias-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.72rem;
            font-weight: 700;
            color: #fff;
        }

        .bias-high { background: var(--colour-cluster-a); }
        .bias-medium { background: var(--colour-accent); }
        .bias-low { background: var(--colour-cluster-c); }

        .cluster-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .cluster-legend span {
            font-size: 0.72rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .cluster-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }

            .source-panel, .info-panel {
                max-height: none;
                border-right: none;
                border-left: none;
                border-bottom: 1px solid var(--colour-border);
            }

            .source-panel {
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
                padding: 12px;
            }

            .source-panel h2, .source-panel .instructions { width: 100%; }
            .source-card { flex: 1 1 calc(50% - 6px); min-width: 140px; margin-bottom: 0; }

            header h1 { font-size: 1.15rem; }
            .grid-container { max-width: 100%; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Bias &amp; Perspective Spectrum</h1>
        <p>Place historical sources on a 2D spectrum to analyse bias, perspective, and provenance</p>
    </header>

    <div class="topic-bar">
        <label>Topic:</label>
        <button class="topic-btn active" data-topic="ww1">Causes of WW1</button>
        <button class="topic-btn" data-topic="suffrage">Women's Suffrage</button>
        <button class="topic-btn" data-topic="empire">British Empire</button>
        <button class="topic-btn" data-topic="industrial">Industrial Revolution</button>
    </div>

    <div class="main-layout">
        <div class="source-panel">
            <h2>Source Cards</h2>
            <p class="instructions">Drag each source card onto the grid. Position it based on how supportive or critical it is (left to right) and whether it is personal or official (bottom to top).</p>
            <div id="cardContainer"></div>
        </div>

        <div class="grid-area">
            <div class="grid-controls">
                <button id="btnCluster" title="Highlight how sources cluster together">Show Clusters</button>
                <button id="btnReset" title="Return all cards to the source panel">Reset All</button>
                <button id="btnGuide" title="Show suggested positions for each source">Show Guide Positions</button>
            </div>
            <div class="grid-container" id="gridContainer">
                <canvas class="grid-canvas" id="gridCanvas"></canvas>
            </div>
        </div>

        <div class="info-panel">
            <div id="defaultInfo">
                <h2>Analysis Guide</h2>
                <div class="info-section">
                    <h3>How to Use</h3>
                    <p>Select a historical topic, then drag source cards onto the grid. Position each source based on two dimensions:</p>
                    <ul>
                        <li><strong>X-axis</strong>: Supportive (left) to Critical (right)</li>
                        <li><strong>Y-axis</strong>: Personal (bottom) to Official (top)</li>
                    </ul>
                </div>
                <div class="info-section">
                    <h3>Understanding Bias</h3>
                    <p>Every historical source carries bias. This does not make it unreliable; it means we must consider the author's purpose, audience, and context. Ask yourself:</p>
                    <ul>
                        <li>Who created this source and why?</li>
                        <li>Who was the intended audience?</li>
                        <li>What might the author have gained or lost?</li>
                        <li>What is missing or left unsaid?</li>
                    </ul>
                </div>
                <div class="info-section">
                    <h3>Provenance</h3>
                    <p>Provenance refers to the origin and history of a source. Understanding where a source comes from helps us judge its reliability and the perspective it represents.</p>
                </div>
                <div class="info-section">
                    <h3>Quadrant Guide</h3>
                    <ul>
                        <li><strong>Personal &amp; Supportive</strong> (bottom-left): Diaries, letters, memoirs that defend or praise the subject</li>
                        <li><strong>Official &amp; Supportive</strong> (top-left): Government reports, propaganda, official statements in favour</li>
                        <li><strong>Personal &amp; Critical</strong> (bottom-right): Private writings, testimonies that challenge or oppose</li>
                        <li><strong>Official &amp; Critical</strong> (top-right): Inquiries, opposition speeches, critical reports</li>
                    </ul>
                </div>
                <div class="info-section">
                    <h3>Cluster Analysis</h3>
                    <p>Once you have placed sources, click "Show Clusters" to see how perspectives group together. Sources that cluster tightly may share similar viewpoints, while outliers may offer unique or underrepresented perspectives.</p>
                </div>
            </div>
            <div id="sourceDetail" class="source-detail"></div>
        </div>
    </div>

    <script>
        const TOPICS = {
            ww1: {
                name: 'Causes of WW1',
                sources: [
                    {
                        id: 'ww1-1', label: 'Source A', title: 'Kaiser Wilhelm II, Speech to the Reichstag (1914)',
                        author: 'Kaiser Wilhelm II', date: '4 August 1914', type: 'Official speech',
                        quote: '"We draw the sword with a clean conscience and clean hands."',
                        context: 'Delivered to the German parliament on the day war was declared, seeking to justify German involvement and rally national support.',
                        provenance: 'Official transcript from the Reichstag proceedings. Published by the German government press office.',
                        bias: 'high', biasNote: 'As head of state, Wilhelm had a strong interest in presenting Germany as the wronged party. The speech was designed to unify the nation behind the war effort.',
                        guideX: 0.2, guideY: 0.85
                    },
                    {
                        id: 'ww1-2', label: 'Source B', title: 'Sir Edward Grey, Memoir (1925)',
                        author: 'Sir Edward Grey', date: '1925', type: 'Political memoir',
                        quote: '"The lamps are going out all over Europe; we shall not see them lit again in our lifetime."',
                        context: 'Written over a decade after the war, Grey (British Foreign Secretary in 1914) reflected on the diplomatic failures that led to conflict.',
                        provenance: 'Published memoir, "Twenty-Five Years", available in major archives. Written with benefit of hindsight.',
                        bias: 'medium', biasNote: 'Grey had reason to defend his own diplomatic record while appearing reflective. The passage of time allowed more measured assessment but also self-justification.',
                        guideX: 0.4, guideY: 0.7
                    },
                    {
                        id: 'ww1-3', label: 'Source C', title: 'Fritz Fischer, "Germany\'s Aims in the First World War" (1961)',
                        author: 'Fritz Fischer', date: '1961', type: 'Academic history',
                        quote: 'Fischer argued that Germany bore primary responsibility for the war through deliberate expansionist policy.',
                        context: 'A controversial German academic work that challenged the prevailing view of shared responsibility, sparking the "Fischer Controversy" in German historiography.',
                        provenance: 'Published academic monograph based on extensive archival research. Peer-reviewed and widely debated.',
                        bias: 'medium', biasNote: 'Fischer wrote in the context of post-WW2 Germany, where confronting national guilt was both necessary and politically charged. His thesis was groundbreaking but contested.',
                        guideX: 0.7, guideY: 0.75
                    },
                    {
                        id: 'ww1-4', label: 'Source D', title: 'Letter from a British Soldier, Ypres (1914)',
                        author: 'Private Thomas Atkins (pseudonym)', date: 'November 1914', type: 'Personal letter',
                        quote: '"We were told the Huns started it all, and I suppose they did, but the lads here just want to go home."',
                        context: 'A letter home from the Western Front during the first months of the war, reflecting ordinary soldiers\' experiences and understanding of the conflict.',
                        provenance: 'From the Imperial War Museum letter collection. Passed through military censorship before posting.',
                        bias: 'low', biasNote: 'While personal and honest in tone, the soldier had limited access to diplomatic information. Military censorship may have affected what was written.',
                        guideX: 0.45, guideY: 0.2
                    },
                    {
                        id: 'ww1-5', label: 'Source E', title: 'Austrian Ultimatum to Serbia (1914)',
                        author: 'Austro-Hungarian Government', date: '23 July 1914', type: 'Diplomatic document',
                        quote: 'The ultimatum demanded Serbia suppress anti-Austrian propaganda and allow Austrian officials to investigate on Serbian soil.',
                        context: 'Issued after the assassination of Archduke Franz Ferdinand, the ultimatum was deliberately designed to be unacceptable, providing a pretext for war.',
                        provenance: 'Official diplomatic correspondence, preserved in multiple national archives. Widely reproduced in documentary collections.',
                        bias: 'high', biasNote: 'The document was crafted as a political tool rather than a genuine attempt at resolution. Austria-Hungary intended Serbia to reject its terms.',
                        guideX: 0.3, guideY: 0.95
                    },
                    {
                        id: 'ww1-6', label: 'Source F', title: 'Rosa Luxemburg, "The Crisis in German Social Democracy" (1915)',
                        author: 'Rosa Luxemburg', date: '1915', type: 'Political pamphlet',
                        quote: 'Luxemburg condemned the war as an imperialist venture that betrayed the working class of every nation.',
                        context: 'Written while imprisoned for anti-war activism. Luxemburg was a leading socialist intellectual who opposed the war from the outset.',
                        provenance: 'Published clandestinely under the pseudonym "Junius". Later widely reprinted in socialist publications.',
                        bias: 'medium', biasNote: 'Luxemburg was an openly committed socialist and anti-war campaigner. Her ideological position shaped her analysis, but her critique drew on substantial evidence.',
                        guideX: 0.85, guideY: 0.35
                    },
                    {
                        id: 'ww1-7', label: 'Source G', title: 'British Recruitment Poster, "Your Country Needs You" (1914)',
                        author: 'Parliamentary Recruiting Committee', date: '1914', type: 'Propaganda poster',
                        quote: 'The iconic image of Lord Kitchener pointing directly at the viewer with the caption "Your Country Needs YOU".',
                        context: 'Part of a mass recruitment campaign before conscription was introduced in 1916. Designed to appeal to patriotic duty and personal honour.',
                        provenance: 'Produced by the British government. Millions of copies printed and distributed nationwide.',
                        bias: 'high', biasNote: 'Explicitly designed as propaganda to encourage enlistment. It presents the war as a clear moral duty and deliberately avoids any complexity.',
                        guideX: 0.1, guideY: 0.9
                    }
                ]
            },
            suffrage: {
                name: "Women's Suffrage",
                sources: [
                    {
                        id: 'suf-1', label: 'Source A', title: 'Emmeline Pankhurst, Speech at Hartford (1913)',
                        author: 'Emmeline Pankhurst', date: 'November 1913', type: 'Public speech',
                        quote: '"I am here as a soldier who has temporarily left the field of battle."',
                        context: 'Delivered during a fundraising tour of the United States, Pankhurst defended militant tactics and framed the suffrage campaign as a war for justice.',
                        provenance: 'Transcribed by journalists present. Multiple newspaper accounts corroborate the content.',
                        bias: 'medium', biasNote: 'Pankhurst was the leader of the WSPU and a committed campaigner. The speech was designed to raise funds and international support.',
                        guideX: 0.25, guideY: 0.3
                    },
                    {
                        id: 'suf-2', label: 'Source B', title: 'Herbert Asquith, Parliamentary Debate (1910)',
                        author: 'H.H. Asquith, Prime Minister', date: '1910', type: 'Parliamentary record',
                        quote: 'Asquith argued that the majority of women did not seek the vote and that enfranchisement would upset the natural order.',
                        context: 'Asquith was a persistent opponent of women\'s suffrage throughout his time as PM, blocking several bills despite growing public support.',
                        provenance: 'Hansard parliamentary record. Official, verbatim transcript of Commons debate.',
                        bias: 'high', biasNote: 'Asquith had a well-documented personal opposition to women\'s suffrage. His position shaped government policy for nearly a decade.',
                        guideX: 0.8, guideY: 0.9
                    },
                    {
                        id: 'suf-3', label: 'Source C', title: 'Millicent Fawcett, Letter to The Times (1906)',
                        author: 'Millicent Garrett Fawcett', date: '1906', type: 'Published letter',
                        quote: 'Fawcett urged peaceful, constitutional methods and warned that violence would harm the cause.',
                        context: 'Fawcett led the NUWSS (suffragists) and consistently advocated for lawful campaigning, often in tension with the Pankhursts\' militant approach.',
                        provenance: 'Published in The Times newspaper. Original held in the Women\'s Library archives.',
                        bias: 'medium', biasNote: 'Fawcett was deeply committed to the cause but sought to distinguish her organisation from the militants. Her criticism of WSPU tactics served strategic purposes.',
                        guideX: 0.35, guideY: 0.45
                    },
                    {
                        id: 'suf-4', label: 'Source D', title: 'Anti-Suffrage Postcard, "What a Woman May Be" (c.1910)',
                        author: 'Unknown publisher', date: 'c. 1910', type: 'Propaganda postcard',
                        quote: 'The postcard contrasted respectable female roles with male convicts, asking why women could not vote while criminals could.',
                        context: 'Actually a pro-suffrage postcard, widely distributed to highlight the absurdity of denying women the vote while male criminals retained it.',
                        provenance: 'From the Museum of London suffrage collection. Mass-produced and widely circulated.',
                        bias: 'medium', biasNote: 'Designed as persuasive propaganda for the suffrage cause. Simplifies a complex legal situation to make a powerful emotional point.',
                        guideX: 0.2, guideY: 0.15
                    },
                    {
                        id: 'suf-5', label: 'Source E', title: 'Force-Feeding Report, Home Office (1909)',
                        author: 'Home Office officials', date: '1909', type: 'Government report',
                        quote: 'The report described force-feeding as a necessary medical procedure to preserve the lives of hunger-striking prisoners.',
                        context: 'Suffragettes imprisoned for militant action went on hunger strike. The government authorised force-feeding, which became a major public controversy.',
                        provenance: 'Official Home Office papers, now in the National Archives. Written to justify government policy.',
                        bias: 'high', biasNote: 'The report was produced to defend a politically damaging policy. The clinical language deliberately obscured the violence of the procedure.',
                        guideX: 0.75, guideY: 0.85
                    },
                    {
                        id: 'suf-6', label: 'Source F', title: 'Hannah Mitchell, Autobiography "The Hard Way Up" (1968)',
                        author: 'Hannah Mitchell', date: '1968 (posthumous)', type: 'Autobiography',
                        quote: 'Mitchell described the exhaustion of combining suffrage activism with domestic duties that male campaigners never faced.',
                        context: 'Mitchell was a working-class suffragette from the north of England. Her memoir provides a rare perspective from outside the middle-class leadership.',
                        provenance: 'Published posthumously by her family. Manuscript held at Manchester Central Library.',
                        bias: 'low', biasNote: 'Written without expectation of publication, making it unusually candid. Mitchell was critical of both the movement\'s class bias and wider society.',
                        guideX: 0.6, guideY: 0.15
                    },
                    {
                        id: 'suf-7', label: 'Source G', title: 'The Cat and Mouse Act, Parliamentary Debates (1913)',
                        author: 'Parliament', date: 'April 1913', type: 'Legislation/debate',
                        quote: 'The Act allowed hunger-striking prisoners to be released when ill and re-arrested once recovered.',
                        context: 'Officially the Prisoners (Temporary Discharge for Ill Health) Act. Introduced after public outcry over force-feeding, it was widely condemned as cruel by suffrage supporters.',
                        provenance: 'Hansard record and official legislation. The nickname "Cat and Mouse Act" came from WSPU propaganda.',
                        bias: 'medium', biasNote: 'The legislation was framed as humanitarian but was designed to break the hunger strike tactic without the negative publicity of force-feeding.',
                        guideX: 0.65, guideY: 0.9
                    }
                ]
            },
            empire: {
                name: 'British Empire',
                sources: [
                    {
                        id: 'emp-1', label: 'Source A', title: 'Cecil Rhodes, "Confession of Faith" (1877)',
                        author: 'Cecil Rhodes', date: '1877', type: 'Personal writing',
                        quote: 'Rhodes wrote of the "duty" to spread British civilisation, describing the Anglo-Saxon race as "the best, the most human, most honourable race".',
                        context: 'Written as a young man, this private document reveals the racial ideology underpinning imperial expansion in southern Africa.',
                        provenance: 'Unpublished during Rhodes\'s lifetime. Found among his private papers and later published by biographers.',
                        bias: 'high', biasNote: 'Rhodes was one of the most committed imperialists of his era. His personal fortune depended on colonial exploitation in southern Africa.',
                        guideX: 0.12, guideY: 0.25
                    },
                    {
                        id: 'emp-2', label: 'Source B', title: 'Dadabhai Naoroji, "Poverty and Un-British Rule in India" (1901)',
                        author: 'Dadabhai Naoroji', date: '1901', type: 'Economic study',
                        quote: 'Naoroji calculated the systematic "drain of wealth" from India to Britain, arguing that imperial rule impoverished the Indian people.',
                        context: 'Naoroji was the first Indian MP in the British Parliament. His "drain theory" provided statistical evidence for the economic exploitation of India.',
                        provenance: 'Published academic work drawing on official trade and revenue statistics. Widely cited in Indian nationalist discourse.',
                        bias: 'medium', biasNote: 'Naoroji was an Indian nationalist, but his arguments were based on British government data. His position gave him unique insight into both systems.',
                        guideX: 0.8, guideY: 0.65
                    },
                    {
                        id: 'emp-3', label: 'Source C', title: 'Queen Victoria, Proclamation to the People of India (1858)',
                        author: 'Queen Victoria / British Government', date: '1 November 1858', type: 'Royal proclamation',
                        quote: 'The proclamation promised to respect Indian customs, religions, and rights, and to govern for the benefit of Indian subjects.',
                        context: 'Issued after the 1857 Indian Rebellion, transferring control from the East India Company to the Crown. It aimed to restore order and loyalty.',
                        provenance: 'Official Crown document, widely distributed across India in multiple languages.',
                        bias: 'high', biasNote: 'A political document designed to pacify India after violent rebellion. The promises made were often not honoured in practice.',
                        guideX: 0.15, guideY: 0.95
                    },
                    {
                        id: 'emp-4', label: 'Source D', title: 'Mary Seacole, "Wonderful Adventures of Mrs Seacole" (1857)',
                        author: 'Mary Seacole', date: '1857', type: 'Autobiography',
                        quote: 'Seacole described how she navigated racial prejudice within the empire while also expressing pride in her British identity.',
                        context: 'A Jamaican-born nurse who served in the Crimean War, Seacole occupied a complex position as both a beneficiary and a subject of empire.',
                        provenance: 'Published autobiography, commercially available in her lifetime. Recently reprinted and now widely studied.',
                        bias: 'medium', biasNote: 'Seacole wrote to rebuild her reputation and finances. Her positive portrayal of British identity may reflect strategic self-presentation as much as genuine feeling.',
                        guideX: 0.35, guideY: 0.2
                    },
                    {
                        id: 'emp-5', label: 'Source E', title: 'Mohandas Gandhi, "Hind Swaraj" (1909)',
                        author: 'Mohandas K. Gandhi', date: '1909', type: 'Political pamphlet',
                        quote: 'Gandhi argued that British civilisation was itself morally bankrupt and that India must seek its own path to self-rule.',
                        context: 'Written on a ship returning to South Africa, this short book laid out Gandhi\'s philosophy of resistance and his critique of Western modernity.',
                        provenance: 'First published in Gujarati in the journal Indian Opinion. Banned by the British authorities in India.',
                        bias: 'medium', biasNote: 'Gandhi was a committed anti-colonial campaigner. His critique extended beyond politics to a broader rejection of Western industrial civilisation.',
                        guideX: 0.85, guideY: 0.3
                    },
                    {
                        id: 'emp-6', label: 'Source F', title: 'Lord Macaulay, "Minute on Indian Education" (1835)',
                        author: 'Thomas Babington Macaulay', date: '1835', type: 'Government policy paper',
                        quote: 'Macaulay proposed creating "a class of persons, Indian in blood and colour, but English in taste, in opinions, in morals, and in intellect".',
                        context: 'This policy document shaped British educational policy in India for generations, promoting English-language education over indigenous learning.',
                        provenance: 'Official government minute, preserved in the India Office Records at the British Library.',
                        bias: 'high', biasNote: 'Macaulay openly expressed contempt for Indian learning and culture. The document reveals the cultural arrogance underpinning imperial education policy.',
                        guideX: 0.2, guideY: 0.85
                    },
                    {
                        id: 'emp-7', label: 'Source G', title: 'Olaudah Equiano, "The Interesting Narrative" (1789)',
                        author: 'Olaudah Equiano', date: '1789', type: 'Autobiography/campaign literature',
                        quote: 'Equiano described the horrors of the Middle Passage and enslaved life, while also demonstrating his own humanity and intelligence.',
                        context: 'Written to support the abolitionist movement. Equiano was formerly enslaved and became a prominent anti-slavery campaigner in Britain.',
                        provenance: 'Self-published and sold through subscription and abolitionist networks. Multiple editions printed in his lifetime.',
                        bias: 'medium', biasNote: 'Equiano wrote with the explicit purpose of influencing opinion against slavery. Some scholars have questioned details of his early biography.',
                        guideX: 0.75, guideY: 0.18
                    }
                ]
            },
            industrial: {
                name: 'Industrial Revolution',
                sources: [
                    {
                        id: 'ind-1', label: 'Source A', title: 'Andrew Ure, "The Philosophy of Manufactures" (1835)',
                        author: 'Andrew Ure', date: '1835', type: 'Published treatise',
                        quote: 'Ure described factories as places of cleanliness and order, where workers benefited from regular employment and moral discipline.',
                        context: 'Ure was a Scottish doctor and scientist who strongly supported industrialisation. His work was essentially a defence of the factory system.',
                        provenance: 'Published commercially. Widely read by factory owners and politicians. Cited in parliamentary debates on factory reform.',
                        bias: 'high', biasNote: 'Ure was paid to visit factories by their owners. His account consistently presented the best possible view of industrial working conditions.',
                        guideX: 0.12, guideY: 0.7
                    },
                    {
                        id: 'ind-2', label: 'Source B', title: 'Friedrich Engels, "The Condition of the Working Class in England" (1845)',
                        author: 'Friedrich Engels', date: '1845', type: 'Social investigation',
                        quote: 'Engels described Manchester\'s working-class districts as places of squalor, disease, and systematic exploitation.',
                        context: 'Engels was a German industrialist\'s son who became a communist revolutionary. He spent two years investigating conditions in Manchester.',
                        provenance: 'Published in German (1845), English translation 1887. Based on personal observation and official health reports.',
                        bias: 'medium', biasNote: 'Engels had a clear ideological purpose, but his observations drew on verifiable evidence. His account has been largely corroborated by other sources.',
                        guideX: 0.8, guideY: 0.4
                    },
                    {
                        id: 'ind-3', label: 'Source C', title: 'Sadler Committee Report on Child Labour (1832)',
                        author: 'Parliamentary Select Committee', date: '1832', type: 'Government inquiry',
                        quote: 'Witnesses described children working 14-hour days, being beaten for falling asleep, and suffering permanent physical damage.',
                        context: 'Michael Sadler MP chaired a committee investigating child labour in textile factories. The testimony led to the Factory Act of 1833.',
                        provenance: 'Official parliamentary papers. Witness testimony was given under oath but the committee\'s composition was weighted towards reformers.',
                        bias: 'medium', biasNote: 'Sadler was a committed reformer who selected witnesses sympathetically. Factory owners argued the evidence was one-sided. The subsequent Royal Commission gave a more balanced view.',
                        guideX: 0.7, guideY: 0.85
                    },
                    {
                        id: 'ind-4', label: 'Source D', title: 'Samuel Smiles, "Self-Help" (1859)',
                        author: 'Samuel Smiles', date: '1859', type: 'Self-improvement literature',
                        quote: 'Smiles celebrated industrialists like Josiah Wedgwood and George Stephenson as examples of what hard work and perseverance could achieve.',
                        context: 'An enormously popular Victorian book that promoted individual responsibility and enterprise. It became a bestseller and shaped middle-class Victorian values.',
                        provenance: 'Commercially published. Sold over 250,000 copies in the 19th century.',
                        bias: 'high', biasNote: 'Smiles presented industrial success as the result of individual virtue, ignoring structural advantages like wealth, connections, and the exploitation of workers.',
                        guideX: 0.15, guideY: 0.5
                    },
                    {
                        id: 'ind-5', label: 'Source E', title: 'Elizabeth Gaskell, "North and South" (1854)',
                        author: 'Elizabeth Gaskell', date: '1854-55', type: 'Novel',
                        quote: 'Gaskell portrayed the tensions between factory owners and workers with sympathy for both sides, while exposing the human cost of industrialisation.',
                        context: 'Gaskell lived in Manchester and witnessed industrial conditions first-hand. Her "social problem" novels brought these issues to a wide middle-class readership.',
                        provenance: 'Published as a serial in Dickens\'s Household Words magazine, then as a novel.',
                        bias: 'medium', biasNote: 'As a novelist, Gaskell had artistic licence. While based on real observation, the work is fiction and reflects her own middle-class perspective and desire for class reconciliation.',
                        guideX: 0.55, guideY: 0.25
                    },
                    {
                        id: 'ind-6', label: 'Source F', title: 'Robert Owen, "A New View of Society" (1813)',
                        author: 'Robert Owen', date: '1813', type: 'Reform proposal',
                        quote: 'Owen argued that good working conditions and education produced better, more productive workers, and proved it at his New Lanark mill.',
                        context: 'Owen was a factory owner who created a model industrial community at New Lanark, Scotland, with better housing, schooling, and shorter hours.',
                        provenance: 'Published essays, widely distributed. Owen\'s New Lanark was visited by thousands, including European royalty and reformers.',
                        bias: 'medium', biasNote: 'Owen had a genuine commitment to reform but also a commercial interest in proving his model profitable. His success at New Lanark was real but difficult to replicate.',
                        guideX: 0.4, guideY: 0.6
                    },
                    {
                        id: 'ind-7', label: 'Source G', title: 'Testimony of Sarah Carpenter, Factory Worker (1849)',
                        author: 'Sarah Carpenter', date: '1849', type: 'Oral testimony',
                        quote: 'Carpenter described being sent to a cotton mill as a child of ten, where she was beaten, overworked, and barely fed.',
                        context: 'Recorded by journalist John Brown for the Ashton Chronicle as part of a series on factory conditions. Carpenter was by then an elderly woman looking back on her childhood.',
                        provenance: 'Published in a local newspaper. Part of a wider journalistic investigation. The testimony was given decades after the events described.',
                        bias: 'low', biasNote: 'Carpenter had no political agenda, but memory over several decades can be unreliable. The journalist may have shaped the account for maximum impact.',
                        guideX: 0.75, guideY: 0.12
                    },
                    {
                        id: 'ind-8', label: 'Source H', title: 'Select Committee on the Health of Towns (1840)',
                        author: 'Parliamentary Select Committee', date: '1840', type: 'Government report',
                        quote: 'The report documented overcrowded housing, contaminated water, and shockingly low life expectancy in industrial towns.',
                        context: 'Part of a growing body of government inquiries that eventually led to public health reforms. The report contributed to the Public Health Act of 1848.',
                        provenance: 'Official parliamentary papers with statistical evidence gathered from local officials and medical officers.',
                        bias: 'low', biasNote: 'While the committee had a reforming agenda, the statistical evidence was gathered systematically and has been corroborated by modern research.',
                        guideX: 0.65, guideY: 0.8
                    }
                ]
            }
        };

        let currentTopic = 'ww1';
        let placements = {};
        let showClusters = false;
        let showGuide = false;
        let selectedSourceId = null;
        let dragData = null;

        const canvas = document.getElementById('gridCanvas');
        const ctx = canvas.getContext('2d');
        const gridContainer = document.getElementById('gridContainer');
        const cardContainer = document.getElementById('cardContainer');

        function resizeCanvas() {
            const rect = gridContainer.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            drawGrid();
        }

        function drawGrid() {
            const w = canvas.width, h = canvas.height;
            const pad = 40;
            ctx.clearRect(0, 0, w, h);

            // Quadrant backgrounds
            const gw = w - pad * 2, gh = h - pad * 2;
            ctx.globalAlpha = 0.25;
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--colour-quadrant-ps').trim();
            ctx.fillRect(pad, h / 2, gw / 2, gh / 2);
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--colour-quadrant-os').trim();
            ctx.fillRect(pad, pad, gw / 2, gh / 2);
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--colour-quadrant-pc').trim();
            ctx.fillRect(w / 2, h / 2, gw / 2, gh / 2);
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--colour-quadrant-oc').trim();
            ctx.fillRect(w / 2, pad, gw / 2, gh / 2);
            ctx.globalAlpha = 1;

            // Grid lines
            ctx.strokeStyle = '#d4c4a8';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            for (let i = 1; i <= 3; i++) {
                const x = pad + (gw / 4) * i;
                ctx.beginPath(); ctx.moveTo(x, pad); ctx.lineTo(x, h - pad); ctx.stroke();
                const y = pad + (gh / 4) * i;
                ctx.beginPath(); ctx.moveTo(pad, y); ctx.lineTo(w - pad, y); ctx.stroke();
            }
            ctx.setLineDash([]);

            // Axes
            ctx.strokeStyle = '#5c3d2e';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(pad, h / 2); ctx.lineTo(w - pad, h / 2); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(w / 2, pad); ctx.lineTo(w / 2, h - pad); ctx.stroke();

            // Labels
            ctx.fillStyle = '#5c3d2e';
            ctx.font = 'bold 11px -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('SUPPORTIVE', pad + gw * 0.25, h / 2 - 6);
            ctx.fillText('CRITICAL', pad + gw * 0.75, h / 2 - 6);
            ctx.save();
            ctx.translate(w / 2 + 6, pad + gh * 0.25);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('OFFICIAL', 0, 0);
            ctx.restore();
            ctx.save();
            ctx.translate(w / 2 + 6, pad + gh * 0.75);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('PERSONAL', 0, 0);
            ctx.restore();

            // Quadrant labels
            ctx.font = 'italic 9px -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.fillStyle = '#7a6555';
            ctx.fillText('Personal & Supportive', pad + gw * 0.25, h - pad + 14);
            ctx.fillText('Personal & Critical', pad + gw * 0.75, h - pad + 14);
            ctx.fillText('Official & Supportive', pad + gw * 0.25, pad - 8);
            ctx.fillText('Official & Critical', pad + gw * 0.75, pad - 8);

            // Arrow heads
            ctx.fillStyle = '#5c3d2e';
            drawArrow(ctx, w - pad, h / 2, 0);
            drawArrow(ctx, pad, h / 2, Math.PI);
            drawArrow(ctx, w / 2, pad, -Math.PI / 2);
            drawArrow(ctx, w / 2, h - pad, Math.PI / 2);

            // Guide positions
            if (showGuide) {
                const sources = TOPICS[currentTopic].sources;
                sources.forEach(s => {
                    const gx = pad + s.guideX * gw;
                    const gy = pad + (1 - s.guideY) * gh;
                    ctx.beginPath();
                    ctx.arc(gx, gy, 12, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(184, 134, 11, 0.15)';
                    ctx.fill();
                    ctx.strokeStyle = 'rgba(184, 134, 11, 0.5)';
                    ctx.lineWidth = 1.5;
                    ctx.setLineDash([3, 3]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    ctx.fillStyle = 'rgba(184, 134, 11, 0.7)';
                    ctx.font = 'bold 8px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(s.label, gx, gy + 3);
                });
            }

            // Cluster analysis
            if (showClusters) {
                drawClusters();
            }
        }

        function drawArrow(ctx, x, y, angle) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(-8, -4);
            ctx.lineTo(-8, 4);
            ctx.closePath();
            ctx.fill();
            ctx.restore();
        }

        function drawClusters() {
            const placed = Object.values(placements);
            if (placed.length < 2) return;
            const pad = 40;
            const w = canvas.width, h = canvas.height;
            const gw = w - pad * 2, gh = h - pad * 2;
            const colours = ['rgba(198, 40, 40, 0.12)', 'rgba(21, 101, 192, 0.12)', 'rgba(46, 125, 50, 0.12)', 'rgba(106, 27, 154, 0.12)'];
            const strokeColours = ['rgba(198, 40, 40, 0.5)', 'rgba(21, 101, 192, 0.5)', 'rgba(46, 125, 50, 0.5)', 'rgba(106, 27, 154, 0.5)'];

            // Simple quadrant-based clustering
            const quadrants = [[], [], [], []];
            placed.forEach(p => {
                const qi = (p.x < 0.5 ? 0 : 1) + (p.y < 0.5 ? 0 : 2);
                quadrants[qi].push(p);
            });

            quadrants.forEach((cluster, qi) => {
                if (cluster.length < 1) return;
                if (cluster.length === 1) {
                    const p = cluster[0];
                    const cx = pad + p.x * gw;
                    const cy = pad + (1 - p.y) * gh;
                    ctx.beginPath();
                    ctx.arc(cx, cy, 30, 0, Math.PI * 2);
                    ctx.fillStyle = colours[qi];
                    ctx.fill();
                    ctx.strokeStyle = strokeColours[qi];
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                    return;
                }
                const cx = cluster.reduce((s, p) => s + p.x, 0) / cluster.length;
                const cy = cluster.reduce((s, p) => s + p.y, 0) / cluster.length;
                const maxDist = Math.max(40, ...cluster.map(p => {
                    const dx = (p.x - cx) * gw;
                    const dy = ((1 - p.y) - (1 - cy)) * gh;
                    return Math.sqrt(dx * dx + dy * dy);
                })) + 25;

                const screenCx = pad + cx * gw;
                const screenCy = pad + (1 - cy) * gh;
                ctx.beginPath();
                ctx.arc(screenCx, screenCy, maxDist, 0, Math.PI * 2);
                ctx.fillStyle = colours[qi];
                ctx.fill();
                ctx.strokeStyle = strokeColours[qi];
                ctx.lineWidth = 1.5;
                ctx.stroke();
            });
        }

        function renderCards() {
            cardContainer.innerHTML = '';
            const sources = TOPICS[currentTopic].sources;
            sources.forEach(source => {
                const card = document.createElement('div');
                card.className = 'source-card' + (placements[source.id] ? ' placed' : '');
                card.setAttribute('draggable', 'true');
                card.dataset.sourceId = source.id;
                card.innerHTML = `<span class="card-label">${source.label}: ${source.title.split(',')[0]}</span><span class="card-author">${source.author}, ${source.date}</span>`;

                card.addEventListener('dragstart', e => {
                    dragData = source.id;
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', source.id);
                    card.style.opacity = '0.5';
                });
                card.addEventListener('dragend', () => { card.style.opacity = ''; });
                card.addEventListener('click', () => showSourceDetail(source.id));
                cardContainer.appendChild(card);
            });
        }

        function renderPlacedCards() {
            gridContainer.querySelectorAll('.placed-card').forEach(el => el.remove());
            const pad = 40;
            const rect = gridContainer.getBoundingClientRect();
            const gw = rect.width - pad * 2, gh = rect.height - pad * 2;

            Object.entries(placements).forEach(([sourceId, pos]) => {
                if (!sourceId.startsWith(currentTopic.substring(0, 3))) {
                    const topicSources = TOPICS[currentTopic].sources;
                    const match = topicSources.find(s => s.id === sourceId);
                    if (!match) return;
                }
                const source = findSource(sourceId);
                if (!source) return;
                const el = document.createElement('div');
                el.className = 'placed-card' + (selectedSourceId === sourceId ? ' selected' : '');
                el.textContent = source.label;
                el.style.left = (pad + pos.x * gw) + 'px';
                el.style.top = (pad + (1 - pos.y) * gh) + 'px';
                el.title = source.title;

                el.addEventListener('click', e => {
                    e.stopPropagation();
                    selectedSourceId = sourceId;
                    showSourceDetail(sourceId);
                    renderPlacedCards();
                });

                // Allow re-dragging placed cards
                el.setAttribute('draggable', 'true');
                el.addEventListener('dragstart', e => {
                    dragData = sourceId;
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', sourceId);
                });

                gridContainer.appendChild(el);
            });
        }

        function findSource(id) {
            for (const topic of Object.values(TOPICS)) {
                const found = topic.sources.find(s => s.id === id);
                if (found) return found;
            }
            return null;
        }

        function showSourceDetail(sourceId) {
            const source = findSource(sourceId);
            if (!source) return;
            selectedSourceId = sourceId;
            const detail = document.getElementById('sourceDetail');
            const defaultInfo = document.getElementById('defaultInfo');
            defaultInfo.style.display = 'none';
            detail.className = 'source-detail visible';

            const biasClass = source.bias === 'high' ? 'bias-high' : source.bias === 'medium' ? 'bias-medium' : 'bias-low';
            const biasLabel = source.bias === 'high' ? 'High Bias' : source.bias === 'medium' ? 'Moderate Bias' : 'Low Bias';

            const placement = placements[sourceId];
            let positionNote = '';
            if (placement) {
                const xLabel = placement.x < 0.35 ? 'Supportive' : placement.x > 0.65 ? 'Critical' : 'Balanced';
                const yLabel = placement.y > 0.65 ? 'Official' : placement.y < 0.35 ? 'Personal' : 'Mixed';
                positionNote = `<div class="detail-field"><label>Your Placement</label><p>${yLabel} &amp; ${xLabel} (X: ${Math.round(placement.x * 100)}%, Y: ${Math.round(placement.y * 100)}%)</p></div>`;
            }

            detail.innerHTML = `
                <h2>Source Detail</h2>
                <div class="detail-title">${source.title}</div>
                <div class="detail-meta">${source.type} | ${source.date}</div>
                <div class="detail-field">
                    <label>Key Quote</label>
                    <blockquote>${source.quote}</blockquote>
                </div>
                <div class="detail-field">
                    <label>Context</label>
                    <p>${source.context}</p>
                </div>
                <div class="detail-field">
                    <label>Provenance</label>
                    <p>${source.provenance}</p>
                </div>
                <div class="detail-field">
                    <label>Bias Assessment</label>
                    <p><span class="bias-indicator ${biasClass}">${biasLabel}</span></p>
                    <p style="margin-top:6px">${source.biasNote}</p>
                </div>
                ${positionNote}
                <div class="detail-field">
                    <label>Questions to Consider</label>
                    <ul style="padding-left:16px;font-size:0.8rem;color:var(--colour-text-muted)">
                        <li>Does the author's position influence their perspective?</li>
                        <li>What might be missing from this account?</li>
                        <li>How does the date of creation affect its reliability?</li>
                        <li>Who was the intended audience?</li>
                    </ul>
                </div>
                <button onclick="deselectSource()" style="margin-top:8px;padding:6px 14px;border:1px solid var(--colour-border);border-radius:var(--radius);background:var(--colour-surface);cursor:pointer;font-size:0.78rem;">Back to Guide</button>
            `;
            renderPlacedCards();
        }

        function deselectSource() {
            selectedSourceId = null;
            document.getElementById('sourceDetail').className = 'source-detail';
            document.getElementById('defaultInfo').style.display = 'block';
            renderPlacedCards();
        }

        // Drag and drop on grid
        gridContainer.addEventListener('dragover', e => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        });

        gridContainer.addEventListener('drop', e => {
            e.preventDefault();
            if (!dragData) return;
            const rect = gridContainer.getBoundingClientRect();
            const pad = 40;
            const gw = rect.width - pad * 2;
            const gh = rect.height - pad * 2;
            const localX = e.clientX - rect.left;
            const localY = e.clientY - rect.top;
            const normX = Math.max(0, Math.min(1, (localX - pad) / gw));
            const normY = Math.max(0, Math.min(1, 1 - (localY - pad) / gh));

            placements[dragData] = { x: normX, y: normY };
            dragData = null;
            renderCards();
            renderPlacedCards();
            drawGrid();
        });

        // Topic switching
        document.querySelectorAll('.topic-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.topic-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTopic = btn.dataset.topic;
                selectedSourceId = null;
                document.getElementById('sourceDetail').className = 'source-detail';
                document.getElementById('defaultInfo').style.display = 'block';
                renderCards();
                renderPlacedCards();
                drawGrid();
            });
        });

        // Controls
        document.getElementById('btnCluster').addEventListener('click', function () {
            showClusters = !showClusters;
            this.classList.toggle('active-toggle', showClusters);
            drawGrid();
        });

        document.getElementById('btnGuide').addEventListener('click', function () {
            showGuide = !showGuide;
            this.classList.toggle('active-toggle', showGuide);
            drawGrid();
        });

        document.getElementById('btnReset').addEventListener('click', () => {
            const sources = TOPICS[currentTopic].sources;
            sources.forEach(s => delete placements[s.id]);
            selectedSourceId = null;
            document.getElementById('sourceDetail').className = 'source-detail';
            document.getElementById('defaultInfo').style.display = 'block';
            renderCards();
            renderPlacedCards();
            drawGrid();
        });

        // Handle resize
        window.addEventListener('resize', () => {
            resizeCanvas();
            renderPlacedCards();
        });

        // Initialise
        resizeCanvas();
        renderCards();
    </script>
</body>
</html>
