<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gender &amp; Article Patterns | French</title>
<style>
:root {
  --purple-dark: #4a1a6b;
  --purple-mid: #6b3fa0;
  --purple-light: #9b6dd7;
  --violet-bg: #f3edfa;
  --violet-card: #ede4f7;
  --masc-blue: #3b82f6;
  --masc-blue-light: #dbeafe;
  --masc-blue-border: #60a5fa;
  --fem-pink: #db2777;
  --fem-pink-light: #fce7f3;
  --fem-pink-border: #f472b6;
  --correct-green: #16a34a;
  --correct-green-bg: #dcfce7;
  --incorrect-red: #dc2626;
  --incorrect-red-bg: #fee2e2;
  --text-primary: #1e1b2e;
  --text-secondary: #4a4560;
  --text-muted: #7c7494;
  --bg-white: #ffffff;
  --bg-page: #f8f5fd;
  --border-light: #e2daf0;
  --shadow-sm: 0 1px 3px rgba(74,26,107,0.08);
  --shadow-md: 0 4px 12px rgba(74,26,107,0.12);
  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 16px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg-page);
  color: var(--text-primary);
  line-height: 1.5;
  min-height: 100vh;
}

/* Sticky Header */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: linear-gradient(135deg, var(--purple-dark), var(--purple-mid));
  color: #fff;
  padding: 16px 24px;
  box-shadow: 0 2px 12px rgba(74,26,107,0.25);
}

.header h1 {
  font-size: 1.5rem;
  font-weight: 700;
  letter-spacing: -0.02em;
}

.header p {
  font-size: 0.85rem;
  opacity: 0.85;
  margin-top: 2px;
}

/* Tab Navigation */
.tab-bar {
  display: flex;
  gap: 4px;
  background: var(--bg-white);
  padding: 6px;
  margin: 16px 20px 0;
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-sm);
}

.tab-btn {
  flex: 1;
  padding: 10px 16px;
  border: none;
  border-radius: var(--radius-sm);
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  background: transparent;
  color: var(--text-secondary);
  transition: all 0.2s;
}

.tab-btn.active {
  background: var(--purple-mid);
  color: #fff;
  box-shadow: var(--shadow-sm);
}

.tab-btn:hover:not(.active) { background: var(--violet-bg); }

/* Main container */
.container { max-width: 1100px; margin: 0 auto; padding: 16px 20px 40px; }

.panel { display: none; }
.panel.active { display: block; }

/* Section headings */
.section-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--purple-dark);
  margin: 24px 0 12px;
}

.section-subtitle {
  font-size: 0.85rem;
  color: var(--text-muted);
  margin: -8px 0 12px;
}

/* Filter buttons */
.filter-row {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 16px;
}

.filter-btn {
  padding: 6px 14px;
  border: 2px solid var(--border-light);
  border-radius: 20px;
  background: var(--bg-white);
  font-size: 0.82rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  color: var(--text-secondary);
}

.filter-btn.active {
  border-color: var(--purple-mid);
  background: var(--purple-mid);
  color: #fff;
}

.filter-btn:hover:not(.active) {
  border-color: var(--purple-light);
  background: var(--violet-bg);
}

/* Sort bar */
.sort-bar {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 16px;
  font-size: 0.85rem;
  color: var(--text-muted);
}

.sort-bar select {
  padding: 6px 10px;
  border: 2px solid var(--border-light);
  border-radius: var(--radius-sm);
  font-size: 0.82rem;
  background: var(--bg-white);
  color: var(--text-primary);
  cursor: pointer;
}

/* Rule banner */
.rule-banner {
  display: none;
  background: var(--violet-card);
  border-left: 4px solid var(--purple-mid);
  padding: 12px 16px;
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  margin-bottom: 16px;
  font-size: 0.88rem;
  color: var(--purple-dark);
  font-weight: 500;
}

.rule-banner.visible { display: block; }

.rule-banner .accuracy {
  display: inline-block;
  margin-left: 8px;
  background: var(--purple-mid);
  color: #fff;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 0.78rem;
}

/* Bar chart */
.chart-container {
  background: var(--bg-white);
  border-radius: var(--radius-md);
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: var(--shadow-sm);
}

.chart-row {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
  font-size: 0.82rem;
}

.chart-label {
  width: 90px;
  font-weight: 600;
  color: var(--text-secondary);
  text-align: right;
  padding-right: 10px;
  flex-shrink: 0;
}

.chart-bars {
  flex: 1;
  display: flex;
  height: 24px;
  border-radius: 4px;
  overflow: hidden;
  background: #f0ecf5;
}

.chart-bar-m {
  background: var(--masc-blue);
  height: 100%;
  transition: width 0.4s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 0.72rem;
  font-weight: 700;
  min-width: 0;
}

.chart-bar-f {
  background: var(--fem-pink);
  height: 100%;
  transition: width 0.4s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 0.72rem;
  font-weight: 700;
  min-width: 0;
}

.chart-legend {
  display: flex;
  gap: 20px;
  justify-content: center;
  margin-top: 12px;
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.chart-legend span::before {
  content: '';
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 3px;
  margin-right: 5px;
  vertical-align: middle;
}

.chart-legend .leg-m::before { background: var(--masc-blue); }
.chart-legend .leg-f::before { background: var(--fem-pink); }

/* Noun cards grid */
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
  gap: 10px;
  margin-bottom: 24px;
}

.noun-card {
  background: var(--bg-white);
  border-radius: var(--radius-md);
  padding: 14px 16px;
  border-left: 5px solid transparent;
  box-shadow: var(--shadow-sm);
  transition: transform 0.15s, box-shadow 0.15s;
}

.noun-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.noun-card.masc { border-left-color: var(--masc-blue-border); }
.noun-card.fem { border-left-color: var(--fem-pink-border); }

.noun-card .article {
  font-size: 0.78rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.noun-card.masc .article { color: var(--masc-blue); }
.noun-card.fem .article { color: var(--fem-pink); }

.noun-card .word {
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--text-primary);
  margin: 2px 0;
}

.noun-card .meaning {
  font-size: 0.78rem;
  color: var(--text-muted);
  font-style: italic;
}

.noun-card .ending-tag {
  display: inline-block;
  margin-top: 6px;
  padding: 1px 8px;
  border-radius: 10px;
  font-size: 0.7rem;
  font-weight: 600;
  background: var(--violet-bg);
  color: var(--purple-mid);
}

.card-count {
  font-size: 0.82rem;
  color: var(--text-muted);
  margin-bottom: 10px;
}

/* Exceptions panel */
.exceptions-box {
  background: #fffbeb;
  border: 2px solid #f59e0b;
  border-radius: var(--radius-md);
  padding: 16px 20px;
  margin-bottom: 24px;
}

.exceptions-box h3 {
  color: #b45309;
  font-size: 0.95rem;
  margin-bottom: 8px;
}

.exceptions-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.exception-chip {
  padding: 4px 12px;
  border-radius: 16px;
  font-size: 0.8rem;
  font-weight: 600;
}

.exception-chip.masc {
  background: var(--masc-blue-light);
  color: var(--masc-blue);
}

.exception-chip.fem {
  background: var(--fem-pink-light);
  color: var(--fem-pink);
}

/* Info panel */
.info-panel {
  background: var(--bg-white);
  border-radius: var(--radius-md);
  padding: 20px 24px;
  box-shadow: var(--shadow-sm);
  margin-bottom: 24px;
}

.info-panel h3 {
  font-size: 0.95rem;
  color: var(--purple-dark);
  margin-bottom: 8px;
}

.info-panel p, .info-panel li {
  font-size: 0.85rem;
  color: var(--text-secondary);
  margin-bottom: 6px;
}

.info-panel ul {
  padding-left: 20px;
  margin-bottom: 12px;
}

/* Quiz Mode */
.quiz-header {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
  margin-bottom: 16px;
}

.quiz-stat {
  background: var(--bg-white);
  padding: 10px 18px;
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-sm);
  text-align: center;
  min-width: 90px;
}

.quiz-stat .stat-value {
  font-size: 1.4rem;
  font-weight: 800;
  color: var(--purple-dark);
}

.quiz-stat .stat-label {
  font-size: 0.72rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.quiz-stat.streak .stat-value { color: #f59e0b; }

.difficulty-bar {
  display: flex;
  gap: 6px;
  margin-bottom: 20px;
}

.diff-btn {
  padding: 6px 16px;
  border: 2px solid var(--border-light);
  border-radius: 20px;
  background: var(--bg-white);
  font-size: 0.82rem;
  font-weight: 600;
  cursor: pointer;
  color: var(--text-secondary);
  transition: all 0.2s;
}

.diff-btn.active {
  border-color: var(--purple-mid);
  background: var(--purple-mid);
  color: #fff;
}

.diff-btn:hover:not(.active) { background: var(--violet-bg); }

.quiz-card {
  background: var(--bg-white);
  border-radius: var(--radius-lg);
  padding: 32px;
  text-align: center;
  box-shadow: var(--shadow-md);
  max-width: 500px;
  margin: 0 auto 20px;
}

.quiz-card .quiz-prompt {
  font-size: 0.85rem;
  color: var(--text-muted);
  margin-bottom: 8px;
}

.quiz-card .quiz-noun {
  font-size: 2.2rem;
  font-weight: 800;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.quiz-card .quiz-meaning {
  font-size: 0.9rem;
  color: var(--text-muted);
  font-style: italic;
  margin-bottom: 24px;
}

.quiz-buttons {
  display: flex;
  gap: 16px;
  justify-content: center;
}

.quiz-btn {
  padding: 14px 40px;
  border: 3px solid;
  border-radius: var(--radius-md);
  font-size: 1.2rem;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.15s;
}

.quiz-btn.btn-le {
  border-color: var(--masc-blue);
  background: var(--masc-blue-light);
  color: var(--masc-blue);
}

.quiz-btn.btn-le:hover {
  background: var(--masc-blue);
  color: #fff;
}

.quiz-btn.btn-la {
  border-color: var(--fem-pink);
  background: var(--fem-pink-light);
  color: var(--fem-pink);
}

.quiz-btn.btn-la:hover {
  background: var(--fem-pink);
  color: #fff;
}

.quiz-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Feedback */
.feedback {
  display: none;
  padding: 16px 20px;
  border-radius: var(--radius-md);
  margin: 16px auto;
  max-width: 500px;
  text-align: center;
}

.feedback.visible { display: block; }

.feedback.correct {
  background: var(--correct-green-bg);
  border: 2px solid var(--correct-green);
}

.feedback.incorrect {
  background: var(--incorrect-red-bg);
  border: 2px solid var(--incorrect-red);
}

.feedback .fb-icon {
  font-size: 1.5rem;
  margin-bottom: 4px;
}

.feedback .fb-text {
  font-size: 0.9rem;
  font-weight: 600;
}

.feedback .fb-rule {
  font-size: 0.82rem;
  color: var(--text-secondary);
  margin-top: 4px;
}

.next-btn {
  display: none;
  margin: 12px auto;
  padding: 10px 28px;
  border: none;
  border-radius: var(--radius-sm);
  background: var(--purple-mid);
  color: #fff;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}

.next-btn.visible { display: block; }
.next-btn:hover { background: var(--purple-dark); }

.quiz-progress {
  max-width: 500px;
  margin: 0 auto 16px;
  height: 6px;
  background: var(--border-light);
  border-radius: 3px;
  overflow: hidden;
}

.quiz-progress-bar {
  height: 100%;
  background: var(--purple-mid);
  border-radius: 3px;
  transition: width 0.3s;
}

/* Responsive */
@media (max-width: 600px) {
  .header { padding: 12px 16px; }
  .header h1 { font-size: 1.2rem; }
  .container { padding: 12px 14px 32px; }
  .cards-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 8px; }
  .noun-card { padding: 10px 12px; }
  .quiz-card { padding: 24px 16px; }
  .quiz-card .quiz-noun { font-size: 1.7rem; }
  .quiz-btn { padding: 12px 28px; font-size: 1rem; }
  .chart-label { width: 70px; font-size: 0.75rem; }
  .tab-bar { margin: 10px 14px 0; }
}
</style>
</head>
<body>

<header class="header">
  <h1>Gender &amp; Article Patterns</h1>
  <p>Discover French noun gender rules through patterns and practice</p>
</header>

<div class="tab-bar">
  <button class="tab-btn active" data-tab="explore" onclick="switchTab('explore')">Explore</button>
  <button class="tab-btn" data-tab="quiz" onclick="switchTab('quiz')">Quiz</button>
  <button class="tab-btn" data-tab="info" onclick="switchTab('info')">Info</button>
</div>

<div class="container">

  <!-- EXPLORE PANEL -->
  <div id="panel-explore" class="panel active">
    <h2 class="section-title">Filter by Ending Pattern</h2>
    <div id="filter-buttons" class="filter-row"></div>

    <div id="rule-banner" class="rule-banner"></div>

    <h2 class="section-title">Gender Distribution by Ending</h2>
    <p class="section-subtitle">Percentage of masculine (blue) vs feminine (pink) nouns for each ending pattern</p>
    <div id="chart-container" class="chart-container"></div>

    <div class="sort-bar">
      <span>Sort by:</span>
      <select id="sort-select" onchange="renderCards()">
        <option value="alpha">Alphabetical</option>
        <option value="ending">By ending</option>
        <option value="gender">By gender</option>
      </select>
      <span id="card-count" class="card-count"></span>
    </div>

    <div id="cards-grid" class="cards-grid"></div>

    <div class="exceptions-box">
      <h3>Key Exceptions: Nouns That Break the Rules</h3>
      <div id="exceptions-list" class="exceptions-list"></div>
    </div>
  </div>

  <!-- QUIZ PANEL -->
  <div id="panel-quiz" class="panel">
    <div class="quiz-header">
      <div class="quiz-stat"><div class="stat-value" id="quiz-score">0</div><div class="stat-label">Score</div></div>
      <div class="quiz-stat"><div class="stat-value" id="quiz-total">0</div><div class="stat-label">Answered</div></div>
      <div class="quiz-stat"><div class="stat-value" id="quiz-pct">0%</div><div class="stat-label">Accuracy</div></div>
      <div class="quiz-stat streak"><div class="stat-value" id="quiz-streak">0</div><div class="stat-label">Streak</div></div>
    </div>

    <div class="difficulty-bar">
      <button class="diff-btn active" data-diff="common" onclick="setDifficulty('common')">Common Nouns</button>
      <button class="diff-btn" data-diff="tricky" onclick="setDifficulty('tricky')">Tricky Exceptions</button>
      <button class="diff-btn" data-diff="all" onclick="setDifficulty('all')">All Nouns</button>
    </div>

    <div class="quiz-progress"><div class="quiz-progress-bar" id="quiz-progress-bar"></div></div>

    <div class="quiz-card" id="quiz-card">
      <div class="quiz-prompt">What is the article?</div>
      <div class="quiz-noun" id="quiz-noun"></div>
      <div class="quiz-meaning" id="quiz-meaning"></div>
      <div class="quiz-buttons">
        <button class="quiz-btn btn-le" id="btn-le" onclick="answerQuiz('m')">le</button>
        <button class="quiz-btn btn-la" id="btn-la" onclick="answerQuiz('f')">la</button>
      </div>
    </div>

    <div id="quiz-feedback" class="feedback"></div>
    <button id="next-btn" class="next-btn" onclick="nextQuestion()">Next Noun</button>
  </div>

  <!-- INFO PANEL -->
  <div id="panel-info" class="panel">
    <div class="info-panel">
      <h3>Why Does Gender Matter in French?</h3>
      <p>Every French noun is either masculine or feminine. This is not optional: gender affects articles (le/la/un/une), adjective agreements, pronoun use, and even past participle endings. Getting gender wrong can change meaning or make sentences grammatically incorrect.</p>
      <p>For example: <strong>le livre</strong> (the book) vs <strong>la livre</strong> (the pound). The article changes the meaning entirely.</p>
    </div>
    <div class="info-panel">
      <h3>How to Learn Noun Gender Effectively</h3>
      <ul>
        <li><strong>Always learn the article with the noun.</strong> Never memorise "maison", always memorise "la maison".</li>
        <li><strong>Use colour coding.</strong> Write masculine nouns in blue, feminine in pink (or any two colours).</li>
        <li><strong>Learn ending patterns.</strong> This app helps you see which endings predict gender most reliably.</li>
        <li><strong>Focus on exceptions.</strong> Once you know the pattern, spend extra time on the nouns that break the rule.</li>
        <li><strong>Practice with context.</strong> Use nouns in full sentences to reinforce the correct article.</li>
      </ul>
    </div>
    <div class="info-panel">
      <h3>The Most Reliable Patterns</h3>
      <ul>
        <li><strong>Almost always feminine:</strong> -tion, -sion, -ance, -ence, -ie, -ette, -euse, -ure, -ise</li>
        <li><strong>Almost always masculine:</strong> -ment, -age, -isme, -eau, -eur (agent nouns), -ier, -in, -oir</li>
        <li><strong>Mixed or unreliable:</strong> -e (most common ending, roughly 65% feminine but many masculine nouns too)</li>
      </ul>
    </div>
    <div class="info-panel">
      <h3>What About l' (elision)?</h3>
      <p>When a noun begins with a vowel or silent h, both "le" and "la" become "l'". The gender does not disappear; you simply cannot hear it in the article. This is why vowel-initial nouns are trickier to learn: <strong>l'homme</strong> (m.), <strong>l'eau</strong> (f.), <strong>l'arbre</strong> (m.), <strong>l'image</strong> (f.).</p>
      <p>Tip: check with "un" (masculine) or "une" (feminine) to confirm the gender when the article is elided.</p>
    </div>
  </div>

</div>

<script>
const NOUNS = [
  // -tion (feminine)
  { word: "nation", meaning: "nation", gender: "f", article: "la", ending: "-tion", exception: false },
  { word: "situation", meaning: "situation", gender: "f", article: "la", ending: "-tion", exception: false },
  { word: "education", meaning: "education", gender: "l'", article: "l'", ending: "-tion", exception: false, realGender: "f" },
  { word: "solution", meaning: "solution", gender: "f", article: "la", ending: "-tion", exception: false },
  { word: "tradition", meaning: "tradition", gender: "f", article: "la", ending: "-tion", exception: false },
  { word: "information", meaning: "information", gender: "f", article: "l'", ending: "-tion", exception: false },
  { word: "question", meaning: "question", gender: "f", article: "la", ending: "-tion", exception: false },
  // -ment (masculine)
  { word: "moment", meaning: "moment", gender: "m", article: "le", ending: "-ment", exception: false },
  { word: "gouvernement", meaning: "government", gender: "m", article: "le", ending: "-ment", exception: false },
  { word: "mouvement", meaning: "movement", gender: "m", article: "le", ending: "-ment", exception: false },
  { word: "sentiment", meaning: "feeling", gender: "m", article: "le", ending: "-ment", exception: false },
  { word: "appartement", meaning: "flat", gender: "m", article: "l'", ending: "-ment", exception: false },
  { word: "document", meaning: "document", gender: "m", article: "le", ending: "-ment", exception: false },
  // -age (masculine)
  { word: "village", meaning: "village", gender: "m", article: "le", ending: "-age", exception: false },
  { word: "voyage", meaning: "journey", gender: "m", article: "le", ending: "-age", exception: false },
  { word: "paysage", meaning: "landscape", gender: "m", article: "le", ending: "-age", exception: false },
  { word: "fromage", meaning: "cheese", gender: "m", article: "le", ending: "-age", exception: false },
  { word: "garage", meaning: "garage", gender: "m", article: "le", ending: "-age", exception: false },
  { word: "message", meaning: "message", gender: "m", article: "le", ending: "-age", exception: false },
  { word: "image", meaning: "image", gender: "f", article: "l'", ending: "-age", exception: true },
  { word: "plage", meaning: "beach", gender: "f", article: "la", ending: "-age", exception: true },
  // -eur (masculine)
  { word: "professeur", meaning: "teacher", gender: "m", article: "le", ending: "-eur", exception: false },
  { word: "ordinateur", meaning: "computer", gender: "m", article: "l'", ending: "-eur", exception: false },
  { word: "directeur", meaning: "director", gender: "m", article: "le", ending: "-eur", exception: false },
  { word: "moteur", meaning: "engine", gender: "m", article: "le", ending: "-eur", exception: false },
  { word: "bonheur", meaning: "happiness", gender: "m", article: "le", ending: "-eur", exception: false },
  { word: "couleur", meaning: "colour", gender: "f", article: "la", ending: "-eur", exception: true },
  { word: "fleur", meaning: "flower", gender: "f", article: "la", ending: "-eur", exception: true },
  { word: "douleur", meaning: "pain", gender: "f", article: "la", ending: "-eur", exception: true },
  // -euse (feminine)
  { word: "chanteuse", meaning: "singer (f.)", gender: "f", article: "la", ending: "-euse", exception: false },
  { word: "vendeuse", meaning: "saleswoman", gender: "f", article: "la", ending: "-euse", exception: false },
  { word: "coiffeuse", meaning: "hairdresser (f.)", gender: "f", article: "la", ending: "-euse", exception: false },
  { word: "danseuse", meaning: "dancer (f.)", gender: "f", article: "la", ending: "-euse", exception: false },
  // -ette (feminine)
  { word: "baguette", meaning: "baguette", gender: "f", article: "la", ending: "-ette", exception: false },
  { word: "bicyclette", meaning: "bicycle", gender: "f", article: "la", ending: "-ette", exception: false },
  { word: "recette", meaning: "recipe", gender: "f", article: "la", ending: "-ette", exception: false },
  { word: "chaussette", meaning: "sock", gender: "f", article: "la", ending: "-ette", exception: false },
  { word: "fourchette", meaning: "fork", gender: "f", article: "la", ending: "-ette", exception: false },
  // -ance / -ence (feminine)
  { word: "chance", meaning: "luck", gender: "f", article: "la", ending: "-ance/-ence", exception: false },
  { word: "vacance", meaning: "holiday", gender: "f", article: "la", ending: "-ance/-ence", exception: false },
  { word: "connaissance", meaning: "knowledge", gender: "f", article: "la", ending: "-ance/-ence", exception: false },
  { word: "science", meaning: "science", gender: "f", article: "la", ending: "-ance/-ence", exception: false },
  { word: "experience", meaning: "experience", gender: "f", article: "l'", ending: "-ance/-ence", exception: false },
  { word: "difference", meaning: "difference", gender: "f", article: "la", ending: "-ance/-ence", exception: false },
  { word: "silence", meaning: "silence", gender: "m", article: "le", ending: "-ance/-ence", exception: true },
  // -isme (masculine)
  { word: "tourisme", meaning: "tourism", gender: "m", article: "le", ending: "-isme", exception: false },
  { word: "optimisme", meaning: "optimism", gender: "m", article: "l'", ending: "-isme", exception: false },
  { word: "capitalisme", meaning: "capitalism", gender: "m", article: "le", ending: "-isme", exception: false },
  { word: "racisme", meaning: "racism", gender: "m", article: "le", ending: "-isme", exception: false },
  // -ie (feminine)
  { word: "vie", meaning: "life", gender: "f", article: "la", ending: "-ie", exception: false },
  { word: "partie", meaning: "part", gender: "f", article: "la", ending: "-ie", exception: false },
  { word: "maladie", meaning: "illness", gender: "f", article: "la", ending: "-ie", exception: false },
  { word: "boulangerie", meaning: "bakery", gender: "f", article: "la", ending: "-ie", exception: false },
  { word: "economie", meaning: "economy", gender: "f", article: "l'", ending: "-ie", exception: false },
  { word: "incendie", meaning: "fire", gender: "m", article: "l'", ending: "-ie", exception: true },
  // -eau (masculine)
  { word: "chapeau", meaning: "hat", gender: "m", article: "le", ending: "-eau", exception: false },
  { word: "gateau", meaning: "cake", gender: "m", article: "le", ending: "-eau", exception: false },
  { word: "bureau", meaning: "desk/office", gender: "m", article: "le", ending: "-eau", exception: false },
  { word: "bateau", meaning: "boat", gender: "m", article: "le", ending: "-eau", exception: false },
  { word: "eau", meaning: "water", gender: "f", article: "l'", ending: "-eau", exception: true },
  { word: "peau", meaning: "skin", gender: "f", article: "la", ending: "-eau", exception: true },
  // -ure (feminine)
  { word: "voiture", meaning: "car", gender: "f", article: "la", ending: "-ure", exception: false },
  { word: "nature", meaning: "nature", gender: "f", article: "la", ending: "-ure", exception: false },
  { word: "aventure", meaning: "adventure", gender: "f", article: "l'", ending: "-ure", exception: false },
  { word: "lecture", meaning: "reading", gender: "f", article: "la", ending: "-ure", exception: false },
  { word: "nourriture", meaning: "food", gender: "f", article: "la", ending: "-ure", exception: false },
  // -oir (masculine)
  { word: "miroir", meaning: "mirror", gender: "m", article: "le", ending: "-oir", exception: false },
  { word: "soir", meaning: "evening", gender: "m", article: "le", ending: "-oir", exception: false },
  { word: "espoir", meaning: "hope", gender: "m", article: "l'", ending: "-oir", exception: false },
  { word: "pouvoir", meaning: "power", gender: "m", article: "le", ending: "-oir", exception: false },
];

// Ending patterns config
const ENDINGS = [
  { key: "-tion", label: "-tion", rule: "-tion endings are almost always feminine", majorGender: "f" },
  { key: "-ment", label: "-ment", rule: "-ment endings are almost always masculine", majorGender: "m" },
  { key: "-age", label: "-age", rule: "-age endings are usually masculine (with a few exceptions like image, plage)", majorGender: "m" },
  { key: "-eur", label: "-eur", rule: "-eur endings are mostly masculine, but abstract/quality nouns (couleur, fleur, douleur) are feminine", majorGender: "m" },
  { key: "-euse", label: "-euse", rule: "-euse endings are almost always feminine (feminine form of -eur agent nouns)", majorGender: "f" },
  { key: "-ette", label: "-ette", rule: "-ette endings are almost always feminine", majorGender: "f" },
  { key: "-ance/-ence", label: "-ance/-ence", rule: "-ance and -ence endings are almost always feminine (exception: le silence)", majorGender: "f" },
  { key: "-isme", label: "-isme", rule: "-isme endings are always masculine", majorGender: "m" },
  { key: "-ie", label: "-ie", rule: "-ie endings are almost always feminine (exception: l'incendie)", majorGender: "f" },
  { key: "-eau", label: "-eau", rule: "-eau endings are usually masculine (exceptions: l'eau, la peau)", majorGender: "m" },
  { key: "-ure", label: "-ure", rule: "-ure endings are almost always feminine", majorGender: "f" },
  { key: "-oir", label: "-oir", rule: "-oir endings are always masculine", majorGender: "m" },
];

let activeFilter = null;
let quizState = {
  score: 0,
  total: 0,
  streak: 0,
  bestStreak: 0,
  difficulty: "common",
  currentNoun: null,
  answered: false,
  usedIndices: []
};

function getGender(noun) {
  return noun.realGender || noun.gender;
}

function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.dataset.tab === tab));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + tab).classList.add('active');
  if (tab === 'quiz' && !quizState.currentNoun) nextQuestion();
}

function buildFilters() {
  const container = document.getElementById('filter-buttons');
  const allBtn = document.createElement('button');
  allBtn.className = 'filter-btn active';
  allBtn.textContent = 'All';
  allBtn.onclick = () => setFilter(null, allBtn);
  container.appendChild(allBtn);

  ENDINGS.forEach(e => {
    const btn = document.createElement('button');
    btn.className = 'filter-btn';
    btn.textContent = e.label;
    btn.onclick = () => setFilter(e.key, btn);
    container.appendChild(btn);
  });
}

function setFilter(key, btn) {
  activeFilter = key;
  document.querySelectorAll('#filter-buttons .filter-btn').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');

  const banner = document.getElementById('rule-banner');
  if (key) {
    const ending = ENDINGS.find(e => e.key === key);
    const nouns = NOUNS.filter(n => n.ending === key);
    const majorCount = nouns.filter(n => getGender(n) === ending.majorGender).length;
    const pct = Math.round((majorCount / nouns.length) * 100);
    banner.innerHTML = ending.rule + ' <span class="accuracy">' + pct + '% ' + (ending.majorGender === 'm' ? 'masculine' : 'feminine') + '</span>';
    banner.classList.add('visible');
  } else {
    banner.classList.remove('visible');
  }
  renderCards();
}

function renderCards() {
  const sort = document.getElementById('sort-select').value;
  let nouns = activeFilter ? NOUNS.filter(n => n.ending === activeFilter) : [...NOUNS];

  if (sort === 'alpha') nouns.sort((a, b) => a.word.localeCompare(b.word));
  else if (sort === 'ending') nouns.sort((a, b) => a.ending.localeCompare(b.ending) || a.word.localeCompare(b.word));
  else if (sort === 'gender') nouns.sort((a, b) => { const ga = getGender(a), gb = getGender(b); return ga === gb ? a.word.localeCompare(b.word) : ga === 'f' ? 1 : -1; });

  document.getElementById('card-count').textContent = 'Showing ' + nouns.length + ' noun' + (nouns.length !== 1 ? 's' : '');

  const grid = document.getElementById('cards-grid');
  grid.innerHTML = nouns.map(n => {
    const g = getGender(n);
    return '<div class="noun-card ' + (g === 'm' ? 'masc' : 'fem') + '">' +
      '<div class="article">' + n.article + '</div>' +
      '<div class="word">' + n.word + '</div>' +
      '<div class="meaning">' + n.meaning + '</div>' +
      '<span class="ending-tag">' + n.ending + '</span>' +
      '</div>';
  }).join('');
}

function renderChart() {
  const container = document.getElementById('chart-container');
  let html = '';

  ENDINGS.forEach(e => {
    const nouns = NOUNS.filter(n => n.ending === e.key);
    const mCount = nouns.filter(n => getGender(n) === 'm').length;
    const fCount = nouns.length - mCount;
    const mPct = Math.round((mCount / nouns.length) * 100);
    const fPct = 100 - mPct;

    html += '<div class="chart-row">' +
      '<div class="chart-label">' + e.label + '</div>' +
      '<div class="chart-bars">' +
      (mPct > 0 ? '<div class="chart-bar-m" style="width:' + mPct + '%">' + (mPct >= 15 ? mPct + '%' : '') + '</div>' : '') +
      (fPct > 0 ? '<div class="chart-bar-f" style="width:' + fPct + '%">' + (fPct >= 15 ? fPct + '%' : '') + '</div>' : '') +
      '</div></div>';
  });

  html += '<div class="chart-legend"><span class="leg-m">Masculine</span><span class="leg-f">Feminine</span></div>';
  container.innerHTML = html;
}

function renderExceptions() {
  const exceptions = NOUNS.filter(n => n.exception);
  const container = document.getElementById('exceptions-list');
  container.innerHTML = exceptions.map(n => {
    const g = getGender(n);
    return '<span class="exception-chip ' + (g === 'm' ? 'masc' : 'fem') + '">' +
      n.article + ' ' + n.word + ' (' + n.meaning + ') ' + (g === 'm' ? 'masc.' : 'fem.') +
      '</span>';
  }).join('');
}

// Quiz
function getQuizPool() {
  if (quizState.difficulty === 'common') return NOUNS.filter(n => !n.exception);
  if (quizState.difficulty === 'tricky') return NOUNS.filter(n => n.exception);
  return [...NOUNS];
}

function setDifficulty(diff) {
  quizState.difficulty = diff;
  quizState.score = 0;
  quizState.total = 0;
  quizState.streak = 0;
  quizState.usedIndices = [];
  document.querySelectorAll('.diff-btn').forEach(b => b.classList.toggle('active', b.dataset.diff === diff));
  updateQuizStats();
  nextQuestion();
}

function nextQuestion() {
  const pool = getQuizPool();
  if (quizState.usedIndices.length >= pool.length) quizState.usedIndices = [];

  let idx;
  do { idx = Math.floor(Math.random() * pool.length); }
  while (quizState.usedIndices.includes(idx) && quizState.usedIndices.length < pool.length);

  quizState.usedIndices.push(idx);
  quizState.currentNoun = pool[idx];
  quizState.answered = false;

  document.getElementById('quiz-noun').textContent = quizState.currentNoun.word;
  document.getElementById('quiz-meaning').textContent = quizState.currentNoun.meaning;
  document.getElementById('btn-le').disabled = false;
  document.getElementById('btn-la').disabled = false;
  document.getElementById('quiz-feedback').classList.remove('visible', 'correct', 'incorrect');
  document.getElementById('next-btn').classList.remove('visible');

  const pool2 = getQuizPool();
  const pct = pool2.length > 0 ? Math.round((quizState.total / pool2.length) * 100) : 0;
  document.getElementById('quiz-progress-bar').style.width = Math.min(pct, 100) + '%';
}

function answerQuiz(guess) {
  if (quizState.answered) return;
  quizState.answered = true;
  quizState.total++;

  const noun = quizState.currentNoun;
  const correctGender = getGender(noun);
  const isCorrect = guess === correctGender;

  if (isCorrect) {
    quizState.score++;
    quizState.streak++;
    if (quizState.streak > quizState.bestStreak) quizState.bestStreak = quizState.streak;
  } else {
    quizState.streak = 0;
  }

  document.getElementById('btn-le').disabled = true;
  document.getElementById('btn-la').disabled = true;

  const fb = document.getElementById('quiz-feedback');
  const ending = ENDINGS.find(e => e.key === noun.ending);
  const correctArticle = correctGender === 'm' ? 'le' : 'la';
  const ruleText = ending ? ending.rule : '';

  fb.className = 'feedback visible ' + (isCorrect ? 'correct' : 'incorrect');
  fb.innerHTML = '<div class="fb-text">' +
    (isCorrect ? 'Correct!' : 'Not quite.') +
    ' It is <strong>' + correctArticle + ' ' + noun.word + '</strong> (' + (correctGender === 'm' ? 'masculine' : 'feminine') + ')</div>' +
    (ruleText ? '<div class="fb-rule">' + (noun.exception ? 'Exception: ' : 'Rule: ') + ruleText + '</div>' : '');

  document.getElementById('next-btn').classList.add('visible');
  updateQuizStats();
}

function updateQuizStats() {
  document.getElementById('quiz-score').textContent = quizState.score;
  document.getElementById('quiz-total').textContent = quizState.total;
  document.getElementById('quiz-pct').textContent = quizState.total > 0 ? Math.round((quizState.score / quizState.total) * 100) + '%' : '0%';
  document.getElementById('quiz-streak').textContent = quizState.streak;
}

// Init
buildFilters();
renderCards();
renderChart();
renderExceptions();
</script>
</body>
</html>
