<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sentence Builder Machine</title>
<style>
:root {
  --subject: #3b82f6;
  --subject-light: #93c5fd;
  --verb: #ef4444;
  --verb-light: #fca5a5;
  --noun: #22c55e;
  --noun-light: #86efac;
  --adjective: #eab308;
  --adjective-light: #fde047;
  --connective: #a855f7;
  --connective-light: #d8b4fe;
  --time: #f97316;
  --time-light: #fdba74;
  --tense: #06b6d4;
  --tense-light: #67e8f9;
  --masc: #60a5fa;
  --fem: #f472b6;
  --neut: #9ca3af;
  --bg: #0f172a;
  --card: #1e293b;
  --card2: #334155;
  --text: #f1f5f9;
  --text2: #94a3b8;
  --success: #22c55e;
  --error: #ef4444;
  --gold: #fbbf24;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}
/* Animated background */
body::before {
  content:'';
  position:fixed;
  inset:0;
  background:
    radial-gradient(ellipse at 20% 50%, rgba(59,130,246,.08) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 20%, rgba(168,85,247,.08) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 80%, rgba(239,68,68,.06) 0%, transparent 50%);
  z-index:0;
  pointer-events:none;
}
.app { position:relative; z-index:1; max-width:1400px; margin:0 auto; padding:10px 16px 30px; }

/* HEADER */
header {
  text-align:center;
  padding:12px 0 8px;
  position:relative;
}
header h1 {
  font-size: clamp(1.6rem, 4vw, 2.4rem);
  font-weight:800;
  background: linear-gradient(135deg, var(--subject), var(--verb), var(--gold), var(--connective));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  letter-spacing:-0.5px;
}
header .subtitle {
  color:var(--text2);
  font-size:0.85rem;
  margin-top:2px;
}

/* FLAG STRIPE */
.flag-stripe {
  height:4px;
  border-radius:2px;
  margin:8px 0;
  transition: background .4s;
}
.flag-stripe.fr { background: linear-gradient(90deg, #002395 33%, #fff 33% 66%, #ED2939 66%); }
.flag-stripe.es { background: linear-gradient(90deg, #AA151B 25%, #F1BF00 25% 75%, #AA151B 75%); }
.flag-stripe.de { background: linear-gradient(90deg, #000 33%, #DD0000 33% 66%, #FFCE00 66%); }

/* TOP BAR */
.top-bar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:8px;
}
/* Language Selector */
.lang-selector {
  display:flex;
  background:var(--card);
  border-radius:12px;
  padding:3px;
  gap:2px;
  border:1px solid rgba(255,255,255,.06);
}
.lang-btn {
  padding:8px 18px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:700;
  font-size:.85rem;
  background:transparent;
  color:var(--text2);
  transition:all .25s;
  display:flex;
  align-items:center;
  gap:6px;
}
.lang-btn .flag-icon { font-size:1.1rem; }
.lang-btn.active {
  background: linear-gradient(135deg, rgba(59,130,246,.3), rgba(168,85,247,.3));
  color:#fff;
  box-shadow:0 2px 10px rgba(59,130,246,.2);
}
.lang-btn:hover:not(.active) { color:var(--text); background:rgba(255,255,255,.05); }

/* Mode / Stats */
.mode-stats { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.mode-toggle {
  display:flex;
  background:var(--card);
  border-radius:10px;
  padding:3px;
  border:1px solid rgba(255,255,255,.06);
}
.mode-btn {
  padding:6px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  font-size:.78rem;
  background:transparent;
  color:var(--text2);
  transition:all .25s;
}
.mode-btn.active { background:var(--connective); color:#fff; }
.mode-btn:hover:not(.active) { color:var(--text); }

.stats {
  display:flex;
  gap:12px;
  font-size:.78rem;
  color:var(--text2);
}
.stat-item { display:flex; align-items:center; gap:4px; }
.stat-val { color:var(--gold); font-weight:700; font-size:.9rem; }

/* TENSE SELECTOR */
.tense-bar {
  display:flex;
  align-items:center;
  gap:6px;
  background:var(--card);
  border-radius:12px;
  padding:6px 12px;
  margin-bottom:8px;
  border:1px solid rgba(6,182,212,.15);
  flex-wrap:wrap;
}
.tense-bar label { font-weight:700; font-size:.8rem; color:var(--tense); margin-right:4px; }
.tense-btn {
  padding:5px 14px;
  border:2px solid var(--tense);
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  font-size:.78rem;
  background:transparent;
  color:var(--tense-light);
  transition:all .25s;
}
.tense-btn.active { background:var(--tense); color:#fff; }
.tense-btn:hover:not(.active) { background:rgba(6,182,212,.15); }

/* CONSTRUCTION ZONE */
.construction-zone {
  background: var(--card);
  border:2px dashed rgba(255,255,255,.12);
  border-radius:16px;
  min-height:80px;
  padding:12px 16px;
  margin-bottom:8px;
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
  position:relative;
  transition: border-color .3s, box-shadow .3s;
}
.construction-zone.drag-over {
  border-color: var(--gold);
  box-shadow: 0 0 20px rgba(251,191,36,.15);
}
.construction-zone.empty::after {
  content:'Drag blocks here to build your sentence...';
  color:var(--text2);
  font-size:.85rem;
  font-style:italic;
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  pointer-events:none;
}
.cz-label {
  position:absolute;
  top:-10px;
  left:16px;
  background:var(--bg);
  padding:0 8px;
  font-size:.7rem;
  font-weight:700;
  color:var(--gold);
  text-transform:uppercase;
  letter-spacing:1px;
}
.zone-controls {
  display:flex;
  gap:6px;
  margin-bottom:6px;
}
.zone-btn {
  padding:5px 12px;
  border:1px solid rgba(255,255,255,.12);
  border-radius:8px;
  background:var(--card);
  color:var(--text2);
  cursor:pointer;
  font-size:.75rem;
  font-weight:600;
  transition:all .2s;
}
.zone-btn:hover { background:var(--card2); color:var(--text); }
.zone-btn.check-btn { border-color:var(--success); color:var(--success); }
.zone-btn.check-btn:hover { background:rgba(34,197,94,.15); }
.zone-btn.clear-btn { border-color:var(--error); color:var(--error); }
.zone-btn.clear-btn:hover { background:rgba(239,68,68,.15); }

/* RESULT BAR */
.result-bar {
  background: linear-gradient(135deg, var(--card), var(--card2));
  border-radius:14px;
  padding:12px 18px;
  margin-bottom:8px;
  border:1px solid rgba(255,255,255,.06);
  display:none;
}
.result-bar.visible { display:block; }
.result-bar .sentence-foreign {
  font-size:1.15rem;
  font-weight:700;
  color:var(--text);
  margin-bottom:3px;
}
.result-bar .sentence-english {
  font-size:.85rem;
  color:var(--text2);
  margin-bottom:2px;
}
.result-bar .sentence-phonetic {
  font-size:.78rem;
  color:var(--tense-light);
  font-style:italic;
}
.result-bar .result-status {
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:3px 10px;
  border-radius:6px;
  font-size:.75rem;
  font-weight:700;
  margin-bottom:6px;
}
.result-bar .result-status.correct { background:rgba(34,197,94,.15); color:var(--success); }
.result-bar .result-status.incorrect { background:rgba(239,68,68,.15); color:var(--error); }
.result-bar .grammar-note {
  font-size:.75rem;
  color:var(--gold);
  margin-top:4px;
  padding:4px 8px;
  background:rgba(251,191,36,.08);
  border-radius:6px;
}

/* CHALLENGE PANEL */
.challenge-panel {
  background: var(--card);
  border-radius:14px;
  padding:10px 16px;
  margin-bottom:8px;
  border:1px solid rgba(251,191,36,.15);
  display:none;
}
.challenge-panel.visible { display:block; }
.challenge-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
}
.challenge-header h3 { font-size:.9rem; color:var(--gold); }
.challenge-progress { font-size:.75rem; color:var(--text2); }
.challenge-sentence {
  font-size:1rem;
  font-weight:600;
  color:var(--text);
  padding:8px 12px;
  background:rgba(251,191,36,.08);
  border-radius:8px;
  border-left:3px solid var(--gold);
}
.challenge-nav { display:flex; gap:6px; margin-top:8px; }
.challenge-nav button {
  padding:5px 12px;
  border:1px solid var(--gold);
  border-radius:8px;
  background:transparent;
  color:var(--gold);
  cursor:pointer;
  font-size:.75rem;
  font-weight:600;
  transition:all .2s;
}
.challenge-nav button:hover { background:rgba(251,191,36,.15); }
.challenge-nav button:disabled { opacity:.3; cursor:default; }

/* BLOCK TRAYS */
.trays { display:grid; grid-template-columns:repeat(auto-fill, minmax(200px,1fr)); gap:8px; }
.tray {
  background:var(--card);
  border-radius:14px;
  padding:10px;
  border:1px solid rgba(255,255,255,.06);
}
.tray-header {
  font-size:.72rem;
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:1.5px;
  margin-bottom:8px;
  padding-bottom:4px;
  border-bottom:2px solid;
  display:flex;
  align-items:center;
  gap:5px;
}
.tray-header .dot {
  width:8px;
  height:8px;
  border-radius:50%;
  display:inline-block;
}
.tray-subjects .tray-header { color:var(--subject); border-color:var(--subject); }
.tray-subjects .dot { background:var(--subject); }
.tray-verbs .tray-header { color:var(--verb); border-color:var(--verb); }
.tray-verbs .dot { background:var(--verb); }
.tray-nouns .tray-header { color:var(--noun); border-color:var(--noun); }
.tray-nouns .dot { background:var(--noun); }
.tray-adjectives .tray-header { color:var(--adjective); border-color:var(--adjective); }
.tray-adjectives .dot { background:var(--adjective); }
.tray-connectives .tray-header { color:var(--connective); border-color:var(--connective); }
.tray-connectives .dot { background:var(--connective); }
.tray-time .tray-header { color:var(--time); border-color:var(--time); }
.tray-time .dot { background:var(--time); }

.tray-blocks { display:flex; flex-wrap:wrap; gap:5px; }

/* BLOCKS */
.block {
  padding:6px 12px;
  border-radius:9px;
  font-size:.8rem;
  font-weight:700;
  cursor:grab;
  user-select:none;
  transition:all .2s;
  position:relative;
  white-space:nowrap;
  border:2px solid transparent;
  box-shadow:0 2px 6px rgba(0,0,0,.2);
}
.block:active { cursor:grabbing; transform:scale(1.05); }
.block:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,.3); }
.block .block-sub {
  display:block;
  font-size:.6rem;
  font-weight:400;
  opacity:.7;
  margin-top:1px;
}
.block.subject { background:var(--subject); color:#fff; }
.block.verb { background:var(--verb); color:#fff; }
.block.noun { background:var(--noun); color:#fff; }
.block.adjective { background:var(--adjective); color:#1a1a1a; }
.block.connective { background:var(--connective); color:#fff; }
.block.time { background:var(--time); color:#1a1a1a; }
.block.masc { border-color:var(--masc) !important; border-width:2px; border-style:solid; }
.block.fem { border-color:var(--fem) !important; border-width:2px; border-style:solid; }
.block.neut-gender { border-color:var(--neut) !important; border-width:2px; border-style:solid; }

/* Blocks in construction zone */
.construction-zone .block { position:relative; }
.construction-zone .block .remove-block {
  position:absolute;
  top:-6px;
  right:-6px;
  width:16px;
  height:16px;
  background:var(--error);
  color:#fff;
  border:none;
  border-radius:50%;
  font-size:.6rem;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  transition:opacity .2s;
  line-height:1;
}
.construction-zone .block:hover .remove-block { opacity:1; }

/* Validation indicators */
.block.valid-connection::after {
  content:'\2713';
  position:absolute;
  top:-6px;
  left:-6px;
  width:16px;
  height:16px;
  background:var(--success);
  color:#fff;
  border-radius:50%;
  font-size:.6rem;
  display:flex;
  align-items:center;
  justify-content:center;
}
.block.invalid-connection {
  animation: shake .3s;
  box-shadow: 0 0 12px rgba(239,68,68,.5) !important;
}
@keyframes shake {
  0%,100% { transform:translateX(0); }
  25% { transform:translateX(-4px); }
  75% { transform:translateX(4px); }
}

/* Tooltip */
.grammar-tooltip {
  position:absolute;
  bottom:calc(100% + 8px);
  left:50%;
  transform:translateX(-50%);
  background:#1a1a2e;
  color:var(--error);
  padding:6px 10px;
  border-radius:8px;
  font-size:.7rem;
  font-weight:600;
  white-space:nowrap;
  pointer-events:none;
  z-index:100;
  border:1px solid var(--error);
  box-shadow:0 4px 12px rgba(0,0,0,.4);
}
.grammar-tooltip::after {
  content:'';
  position:absolute;
  top:100%;
  left:50%;
  transform:translateX(-50%);
  border:5px solid transparent;
  border-top-color:#1a1a2e;
}

/* DRAG GHOST */
.drag-ghost {
  position:fixed;
  pointer-events:none;
  z-index:9999;
  opacity:.85;
  transform:rotate(3deg) scale(1.1);
}

/* Responsive */
@media (max-width:900px) {
  .trays { grid-template-columns:repeat(auto-fill, minmax(160px,1fr)); }
}
@media (max-width:600px) {
  .trays { grid-template-columns:1fr 1fr; }
  .top-bar { flex-direction:column; align-items:stretch; }
  .lang-selector { justify-content:center; }
}

/* SCROLLBAR */
::-webkit-scrollbar { width:6px; }
::-webkit-scrollbar-track { background:var(--bg); }
::-webkit-scrollbar-thumb { background:var(--card2); border-radius:3px; }

/* Celebration */
.celebration {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:9999;
}
.confetti {
  position:absolute;
  width:8px;
  height:8px;
  border-radius:2px;
  animation:confettiFall 1.5s ease-out forwards;
}
@keyframes confettiFall {
  0% { opacity:1; transform:translateY(0) rotate(0deg); }
  100% { opacity:0; transform:translateY(100vh) rotate(720deg); }
}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Sentence Builder Machine</h1>
    <div class="subtitle">Modern Foreign Languages &mdash; Build, conjugate, and master grammar</div>
  </header>
  <div class="flag-stripe fr" id="flagStripe"></div>

  <div class="top-bar">
    <div class="lang-selector" id="langSelector">
      <button class="lang-btn active" data-lang="fr"><span class="flag-icon">&#127467;&#127479;</span> French</button>
      <button class="lang-btn" data-lang="es"><span class="flag-icon">&#127466;&#127480;</span> Spanish</button>
      <button class="lang-btn" data-lang="de"><span class="flag-icon">&#127465;&#127466;</span> German</button>
    </div>
    <div class="mode-stats">
      <div class="mode-toggle" id="modeToggle">
        <button class="mode-btn active" data-mode="free">Free Build</button>
        <button class="mode-btn" data-mode="challenge">Challenge</button>
      </div>
      <div class="stats">
        <div class="stat-item">Built: <span class="stat-val" id="statBuilt">0</span></div>
        <div class="stat-item">Accuracy: <span class="stat-val" id="statAccuracy">--</span></div>
      </div>
    </div>
  </div>

  <div class="tense-bar" id="tenseBar">
    <label>TENSE:</label>
    <button class="tense-btn active" data-tense="present">Present</button>
    <button class="tense-btn" data-tense="past">Past</button>
    <button class="tense-btn" data-tense="future">Future</button>
  </div>

  <div class="challenge-panel" id="challengePanel">
    <div class="challenge-header">
      <h3>Challenge Mode</h3>
      <span class="challenge-progress" id="challengeProgress">1 / 5</span>
    </div>
    <div class="challenge-sentence" id="challengeSentence"></div>
    <div class="challenge-nav">
      <button id="prevChallenge" disabled>&laquo; Previous</button>
      <button id="nextChallenge">Next &raquo;</button>
    </div>
  </div>

  <div style="position:relative; margin-bottom:8px;">
    <span class="cz-label">Construction Zone</span>
    <div class="construction-zone empty" id="constructionZone"></div>
  </div>

  <div class="zone-controls">
    <button class="zone-btn check-btn" id="checkBtn">&#10003; Check Sentence</button>
    <button class="zone-btn clear-btn" id="clearBtn">&#10007; Clear All</button>
  </div>

  <div class="result-bar" id="resultBar">
    <div class="result-status" id="resultStatus"></div>
    <div class="sentence-foreign" id="sentenceForeign"></div>
    <div class="sentence-english" id="sentenceEnglish"></div>
    <div class="sentence-phonetic" id="sentencePhonetic"></div>
    <div class="grammar-note" id="grammarNote" style="display:none;"></div>
  </div>

  <div class="trays" id="trays"></div>
</div>

<script>
// ===================== DATA =====================
const DATA = {
  fr: {
    subjects: [
      { id:'je', text:'Je', en:'I', person:'1s' },
      { id:'tu', text:'Tu', en:'You (informal)', person:'2s' },
      { id:'il', text:'Il', en:'He', person:'3sm' },
      { id:'elle', text:'Elle', en:'She', person:'3sf' },
      { id:'on', text:'On', en:'One/We (informal)', person:'3sm' },
      { id:'nous', text:'Nous', en:'We', person:'1p' },
      { id:'vous', text:'Vous', en:'You (formal/plural)', person:'2p' },
      { id:'ils', text:'Ils', en:'They (m)', person:'3pm' },
      { id:'elles', text:'Elles', en:'They (f)', person:'3pf' }
    ],
    verbs: [
      { id:'etre', inf:'être', en:'to be',
        present:{ '1s':'suis','2s':'es','3sm':'est','3sf':'est','1p':'sommes','2p':'êtes','3pm':'sont','3pf':'sont' },
        past:{ '1s':'ai été','2s':'as été','3sm':'a été','3sf':'a été','1p':'avons été','2p':'avez été','3pm':'ont été','3pf':'ont été' },
        future:{ '1s':'serai','2s':'seras','3sm':'sera','3sf':'sera','1p':'serons','2p':'serez','3pm':'seront','3pf':'seront' }
      },
      { id:'avoir', inf:'avoir', en:'to have',
        present:{ '1s':'ai','2s':'as','3sm':'a','3sf':'a','1p':'avons','2p':'avez','3pm':'ont','3pf':'ont' },
        past:{ '1s':'ai eu','2s':'as eu','3sm':'a eu','3sf':'a eu','1p':'avons eu','2p':'avez eu','3pm':'ont eu','3pf':'ont eu' },
        future:{ '1s':'aurai','2s':'auras','3sm':'aura','3sf':'aura','1p':'aurons','2p':'aurez','3pm':'auront','3pf':'auront' }
      },
      { id:'aller', inf:'aller', en:'to go',
        present:{ '1s':'vais','2s':'vas','3sm':'va','3sf':'va','1p':'allons','2p':'allez','3pm':'vont','3pf':'vont' },
        past:{ '1s':'suis allé(e)','2s':'es allé(e)','3sm':'est allé','3sf':'est allée','1p':'sommes allé(e)s','2p':'êtes allé(e)(s)','3pm':'sont allés','3pf':'sont allées' },
        future:{ '1s':'irai','2s':'iras','3sm':'ira','3sf':'ira','1p':'irons','2p':'irez','3pm':'iront','3pf':'iront' }
      },
      { id:'faire', inf:'faire', en:'to do/make',
        present:{ '1s':'fais','2s':'fais','3sm':'fait','3sf':'fait','1p':'faisons','2p':'faites','3pm':'font','3pf':'font' },
        past:{ '1s':'ai fait','2s':'as fait','3sm':'a fait','3sf':'a fait','1p':'avons fait','2p':'avez fait','3pm':'ont fait','3pf':'ont fait' },
        future:{ '1s':'ferai','2s':'feras','3sm':'fera','3sf':'fera','1p':'ferons','2p':'ferez','3pm':'feront','3pf':'feront' }
      },
      { id:'manger', inf:'manger', en:'to eat',
        present:{ '1s':'mange','2s':'manges','3sm':'mange','3sf':'mange','1p':'mangeons','2p':'mangez','3pm':'mangent','3pf':'mangent' },
        past:{ '1s':'ai mangé','2s':'as mangé','3sm':'a mangé','3sf':'a mangé','1p':'avons mangé','2p':'avez mangé','3pm':'ont mangé','3pf':'ont mangé' },
        future:{ '1s':'mangerai','2s':'mangeras','3sm':'mangera','3sf':'mangera','1p':'mangerons','2p':'mangerez','3pm':'mangeront','3pf':'mangeront' }
      },
      { id:'jouer', inf:'jouer', en:'to play',
        present:{ '1s':'joue','2s':'joues','3sm':'joue','3sf':'joue','1p':'jouons','2p':'jouez','3pm':'jouent','3pf':'jouent' },
        past:{ '1s':'ai joué','2s':'as joué','3sm':'a joué','3sf':'a joué','1p':'avons joué','2p':'avez joué','3pm':'ont joué','3pf':'ont joué' },
        future:{ '1s':'jouerai','2s':'joueras','3sm':'jouera','3sf':'jouera','1p':'jouerons','2p':'jouerez','3pm':'joueront','3pf':'joueront' }
      },
      { id:'aimer', inf:'aimer', en:'to like/love',
        present:{ '1s':'aime','2s':'aimes','3sm':'aime','3sf':'aime','1p':'aimons','2p':'aimez','3pm':'aiment','3pf':'aiment' },
        past:{ '1s':'ai aimé','2s':'as aimé','3sm':'a aimé','3sf':'a aimé','1p':'avons aimé','2p':'avez aimé','3pm':'ont aimé','3pf':'ont aimé' },
        future:{ '1s':'aimerai','2s':'aimeras','3sm':'aimera','3sf':'aimera','1p':'aimerons','2p':'aimerez','3pm':'aimeront','3pf':'aimeront' }
      },
      { id:'habiter', inf:'habiter', en:'to live (in)',
        present:{ '1s':'habite','2s':'habites','3sm':'habite','3sf':'habite','1p':'habitons','2p':'habitez','3pm':'habitent','3pf':'habitent' },
        past:{ '1s':'ai habité','2s':'as habité','3sm':'a habité','3sf':'a habité','1p':'avons habité','2p':'avez habité','3pm':'ont habité','3pf':'ont habité' },
        future:{ '1s':'habiterai','2s':'habiteras','3sm':'habitera','3sf':'habitera','1p':'habiterons','2p':'habiterez','3pm':'habiteront','3pf':'habiteront' }
      },
      { id:'parler', inf:'parler', en:'to speak',
        present:{ '1s':'parle','2s':'parles','3sm':'parle','3sf':'parle','1p':'parlons','2p':'parlez','3pm':'parlent','3pf':'parlent' },
        past:{ '1s':'ai parlé','2s':'as parlé','3sm':'a parlé','3sf':'a parlé','1p':'avons parlé','2p':'avez parlé','3pm':'ont parlé','3pf':'ont parlé' },
        future:{ '1s':'parlerai','2s':'parleras','3sm':'parlera','3sf':'parlera','1p':'parlerons','2p':'parlerez','3pm':'parleront','3pf':'parleront' }
      },
      { id:'vouloir', inf:'vouloir', en:'to want',
        present:{ '1s':'veux','2s':'veux','3sm':'veut','3sf':'veut','1p':'voulons','2p':'voulez','3pm':'veulent','3pf':'veulent' },
        past:{ '1s':'ai voulu','2s':'as voulu','3sm':'a voulu','3sf':'a voulu','1p':'avons voulu','2p':'avez voulu','3pm':'ont voulu','3pf':'ont voulu' },
        future:{ '1s':'voudrai','2s':'voudras','3sm':'voudra','3sf':'voudra','1p':'voudrons','2p':'voudrez','3pm':'voudront','3pf':'voudront' }
      },
      { id:'pouvoir', inf:'pouvoir', en:'to be able to',
        present:{ '1s':'peux','2s':'peux','3sm':'peut','3sf':'peut','1p':'pouvons','2p':'pouvez','3pm':'peuvent','3pf':'peuvent' },
        past:{ '1s':'ai pu','2s':'as pu','3sm':'a pu','3sf':'a pu','1p':'avons pu','2p':'avez pu','3pm':'ont pu','3pf':'ont pu' },
        future:{ '1s':'pourrai','2s':'pourras','3sm':'pourra','3sf':'pourra','1p':'pourrons','2p':'pourrez','3pm':'pourront','3pf':'pourront' }
      },
      { id:'boire', inf:'boire', en:'to drink',
        present:{ '1s':'bois','2s':'bois','3sm':'boit','3sf':'boit','1p':'buvons','2p':'buvez','3pm':'boivent','3pf':'boivent' },
        past:{ '1s':'ai bu','2s':'as bu','3sm':'a bu','3sf':'a bu','1p':'avons bu','2p':'avez bu','3pm':'ont bu','3pf':'ont bu' },
        future:{ '1s':'boirai','2s':'boiras','3sm':'boira','3sf':'boira','1p':'boirons','2p':'boirez','3pm':'boiront','3pf':'boiront' }
      }
    ],
    nouns: [
      { id:'le_chat', text:'le chat', en:'the cat', gender:'m', article:'le' },
      { id:'la_maison', text:'la maison', en:'the house', gender:'f', article:'la' },
      { id:'le_livre', text:'le livre', en:'the book', gender:'m', article:'le' },
      { id:'la_musique', text:'la musique', en:'the music', gender:'f', article:'la' },
      { id:'le_football', text:'le football', en:'football', gender:'m', article:'le' },
      { id:'la_nourriture', text:'la nourriture', en:'the food', gender:'f', article:'la' },
      { id:'le_chocolat', text:'le chocolat', en:'the chocolate', gender:'m', article:'le' },
      { id:'la_pizza', text:'la pizza', en:'pizza', gender:'f', article:'la' },
      { id:'le_francais', text:'le français', en:'French', gender:'m', article:'le' },
      { id:'la_ville', text:'la ville', en:'the town/city', gender:'f', article:'la' },
      { id:'le_cinema', text:'le cinéma', en:'the cinema', gender:'m', article:'le' },
      { id:'la_plage', text:'la plage', en:'the beach', gender:'f', article:'la' },
      { id:'les_amis', text:'les amis', en:'friends', gender:'m', article:'les', plural:true },
      { id:'le_tennis', text:'le tennis', en:'tennis', gender:'m', article:'le' },
      { id:'l_eau', text:"l'eau", en:'water', gender:'f', article:"l'" },
      { id:'le_gateau', text:'le gâteau', en:'the cake', gender:'m', article:'le' },
      { id:'en_france', text:'en France', en:'in France', gender:'f', article:'en', isPlace:true },
      { id:'a_paris', text:'à Paris', en:'in Paris', gender:'m', article:'à', isPlace:true },
      { id:'a_lecole', text:"à l'école", en:'at school', gender:'f', article:'à', isPlace:true }
    ],
    adjectives: [
      { id:'grand', m:'grand', f:'grande', en:'big/tall', mPl:'grands', fPl:'grandes' },
      { id:'petit', m:'petit', f:'petite', en:'small', mPl:'petits', fPl:'petites' },
      { id:'bon', m:'bon', f:'bonne', en:'good', mPl:'bons', fPl:'bonnes' },
      { id:'mauvais', m:'mauvais', f:'mauvaise', en:'bad', mPl:'mauvais', fPl:'mauvaises' },
      { id:'beau', m:'beau', f:'belle', en:'beautiful', mPl:'beaux', fPl:'belles' },
      { id:'nouveau', m:'nouveau', f:'nouvelle', en:'new', mPl:'nouveaux', fPl:'nouvelles' },
      { id:'vieux', m:'vieux', f:'vieille', en:'old', mPl:'vieux', fPl:'vieilles' },
      { id:'heureux', m:'heureux', f:'heureuse', en:'happy', mPl:'heureux', fPl:'heureuses' },
      { id:'triste', m:'triste', f:'triste', en:'sad', mPl:'tristes', fPl:'tristes' },
      { id:'intelligent', m:'intelligent', f:'intelligente', en:'clever', mPl:'intelligents', fPl:'intelligentes' },
      { id:'delicieux', m:'délicieux', f:'délicieuse', en:'delicious', mPl:'délicieux', fPl:'délicieuses' },
      { id:'amusant', m:'amusant', f:'amusante', en:'fun/funny', mPl:'amusants', fPl:'amusantes' },
      { id:'interessant', m:'intéressant', f:'intéressante', en:'interesting', mPl:'intéressants', fPl:'intéressantes' }
    ],
    connectives: [
      { id:'et', text:'et', en:'and' },
      { id:'mais', text:'mais', en:'but' },
      { id:'parce_que', text:'parce que', en:'because' },
      { id:'car', text:'car', en:'because/for' },
      { id:'aussi', text:'aussi', en:'also' },
      { id:'cependant', text:'cependant', en:'however' },
      { id:'donc', text:'donc', en:'so/therefore' },
      { id:'puis', text:'puis', en:'then' },
      { id:'ou', text:'ou', en:'or' }
    ],
    timePhrases: [
      { id:'aujourdhui', text:"aujourd'hui", en:'today' },
      { id:'hier', text:'hier', en:'yesterday' },
      { id:'demain', text:'demain', en:'tomorrow' },
      { id:'souvent', text:'souvent', en:'often' },
      { id:'toujours', text:'toujours', en:'always' },
      { id:'quelquefois', text:'quelquefois', en:'sometimes' },
      { id:'le_weekend', text:'le week-end', en:'at the weekend' },
      { id:'en_ete', text:'en été', en:'in summer' },
      { id:'le_soir', text:'le soir', en:'in the evening' },
      { id:'tous_les_jours', text:'tous les jours', en:'every day' }
    ],
    phonetics: {
      'je':'zhuh','tu':'too','il':'eel','elle':'ell','on':'on','nous':'noo','vous':'voo','ils':'eel','elles':'ell',
      'suis':'swee','es':'eh','est':'eh','sommes':'som','êtes':'et','sont':'son',
      'ai':'ay','as':'ah','a':'ah','avons':'ah-von','avez':'ah-vay','ont':'on',
      'vais':'vay','vas':'vah','va':'vah','allons':'ah-lon','allez':'ah-lay','vont':'von',
      'fais':'fay','fait':'fay','faisons':'fuh-zon','faites':'fet','font':'fon',
      'mange':'monzh','manges':'monzh','mangeons':'mon-zhon','mangez':'mon-zhay','mangent':'monzh',
      'joue':'zhoo','joues':'zhoo','jouons':'zhoo-on','jouez':'zhoo-ay','jouent':'zhoo',
      'aime':'em','aimes':'em','aimons':'em-on','aimez':'em-ay','aiment':'em',
      'le':'luh','la':'lah','les':'lay',"l'":'l',
      'chat':'shah','maison':'may-zon','livre':'leev-ruh','musique':'moo-zeek',
      'football':'foot-bol','nourriture':'noo-ree-toor','chocolat':'shoh-koh-lah',
      'pizza':'peet-sah','français':'fron-say','ville':'veel','cinéma':'see-nay-mah',
      'plage':'plazh','amis':'ah-mee','tennis':'teh-nees',"l'eau":'loh',
      'gâteau':'gah-toh','en France':'on frons','à Paris':'ah pah-ree',
      "à l'école":"ah lay-kol",
      'grand':'gron','grande':'grond','petit':'puh-tee','petite':'puh-teet',
      'bon':'bon','bonne':'bon','beau':'boh','belle':'bell',
      'et':'ay','mais':'may','parce que':'pars kuh','car':'kar',
      'aussi':'oh-see','cependant':'suh-pon-don','donc':'donk','puis':'pwee','ou':'oo',
      "aujourd'hui":"oh-zhoor-dwee",'hier':'ee-air','demain':'duh-man',
      'souvent':'soo-von','toujours':'too-zhoor','quelquefois':'kel-kuh-fwah',
      'le week-end':'luh wee-kend','en été':'on ay-tay','le soir':'luh swahr',
      'tous les jours':'too lay zhoor',
      'habite':'ah-beet','habites':'ah-beet','habitons':'ah-bee-ton','habitez':'ah-bee-tay','habitent':'ah-beet',
      'parle':'parl','parles':'parl','parlons':'par-lon','parlez':'par-lay','parlent':'parl',
      'veux':'vuh','veut':'vuh','voulons':'voo-lon','voulez':'voo-lay','veulent':'vuhl',
      'peux':'puh','peut':'puh','pouvons':'poo-von','pouvez':'poo-vay','peuvent':'puhv',
      'bois':'bwah','boit':'bwah','buvons':'boo-von','buvez':'boo-vay','boivent':'bwav',
      'été':'ay-tay','eu':'oo','allé':'ah-lay','allée':'ah-lay','fait':'fay',
      'mangé':'mon-zhay','joué':'zhoo-ay','aimé':'em-ay','habité':'ah-bee-tay','parlé':'par-lay',
      'voulu':'voo-loo','pu':'poo','bu':'boo',
      'serai':'suh-ray','seras':'suh-rah','sera':'suh-rah','serons':'suh-ron','serez':'suh-ray','seront':'suh-ron',
      'aurai':'oh-ray','auras':'oh-rah','aura':'oh-rah','aurons':'oh-ron','aurez':'oh-ray','auront':'oh-ron',
      'irai':'ee-ray','iras':'ee-rah','ira':'ee-rah','irons':'ee-ron','irez':'ee-ray','iront':'ee-ron',
      'ferai':'fuh-ray','feras':'fuh-rah','fera':'fuh-rah','ferons':'fuh-ron','ferez':'fuh-ray','feront':'fuh-ron',
      'heureux':'uh-ruh','heureuse':'uh-ruhz','triste':'treest',
      'intelligent':'an-teh-lee-zhon','intelligente':'an-teh-lee-zhont',
      'délicieux':'day-lee-syuh','délicieuse':'day-lee-syuhz',
      'amusant':'ah-moo-zon','amusante':'ah-moo-zont',
      'intéressant':'an-tay-reh-son','intéressante':'an-tay-reh-sont',
      'nouveau':'noo-voh','nouvelle':'noo-vel','vieux':'vyuh','vieille':'vyay',
      'mauvais':'moh-vay','mauvaise':'moh-vez'
    },
    challenges: [
      { en:'I eat the chocolate', blocks:['je','manger','le_chocolat'], tense:'present' },
      { en:'She is happy', blocks:['elle','etre','heureux'], tense:'present' },
      { en:'We played football yesterday', blocks:['nous','jouer','le_football','hier'], tense:'past' },
      { en:'They (m) will go to the beach tomorrow', blocks:['ils','aller','la_plage','demain'], tense:'future' },
      { en:'I like the music because it is beautiful', blocks:['je','aimer','la_musique','parce_que','elle','etre','beau'], tense:'present' },
      { en:'He speaks French at school every day', blocks:['il','parler','le_francais','a_lecole','tous_les_jours'], tense:'present' }
    ]
  },

  es: {
    subjects: [
      { id:'yo', text:'Yo', en:'I', person:'1s' },
      { id:'tu_es', text:'Tú', en:'You (informal)', person:'2s' },
      { id:'el', text:'Él', en:'He', person:'3sm' },
      { id:'ella', text:'Ella', en:'She', person:'3sf' },
      { id:'nosotros', text:'Nosotros', en:'We', person:'1p' },
      { id:'vosotros', text:'Vosotros', en:'You all', person:'2p' },
      { id:'ellos', text:'Ellos', en:'They (m)', person:'3pm' },
      { id:'ellas', text:'Ellas', en:'They (f)', person:'3pf' }
    ],
    verbs: [
      { id:'ser', inf:'ser', en:'to be (permanent)',
        present:{'1s':'soy','2s':'eres','3sm':'es','3sf':'es','1p':'somos','2p':'sois','3pm':'son','3pf':'son'},
        past:{'1s':'fui','2s':'fuiste','3sm':'fue','3sf':'fue','1p':'fuimos','2p':'fuisteis','3pm':'fueron','3pf':'fueron'},
        future:{'1s':'seré','2s':'serás','3sm':'será','3sf':'será','1p':'seremos','2p':'seréis','3pm':'serán','3pf':'serán'}
      },
      { id:'estar', inf:'estar', en:'to be (temporary)',
        present:{'1s':'estoy','2s':'estás','3sm':'está','3sf':'está','1p':'estamos','2p':'estáis','3pm':'están','3pf':'están'},
        past:{'1s':'estuve','2s':'estuviste','3sm':'estuvo','3sf':'estuvo','1p':'estuvimos','2p':'estuvisteis','3pm':'estuvieron','3pf':'estuvieron'},
        future:{'1s':'estaré','2s':'estarás','3sm':'estará','3sf':'estará','1p':'estaremos','2p':'estaréis','3pm':'estarán','3pf':'estarán'}
      },
      { id:'tener', inf:'tener', en:'to have',
        present:{'1s':'tengo','2s':'tienes','3sm':'tiene','3sf':'tiene','1p':'tenemos','2p':'tenéis','3pm':'tienen','3pf':'tienen'},
        past:{'1s':'tuve','2s':'tuviste','3sm':'tuvo','3sf':'tuvo','1p':'tuvimos','2p':'tuvisteis','3pm':'tuvieron','3pf':'tuvieron'},
        future:{'1s':'tendré','2s':'tendrás','3sm':'tendrá','3sf':'tendrá','1p':'tendremos','2p':'tendréis','3pm':'tendrán','3pf':'tendrán'}
      },
      { id:'ir', inf:'ir', en:'to go',
        present:{'1s':'voy','2s':'vas','3sm':'va','3sf':'va','1p':'vamos','2p':'vais','3pm':'van','3pf':'van'},
        past:{'1s':'fui','2s':'fuiste','3sm':'fue','3sf':'fue','1p':'fuimos','2p':'fuisteis','3pm':'fueron','3pf':'fueron'},
        future:{'1s':'iré','2s':'irás','3sm':'irá','3sf':'irá','1p':'iremos','2p':'iréis','3pm':'irán','3pf':'irán'}
      },
      { id:'hacer', inf:'hacer', en:'to do/make',
        present:{'1s':'hago','2s':'haces','3sm':'hace','3sf':'hace','1p':'hacemos','2p':'hacéis','3pm':'hacen','3pf':'hacen'},
        past:{'1s':'hice','2s':'hiciste','3sm':'hizo','3sf':'hizo','1p':'hicimos','2p':'hicisteis','3pm':'hicieron','3pf':'hicieron'},
        future:{'1s':'haré','2s':'harás','3sm':'hará','3sf':'hará','1p':'haremos','2p':'haréis','3pm':'harán','3pf':'harán'}
      },
      { id:'comer', inf:'comer', en:'to eat',
        present:{'1s':'como','2s':'comes','3sm':'come','3sf':'come','1p':'comemos','2p':'coméis','3pm':'comen','3pf':'comen'},
        past:{'1s':'comí','2s':'comiste','3sm':'comió','3sf':'comió','1p':'comimos','2p':'comisteis','3pm':'comieron','3pf':'comieron'},
        future:{'1s':'comeré','2s':'comerás','3sm':'comerá','3sf':'comerá','1p':'comeremos','2p':'comeréis','3pm':'comerán','3pf':'comerán'}
      },
      { id:'jugar', inf:'jugar', en:'to play',
        present:{'1s':'juego','2s':'juegas','3sm':'juega','3sf':'juega','1p':'jugamos','2p':'jugáis','3pm':'juegan','3pf':'juegan'},
        past:{'1s':'jugué','2s':'jugaste','3sm':'jugó','3sf':'jugó','1p':'jugamos','2p':'jugasteis','3pm':'jugaron','3pf':'jugaron'},
        future:{'1s':'jugaré','2s':'jugarás','3sm':'jugará','3sf':'jugará','1p':'jugaremos','2p':'jugaréis','3pm':'jugarán','3pf':'jugarán'}
      },
      { id:'gustar_es', inf:'gustar', en:'to like',
        present:{'1s':'gusto','2s':'gustas','3sm':'gusta','3sf':'gusta','1p':'gustamos','2p':'gustáis','3pm':'gustan','3pf':'gustan'},
        past:{'1s':'gusté','2s':'gustaste','3sm':'gustó','3sf':'gustó','1p':'gustamos','2p':'gustasteis','3pm':'gustaron','3pf':'gustaron'},
        future:{'1s':'gustaré','2s':'gustarás','3sm':'gustará','3sf':'gustará','1p':'gustaremos','2p':'gustaréis','3pm':'gustarán','3pf':'gustarán'}
      },
      { id:'vivir', inf:'vivir', en:'to live',
        present:{'1s':'vivo','2s':'vives','3sm':'vive','3sf':'vive','1p':'vivimos','2p':'vivís','3pm':'viven','3pf':'viven'},
        past:{'1s':'viví','2s':'viviste','3sm':'vivió','3sf':'vivió','1p':'vivimos','2p':'vivisteis','3pm':'vivieron','3pf':'vivieron'},
        future:{'1s':'viviré','2s':'vivirás','3sm':'vivirá','3sf':'vivirá','1p':'viviremos','2p':'viviréis','3pm':'vivirán','3pf':'vivirán'}
      },
      { id:'hablar', inf:'hablar', en:'to speak',
        present:{'1s':'hablo','2s':'hablas','3sm':'habla','3sf':'habla','1p':'hablamos','2p':'habláis','3pm':'hablan','3pf':'hablan'},
        past:{'1s':'hablé','2s':'hablaste','3sm':'habló','3sf':'habló','1p':'hablamos','2p':'hablasteis','3pm':'hablaron','3pf':'hablaron'},
        future:{'1s':'hablaré','2s':'hablarás','3sm':'hablará','3sf':'hablará','1p':'hablaremos','2p':'hablaréis','3pm':'hablarán','3pf':'hablarán'}
      },
      { id:'querer', inf:'querer', en:'to want',
        present:{'1s':'quiero','2s':'quieres','3sm':'quiere','3sf':'quiere','1p':'queremos','2p':'queréis','3pm':'quieren','3pf':'quieren'},
        past:{'1s':'quise','2s':'quisiste','3sm':'quiso','3sf':'quiso','1p':'quisimos','2p':'quisisteis','3pm':'quisieron','3pf':'quisieron'},
        future:{'1s':'querré','2s':'querrás','3sm':'querrá','3sf':'querrá','1p':'querremos','2p':'querréis','3pm':'querrán','3pf':'querrán'}
      },
      { id:'beber', inf:'beber', en:'to drink',
        present:{'1s':'bebo','2s':'bebes','3sm':'bebe','3sf':'bebe','1p':'bebemos','2p':'bebéis','3pm':'beben','3pf':'beben'},
        past:{'1s':'bebí','2s':'bebiste','3sm':'bebió','3sf':'bebió','1p':'bebimos','2p':'bebisteis','3pm':'bebieron','3pf':'bebieron'},
        future:{'1s':'beberé','2s':'beberás','3sm':'beberá','3sf':'beberá','1p':'beberemos','2p':'beberéis','3pm':'beberán','3pf':'beberán'}
      }
    ],
    nouns: [
      { id:'el_gato', text:'el gato', en:'the cat', gender:'m', article:'el' },
      { id:'la_casa', text:'la casa', en:'the house', gender:'f', article:'la' },
      { id:'el_libro', text:'el libro', en:'the book', gender:'m', article:'el' },
      { id:'la_musica', text:'la música', en:'the music', gender:'f', article:'la' },
      { id:'el_futbol', text:'el fútbol', en:'football', gender:'m', article:'el' },
      { id:'la_comida', text:'la comida', en:'the food', gender:'f', article:'la' },
      { id:'el_chocolate_es', text:'el chocolate', en:'the chocolate', gender:'m', article:'el' },
      { id:'la_pizza_es', text:'la pizza', en:'pizza', gender:'f', article:'la' },
      { id:'el_espanol', text:'el español', en:'Spanish', gender:'m', article:'el' },
      { id:'la_ciudad', text:'la ciudad', en:'the city', gender:'f', article:'la' },
      { id:'el_cine', text:'el cine', en:'the cinema', gender:'m', article:'el' },
      { id:'la_playa', text:'la playa', en:'the beach', gender:'f', article:'la' },
      { id:'los_amigos', text:'los amigos', en:'friends', gender:'m', article:'los', plural:true },
      { id:'el_tenis', text:'el tenis', en:'tennis', gender:'m', article:'el' },
      { id:'el_agua', text:'el agua', en:'water', gender:'f', article:'el' },
      { id:'el_pastel', text:'el pastel', en:'the cake', gender:'m', article:'el' },
      { id:'en_espana', text:'en España', en:'in Spain', gender:'f', article:'en', isPlace:true },
      { id:'en_madrid', text:'en Madrid', en:'in Madrid', gender:'m', article:'en', isPlace:true },
      { id:'en_el_colegio', text:'en el colegio', en:'at school', gender:'m', article:'en', isPlace:true }
    ],
    adjectives: [
      { id:'grande_es', m:'grande', f:'grande', en:'big', mPl:'grandes', fPl:'grandes' },
      { id:'pequeno', m:'pequeño', f:'pequeña', en:'small', mPl:'pequeños', fPl:'pequeñas' },
      { id:'bueno', m:'bueno', f:'buena', en:'good', mPl:'buenos', fPl:'buenas' },
      { id:'malo', m:'malo', f:'mala', en:'bad', mPl:'malos', fPl:'malas' },
      { id:'bonito', m:'bonito', f:'bonita', en:'beautiful', mPl:'bonitos', fPl:'bonitas' },
      { id:'nuevo_es', m:'nuevo', f:'nueva', en:'new', mPl:'nuevos', fPl:'nuevas' },
      { id:'viejo_es', m:'viejo', f:'vieja', en:'old', mPl:'viejos', fPl:'viejas' },
      { id:'feliz', m:'feliz', f:'feliz', en:'happy', mPl:'felices', fPl:'felices' },
      { id:'triste_es', m:'triste', f:'triste', en:'sad', mPl:'tristes', fPl:'tristes' },
      { id:'inteligente', m:'inteligente', f:'inteligente', en:'clever', mPl:'inteligentes', fPl:'inteligentes' },
      { id:'delicioso', m:'delicioso', f:'deliciosa', en:'delicious', mPl:'deliciosos', fPl:'deliciosas' },
      { id:'divertido', m:'divertido', f:'divertida', en:'fun/funny', mPl:'divertidos', fPl:'divertidas' },
      { id:'interesante', m:'interesante', f:'interesante', en:'interesting', mPl:'interesantes', fPl:'interesantes' }
    ],
    connectives: [
      { id:'y', text:'y', en:'and' },
      { id:'pero', text:'pero', en:'but' },
      { id:'porque', text:'porque', en:'because' },
      { id:'tambien', text:'también', en:'also' },
      { id:'sin_embargo', text:'sin embargo', en:'however' },
      { id:'entonces', text:'entonces', en:'so/then' },
      { id:'luego', text:'luego', en:'then/later' },
      { id:'o', text:'o', en:'or' }
    ],
    timePhrases: [
      { id:'hoy', text:'hoy', en:'today' },
      { id:'ayer', text:'ayer', en:'yesterday' },
      { id:'manana_t', text:'mañana', en:'tomorrow' },
      { id:'a_menudo', text:'a menudo', en:'often' },
      { id:'siempre', text:'siempre', en:'always' },
      { id:'a_veces', text:'a veces', en:'sometimes' },
      { id:'el_fin_de_semana', text:'el fin de semana', en:'at the weekend' },
      { id:'en_verano', text:'en verano', en:'in summer' },
      { id:'por_la_noche', text:'por la noche', en:'in the evening' },
      { id:'todos_los_dias', text:'todos los días', en:'every day' }
    ],
    phonetics: {
      'yo':'yoh','tú':'too','él':'el','ella':'ey-ya','nosotros':'noh-soh-trohs','vosotros':'boh-soh-trohs','ellos':'ey-yohs','ellas':'ey-yas',
      'soy':'soy','eres':'eh-rehs','es':'ehs','somos':'soh-mohs','sois':'soys','son':'sohn',
      'estoy':'ehs-toy','estás':'ehs-tahs','está':'ehs-tah','estamos':'ehs-tah-mohs',
      'tengo':'tehn-goh','tienes':'tyeh-nehs','tiene':'tyeh-neh','tenemos':'teh-neh-mohs',
      'voy':'boy','vas':'bahs','va':'bah','vamos':'bah-mohs','vais':'bah-ees','van':'bahn',
      'hago':'ah-goh','haces':'ah-sehs','hace':'ah-seh','hacemos':'ah-seh-mohs',
      'como':'koh-moh','comes':'koh-mehs','come':'koh-meh','comemos':'koh-meh-mohs',
      'juego':'hweh-goh','juegas':'hweh-gahs','juega':'hweh-gah','jugamos':'hoo-gah-mohs',
      'el':'ehl','la':'lah','los':'lohs','las':'lahs',
      'gato':'gah-toh','casa':'kah-sah','libro':'lee-broh','música':'moo-see-kah',
      'fútbol':'foot-bohl','comida':'koh-mee-dah','chocolate':'choh-koh-lah-teh',
      'ciudad':'syoo-dahd','cine':'see-neh','playa':'plah-yah','amigos':'ah-mee-gohs',
      'y':'ee','pero':'peh-roh','porque':'pohr-keh','también':'tahm-byehn',
      'hoy':'oy','ayer':'ah-yehr','mañana':'mah-nyah-nah','siempre':'syehm-preh',
      'a veces':'ah beh-sehs','a menudo':'ah meh-noo-doh',
      'grande':'grahn-deh','pequeño':'peh-keh-nyoh','bueno':'bweh-noh','malo':'mah-loh',
      'bonito':'boh-nee-toh','feliz':'feh-leez','triste':'trees-teh',
      'hablo':'ah-bloh','hablas':'ah-blahs','habla':'ah-blah','hablamos':'ah-blah-mohs',
      'vivo':'bee-boh','vives':'bee-behs','vive':'bee-beh','vivimos':'bee-bee-mohs',
      'quiero':'kyeh-roh','quieres':'kyeh-rehs','quiere':'kyeh-reh','queremos':'keh-reh-mohs',
      'bebo':'beh-boh','bebes':'beh-behs','bebe':'beh-beh','bebemos':'beh-beh-mohs',
      'en España':'ehn ehs-pah-nyah','en Madrid':'ehn mah-dreed','en el colegio':'ehn ehl koh-leh-hyoh',
      'español':'ehs-pah-nyohl','tenis':'teh-nees','agua':'ah-gwah','pastel':'pahs-tehl',
      'el fin de semana':'ehl feen deh seh-mah-nah','en verano':'ehn beh-rah-noh',
      'por la noche':'pohr lah noh-cheh','todos los días':'toh-dohs lohs dee-ahs',
      'sin embargo':'seen ehm-bahr-goh','entonces':'ehn-tohn-sehs','luego':'lweh-goh','o':'oh',
      'gusto':'goos-toh','gustas':'goos-tahs','gusta':'goos-tah','gustamos':'goos-tah-mohs',
      'delicioso':'deh-lee-syoh-soh','divertido':'dee-behr-tee-doh','interesante':'een-teh-reh-sahn-teh',
      'inteligente':'een-teh-lee-hehn-teh','nuevo':'nweh-boh','viejo':'byeh-hoh',
      'pequeña':'peh-keh-nyah','buena':'bweh-nah','mala':'mah-lah','bonita':'boh-nee-tah',
      'nueva':'nweh-bah','vieja':'byeh-hah','pizza':'peet-sah'
    },
    challenges: [
      { en:'I eat the chocolate', blocks:['yo','comer','el_chocolate_es'], tense:'present' },
      { en:'She is happy', blocks:['ella','estar','feliz'], tense:'present' },
      { en:'We played football yesterday', blocks:['nosotros','jugar','el_futbol','ayer'], tense:'past' },
      { en:'They (m) will go to the beach tomorrow', blocks:['ellos','ir','la_playa','manana_t'], tense:'future' },
      { en:'I like the music because it is beautiful', blocks:['yo','gustar_es','la_musica','porque','ella','ser','bonito'], tense:'present' },
      { en:'He speaks Spanish at school every day', blocks:['el','hablar','el_espanol','en_el_colegio','todos_los_dias'], tense:'present' }
    ]
  },

  de: {
    subjects: [
      { id:'ich', text:'Ich', en:'I', person:'1s' },
      { id:'du', text:'Du', en:'You (informal)', person:'2s' },
      { id:'er', text:'Er', en:'He', person:'3sm' },
      { id:'sie_s', text:'Sie (she)', en:'She', person:'3sf' },
      { id:'es_de', text:'Es', en:'It', person:'3sn' },
      { id:'wir', text:'Wir', en:'We', person:'1p' },
      { id:'ihr', text:'Ihr', en:'You all', person:'2p' },
      { id:'sie_p', text:'Sie (they)', en:'They', person:'3p' }
    ],
    verbs: [
      { id:'sein', inf:'sein', en:'to be',
        present:{'1s':'bin','2s':'bist','3sm':'ist','3sf':'ist','3sn':'ist','1p':'sind','2p':'seid','3p':'sind'},
        past:{'1s':'war','2s':'warst','3sm':'war','3sf':'war','3sn':'war','1p':'waren','2p':'wart','3p':'waren'},
        future:{'1s':'werde sein','2s':'wirst sein','3sm':'wird sein','3sf':'wird sein','3sn':'wird sein','1p':'werden sein','2p':'werdet sein','3p':'werden sein'}
      },
      { id:'haben', inf:'haben', en:'to have',
        present:{'1s':'habe','2s':'hast','3sm':'hat','3sf':'hat','3sn':'hat','1p':'haben','2p':'habt','3p':'haben'},
        past:{'1s':'hatte','2s':'hattest','3sm':'hatte','3sf':'hatte','3sn':'hatte','1p':'hatten','2p':'hattet','3p':'hatten'},
        future:{'1s':'werde haben','2s':'wirst haben','3sm':'wird haben','3sf':'wird haben','3sn':'wird haben','1p':'werden haben','2p':'werdet haben','3p':'werden haben'}
      },
      { id:'gehen', inf:'gehen', en:'to go',
        present:{'1s':'gehe','2s':'gehst','3sm':'geht','3sf':'geht','3sn':'geht','1p':'gehen','2p':'geht','3p':'gehen'},
        past:{'1s':'ging','2s':'gingst','3sm':'ging','3sf':'ging','3sn':'ging','1p':'gingen','2p':'gingt','3p':'gingen'},
        future:{'1s':'werde gehen','2s':'wirst gehen','3sm':'wird gehen','3sf':'wird gehen','3sn':'wird gehen','1p':'werden gehen','2p':'werdet gehen','3p':'werden gehen'}
      },
      { id:'machen', inf:'machen', en:'to do/make',
        present:{'1s':'mache','2s':'machst','3sm':'macht','3sf':'macht','3sn':'macht','1p':'machen','2p':'macht','3p':'machen'},
        past:{'1s':'machte','2s':'machtest','3sm':'machte','3sf':'machte','3sn':'machte','1p':'machten','2p':'machtet','3p':'machten'},
        future:{'1s':'werde machen','2s':'wirst machen','3sm':'wird machen','3sf':'wird machen','3sn':'wird machen','1p':'werden machen','2p':'werdet machen','3p':'werden machen'}
      },
      { id:'essen', inf:'essen', en:'to eat',
        present:{'1s':'esse','2s':'isst','3sm':'isst','3sf':'isst','3sn':'isst','1p':'essen','2p':'esst','3p':'essen'},
        past:{'1s':'aß','2s':'aßt','3sm':'aß','3sf':'aß','3sn':'aß','1p':'aßen','2p':'aßt','3p':'aßen'},
        future:{'1s':'werde essen','2s':'wirst essen','3sm':'wird essen','3sf':'wird essen','3sn':'wird essen','1p':'werden essen','2p':'werdet essen','3p':'werden essen'}
      },
      { id:'spielen', inf:'spielen', en:'to play',
        present:{'1s':'spiele','2s':'spielst','3sm':'spielt','3sf':'spielt','3sn':'spielt','1p':'spielen','2p':'spielt','3p':'spielen'},
        past:{'1s':'spielte','2s':'spieltest','3sm':'spielte','3sf':'spielte','3sn':'spielte','1p':'spielten','2p':'spieltet','3p':'spielten'},
        future:{'1s':'werde spielen','2s':'wirst spielen','3sm':'wird spielen','3sf':'wird spielen','3sn':'wird spielen','1p':'werden spielen','2p':'werdet spielen','3p':'werden spielen'}
      },
      { id:'moegen', inf:'mögen', en:'to like',
        present:{'1s':'mag','2s':'magst','3sm':'mag','3sf':'mag','3sn':'mag','1p':'mögen','2p':'mögt','3p':'mögen'},
        past:{'1s':'mochte','2s':'mochtest','3sm':'mochte','3sf':'mochte','3sn':'mochte','1p':'mochten','2p':'mochtet','3p':'mochten'},
        future:{'1s':'werde mögen','2s':'wirst mögen','3sm':'wird mögen','3sf':'wird mögen','3sn':'wird mögen','1p':'werden mögen','2p':'werdet mögen','3p':'werden mögen'}
      },
      { id:'wohnen', inf:'wohnen', en:'to live (in)',
        present:{'1s':'wohne','2s':'wohnst','3sm':'wohnt','3sf':'wohnt','3sn':'wohnt','1p':'wohnen','2p':'wohnt','3p':'wohnen'},
        past:{'1s':'wohnte','2s':'wohntest','3sm':'wohnte','3sf':'wohnte','3sn':'wohnte','1p':'wohnten','2p':'wohntet','3p':'wohnten'},
        future:{'1s':'werde wohnen','2s':'wirst wohnen','3sm':'wird wohnen','3sf':'wird wohnen','3sn':'wird wohnen','1p':'werden wohnen','2p':'werdet wohnen','3p':'werden wohnen'}
      },
      { id:'sprechen', inf:'sprechen', en:'to speak',
        present:{'1s':'spreche','2s':'sprichst','3sm':'spricht','3sf':'spricht','3sn':'spricht','1p':'sprechen','2p':'sprecht','3p':'sprechen'},
        past:{'1s':'sprach','2s':'sprachst','3sm':'sprach','3sf':'sprach','3sn':'sprach','1p':'sprachen','2p':'spracht','3p':'sprachen'},
        future:{'1s':'werde sprechen','2s':'wirst sprechen','3sm':'wird sprechen','3sf':'wird sprechen','3sn':'wird sprechen','1p':'werden sprechen','2p':'werdet sprechen','3p':'werden sprechen'}
      },
      { id:'wollen', inf:'wollen', en:'to want',
        present:{'1s':'will','2s':'willst','3sm':'will','3sf':'will','3sn':'will','1p':'wollen','2p':'wollt','3p':'wollen'},
        past:{'1s':'wollte','2s':'wolltest','3sm':'wollte','3sf':'wollte','3sn':'wollte','1p':'wollten','2p':'wolltet','3p':'wollten'},
        future:{'1s':'werde wollen','2s':'wirst wollen','3sm':'wird wollen','3sf':'wird wollen','3sn':'wird wollen','1p':'werden wollen','2p':'werdet wollen','3p':'werden wollen'}
      },
      { id:'trinken', inf:'trinken', en:'to drink',
        present:{'1s':'trinke','2s':'trinkst','3sm':'trinkt','3sf':'trinkt','3sn':'trinkt','1p':'trinken','2p':'trinkt','3p':'trinken'},
        past:{'1s':'trank','2s':'trankst','3sm':'trank','3sf':'trank','3sn':'trank','1p':'tranken','2p':'trankt','3p':'tranken'},
        future:{'1s':'werde trinken','2s':'wirst trinken','3sm':'wird trinken','3sf':'wird trinken','3sn':'wird trinken','1p':'werden trinken','2p':'werdet trinken','3p':'werden trinken'}
      },
      { id:'koennen', inf:'können', en:'to be able to',
        present:{'1s':'kann','2s':'kannst','3sm':'kann','3sf':'kann','3sn':'kann','1p':'können','2p':'könnt','3p':'können'},
        past:{'1s':'konnte','2s':'konntest','3sm':'konnte','3sf':'konnte','3sn':'konnte','1p':'konnten','2p':'konntet','3p':'konnten'},
        future:{'1s':'werde können','2s':'wirst können','3sm':'wird können','3sf':'wird können','3sn':'wird können','1p':'werden können','2p':'werdet können','3p':'werden können'}
      }
    ],
    nouns: [
      { id:'die_katze', text:'die Katze', en:'the cat', gender:'f', article:'die' },
      { id:'das_haus', text:'das Haus', en:'the house', gender:'n', article:'das' },
      { id:'das_buch', text:'das Buch', en:'the book', gender:'n', article:'das' },
      { id:'die_musik', text:'die Musik', en:'the music', gender:'f', article:'die' },
      { id:'der_fussball', text:'der Fußball', en:'football', gender:'m', article:'der' },
      { id:'das_essen_n', text:'das Essen', en:'the food', gender:'n', article:'das' },
      { id:'die_schokolade', text:'die Schokolade', en:'the chocolate', gender:'f', article:'die' },
      { id:'die_pizza_de', text:'die Pizza', en:'pizza', gender:'f', article:'die' },
      { id:'das_deutsch', text:'Deutsch', en:'German', gender:'n', article:'' },
      { id:'die_stadt', text:'die Stadt', en:'the city', gender:'f', article:'die' },
      { id:'das_kino', text:'das Kino', en:'the cinema', gender:'n', article:'das' },
      { id:'der_strand', text:'der Strand', en:'the beach', gender:'m', article:'der' },
      { id:'die_freunde', text:'die Freunde', en:'friends', gender:'m', article:'die', plural:true },
      { id:'das_tennis_de', text:'Tennis', en:'tennis', gender:'n', article:'' },
      { id:'das_wasser', text:'das Wasser', en:'water', gender:'n', article:'das' },
      { id:'der_kuchen', text:'der Kuchen', en:'the cake', gender:'m', article:'der' },
      { id:'in_deutschland', text:'in Deutschland', en:'in Germany', gender:'n', article:'in', isPlace:true },
      { id:'in_berlin', text:'in Berlin', en:'in Berlin', gender:'n', article:'in', isPlace:true },
      { id:'in_der_schule', text:'in der Schule', en:'at school', gender:'f', article:'in', isPlace:true }
    ],
    adjectives: [
      { id:'gross', m:'groß', f:'groß', n:'groß', en:'big/tall', pred:true },
      { id:'klein', m:'klein', f:'klein', n:'klein', en:'small', pred:true },
      { id:'gut', m:'gut', f:'gut', n:'gut', en:'good', pred:true },
      { id:'schlecht', m:'schlecht', f:'schlecht', n:'schlecht', en:'bad', pred:true },
      { id:'schoen', m:'schön', f:'schön', n:'schön', en:'beautiful', pred:true },
      { id:'neu', m:'neu', f:'neu', n:'neu', en:'new', pred:true },
      { id:'alt', m:'alt', f:'alt', n:'alt', en:'old', pred:true },
      { id:'gluecklich', m:'glücklich', f:'glücklich', n:'glücklich', en:'happy', pred:true },
      { id:'traurig', m:'traurig', f:'traurig', n:'traurig', en:'sad', pred:true },
      { id:'klug', m:'klug', f:'klug', n:'klug', en:'clever', pred:true },
      { id:'lecker', m:'lecker', f:'lecker', n:'lecker', en:'delicious', pred:true },
      { id:'lustig', m:'lustig', f:'lustig', n:'lustig', en:'fun/funny', pred:true },
      { id:'interessant_de', m:'interessant', f:'interessant', n:'interessant', en:'interesting', pred:true }
    ],
    connectives: [
      { id:'und', text:'und', en:'and' },
      { id:'aber', text:'aber', en:'but' },
      { id:'weil', text:'weil', en:'because' },
      { id:'auch', text:'auch', en:'also' },
      { id:'jedoch', text:'jedoch', en:'however' },
      { id:'also_de', text:'also', en:'so/therefore' },
      { id:'dann', text:'dann', en:'then' },
      { id:'oder', text:'oder', en:'or' }
    ],
    timePhrases: [
      { id:'heute', text:'heute', en:'today' },
      { id:'gestern', text:'gestern', en:'yesterday' },
      { id:'morgen_de', text:'morgen', en:'tomorrow' },
      { id:'oft', text:'oft', en:'often' },
      { id:'immer', text:'immer', en:'always' },
      { id:'manchmal', text:'manchmal', en:'sometimes' },
      { id:'am_wochenende', text:'am Wochenende', en:'at the weekend' },
      { id:'im_sommer', text:'im Sommer', en:'in summer' },
      { id:'am_abend', text:'am Abend', en:'in the evening' },
      { id:'jeden_tag', text:'jeden Tag', en:'every day' }
    ],
    phonetics: {
      'ich':'ikh','du':'doo','er':'air','sie':'zee','es':'ess','wir':'veer','ihr':'eer',
      'bin':'bin','bist':'bist','ist':'ist','sind':'zint','seid':'zyde',
      'habe':'hah-buh','hast':'hahst','hat':'haht','haben':'hah-ben','habt':'hahbt',
      'gehe':'gay-uh','gehst':'gayst','geht':'gayt','gehen':'gay-en',
      'mache':'makh-uh','machst':'makhst','macht':'makht','machen':'makh-en',
      'esse':'ess-uh','isst':'isst','essen':'ess-en','esst':'esst',
      'spiele':'shpee-luh','spielst':'shpeelst','spielt':'shpeelt','spielen':'shpee-len',
      'mag':'mahg','magst':'mahgst','mögen':'mur-gen','mögt':'murgt',
      'wohne':'voh-nuh','wohnst':'vohnst','wohnt':'vohnt','wohnen':'voh-nen',
      'spreche':'shpreh-khuh','sprichst':'shprikhst','spricht':'shprikht','sprechen':'shpreh-khen','sprecht':'shprekht',
      'will':'vil','willst':'vilst','wollen':'vol-en','wollt':'volt',
      'trinke':'trink-uh','trinkst':'trinkst','trinkt':'trinkt','trinken':'trink-en',
      'kann':'kahn','kannst':'kahnst','können':'kur-nen','könnt':'kurnt',
      'die':'dee','der':'dair','das':'dahs','den':'dehn',
      'Katze':'kaht-suh','Haus':'hows','Buch':'bookh','Musik':'moo-zeek',
      'Fußball':'foos-bahl','Essen':'ess-en','Schokolade':'shoh-koh-lah-duh',
      'Pizza':'peet-sah','Deutsch':'doytsh','Stadt':'shtaht','Kino':'kee-noh',
      'Strand':'shtrahnt','Freunde':'froyn-duh','Tennis':'teh-nis','Wasser':'vahs-er',
      'Kuchen':'koo-khen',
      'in Deutschland':'in doytsh-lahnt','in Berlin':'in behr-leen','in der Schule':'in dair shoo-luh',
      'groß':'grohs','klein':'klyne','gut':'goot','schlecht':'shlekht',
      'schön':'shurn','neu':'noy','alt':'ahlt','glücklich':'glook-likh',
      'traurig':'trow-rikh','klug':'kloog','lecker':'leh-ker','lustig':'loos-tikh','interessant':'in-teh-reh-sahnt',
      'und':'oont','aber':'ah-ber','weil':'vyle','auch':'owkh',
      'jedoch':'yeh-dokh','also':'ahl-zoh','dann':'dahn','oder':'oh-der',
      'heute':'hoy-tuh','gestern':'geh-stern','morgen':'mor-gen',
      'oft':'oft','immer':'im-er','manchmal':'mahnkh-mahl',
      'am Wochenende':'ahm vokh-en-en-duh','im Sommer':'im zom-er',
      'am Abend':'ahm ah-bent','jeden Tag':'yay-den tahg',
      'war':'vahr','warst':'vahrst','waren':'vah-ren','wart':'vahrt',
      'hatte':'hah-tuh','hattest':'hah-test','hatten':'hah-ten','hattet':'hah-tet',
      'ging':'ging','gingst':'gingst','gingen':'ging-en','gingt':'gingt',
      'machte':'makh-tuh','machtest':'makh-test','machten':'makh-ten','machtet':'makh-tet',
      'aß':'ahs','aßt':'ahst','aßen':'ahs-en',
      'spielte':'shpeel-tuh','spieltest':'shpeel-test','spielten':'shpeel-ten','spieltet':'shpeel-tet',
      'mochte':'mokh-tuh','mochtest':'mokh-test','mochten':'mokh-ten','mochtet':'mokh-tet',
      'wohnte':'vohn-tuh','wohntest':'vohn-test','wohnten':'vohn-ten','wohntet':'vohn-tet',
      'sprach':'shprakh','sprachst':'shprakhst','sprachen':'shprakh-en','spracht':'shprakht',
      'wollte':'vol-tuh','wolltest':'vol-test','wollten':'vol-ten','wolltet':'vol-tet',
      'trank':'trahnk','trankst':'trahnkst','tranken':'trahnk-en','trankt':'trahnkt',
      'konnte':'kon-tuh','konntest':'kon-test','konnten':'kon-ten','konntet':'kon-tet',
      'werde':'vair-duh','wirst':'virst','wird':'virt','werden':'vair-den','werdet':'vair-det'
    },
    challenges: [
      { en:'I eat the chocolate', blocks:['ich','essen','die_schokolade'], tense:'present' },
      { en:'She is happy', blocks:['sie_s','sein','gluecklich'], tense:'present' },
      { en:'We played football yesterday', blocks:['wir','spielen','der_fussball','gestern'], tense:'past' },
      { en:'They will go to the beach tomorrow', blocks:['sie_p','gehen','der_strand','morgen_de'], tense:'future' },
      { en:'I like the music because it is beautiful', blocks:['ich','moegen','die_musik','weil','sie_s','sein','schoen'], tense:'present' },
      { en:'He speaks German at school every day', blocks:['er','sprechen','das_deutsch','in_der_schule','jeden_tag'], tense:'present' }
    ]
  }
};

// ===================== STATE =====================
let state = {
  lang: 'fr',
  tense: 'present',
  mode: 'free',
  zoneBlocks: [],
  challengeIdx: 0,
  sentencesBuilt: 0,
  correctCount: 0,
  totalChecked: 0
};

// ===================== HELPERS =====================
function $(sel) { return document.querySelector(sel); }
function $$(sel) { return document.querySelectorAll(sel); }

function langData() { return DATA[state.lang]; }

function findBlock(id) {
  const d = langData();
  for (const cat of ['subjects','verbs','nouns','adjectives','connectives','timePhrases']) {
    const found = d[cat].find(b => b.id === id);
    if (found) return { ...found, category: cat };
  }
  return null;
}

function getBlockType(category) {
  const map = { subjects:'subject', verbs:'verb', nouns:'noun', adjectives:'adjective', connectives:'connective', timePhrases:'time' };
  return map[category] || 'noun';
}

function conjugateVerb(verbId, person, tense) {
  const verb = langData().verbs.find(v => v.id === verbId);
  if (!verb) return null;
  const t = verb[tense];
  if (!t) return null;
  return t[person] || t['3sm'] || null;
}

function getAdjectiveForm(adjId, gender, plural) {
  const adj = langData().adjectives.find(a => a.id === adjId);
  if (!adj) return null;
  if (state.lang === 'de') return adj.m; // predicative adjectives don't decline in German
  if (plural) return gender === 'f' ? (adj.fPl || adj.f) : (adj.mPl || adj.m);
  return gender === 'f' ? adj.f : adj.m;
}

function getPhonetic(word) {
  if (!word) return '';
  const ph = langData().phonetics;
  if (ph[word]) return ph[word];
  // Try each word in multi-word phrases
  const parts = word.split(' ');
  if (parts.length > 1) {
    const mapped = parts.map(p => ph[p] || p);
    return mapped.join(' ');
  }
  return word;
}

// ===================== RENDER TRAYS =====================
function renderTrays() {
  const d = langData();
  const traysEl = $('#trays');
  traysEl.innerHTML = '';

  const categories = [
    { key:'subjects', label:'Subjects', cssClass:'tray-subjects' },
    { key:'verbs', label:'Verbs', cssClass:'tray-verbs' },
    { key:'nouns', label:'Nouns / Objects', cssClass:'tray-nouns' },
    { key:'adjectives', label:'Adjectives', cssClass:'tray-adjectives' },
    { key:'connectives', label:'Connectives', cssClass:'tray-connectives' },
    { key:'timePhrases', label:'Time Phrases', cssClass:'tray-time' }
  ];

  categories.forEach(cat => {
    const tray = document.createElement('div');
    tray.className = `tray ${cat.cssClass}`;
    const type = getBlockType(cat.key);
    tray.innerHTML = `<div class="tray-header"><span class="dot"></span>${cat.label}</div><div class="tray-blocks"></div>`;
    const container = tray.querySelector('.tray-blocks');

    d[cat.key].forEach(item => {
      const block = createBlockElement(item, cat.key);
      container.appendChild(block);
    });

    traysEl.appendChild(tray);
  });
}

function createBlockElement(item, category) {
  const type = getBlockType(category);
  const block = document.createElement('div');
  block.className = `block ${type}`;
  block.dataset.id = item.id;
  block.dataset.category = category;
  block.draggable = true;

  // Gender styling for nouns
  if (category === 'nouns') {
    if (item.gender === 'm') block.classList.add('masc');
    else if (item.gender === 'f') block.classList.add('fem');
    else if (item.gender === 'n') block.classList.add('neut-gender');
  }

  // Text content
  let mainText = '';
  let subText = '';

  if (category === 'subjects') {
    mainText = item.text;
    subText = item.en;
  } else if (category === 'verbs') {
    // Show conjugated form based on current context
    mainText = item.inf;
    subText = item.en;
  } else if (category === 'nouns') {
    mainText = item.text;
    subText = item.en;
  } else if (category === 'adjectives') {
    mainText = item.m;
    subText = item.en;
  } else if (category === 'connectives') {
    mainText = item.text;
    subText = item.en;
  } else if (category === 'timePhrases') {
    mainText = item.text;
    subText = item.en;
  }

  block.innerHTML = `${mainText}<span class="block-sub">${subText}</span>`;

  // Drag events
  block.addEventListener('dragstart', (e) => {
    e.dataTransfer.setData('text/plain', JSON.stringify({ id:item.id, category }));
    e.dataTransfer.effectAllowed = 'copy';
    block.style.opacity = '0.5';
  });
  block.addEventListener('dragend', () => {
    block.style.opacity = '1';
  });

  // Touch support
  block.addEventListener('touchstart', handleTouchStart, { passive:false });

  return block;
}

// ===================== CONSTRUCTION ZONE =====================
function setupConstructionZone() {
  const zone = $('#constructionZone');
  zone.addEventListener('dragover', (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'copy';
    zone.classList.add('drag-over');
  });
  zone.addEventListener('dragleave', () => {
    zone.classList.remove('drag-over');
  });
  zone.addEventListener('drop', (e) => {
    e.preventDefault();
    zone.classList.remove('drag-over');
    try {
      const data = JSON.parse(e.dataTransfer.getData('text/plain'));
      addBlockToZone(data.id, data.category);
    } catch(err) {}
  });
}

function addBlockToZone(id, category) {
  state.zoneBlocks.push({ id, category });
  renderZone();
}

function removeBlockFromZone(index) {
  state.zoneBlocks.splice(index, 1);
  renderZone();
}

function renderZone() {
  const zone = $('#constructionZone');
  zone.innerHTML = '';

  if (state.zoneBlocks.length === 0) {
    zone.classList.add('empty');
    $('#resultBar').classList.remove('visible');
    return;
  }
  zone.classList.remove('empty');

  // Determine subject context for conjugation
  const analysis = analyzeSentence();

  state.zoneBlocks.forEach((zb, idx) => {
    const item = findBlock(zb.id);
    if (!item) return;
    const type = getBlockType(zb.category);
    const block = document.createElement('div');
    block.className = `block ${type}`;
    block.dataset.zoneIdx = idx;

    // Gender styling for nouns
    if (zb.category === 'nouns' && item.gender) {
      if (item.gender === 'm') block.classList.add('masc');
      else if (item.gender === 'f') block.classList.add('fem');
      else if (item.gender === 'n') block.classList.add('neut-gender');
    }

    // Build display text with auto-conjugation
    let displayText = '';
    let subText = '';

    if (zb.category === 'verbs') {
      // Auto-conjugate based on preceding subject
      const precedingSubject = findPrecedingSubject(idx);
      if (precedingSubject) {
        const conjugated = conjugateVerb(item.id, precedingSubject.person, state.tense);
        displayText = conjugated || item.inf;
        subText = item.en;
      } else {
        displayText = item.inf;
        subText = item.en + ' (needs subject)';
      }
    } else if (zb.category === 'adjectives') {
      // Adjust for gender agreement
      const nearestNoun = findNearestNoun(idx);
      const subjectGender = findSubjectGender(idx);
      const gender = nearestNoun ? nearestNoun.gender : (subjectGender || 'm');
      const plural = nearestNoun ? nearestNoun.plural : false;
      const form = getAdjectiveForm(item.id, gender, plural);
      displayText = form || item.m;
      subText = item.en;
    } else if (zb.category === 'subjects') {
      displayText = item.text;
      subText = item.en;
    } else if (zb.category === 'nouns') {
      displayText = item.text;
      subText = item.en;
    } else if (zb.category === 'connectives') {
      displayText = item.text;
      subText = item.en;
    } else if (zb.category === 'timePhrases') {
      displayText = item.text;
      subText = item.en;
    }

    // Validation
    const validation = validateBlockAt(idx);
    if (validation.valid) {
      block.classList.add('valid-connection');
    } else if (validation.error) {
      block.classList.add('invalid-connection');
      const tooltip = document.createElement('div');
      tooltip.className = 'grammar-tooltip';
      tooltip.textContent = validation.error;
      block.appendChild(tooltip);
      setTimeout(() => tooltip.remove(), 3000);
    }

    block.innerHTML = `${displayText}<span class="block-sub">${subText}</span><button class="remove-block" title="Remove">&times;</button>`;
    block.querySelector('.remove-block').addEventListener('click', (e) => {
      e.stopPropagation();
      removeBlockFromZone(idx);
    });

    // Allow reordering via drag within zone
    block.draggable = true;
    block.addEventListener('dragstart', (e) => {
      e.dataTransfer.setData('text/plain', JSON.stringify({ zoneIdx: idx }));
      block.style.opacity = '0.5';
    });
    block.addEventListener('dragend', () => { block.style.opacity = '1'; });
    block.addEventListener('dragover', (e) => {
      e.preventDefault();
      block.style.borderLeft = '3px solid var(--gold)';
    });
    block.addEventListener('dragleave', () => {
      block.style.borderLeft = '';
    });
    block.addEventListener('drop', (e) => {
      e.preventDefault();
      e.stopPropagation();
      block.style.borderLeft = '';
      try {
        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
        if (data.zoneIdx !== undefined) {
          // Reorder within zone
          const fromIdx = data.zoneIdx;
          const toIdx = idx;
          if (fromIdx !== toIdx) {
            const moved = state.zoneBlocks.splice(fromIdx, 1)[0];
            state.zoneBlocks.splice(toIdx, 0, moved);
            renderZone();
          }
        } else {
          // New block being dropped on existing block (insert before)
          state.zoneBlocks.splice(idx, 0, { id: data.id, category: data.category });
          renderZone();
        }
      } catch(err) {}
    });

    zone.appendChild(block);
  });

  // Live update result bar
  updateResultBar();
}

function findPrecedingSubject(idx) {
  // Walk backwards from idx to find the nearest subject
  for (let i = idx - 1; i >= 0; i--) {
    const zb = state.zoneBlocks[i];
    if (zb.category === 'subjects') {
      const item = findBlock(zb.id);
      return item;
    }
    // Stop at connectives (they start a new clause)
    if (zb.category === 'connectives') break;
  }
  return null;
}

function findSubjectGender(idx) {
  for (let i = idx - 1; i >= 0; i--) {
    const zb = state.zoneBlocks[i];
    if (zb.category === 'subjects') {
      const item = findBlock(zb.id);
      if (item.person.includes('f')) return 'f';
      if (item.person.includes('n')) return 'n';
      return 'm';
    }
    if (zb.category === 'connectives') break;
  }
  return null;
}

function findNearestNoun(idx) {
  // Search nearby for a noun to determine gender/number agreement
  for (let i = idx - 1; i >= 0; i--) {
    const zb = state.zoneBlocks[i];
    if (zb.category === 'nouns') return findBlock(zb.id);
    if (zb.category === 'connectives') break;
  }
  // Also check the subject for gender
  for (let i = idx - 1; i >= 0; i--) {
    const zb = state.zoneBlocks[i];
    if (zb.category === 'subjects') {
      const subj = findBlock(zb.id);
      if (subj.person.includes('f')) return { gender:'f', plural:subj.person.includes('p') };
      if (subj.person.includes('n')) return { gender:'n', plural:false };
      return { gender:'m', plural:subj.person.includes('p') };
    }
    if (zb.category === 'connectives') break;
  }
  return null;
}

function validateBlockAt(idx) {
  const zb = state.zoneBlocks[idx];
  const item = findBlock(zb.id);
  if (!item) return { valid:false };

  // Verb without preceding subject
  if (zb.category === 'verbs') {
    const subj = findPrecedingSubject(idx);
    if (!subj) return { valid:false, error:'Verb needs a subject before it' };
    return { valid:true };
  }

  // Two subjects in a row
  if (zb.category === 'subjects' && idx > 0) {
    const prev = state.zoneBlocks[idx-1];
    if (prev.category === 'subjects') return { valid:false, error:'Two subjects in a row' };
  }

  // Two verbs in a row (without connective)
  if (zb.category === 'verbs' && idx > 0) {
    const prev = state.zoneBlocks[idx-1];
    if (prev.category === 'verbs') return { valid:false, error:'Two verbs in a row' };
  }

  // Connective at start
  if (zb.category === 'connectives' && idx === 0) {
    return { valid:false, error:'Sentence cannot start with a connective' };
  }

  // Connective at end
  if (zb.category === 'connectives' && idx === state.zoneBlocks.length - 1) {
    return { valid:false, error:'Sentence cannot end with a connective' };
  }

  return { valid:true };
}

function analyzeSentence() {
  // Basic sentence structure analysis
  const blocks = state.zoneBlocks.map((zb, idx) => ({
    ...zb,
    item: findBlock(zb.id),
    idx
  }));
  return { blocks };
}

// ===================== RESULT BAR =====================
function updateResultBar() {
  if (state.zoneBlocks.length === 0) {
    $('#resultBar').classList.remove('visible');
    return;
  }

  const result = buildSentenceText();
  $('#resultBar').classList.add('visible');
  $('#sentenceForeign').textContent = result.foreign;
  $('#sentenceEnglish').textContent = result.english;
  $('#sentencePhonetic').textContent = result.phonetic;
  $('#resultStatus').textContent = '';
  $('#resultStatus').className = 'result-status';
  $('#grammarNote').style.display = 'none';
}

function buildSentenceText() {
  let foreignParts = [];
  let englishParts = [];
  let phoneticParts = [];

  state.zoneBlocks.forEach((zb, idx) => {
    const item = findBlock(zb.id);
    if (!item) return;

    let foreignWord = '';
    let englishWord = '';

    if (zb.category === 'verbs') {
      const subj = findPrecedingSubject(idx);
      if (subj) {
        const conjugated = conjugateVerb(item.id, subj.person, state.tense);
        foreignWord = conjugated || item.inf;
      } else {
        foreignWord = item.inf;
      }
      englishWord = getEnglishVerb(item, idx);
    } else if (zb.category === 'adjectives') {
      const nearestNoun = findNearestNoun(idx);
      const subjectGender = findSubjectGender(idx);
      const gender = nearestNoun ? nearestNoun.gender : (subjectGender || 'm');
      const plural = nearestNoun ? nearestNoun.plural : false;
      foreignWord = getAdjectiveForm(item.id, gender, plural) || item.m;
      englishWord = item.en;
    } else if (zb.category === 'subjects') {
      foreignWord = item.text;
      englishWord = item.en;
    } else if (zb.category === 'nouns') {
      foreignWord = item.text;
      englishWord = item.en;
    } else if (zb.category === 'connectives') {
      foreignWord = item.text;
      englishWord = item.en;
    } else if (zb.category === 'timePhrases') {
      foreignWord = item.text;
      englishWord = item.en;
    }

    foreignParts.push(foreignWord);
    englishParts.push(englishWord);
    phoneticParts.push(getPhonetic(foreignWord));
  });

  let foreign = foreignParts.join(' ');
  // Capitalize first letter
  foreign = foreign.charAt(0).toUpperCase() + foreign.slice(1);

  return {
    foreign,
    english: englishParts.join(' '),
    phonetic: phoneticParts.join(' ')
  };
}

function getEnglishVerb(verbItem, idx) {
  const subj = findPrecedingSubject(idx);
  let base = verbItem.en.replace('to ', '');
  if (state.tense === 'past') return base + ' (past)';
  if (state.tense === 'future') return 'will ' + base;
  // present 3rd person
  if (subj && (subj.person === '3sm' || subj.person === '3sf' || subj.person === '3sn')) {
    if (base.endsWith('s') || base.endsWith('sh') || base.endsWith('ch')) return base + 'es';
    if (base.endsWith('y') && !'aeiou'.includes(base[base.length-2])) return base.slice(0,-1) + 'ies';
    return base + 's';
  }
  return base;
}

// ===================== CHECK SENTENCE =====================
function checkSentence() {
  if (state.zoneBlocks.length === 0) return;

  state.totalChecked++;
  const result = buildSentenceText();

  // Check if structure is valid
  let hasSubject = false;
  let hasVerb = false;
  let errors = [];

  state.zoneBlocks.forEach((zb, idx) => {
    if (zb.category === 'subjects') hasSubject = true;
    if (zb.category === 'verbs') hasVerb = true;
    const v = validateBlockAt(idx);
    if (v.error) errors.push(v.error);
  });

  if (!hasSubject) errors.push('Missing a subject');
  if (!hasVerb) errors.push('Missing a verb');

  const isCorrect = errors.length === 0;

  if (isCorrect) {
    state.correctCount++;
    state.sentencesBuilt++;
    $('#resultStatus').textContent = '\u2713 Grammatically Correct!';
    $('#resultStatus').className = 'result-status correct';
    $('#grammarNote').style.display = 'none';
    celebrate();
  } else {
    $('#resultStatus').textContent = '\u2717 Needs Improvement';
    $('#resultStatus').className = 'result-status incorrect';
    $('#grammarNote').textContent = errors.join('. ');
    $('#grammarNote').style.display = 'block';
  }

  // Challenge mode check
  if (state.mode === 'challenge') {
    checkChallenge(isCorrect);
  }

  updateStats();
}

function checkChallenge(structureCorrect) {
  const challenges = langData().challenges;
  const challenge = challenges[state.challengeIdx];
  if (!challenge) return;

  // Check if the right blocks are used
  const usedIds = state.zoneBlocks.map(zb => zb.id);
  const expected = challenge.blocks;
  const match = expected.length === usedIds.length && expected.every((id, i) => usedIds[i] === id);

  if (match && state.tense === challenge.tense) {
    $('#grammarNote').textContent = 'Perfect! You matched the challenge sentence exactly!';
    $('#grammarNote').style.display = 'block';
    $('#resultStatus').textContent = '\u2713 Challenge Complete!';
    $('#resultStatus').className = 'result-status correct';
  }
}

// ===================== CHALLENGE MODE =====================
function renderChallenge() {
  const panel = $('#challengePanel');
  if (state.mode !== 'challenge') {
    panel.classList.remove('visible');
    return;
  }
  panel.classList.add('visible');
  const challenges = langData().challenges;
  const ch = challenges[state.challengeIdx];
  if (!ch) return;

  $('#challengeSentence').textContent = `"${ch.en}"`;
  $('#challengeProgress').textContent = `${state.challengeIdx + 1} / ${challenges.length}`;
  $('#prevChallenge').disabled = state.challengeIdx === 0;
  $('#nextChallenge').disabled = state.challengeIdx >= challenges.length - 1;

  // Set the tense for the challenge
  state.tense = ch.tense;
  $$('.tense-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.tense === ch.tense);
  });
}

// ===================== CELEBRATION =====================
function celebrate() {
  const container = document.createElement('div');
  container.className = 'celebration';
  document.body.appendChild(container);

  const colors = ['#3b82f6','#ef4444','#22c55e','#eab308','#a855f7','#f97316','#fbbf24','#f472b6'];
  for (let i = 0; i < 40; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.top = '-10px';
    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDelay = Math.random() * 0.5 + 's';
    confetti.style.animationDuration = (1 + Math.random()) + 's';
    confetti.style.width = (5 + Math.random() * 8) + 'px';
    confetti.style.height = (5 + Math.random() * 8) + 'px';
    container.appendChild(confetti);
  }

  setTimeout(() => container.remove(), 2500);
}

// ===================== STATS =====================
function updateStats() {
  $('#statBuilt').textContent = state.sentencesBuilt;
  if (state.totalChecked > 0) {
    const pct = Math.round((state.correctCount / state.totalChecked) * 100);
    $('#statAccuracy').textContent = pct + '%';
  }
}

// ===================== TOUCH SUPPORT =====================
let touchDragData = null;
let touchGhost = null;
let touchDropZone = false;

function handleTouchStart(e) {
  e.preventDefault();
  const block = e.currentTarget;
  const id = block.dataset.id;
  const category = block.dataset.category;
  if (!id || !category) return;

  touchDragData = { id, category };

  // Create ghost
  touchGhost = block.cloneNode(true);
  touchGhost.className = 'block ' + getBlockType(category) + ' drag-ghost';
  document.body.appendChild(touchGhost);

  const touch = e.touches[0];
  touchGhost.style.left = touch.clientX + 'px';
  touchGhost.style.top = touch.clientY + 'px';

  document.addEventListener('touchmove', handleTouchMove, { passive:false });
  document.addEventListener('touchend', handleTouchEnd);
}

function handleTouchMove(e) {
  e.preventDefault();
  if (!touchGhost) return;
  const touch = e.touches[0];
  touchGhost.style.left = touch.clientX + 'px';
  touchGhost.style.top = touch.clientY + 'px';

  // Check if over construction zone
  const zone = $('#constructionZone');
  const rect = zone.getBoundingClientRect();
  touchDropZone = (touch.clientX >= rect.left && touch.clientX <= rect.right && touch.clientY >= rect.top && touch.clientY <= rect.bottom);

  if (touchDropZone) {
    zone.classList.add('drag-over');
  } else {
    zone.classList.remove('drag-over');
  }
}

function handleTouchEnd(e) {
  document.removeEventListener('touchmove', handleTouchMove);
  document.removeEventListener('touchend', handleTouchEnd);

  if (touchGhost) {
    touchGhost.remove();
    touchGhost = null;
  }

  if (touchDropZone && touchDragData) {
    addBlockToZone(touchDragData.id, touchDragData.category);
  }

  $('#constructionZone').classList.remove('drag-over');
  touchDragData = null;
  touchDropZone = false;
}

// ===================== EVENT SETUP =====================
function setup() {
  // Language selector
  $$('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      state.lang = btn.dataset.lang;
      $$('.lang-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      $('#flagStripe').className = 'flag-stripe ' + state.lang;
      state.zoneBlocks = [];
      renderTrays();
      renderZone();
      renderChallenge();
    });
  });

  // Tense selector
  $$('.tense-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      state.tense = btn.dataset.tense;
      $$('.tense-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderZone();
    });
  });

  // Mode toggle
  $$('.mode-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      state.mode = btn.dataset.mode;
      $$('.mode-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state.challengeIdx = 0;
      state.zoneBlocks = [];
      renderZone();
      renderChallenge();
    });
  });

  // Check and Clear
  $('#checkBtn').addEventListener('click', checkSentence);
  $('#clearBtn').addEventListener('click', () => {
    state.zoneBlocks = [];
    renderZone();
  });

  // Challenge navigation
  $('#prevChallenge').addEventListener('click', () => {
    if (state.challengeIdx > 0) {
      state.challengeIdx--;
      state.zoneBlocks = [];
      renderZone();
      renderChallenge();
    }
  });
  $('#nextChallenge').addEventListener('click', () => {
    const max = langData().challenges.length - 1;
    if (state.challengeIdx < max) {
      state.challengeIdx++;
      state.zoneBlocks = [];
      renderZone();
      renderChallenge();
    }
  });

  setupConstructionZone();
  renderTrays();
  renderZone();
  renderChallenge();
}

document.addEventListener('DOMContentLoaded', setup);
</script>
</body>
</html>
