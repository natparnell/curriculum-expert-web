<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cognitive Load Analyser</title>
<style>
:root {
    --bg-primary: #f8f9fa;
    --bg-white: #ffffff;
    --bg-panel: #f1f3f5;
    --text-primary: #212529;
    --text-secondary: #495057;
    --text-muted: #868e96;
    --border-light: #dee2e6;
    --border-medium: #ced4da;
    --green-low: #2b9348;
    --green-light: #d4edda;
    --green-bg: #edf7ef;
    --amber-mid: #e67e22;
    --amber-light: #ffeaa7;
    --amber-bg: #fef9e7;
    --red-high: #c0392b;
    --red-light: #f8d7da;
    --red-bg: #fdf0f0;
    --blue-accent: #2563eb;
    --blue-light: #dbeafe;
    --blue-bg: #eff6ff;
    --purple-germane: #7c3aed;
    --purple-light: #ede9fe;
    --header-bg: #1e293b;
    --header-text: #f8fafc;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
    --radius: 8px;
    --radius-lg: 12px;
    --max-width: 960px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
}

header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--header-bg);
    color: var(--header-text);
    padding: 16px 24px;
    box-shadow: var(--shadow-md);
}

header h1 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.02em;
}

header p {
    font-size: 0.85rem;
    color: #94a3b8;
    margin-top: 2px;
}

main {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 24px 16px 60px;
}

.card {
    background: var(--bg-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-light);
    padding: 24px;
    margin-bottom: 20px;
}

.card h2 {
    font-size: 1.15rem;
    font-weight: 700;
    margin-bottom: 16px;
    color: var(--text-primary);
}

.card h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--text-secondary);
}

/* Load types overview */
.load-types {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 16px;
}

.load-type-card {
    border-radius: var(--radius);
    padding: 20px;
    border-left: 5px solid;
}

.load-type-card.intrinsic {
    background: var(--amber-bg);
    border-color: var(--amber-mid);
}

.load-type-card.extraneous {
    background: var(--red-bg);
    border-color: var(--red-high);
}

.load-type-card.germane {
    background: linear-gradient(135deg, #f3e8ff, #ede9fe);
    border-color: var(--purple-germane);
}

.load-type-card h3 {
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 4px;
}

.load-type-card .tag {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 2px 8px;
    border-radius: 10px;
    margin-bottom: 8px;
}

.intrinsic .tag { background: var(--amber-mid); color: #fff; }
.extraneous .tag { background: var(--red-high); color: #fff; }
.germane .tag { background: var(--purple-germane); color: #fff; }

.load-type-card p {
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.5;
}

/* Checklist */
.category-group {
    margin-bottom: 24px;
}

.category-group:last-child { margin-bottom: 0; }

.category-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    background: var(--bg-panel);
    border-radius: var(--radius);
    margin-bottom: 12px;
    font-weight: 700;
    font-size: 0.95rem;
}

.category-icon {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    color: #fff;
    flex-shrink: 0;
}

.cat-info .category-icon { background: var(--blue-accent); }
.cat-task .category-icon { background: var(--amber-mid); }
.cat-resource .category-icon { background: var(--green-low); }

.checklist-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px 14px;
    border-bottom: 1px solid var(--border-light);
    transition: background 0.15s;
}

.checklist-item:last-child { border-bottom: none; }
.checklist-item:hover { background: #fafbfc; }

.item-number {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    background: var(--bg-panel);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-muted);
    margin-top: 2px;
}

.item-text {
    flex: 1;
    font-size: 0.9rem;
    line-height: 1.5;
}

.radio-group {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
    margin-top: 1px;
}

.radio-group label {
    display: flex;
    align-items: center;
    gap: 3px;
    font-size: 0.75rem;
    color: var(--text-muted);
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid var(--border-light);
    transition: all 0.15s;
    user-select: none;
}

.radio-group label:hover { background: var(--bg-panel); }

.radio-group input[type="radio"] { display: none; }

.radio-group label.selected-yes {
    background: var(--green-light);
    border-color: var(--green-low);
    color: var(--green-low);
    font-weight: 600;
}

.radio-group label.selected-partial {
    background: var(--amber-light);
    border-color: var(--amber-mid);
    color: #b87900;
    font-weight: 600;
}

.radio-group label.selected-no {
    background: var(--red-light);
    border-color: var(--red-high);
    color: var(--red-high);
    font-weight: 600;
}

/* Gauge and results */
.results-grid {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 24px;
    align-items: start;
}

@media (max-width: 700px) {
    .results-grid { grid-template-columns: 1fr; }
}

.gauge-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.gauge-wrap canvas {
    max-width: 100%;
    height: auto;
}

.gauge-label {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-top: 8px;
    text-align: center;
}

.gauge-score {
    font-size: 2rem;
    font-weight: 800;
    margin-top: 4px;
}

.gauge-score.score-green { color: var(--green-low); }
.gauge-score.score-amber { color: var(--amber-mid); }
.gauge-score.score-red { color: var(--red-high); }

.gauge-verdict {
    font-size: 0.95rem;
    font-weight: 600;
    margin-top: 2px;
}

.bar-charts h3 {
    font-size: 0.95rem;
    margin-bottom: 14px;
}

.bar-row {
    margin-bottom: 14px;
}

.bar-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    margin-bottom: 4px;
}

.bar-label span:first-child { font-weight: 600; color: var(--text-secondary); }
.bar-label span:last-child { color: var(--text-muted); }

.bar-track {
    height: 22px;
    background: var(--bg-panel);
    border-radius: 11px;
    overflow: hidden;
    position: relative;
}

.bar-fill {
    height: 100%;
    border-radius: 11px;
    transition: width 0.4s ease, background 0.4s ease;
    min-width: 0;
}

/* Suggestions */
.suggestions-list {
    list-style: none;
}

.suggestion-item {
    display: flex;
    gap: 10px;
    padding: 12px 14px;
    border-radius: var(--radius);
    margin-bottom: 8px;
    font-size: 0.85rem;
    line-height: 1.5;
    align-items: flex-start;
}

.suggestion-item.partial {
    background: var(--amber-bg);
    border-left: 3px solid var(--amber-mid);
}

.suggestion-item.no {
    background: var(--red-bg);
    border-left: 3px solid var(--red-high);
}

.suggestion-icon {
    flex-shrink: 0;
    font-size: 1rem;
    margin-top: 1px;
}

.suggestion-text strong {
    display: block;
    margin-bottom: 2px;
    font-size: 0.85rem;
}

.suggestion-text span {
    color: var(--text-secondary);
}

.empty-suggestions {
    text-align: center;
    padding: 32px;
    color: var(--text-muted);
    font-size: 0.9rem;
}

/* Report button */
.btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 20px;
    border: none;
    border-radius: var(--radius);
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
}

.btn-primary {
    background: var(--blue-accent);
    color: #fff;
}

.btn-primary:hover { background: #1d4ed8; }

.btn-secondary {
    background: var(--bg-panel);
    color: var(--text-secondary);
    border: 1px solid var(--border-medium);
}

.btn-secondary:hover { background: #e9ecef; }

.report-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 16px;
}

.report-output {
    background: var(--bg-panel);
    border: 1px solid var(--border-light);
    border-radius: var(--radius);
    padding: 16px;
    font-size: 0.85rem;
    line-height: 1.7;
    white-space: pre-wrap;
    font-family: inherit;
    max-height: 400px;
    overflow-y: auto;
    display: none;
}

.report-output.visible { display: block; }

.copied-toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--header-bg);
    color: #fff;
    padding: 10px 20px;
    border-radius: var(--radius);
    font-size: 0.85rem;
    font-weight: 600;
    opacity: 0;
    transition: all 0.3s;
    pointer-events: none;
    z-index: 200;
}

.copied-toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

/* Info panel / theory */
.info-toggle {
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    user-select: none;
}

.info-toggle .arrow {
    transition: transform 0.2s;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.info-toggle.open .arrow { transform: rotate(180deg); }

.info-content {
    display: none;
    margin-top: 16px;
}

.info-content.visible { display: block; }

.theory-section {
    margin-bottom: 18px;
    padding-bottom: 18px;
    border-bottom: 1px solid var(--border-light);
}

.theory-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

.theory-section h3 {
    font-size: 0.95rem;
    font-weight: 700;
    margin-bottom: 6px;
    color: var(--text-primary);
}

.theory-section p {
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.6;
}

.reset-bar {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 4px;
}

@media (max-width: 600px) {
    header { padding: 12px 16px; }
    header h1 { font-size: 1.25rem; }
    .card { padding: 16px; }
    .checklist-item { flex-direction: column; gap: 8px; }
    .radio-group { align-self: flex-start; }
    .load-types { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<header>
    <h1>Cognitive Load Analyser</h1>
    <p>Analyse a lesson design for cognitive load principles</p>
</header>

<main>
    <!-- Load types overview -->
    <div class="card">
        <h2>Three Types of Cognitive Load</h2>
        <div class="load-types">
            <div class="load-type-card intrinsic">
                <span class="tag">Intrinsic Load</span>
                <h3>Content Complexity</h3>
                <p>The inherent difficulty of the material itself. Determined by element interactivity: how many new concepts must be processed simultaneously. Teachers manage this by sequencing content carefully and activating prior knowledge.</p>
            </div>
            <div class="load-type-card extraneous">
                <span class="tag">Extraneous Load</span>
                <h3>Poor Design Overhead</h3>
                <p>Unnecessary cognitive effort caused by poorly designed instruction. This includes cluttered slides, split attention between separate sources, or redundant information. Minimising extraneous load is always desirable.</p>
            </div>
            <div class="load-type-card germane">
                <span class="tag">Germane Load</span>
                <h3>Productive Learning Effort</h3>
                <p>The mental work devoted to constructing and automating schemas. This is the "good" load: the effort of organising, integrating, and making sense of new knowledge. Effective lessons maximise germane processing.</p>
            </div>
        </div>
    </div>

    <!-- Assessment checklist -->
    <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:16px;">
            <h2 style="margin-bottom:0;">Lesson Design Checklist</h2>
            <div class="reset-bar">
                <button class="btn btn-secondary" onclick="resetAll()" style="font-size:0.8rem;padding:6px 14px;">Reset all</button>
            </div>
        </div>

        <div id="checklist-container"></div>
    </div>

    <!-- Results: gauge + bar charts -->
    <div class="card">
        <h2>Cognitive Load Assessment</h2>
        <div class="results-grid">
            <div class="gauge-wrap">
                <canvas id="gauge" width="260" height="180"></canvas>
                <div class="gauge-label">Overall Design Quality</div>
                <div class="gauge-score" id="gauge-score-text">--</div>
                <div class="gauge-verdict" id="gauge-verdict"></div>
            </div>
            <div class="bar-charts">
                <h3>Score Breakdown by Category</h3>
                <div class="bar-row" id="bar-info"></div>
                <div class="bar-row" id="bar-task"></div>
                <div class="bar-row" id="bar-resource"></div>
            </div>
        </div>
    </div>

    <!-- Improvement suggestions -->
    <div class="card">
        <h2>Improvement Suggestions</h2>
        <ul class="suggestions-list" id="suggestions-list">
            <li class="empty-suggestions">Complete the checklist above to receive targeted improvement suggestions.</li>
        </ul>
    </div>

    <!-- Report generation -->
    <div class="card">
        <h2>Generate Report</h2>
        <div class="report-actions">
            <button class="btn btn-primary" onclick="generateReport()">Generate report</button>
            <button class="btn btn-secondary" onclick="copyReport()">Copy to clipboard</button>
        </div>
        <div class="report-output" id="report-output"></div>
    </div>

    <!-- Theory info panel -->
    <div class="card">
        <div class="info-toggle" id="info-toggle" onclick="toggleInfo()">
            <h2 style="margin-bottom:0;">Research Background</h2>
            <span class="arrow">&#9660;</span>
        </div>
        <div class="info-content" id="info-content">
            <div class="theory-section">
                <h3>Sweller's Cognitive Load Theory</h3>
                <p>Developed by John Sweller in the late 1980s, cognitive load theory is grounded in our understanding of human cognitive architecture. It recognises that working memory is severely limited in both capacity and duration when dealing with novel information, whereas long-term memory is effectively unlimited. Instruction should be designed to work within these constraints, minimising unnecessary load (extraneous) while optimising the load devoted to learning (germane). The theory has generated numerous instructional effects, including the worked example effect, the split-attention effect, and the redundancy effect.</p>
            </div>
            <div class="theory-section">
                <h3>Working Memory Limitations</h3>
                <p>George Miller's seminal 1956 paper proposed that working memory can hold approximately seven items (plus or minus two) at any one time. Subsequent research by Cowan and others has revised this estimate downward to about four chunks for novel information. Critically, these items are lost within roughly 20 seconds without rehearsal. This means that any instructional design requiring learners to hold and process more than a handful of new elements simultaneously is likely to overwhelm working memory, leading to cognitive overload and impaired learning.</p>
            </div>
            <div class="theory-section">
                <h3>Dual Coding Theory</h3>
                <p>Allan Paivio's dual coding theory proposes that we process information through two distinct channels: a verbal channel (for spoken or written language) and a visual/pictorial channel. Each channel has its own limited capacity. Effective instruction presents complementary information across both channels. For example, a diagram with narrated explanation uses both channels, whereas a diagram with on-screen text overloads the visual channel alone. This underpins the modality effect in cognitive load theory.</p>
            </div>
            <div class="theory-section">
                <h3>The Expertise Reversal Effect</h3>
                <p>Instructional techniques that are highly effective for novice learners can become ineffective, or even counterproductive, for more experienced learners. For example, worked examples benefit beginners enormously but can impose redundant extraneous load on experts who already possess relevant schemas. This means that effective teachers must adapt their instruction to the expertise level of their students, gradually removing scaffolding as knowledge develops. What constitutes helpful support for one group may be an unnecessary burden for another.</p>
            </div>
            <div class="theory-section">
                <h3>Desirable Difficulties</h3>
                <p>Robert Bjork's concept of desirable difficulties reminds us that some cognitive effort is productive. Strategies such as spaced practice, interleaving, retrieval practice, and varied conditions of learning make initial encoding harder but strengthen long-term retention and transfer. The key distinction is between effort that feels hard because it is building durable learning (germane load / desirable difficulty) and effort that is hard because the instruction is poorly designed (extraneous load). Effective lessons include challenge, but ensure it is the right kind of challenge.</p>
            </div>
        </div>
    </div>
</main>

<div class="copied-toast" id="copied-toast">Copied to clipboard</div>

<script>
const CHECKLIST_DATA = [
    {
        category: "Information Presentation",
        cssClass: "cat-info",
        items: [
            {
                text: "New content is broken into small, manageable chunks",
                suggestion: "Break complex information into smaller segments. Introduce one idea at a time before combining them. Use the 'chunk, check, chew' approach: present a chunk, check understanding, then let students process it."
            },
            {
                text: "Visual and verbal channels are used together (dual coding)",
                suggestion: "Pair spoken explanation with relevant images, diagrams, or demonstrations. Avoid presenting the same information as both on-screen text and narration simultaneously; instead, use images with narration."
            },
            {
                text: "Redundant information has been removed",
                suggestion: "Audit your materials for information that is presented more than once in different forms. If a diagram is self-explanatory, remove the accompanying paragraph restating the same content. Less is often more."
            },
            {
                text: "Key vocabulary is pre-taught before it appears in context",
                suggestion: "Identify the essential tier-2 and tier-3 vocabulary students will encounter. Explicitly teach these words before the lesson content so that reading or listening comprehension is not impeded by unknown terms."
            },
            {
                text: "Worked examples are provided before independent practice",
                suggestion: "Model the process step by step using worked examples before asking students to attempt tasks independently. Consider using faded worked examples that gradually remove steps as students gain confidence."
            }
        ]
    },
    {
        category: "Task Design",
        cssClass: "cat-task",
        items: [
            {
                text: "Tasks build in complexity gradually",
                suggestion: "Sequence tasks from simple to complex. Begin with isolated skills or concepts before combining them. Ensure students can succeed at a foundational level before introducing additional elements of difficulty."
            },
            {
                text: "Students are not required to hold too many new ideas at once",
                suggestion: "Count the number of novel elements in each task. If more than three or four new concepts must be processed simultaneously, consider breaking the task down or providing external support (e.g., reference sheets)."
            },
            {
                text: "Prior knowledge is activated before new learning",
                suggestion: "Begin with a brief retrieval activity or discussion that surfaces what students already know about the topic. This primes relevant schemas in long-term memory, creating 'hooks' for new information to attach to."
            },
            {
                text: "Scaffolding is provided and gradually removed",
                suggestion: "Use scaffolds such as partially completed examples, writing frames, graphic organisers, or sentence starters. Plan a clear trajectory for removing these supports as students develop competence (fading)."
            },
            {
                text: "Practice is spaced rather than massed",
                suggestion: "Distribute practice over time rather than concentrating it in a single session. Revisit key concepts in subsequent lessons through retrieval practice, interleaved homework, or low-stakes quizzes."
            }
        ]
    },
    {
        category: "Resources and Materials",
        cssClass: "cat-resource",
        items: [
            {
                text: "Slides are not text-heavy",
                suggestion: "Reduce on-screen text to essential keywords or phrases. Use the slide as a visual anchor, not a script. If detailed text is needed, provide it on a handout so students are not trying to read and listen at the same time."
            },
            {
                text: "Diagrams are labelled directly (not with a separate legend)",
                suggestion: "Place labels directly onto diagrams rather than using a key or legend at the side. Split attention between a diagram and a separate legend imposes unnecessary extraneous load; integrated labels eliminate this."
            },
            {
                text: "Font sizes and colours support readability",
                suggestion: "Use a minimum 24pt font on slides and ensure high contrast between text and background. Avoid decorative fonts. Use colour purposefully to highlight key information, not for decoration."
            },
            {
                text: "Animations and transitions serve a clear learning purpose",
                suggestion: "Remove animations that exist purely for visual appeal. Use animations only where they genuinely support understanding, such as revealing information step by step to manage the flow of new content."
            },
            {
                text: "Handouts complement rather than duplicate slides",
                suggestion: "Design handouts that add value beyond what is on slides. Consider partially completed notes, graphic organisers, or practice tasks. Avoid printing slides directly as handouts, as this creates redundancy."
            }
        ]
    }
];

const SUGGESTIONS_MAP = {};
let itemCounter = 0;
CHECKLIST_DATA.forEach(cat => {
    cat.items.forEach(item => {
        SUGGESTIONS_MAP[itemCounter] = item.suggestion;
        itemCounter++;
    });
});

function buildChecklist() {
    const container = document.getElementById('checklist-container');
    let globalIndex = 0;

    CHECKLIST_DATA.forEach(cat => {
        const group = document.createElement('div');
        group.className = 'category-group';

        const header = document.createElement('div');
        header.className = 'category-header';
        header.innerHTML = '<div class="category-icon ' + cat.cssClass + '">' + getCatIcon(cat.cssClass) + '</div>' + cat.category;
        group.appendChild(header);

        cat.items.forEach((item, i) => {
            const row = document.createElement('div');
            row.className = 'checklist-item';

            const num = document.createElement('div');
            num.className = 'item-number';
            num.textContent = globalIndex + 1;

            const text = document.createElement('div');
            text.className = 'item-text';
            text.textContent = item.text;

            const radios = document.createElement('div');
            radios.className = 'radio-group';

            ['Yes', 'Partially', 'No'].forEach(val => {
                const label = document.createElement('label');
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'item-' + globalIndex;
                input.value = val;
                input.addEventListener('change', function() {
                    updateLabelStyles(radios, val);
                    recalculate();
                });
                label.appendChild(input);
                label.appendChild(document.createTextNode(val));
                radios.appendChild(label);
            });

            row.appendChild(num);
            row.appendChild(text);
            row.appendChild(radios);
            group.appendChild(row);

            globalIndex++;
        });

        container.appendChild(group);
    });
}

function getCatIcon(cls) {
    if (cls === 'cat-info') return 'i';
    if (cls === 'cat-task') return 'T';
    return 'R';
}

function updateLabelStyles(radioGroup, selectedVal) {
    const labels = radioGroup.querySelectorAll('label');
    labels.forEach(label => {
        label.className = '';
        const input = label.querySelector('input');
        if (input.checked) {
            if (input.value === 'Yes') label.className = 'selected-yes';
            else if (input.value === 'Partially') label.className = 'selected-partial';
            else label.className = 'selected-no';
        }
    });
}

function getScores() {
    const scores = { info: 0, task: 0, resource: 0 };
    const maxPerCat = 10;
    let globalIndex = 0;
    const responses = [];

    CHECKLIST_DATA.forEach((cat, catIdx) => {
        let catScore = 0;
        cat.items.forEach(() => {
            const name = 'item-' + globalIndex;
            const checked = document.querySelector('input[name="' + name + '"]:checked');
            let val = null;
            let score = 0;
            if (checked) {
                val = checked.value;
                if (val === 'Yes') score = 2;
                else if (val === 'Partially') score = 1;
                else score = 0;
            }
            catScore += score;
            responses.push({ index: globalIndex, value: val, score: score, catIdx: catIdx });
            globalIndex++;
        });
        if (catIdx === 0) scores.info = catScore;
        else if (catIdx === 1) scores.task = catScore;
        else scores.resource = catScore;
    });

    const totalMax = 30;
    const totalScore = scores.info + scores.task + scores.resource;
    const percentage = Math.round((totalScore / totalMax) * 100);

    return { scores, totalScore, totalMax, percentage, responses };
}

function recalculate() {
    const data = getScores();
    drawGauge(data.percentage);
    drawBars(data.scores);
    drawSuggestions(data.responses);
}

function drawGauge(pct) {
    const canvas = document.getElementById('gauge');
    const ctx = canvas.getContext('2d');
    const w = canvas.width;
    const h = canvas.height;
    const cx = w / 2;
    const cy = h - 20;
    const radius = 100;

    ctx.clearRect(0, 0, w, h);

    // Background arc
    const startAngle = Math.PI;
    const endAngle = 2 * Math.PI;

    // Draw background track
    ctx.beginPath();
    ctx.arc(cx, cy, radius, startAngle, endAngle);
    ctx.lineWidth = 28;
    ctx.strokeStyle = '#e9ecef';
    ctx.lineCap = 'round';
    ctx.stroke();

    // Gradient segments: red -> amber -> green (left to right = low score to high score)
    const segments = [
        { start: Math.PI, end: Math.PI + Math.PI * 0.33, color: '#e74c3c' },
        { start: Math.PI + Math.PI * 0.33, end: Math.PI + Math.PI * 0.66, color: '#f39c12' },
        { start: Math.PI + Math.PI * 0.66, end: 2 * Math.PI, color: '#27ae60' }
    ];

    segments.forEach(seg => {
        ctx.beginPath();
        ctx.arc(cx, cy, radius, seg.start, seg.end);
        ctx.lineWidth = 28;
        ctx.strokeStyle = seg.color;
        ctx.lineCap = 'butt';
        ctx.stroke();
    });

    // Round caps at ends
    ctx.beginPath();
    ctx.arc(cx, cy, radius, startAngle, startAngle + 0.01);
    ctx.lineWidth = 28;
    ctx.strokeStyle = '#e74c3c';
    ctx.lineCap = 'round';
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(cx, cy, radius, endAngle - 0.01, endAngle);
    ctx.lineWidth = 28;
    ctx.strokeStyle = '#27ae60';
    ctx.lineCap = 'round';
    ctx.stroke();

    // Needle
    const answered = hasAnyAnswer();
    const needleAngle = answered ? (Math.PI + (pct / 100) * Math.PI) : (Math.PI + 0.5 * Math.PI);
    const needleLength = radius - 20;
    const nx = cx + needleLength * Math.cos(needleAngle);
    const ny = cy + needleLength * Math.sin(needleAngle);

    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(nx, ny);
    ctx.lineWidth = 3;
    ctx.strokeStyle = answered ? '#2d3436' : '#ccc';
    ctx.lineCap = 'round';
    ctx.stroke();

    // Center dot
    ctx.beginPath();
    ctx.arc(cx, cy, 6, 0, 2 * Math.PI);
    ctx.fillStyle = answered ? '#2d3436' : '#ccc';
    ctx.fill();

    // Labels
    ctx.font = '11px -apple-system, sans-serif';
    ctx.fillStyle = '#868e96';
    ctx.textAlign = 'center';
    ctx.fillText('High Load', cx - radius + 10, cy + 16);
    ctx.fillText('Low Load', cx + radius - 10, cy + 16);

    // Score text
    const scoreEl = document.getElementById('gauge-score-text');
    const verdictEl = document.getElementById('gauge-verdict');

    if (!answered) {
        scoreEl.textContent = '--';
        scoreEl.className = 'gauge-score';
        verdictEl.textContent = '';
        return;
    }

    scoreEl.textContent = pct + '%';

    if (pct >= 70) {
        scoreEl.className = 'gauge-score score-green';
        verdictEl.textContent = 'Well-designed lesson';
        verdictEl.style.color = 'var(--green-low)';
    } else if (pct >= 40) {
        scoreEl.className = 'gauge-score score-amber';
        verdictEl.textContent = 'Some areas to improve';
        verdictEl.style.color = 'var(--amber-mid)';
    } else {
        scoreEl.className = 'gauge-score score-red';
        verdictEl.textContent = 'High cognitive load risk';
        verdictEl.style.color = 'var(--red-high)';
    }
}

function hasAnyAnswer() {
    const total = CHECKLIST_DATA.reduce((s, c) => s + c.items.length, 0);
    for (let i = 0; i < total; i++) {
        if (document.querySelector('input[name="item-' + i + '"]:checked')) return true;
    }
    return false;
}

function drawBars(scores) {
    const cats = [
        { id: 'bar-info', label: 'Information Presentation', score: scores.info, max: 10 },
        { id: 'bar-task', label: 'Task Design', score: scores.task, max: 10 },
        { id: 'bar-resource', label: 'Resources and Materials', score: scores.resource, max: 10 }
    ];

    cats.forEach(cat => {
        const el = document.getElementById(cat.id);
        const pct = Math.round((cat.score / cat.max) * 100);
        const color = pct >= 70 ? 'var(--green-low)' : pct >= 40 ? 'var(--amber-mid)' : 'var(--red-high)';

        el.innerHTML =
            '<div class="bar-label"><span>' + cat.label + '</span><span>' + cat.score + ' / ' + cat.max + '</span></div>' +
            '<div class="bar-track"><div class="bar-fill" style="width:' + pct + '%;background:' + color + '"></div></div>';
    });
}

function drawSuggestions(responses) {
    const list = document.getElementById('suggestions-list');
    list.innerHTML = '';

    let hasSuggestions = false;
    let globalIdx = 0;

    CHECKLIST_DATA.forEach(cat => {
        cat.items.forEach(item => {
            const resp = responses[globalIdx];
            if (resp.value === 'No' || resp.value === 'Partially') {
                hasSuggestions = true;
                const li = document.createElement('li');
                li.className = 'suggestion-item ' + (resp.value === 'No' ? 'no' : 'partial');

                const icon = document.createElement('span');
                icon.className = 'suggestion-icon';
                icon.textContent = resp.value === 'No' ? '\u26A0' : '\u25CB';

                const textDiv = document.createElement('div');
                textDiv.className = 'suggestion-text';

                const strong = document.createElement('strong');
                strong.textContent = item.text;

                const span = document.createElement('span');
                span.textContent = item.suggestion;

                textDiv.appendChild(strong);
                textDiv.appendChild(span);
                li.appendChild(icon);
                li.appendChild(textDiv);
                list.appendChild(li);
            }
            globalIdx++;
        });
    });

    if (!hasSuggestions) {
        list.innerHTML = '<li class="empty-suggestions">Complete the checklist above to receive targeted improvement suggestions.</li>';
    }
}

function generateReport() {
    const data = getScores();
    const output = document.getElementById('report-output');
    let lines = [];

    lines.push('COGNITIVE LOAD ANALYSIS REPORT');
    lines.push('Generated: ' + new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' }));
    lines.push('');
    lines.push('OVERALL SCORE: ' + data.percentage + '% (' + data.totalScore + ' / ' + data.totalMax + ')');

    if (data.percentage >= 70) lines.push('Verdict: Well-designed lesson');
    else if (data.percentage >= 40) lines.push('Verdict: Some areas to improve');
    else lines.push('Verdict: High cognitive load risk');

    lines.push('');
    lines.push('CATEGORY BREAKDOWN');
    lines.push('  Information Presentation: ' + data.scores.info + ' / 10');
    lines.push('  Task Design:              ' + data.scores.task + ' / 10');
    lines.push('  Resources and Materials:   ' + data.scores.resource + ' / 10');

    // Strengths
    const strengths = [];
    const improvements = [];
    let globalIdx = 0;

    CHECKLIST_DATA.forEach(cat => {
        cat.items.forEach(item => {
            const resp = data.responses[globalIdx];
            if (resp.value === 'Yes') {
                strengths.push(item.text);
            } else if (resp.value === 'No' || resp.value === 'Partially') {
                improvements.push({
                    text: item.text,
                    level: resp.value,
                    suggestion: item.suggestion
                });
            }
            globalIdx++;
        });
    });

    if (strengths.length > 0) {
        lines.push('');
        lines.push('STRENGTHS');
        strengths.forEach(s => lines.push('  + ' + s));
    }

    if (improvements.length > 0) {
        lines.push('');
        lines.push('AREAS FOR IMPROVEMENT');
        improvements.forEach(imp => {
            const tag = imp.level === 'No' ? '[Not yet]' : '[Partial]';
            lines.push('');
            lines.push('  - ' + tag + ' ' + imp.text);
            lines.push('    Suggestion: ' + imp.suggestion);
        });
    }

    lines.push('');
    lines.push('---');
    lines.push('This report was generated by the Cognitive Load Analyser.');

    output.textContent = lines.join('\n');
    output.classList.add('visible');
}

function copyReport() {
    const output = document.getElementById('report-output');
    if (!output.textContent.trim()) {
        generateReport();
    }
    navigator.clipboard.writeText(output.textContent).then(() => {
        const toast = document.getElementById('copied-toast');
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
    });
}

function resetAll() {
    const total = CHECKLIST_DATA.reduce((s, c) => s + c.items.length, 0);
    for (let i = 0; i < total; i++) {
        const radios = document.querySelectorAll('input[name="item-' + i + '"]');
        radios.forEach(r => {
            r.checked = false;
        });
    }
    // Clear label styles
    document.querySelectorAll('.radio-group label').forEach(l => l.className = '');
    document.getElementById('report-output').classList.remove('visible');
    document.getElementById('report-output').textContent = '';
    recalculate();
}

function toggleInfo() {
    const toggle = document.getElementById('info-toggle');
    const content = document.getElementById('info-content');
    toggle.classList.toggle('open');
    content.classList.toggle('visible');
}

// Initialise
buildChecklist();
drawGauge(50);
drawBars({ info: 0, task: 0, resource: 0 });
</script>
</body>
</html>