<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simultaneous Equations Visualiser - GCSE/A-Level Mathematics</title>
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --line1-color: #2563eb;
            --line1-light: #93b4f5;
            --line2-color: #dc2626;
            --line2-light: #f5a3a3;
            --intersection-color: #16a34a;
            --intersection-light: #bbf7d0;
            --axis-color: #374151;
            --grid-color: #e5e7eb;
            --grid-color-major: #cbd5e1;
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: #cbd5e1;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        html { font-size: 16px; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 1.25rem 2rem;
            text-align: center;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 0.15rem;
        }

        header p {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            padding: 1.25rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--bg-tertiary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title .icon {
            font-size: 1.2rem;
        }

        /* Graph area */
        .graph-area {
            grid-column: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .canvas-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
            max-height: 600px;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            background: white;
            display: block;
        }

        .result-banner {
            text-align: center;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 1.05rem;
        }

        .result-one { background: var(--intersection-light); color: #15803d; }
        .result-none { background: #fef2f2; color: #b91c1c; }
        .result-infinite { background: #fefce8; color: #a16207; }

        /* Controls */
        .controls-area {
            grid-column: 2;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .eq-controls {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .eq-label {
            font-weight: 700;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .eq-label .dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: inline-block;
        }

        .dot-line1 { background: var(--line1-color); }
        .dot-line2 { background: var(--line2-color); }

        .eq-display {
            font-family: 'Cambria Math', 'Latin Modern Math', Georgia, serif;
            font-size: 1.25rem;
            text-align: center;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            font-weight: 600;
        }

        .coeff-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.75rem;
        }

        .coeff-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .coeff-group label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .coeff-group input[type="number"] {
            width: 100%;
            padding: 0.5rem 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            text-align: center;
            font-family: 'Cambria Math', Georgia, serif;
            transition: border-color 0.2s;
        }

        .coeff-group input[type="number"]:focus {
            outline: none;
            border-color: var(--line1-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }

        .coeff-group.eq2 input[type="number"]:focus {
            border-color: var(--line2-color);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.15);
        }

        input[type="range"] {
            width: 100%;
            margin-top: 0.15rem;
            accent-color: var(--line1-color);
        }

        .eq2 input[type="range"] {
            accent-color: var(--line2-color);
        }

        .presets-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .preset-btn {
            padding: 0.6rem 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--bg-secondary);
            cursor: pointer;
            font-size: 0.85rem;
            text-align: left;
            transition: all 0.15s;
            line-height: 1.4;
        }

        .preset-btn:hover {
            border-color: var(--line1-color);
            background: #eff6ff;
            box-shadow: var(--shadow-sm);
        }

        .preset-btn strong {
            display: block;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.15rem;
        }

        /* Solution panel */
        .solution-panel {
            grid-column: 1 / -1;
        }

        .methods-tabs {
            display: flex;
            gap: 0.25rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--bg-tertiary);
            padding-bottom: 0;
        }

        .method-tab {
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.15s;
        }

        .method-tab:hover { color: var(--text-secondary); }

        .method-tab.active {
            color: var(--line1-color);
            border-bottom-color: var(--line1-color);
        }

        .method-content {
            display: none;
        }

        .method-content.active {
            display: block;
        }

        .step {
            display: flex;
            gap: 0.75rem;
            padding: 0.65rem 0;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .step:last-child { border-bottom: none; }

        .step-num {
            width: 28px;
            height: 28px;
            min-width: 28px;
            border-radius: 50%;
            background: var(--line1-color);
            color: white;
            font-size: 0.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .step-body {
            flex: 1;
        }

        .step-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .step-math {
            font-family: 'Cambria Math', Georgia, serif;
            font-size: 1.05rem;
            color: var(--text-primary);
            font-weight: 600;
            background: var(--bg-tertiary);
            padding: 0.35rem 0.65rem;
            border-radius: var(--radius-sm);
            display: inline-block;
        }

        .step-result .step-num {
            background: var(--intersection-color);
        }

        .step-result .step-math {
            background: var(--intersection-light);
            color: #15803d;
        }

        /* Info panel */
        .info-panel {
            grid-column: 1 / -1;
        }

        .info-panel details {
            margin-bottom: 0.5rem;
        }

        .info-panel summary {
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            padding: 0.6rem 0;
            color: var(--text-primary);
            border-bottom: 1px solid var(--bg-tertiary);
            list-style: none;
        }

        .info-panel summary::before {
            content: '+ ';
            font-weight: 700;
            color: var(--line1-color);
        }

        .info-panel details[open] summary::before {
            content: '- ';
        }

        .info-panel .info-body {
            padding: 0.75rem 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .info-body p { margin-bottom: 0.5rem; }
        .info-body ul { margin: 0.5rem 0 0.5rem 1.5rem; }
        .info-body li { margin-bottom: 0.25rem; }

        /* Responsive */
        @media (max-width: 900px) {
            main {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            .graph-area { grid-column: 1; }
            .controls-area { grid-column: 1; }
            .solution-panel { grid-column: 1; }
            .info-panel { grid-column: 1; }
            .canvas-wrapper { max-height: 450px; }
        }

        @media (max-width: 500px) {
            header h1 { font-size: 1.25rem; }
            header { padding: 1rem; }
            .coeff-row { grid-template-columns: 1fr; }
            .presets-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<header>
    <h1>Simultaneous Equations Visualiser</h1>
    <p>Adjust coefficients and see how two linear equations intersect on the coordinate plane</p>
</header>

<main>
    <!-- Graph -->
    <div class="graph-area">
        <div class="card">
            <div class="canvas-wrapper">
                <canvas id="graph"></canvas>
            </div>
        </div>
        <div id="resultBanner" class="result-banner result-one">
            Solution: (x, y) = (2, 1)
        </div>
    </div>

    <!-- Controls -->
    <div class="controls-area">
        <!-- Equation 1 -->
        <div class="card">
            <div class="card-title">
                <span class="dot dot-line1"></span> Equation 1
            </div>
            <div class="eq-controls">
                <div id="eq1Display" class="eq-display">2x + 3y = 7</div>
                <div class="coeff-row">
                    <div class="coeff-group">
                        <label>a (x coeff)</label>
                        <input type="number" id="a1" value="2" step="1" min="-10" max="10">
                        <input type="range" id="a1r" value="2" min="-10" max="10" step="1">
                    </div>
                    <div class="coeff-group">
                        <label>b (y coeff)</label>
                        <input type="number" id="b1" value="3" step="1" min="-10" max="10">
                        <input type="range" id="b1r" value="3" min="-10" max="10" step="1">
                    </div>
                    <div class="coeff-group">
                        <label>c (constant)</label>
                        <input type="number" id="c1" value="7" step="1" min="-20" max="20">
                        <input type="range" id="c1r" value="7" min="-20" max="20" step="1">
                    </div>
                </div>
            </div>
        </div>

        <!-- Equation 2 -->
        <div class="card">
            <div class="card-title">
                <span class="dot dot-line2"></span> Equation 2
            </div>
            <div class="eq-controls">
                <div id="eq2Display" class="eq-display">x - y = 1</div>
                <div class="coeff-row">
                    <div class="coeff-group eq2">
                        <label>a (x coeff)</label>
                        <input type="number" id="a2" value="1" step="1" min="-10" max="10">
                        <input type="range" id="a2r" value="1" min="-10" max="10" step="1">
                    </div>
                    <div class="coeff-group eq2">
                        <label>b (y coeff)</label>
                        <input type="number" id="b2" value="-1" step="1" min="-10" max="10">
                        <input type="range" id="b2r" value="-1" min="-10" max="10" step="1">
                    </div>
                    <div class="coeff-group eq2">
                        <label>c (constant)</label>
                        <input type="number" id="c2" value="1" step="1" min="-20" max="20">
                        <input type="range" id="c2r" value="1" min="-20" max="20" step="1">
                    </div>
                </div>
            </div>
        </div>

        <!-- Presets -->
        <div class="card">
            <div class="card-title"><span class="icon">&#9733;</span> Preset Examples</div>
            <div class="presets-grid">
                <button class="preset-btn" data-preset="basic">
                    <strong>Basic (One solution)</strong>
                    2x + 3y = 7, x - y = 1
                </button>
                <button class="preset-btn" data-preset="gcse1">
                    <strong>GCSE Style</strong>
                    3x + 2y = 12, 5x - 2y = 4
                </button>
                <button class="preset-btn" data-preset="parallel">
                    <strong>Parallel (No solution)</strong>
                    2x + 4y = 8, x + 2y = 6
                </button>
                <button class="preset-btn" data-preset="identical">
                    <strong>Identical (Infinite)</strong>
                    2x + 4y = 8, x + 2y = 4
                </button>
                <button class="preset-btn" data-preset="gcse2">
                    <strong>GCSE Higher</strong>
                    4x - 3y = 1, 2x + y = 5
                </button>
                <button class="preset-btn" data-preset="negative">
                    <strong>Negative Solution</strong>
                    x + y = -2, 2x - y = -7
                </button>
            </div>
        </div>
    </div>

    <!-- Solution Steps -->
    <div class="solution-panel card">
        <div class="card-title"><span class="icon">&#128221;</span> Step-by-Step Solution</div>
        <div class="methods-tabs">
            <button class="method-tab active" data-method="elimination">Elimination Method</button>
            <button class="method-tab" data-method="substitution">Substitution Method</button>
        </div>
        <div id="eliminationSteps" class="method-content active"></div>
        <div id="substitutionSteps" class="method-content"></div>
    </div>

    <!-- Info Panel -->
    <div class="info-panel card">
        <div class="card-title"><span class="icon">&#128218;</span> Learn About Simultaneous Equations</div>

        <details open>
            <summary>What are simultaneous equations?</summary>
            <div class="info-body">
                <p>Simultaneous equations are a set of two or more equations that share the same variables. The goal is to find values of those variables that satisfy all equations at the same time ("simultaneously").</p>
                <p>In GCSE and A-Level mathematics, you most commonly encounter two linear equations in two unknowns (x and y). Each equation in the form <em>ax + by = c</em> represents a straight line on the coordinate plane.</p>
            </div>
        </details>

        <details>
            <summary>Why is the intersection the solution?</summary>
            <div class="info-body">
                <p>Each point on a line satisfies that line's equation. The intersection point lies on both lines at once, which means it satisfies both equations simultaneously. That is why the coordinates of the intersection give us the solution.</p>
                <p>If the lines are parallel they never meet, so no point satisfies both equations: there is no solution. If the lines are identical, every point on the line satisfies both equations: there are infinitely many solutions.</p>
            </div>
        </details>

        <details>
            <summary>Elimination method</summary>
            <div class="info-body">
                <p>The elimination method works by adding or subtracting the equations (after multiplying if needed) so that one variable cancels out. You then solve for the remaining variable and substitute back.</p>
                <ul>
                    <li>Multiply one or both equations so the coefficients of one variable match.</li>
                    <li>Add or subtract the equations to eliminate that variable.</li>
                    <li>Solve for the remaining variable.</li>
                    <li>Substitute back into either original equation to find the other variable.</li>
                </ul>
            </div>
        </details>

        <details>
            <summary>Substitution method</summary>
            <div class="info-body">
                <p>The substitution method works by rearranging one equation to express one variable in terms of the other, then substituting that expression into the second equation.</p>
                <ul>
                    <li>Rearrange one equation to make x (or y) the subject.</li>
                    <li>Substitute that expression into the other equation.</li>
                    <li>Solve the resulting equation in one variable.</li>
                    <li>Substitute back to find the other variable.</li>
                </ul>
            </div>
        </details>

        <details>
            <summary>Three possible outcomes</summary>
            <div class="info-body">
                <ul>
                    <li><strong>One unique solution</strong>: the lines intersect at exactly one point. The determinant (a1*b2 - a2*b1) is non-zero.</li>
                    <li><strong>No solution</strong>: the lines are parallel (same gradient, different intercept). The determinant is zero but the equations are inconsistent.</li>
                    <li><strong>Infinitely many solutions</strong>: the lines are identical (one equation is a scalar multiple of the other). Every point on the line is a solution.</li>
                </ul>
            </div>
        </details>
    </div>
</main>

<script>
(function() {
    'use strict';

    // --- DOM references ---
    const canvas = document.getElementById('graph');
    const ctx = canvas.getContext('2d');
    const banner = document.getElementById('resultBanner');
    const eq1Display = document.getElementById('eq1Display');
    const eq2Display = document.getElementById('eq2Display');
    const elimDiv = document.getElementById('eliminationSteps');
    const substDiv = document.getElementById('substitutionSteps');

    const inputs = {
        a1: document.getElementById('a1'), b1: document.getElementById('b1'), c1: document.getElementById('c1'),
        a2: document.getElementById('a2'), b2: document.getElementById('b2'), c2: document.getElementById('c2'),
        a1r: document.getElementById('a1r'), b1r: document.getElementById('b1r'), c1r: document.getElementById('c1r'),
        a2r: document.getElementById('a2r'), b2r: document.getElementById('b2r'), c2r: document.getElementById('c2r')
    };

    // --- State ---
    const GRID_RANGE = 10;
    const PADDING = 40;

    function getCoeffs() {
        return {
            a1: parseFloat(inputs.a1.value) || 0,
            b1: parseFloat(inputs.b1.value) || 0,
            c1: parseFloat(inputs.c1.value) || 0,
            a2: parseFloat(inputs.a2.value) || 0,
            b2: parseFloat(inputs.b2.value) || 0,
            c2: parseFloat(inputs.c2.value) || 0
        };
    }

    // --- Solve ---
    function solve(a1, b1, c1, a2, b2, c2) {
        var det = a1 * b2 - a2 * b1;
        if (Math.abs(det) < 1e-12) {
            // Check if same line: a1*c2 == a2*c1 and b1*c2 == b2*c1
            var crossAC = a1 * c2 - a2 * c1;
            var crossBC = b1 * c2 - b2 * c1;
            if (Math.abs(crossAC) < 1e-12 && Math.abs(crossBC) < 1e-12) {
                return { type: 'infinite' };
            }
            return { type: 'none' };
        }
        var x = (c1 * b2 - c2 * b1) / det;
        var y = (a1 * c2 - a2 * c1) / det;
        return { type: 'one', x: x, y: y };
    }

    // --- Format helpers ---
    function frac(num, den) {
        if (den < 0) { num = -num; den = -den; }
        var g = gcd(Math.abs(num), Math.abs(den));
        num /= g; den /= g;
        if (den === 1) return '' + num;
        return num + '/' + den;
    }

    function gcd(a, b) {
        a = Math.abs(a); b = Math.abs(b);
        while (b) { var t = b; b = a % b; a = t; }
        return a || 1;
    }

    function roundNice(v) {
        if (Math.abs(v - Math.round(v)) < 1e-9) return Math.round(v);
        return Math.round(v * 1000) / 1000;
    }

    function signedCoeff(val, varName, isFirst) {
        val = roundNice(val);
        if (val === 0) return '';
        var abs = Math.abs(val);
        var prefix = '';
        if (isFirst) {
            prefix = val < 0 ? '-' : '';
        } else {
            prefix = val < 0 ? ' - ' : ' + ';
        }
        if (abs === 1) return prefix + varName;
        return prefix + abs + varName;
    }

    function formatEq(a, b, c) {
        a = roundNice(a); b = roundNice(b); c = roundNice(c);
        var parts = '';
        var first = true;
        if (a !== 0) {
            parts += signedCoeff(a, 'x', first);
            first = false;
        }
        if (b !== 0) {
            parts += signedCoeff(b, 'y', first);
            first = false;
        }
        if (first) parts = '0';
        return parts + ' = ' + c;
    }

    // --- Canvas drawing ---
    function resizeCanvas() {
        var wrapper = canvas.parentElement;
        var size = Math.min(wrapper.clientWidth, wrapper.clientHeight);
        var dpr = window.devicePixelRatio || 1;
        canvas.width = size * dpr;
        canvas.height = size * dpr;
        canvas.style.width = size + 'px';
        canvas.style.height = size + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        return size;
    }

    function drawGraph() {
        var size = resizeCanvas();
        var w = size, h = size;
        var pad = PADDING;
        var plotW = w - 2 * pad;
        var plotH = h - 2 * pad;

        function toCanvasX(x) { return pad + (x + GRID_RANGE) / (2 * GRID_RANGE) * plotW; }
        function toCanvasY(y) { return pad + (GRID_RANGE - y) / (2 * GRID_RANGE) * plotH; }

        ctx.clearRect(0, 0, w, h);

        // Grid
        ctx.lineWidth = 0.5;
        for (var i = -GRID_RANGE; i <= GRID_RANGE; i++) {
            ctx.strokeStyle = (i === 0) ? var_axis : ((i % 5 === 0) ? var_gridMajor : var_grid);
            if (i === 0) ctx.lineWidth = 1.5; else ctx.lineWidth = 0.5;
            ctx.beginPath();
            ctx.moveTo(toCanvasX(i), pad);
            ctx.lineTo(toCanvasX(i), h - pad);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(pad, toCanvasY(i));
            ctx.lineTo(w - pad, toCanvasY(i));
            ctx.stroke();
        }

        // Axis labels
        ctx.fillStyle = '#64748b';
        ctx.font = '11px -apple-system, BlinkMacSystemFont, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        for (var i = -GRID_RANGE; i <= GRID_RANGE; i += 2) {
            if (i === 0) continue;
            ctx.fillText(i, toCanvasX(i), toCanvasY(0) + 4);
        }
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        for (var i = -GRID_RANGE; i <= GRID_RANGE; i += 2) {
            if (i === 0) continue;
            ctx.fillText(i, toCanvasX(0) - 5, toCanvasY(i));
        }
        // Origin
        ctx.textAlign = 'right';
        ctx.textBaseline = 'top';
        ctx.fillText('0', toCanvasX(0) - 4, toCanvasY(0) + 4);

        // Axis arrows + labels
        ctx.fillStyle = var_axis;
        ctx.font = 'bold 13px -apple-system, BlinkMacSystemFont, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'bottom';
        ctx.fillText('x', w - pad + 18, toCanvasY(0) + 5);
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        ctx.fillText('y', toCanvasX(0) - 4, pad - 14);

        // Draw lines
        var co = getCoeffs();
        drawLine(co.a1, co.b1, co.c1, var_line1, 2.5, toCanvasX, toCanvasY, w, h, pad);
        drawLine(co.a2, co.b2, co.c2, var_line2, 2.5, toCanvasX, toCanvasY, w, h, pad);

        // Intersection
        var sol = solve(co.a1, co.b1, co.c1, co.a2, co.b2, co.c2);
        if (sol.type === 'one') {
            var cx = toCanvasX(sol.x);
            var cy = toCanvasY(sol.y);
            // Glow
            ctx.beginPath();
            ctx.arc(cx, cy, 10, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(22, 163, 74, 0.2)';
            ctx.fill();
            // Dot
            ctx.beginPath();
            ctx.arc(cx, cy, 6, 0, Math.PI * 2);
            ctx.fillStyle = var_inter;
            ctx.fill();
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.stroke();
            // Coordinate label
            var label = '(' + roundNice(sol.x) + ', ' + roundNice(sol.y) + ')';
            ctx.font = 'bold 13px -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.fillStyle = var_inter;
            ctx.textAlign = 'left';
            ctx.textBaseline = 'bottom';
            ctx.fillText(label, cx + 10, cy - 8);
        }
    }

    // CSS variable caching
    var var_axis = '#374151';
    var var_grid = '#e5e7eb';
    var var_gridMajor = '#cbd5e1';
    var var_line1 = '#2563eb';
    var var_line2 = '#dc2626';
    var var_inter = '#16a34a';

    function drawLine(a, b, c, color, width, toCanvasX, toCanvasY, w, h, pad) {
        // Compute two points at edges of visible range
        var pts = [];
        var R = GRID_RANGE + 1;
        if (Math.abs(b) > 1e-12) {
            // y = (c - ax)/b
            for (var xv = -R; xv <= R; xv += 0.1) {
                pts.push({ x: xv, y: (c - a * xv) / b });
            }
        } else if (Math.abs(a) > 1e-12) {
            // vertical: x = c/a
            var xv = c / a;
            pts.push({ x: xv, y: -R });
            pts.push({ x: xv, y: R });
        } else {
            return; // degenerate: 0x + 0y = c
        }

        ctx.save();
        ctx.beginPath();
        ctx.rect(pad, pad, w - 2 * pad, h - 2 * pad);
        ctx.clip();

        ctx.strokeStyle = color;
        ctx.lineWidth = width;
        ctx.beginPath();
        var started = false;
        for (var i = 0; i < pts.length; i++) {
            var cx = toCanvasX(pts[i].x);
            var cy = toCanvasY(pts[i].y);
            if (!started) { ctx.moveTo(cx, cy); started = true; }
            else ctx.lineTo(cx, cy);
        }
        ctx.stroke();
        ctx.restore();
    }

    // --- Solution steps ---
    function buildSteps() {
        var co = getCoeffs();
        var sol = solve(co.a1, co.b1, co.c1, co.a2, co.b2, co.c2);
        buildElimination(co, sol);
        buildSubstitution(co, sol);
        updateBanner(co, sol);
        eq1Display.textContent = formatEq(co.a1, co.b1, co.c1);
        eq2Display.textContent = formatEq(co.a2, co.b2, co.c2);
    }

    function updateBanner(co, sol) {
        if (sol.type === 'one') {
            banner.className = 'result-banner result-one';
            banner.textContent = 'One unique solution: (x, y) = (' + roundNice(sol.x) + ', ' + roundNice(sol.y) + ')';
        } else if (sol.type === 'none') {
            banner.className = 'result-banner result-none';
            banner.textContent = 'No solution: the lines are parallel and never intersect.';
        } else {
            banner.className = 'result-banner result-infinite';
            banner.textContent = 'Infinitely many solutions: the equations describe the same line.';
        }
    }

    function stepHTML(num, desc, math, isResult) {
        return '<div class="step' + (isResult ? ' step-result' : '') + '">' +
            '<div class="step-num">' + num + '</div>' +
            '<div class="step-body">' +
            '<div class="step-desc">' + desc + '</div>' +
            '<div class="step-math">' + math + '</div>' +
            '</div></div>';
    }

    function buildElimination(co, sol) {
        var a1 = co.a1, b1 = co.b1, c1 = co.c1;
        var a2 = co.a2, b2 = co.b2, c2 = co.c2;
        var html = '';
        var n = 1;

        html += stepHTML(n++, 'Write both equations in the form ax + by = c.',
            '(1) ' + formatEq(a1, b1, c1) + '&nbsp;&nbsp;&nbsp;(2) ' + formatEq(a2, b2, c2));

        if (sol.type === 'none') {
            html += stepHTML(n++, 'The determinant a1*b2 - a2*b1 = 0, meaning the lines are parallel.',
                roundNice(a1) + ' &times; ' + roundNice(b2) + ' - ' + roundNice(a2) + ' &times; ' + roundNice(b1) + ' = ' + roundNice(a1*b2 - a2*b1));
            html += stepHTML(n, 'No solution exists: the lines never meet.', 'No solution', true);
            elimDiv.innerHTML = html;
            return;
        }

        if (sol.type === 'infinite') {
            html += stepHTML(n++, 'The equations are multiples of each other (same line).',
                'Both represent the same line.');
            html += stepHTML(n, 'Infinitely many solutions: every point on the line is a solution.', 'Infinite solutions', true);
            elimDiv.innerHTML = html;
            return;
        }

        // Decide which variable to eliminate: pick the one needing smaller multipliers
        var elimY = true; // try eliminating y
        var m1, m2;

        if (b1 === 0 && b2 === 0) {
            // both have no y: solve for x directly
            elimY = false;
        }

        if (elimY && b1 !== 0 && b2 !== 0) {
            // Eliminate y: multiply eq1 by |b2|, eq2 by |b1|
            var lb = lcmAbs(b1, b2);
            m1 = lb / Math.abs(b1);
            m2 = lb / Math.abs(b2);
            var sign = (b1 * m1) * (b2 * m2) > 0 ? 'subtract' : 'add';

            var na1 = a1 * m1, nb1 = b1 * m1, nc1 = c1 * m1;
            var na2 = a2 * m2, nb2 = b2 * m2, nc2 = c2 * m2;

            if (m1 !== 1 || m2 !== 1) {
                html += stepHTML(n++, 'Multiply to make the y-coefficients match.',
                    '(1) &times; ' + roundNice(m1) + ': ' + formatEq(na1, nb1, nc1) +
                    '&nbsp;&nbsp;&nbsp;(2) &times; ' + roundNice(m2) + ': ' + formatEq(na2, nb2, nc2));
            }

            var ra, rc;
            if (sign === 'subtract') {
                html += stepHTML(n++, 'Subtract the equations to eliminate y.', '(1) - (2):');
                ra = na1 - na2;
                rc = nc1 - nc2;
            } else {
                html += stepHTML(n++, 'Add the equations to eliminate y.', '(1) + (2):');
                ra = na1 + na2;
                rc = nc1 + nc2;
            }

            html += stepHTML(n++, 'Simplify to find x.',
                roundNice(ra) + 'x = ' + roundNice(rc) + ', so x = ' + roundNice(sol.x));

            html += stepHTML(n++, 'Substitute x = ' + roundNice(sol.x) + ' into equation (1) to find y.',
                roundNice(a1) + '(' + roundNice(sol.x) + ') + ' + roundNice(b1) + 'y = ' + roundNice(c1));

            html += stepHTML(n++, 'Solve for y.',
                'y = ' + roundNice(sol.y));
        } else {
            // Eliminate x
            var la = lcmAbs(a1 || 1, a2 || 1);
            m1 = a1 === 0 ? 1 : la / Math.abs(a1);
            m2 = a2 === 0 ? 1 : la / Math.abs(a2);

            var na1 = a1 * m1, nb1 = b1 * m1, nc1 = c1 * m1;
            var na2 = a2 * m2, nb2 = b2 * m2, nc2 = c2 * m2;
            var sign = (na1 * na2) > 0 ? 'subtract' : 'add';

            if (m1 !== 1 || m2 !== 1) {
                html += stepHTML(n++, 'Multiply to make the x-coefficients match.',
                    '(1) &times; ' + roundNice(m1) + ': ' + formatEq(na1, nb1, nc1) +
                    '&nbsp;&nbsp;&nbsp;(2) &times; ' + roundNice(m2) + ': ' + formatEq(na2, nb2, nc2));
            }

            var rb, rc;
            if (sign === 'subtract') {
                html += stepHTML(n++, 'Subtract the equations to eliminate x.', '(1) - (2):');
                rb = nb1 - nb2;
                rc = nc1 - nc2;
            } else {
                html += stepHTML(n++, 'Add the equations to eliminate x.', '(1) + (2):');
                rb = nb1 + nb2;
                rc = nc1 + nc2;
            }

            html += stepHTML(n++, 'Simplify to find y.',
                roundNice(rb) + 'y = ' + roundNice(rc) + ', so y = ' + roundNice(sol.y));

            html += stepHTML(n++, 'Substitute y = ' + roundNice(sol.y) + ' into equation (1) to find x.',
                roundNice(a1) + 'x + ' + roundNice(b1) + '(' + roundNice(sol.y) + ') = ' + roundNice(c1));

            html += stepHTML(n++, 'Solve for x.', 'x = ' + roundNice(sol.x));
        }

        html += stepHTML(n, 'Solution found.',
            'x = ' + roundNice(sol.x) + ', y = ' + roundNice(sol.y), true);

        elimDiv.innerHTML = html;
    }

    function buildSubstitution(co, sol) {
        var a1 = co.a1, b1 = co.b1, c1 = co.c1;
        var a2 = co.a2, b2 = co.b2, c2 = co.c2;
        var html = '';
        var n = 1;

        html += stepHTML(n++, 'Write both equations.',
            '(1) ' + formatEq(a1, b1, c1) + '&nbsp;&nbsp;&nbsp;(2) ' + formatEq(a2, b2, c2));

        if (sol.type === 'none') {
            html += stepHTML(n, 'The lines are parallel: no solution exists.', 'No solution', true);
            substDiv.innerHTML = html;
            return;
        }
        if (sol.type === 'infinite') {
            html += stepHTML(n, 'The equations are identical: infinitely many solutions.', 'Infinite solutions', true);
            substDiv.innerHTML = html;
            return;
        }

        // Choose which equation/variable to rearrange (prefer simpler coefficients)
        var useEq1, solveForX;
        if (Math.abs(a1) === 1) { useEq1 = true; solveForX = true; }
        else if (Math.abs(b1) === 1) { useEq1 = true; solveForX = false; }
        else if (Math.abs(a2) === 1) { useEq1 = false; solveForX = true; }
        else if (Math.abs(b2) === 1) { useEq1 = false; solveForX = false; }
        else if (a1 !== 0) { useEq1 = true; solveForX = true; }
        else { useEq1 = true; solveForX = false; }

        var ea = useEq1 ? a1 : a2;
        var eb = useEq1 ? b1 : b2;
        var ec = useEq1 ? c1 : c2;
        var oa = useEq1 ? a2 : a1;
        var ob = useEq1 ? b2 : b1;
        var oc = useEq1 ? c2 : c1;
        var eqNum = useEq1 ? '(1)' : '(2)';
        var otherNum = useEq1 ? '(2)' : '(1)';

        if (solveForX) {
            // x = (c - by) / a
            html += stepHTML(n++, 'Rearrange equation ' + eqNum + ' to make x the subject.',
                'x = (' + roundNice(ec) + ' - ' + roundNice(eb) + 'y) / ' + roundNice(ea));

            html += stepHTML(n++, 'Substitute this expression for x into equation ' + otherNum + '.',
                roundNice(oa) + ' &times; (' + roundNice(ec) + ' - ' + roundNice(eb) + 'y) / ' + roundNice(ea) + ' + ' + roundNice(ob) + 'y = ' + roundNice(oc));

            html += stepHTML(n++, 'Simplify and solve for y.',
                'y = ' + roundNice(sol.y));

            html += stepHTML(n++, 'Substitute y = ' + roundNice(sol.y) + ' back into the rearranged equation.',
                'x = (' + roundNice(ec) + ' - ' + roundNice(eb) + ' &times; ' + roundNice(sol.y) + ') / ' + roundNice(ea) + ' = ' + roundNice(sol.x));
        } else {
            // y = (c - ax) / b
            html += stepHTML(n++, 'Rearrange equation ' + eqNum + ' to make y the subject.',
                'y = (' + roundNice(ec) + ' - ' + roundNice(ea) + 'x) / ' + roundNice(eb));

            html += stepHTML(n++, 'Substitute this expression for y into equation ' + otherNum + '.',
                roundNice(oa) + 'x + ' + roundNice(ob) + ' &times; (' + roundNice(ec) + ' - ' + roundNice(ea) + 'x) / ' + roundNice(eb) + ' = ' + roundNice(oc));

            html += stepHTML(n++, 'Simplify and solve for x.',
                'x = ' + roundNice(sol.x));

            html += stepHTML(n++, 'Substitute x = ' + roundNice(sol.x) + ' back into the rearranged equation.',
                'y = (' + roundNice(ec) + ' - ' + roundNice(ea) + ' &times; ' + roundNice(sol.x) + ') / ' + roundNice(eb) + ' = ' + roundNice(sol.y));
        }

        html += stepHTML(n, 'Solution found.',
            'x = ' + roundNice(sol.x) + ', y = ' + roundNice(sol.y), true);

        substDiv.innerHTML = html;
    }

    function lcmAbs(a, b) {
        a = Math.abs(a); b = Math.abs(b);
        if (a === 0 || b === 0) return a || b || 1;
        return (a * b) / gcd(a, b);
    }

    // --- Sync sliders and number inputs ---
    function syncPair(numId, rangeId) {
        var numEl = inputs[numId];
        var rangeEl = inputs[rangeId];
        numEl.addEventListener('input', function() {
            rangeEl.value = numEl.value;
            update();
        });
        rangeEl.addEventListener('input', function() {
            numEl.value = rangeEl.value;
            update();
        });
    }

    syncPair('a1', 'a1r');
    syncPair('b1', 'b1r');
    syncPair('c1', 'c1r');
    syncPair('a2', 'a2r');
    syncPair('b2', 'b2r');
    syncPair('c2', 'c2r');

    // --- Presets ---
    var presets = {
        basic:    { a1:2, b1:3, c1:7,  a2:1, b2:-1, c2:1 },
        gcse1:    { a1:3, b1:2, c1:12, a2:5, b2:-2, c2:4 },
        parallel: { a1:2, b1:4, c1:8,  a2:1, b2:2,  c2:6 },
        identical:{ a1:2, b1:4, c1:8,  a2:1, b2:2,  c2:4 },
        gcse2:    { a1:4, b1:-3,c1:1,  a2:2, b2:1,  c2:5 },
        negative: { a1:1, b1:1, c1:-2, a2:2, b2:-1, c2:-7 }
    };

    document.querySelectorAll('.preset-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var p = presets[btn.getAttribute('data-preset')];
            if (!p) return;
            inputs.a1.value = p.a1; inputs.a1r.value = p.a1;
            inputs.b1.value = p.b1; inputs.b1r.value = p.b1;
            inputs.c1.value = p.c1; inputs.c1r.value = p.c1;
            inputs.a2.value = p.a2; inputs.a2r.value = p.a2;
            inputs.b2.value = p.b2; inputs.b2r.value = p.b2;
            inputs.c2.value = p.c2; inputs.c2r.value = p.c2;
            update();
        });
    });

    // --- Tabs ---
    document.querySelectorAll('.method-tab').forEach(function(tab) {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.method-tab').forEach(function(t) { t.classList.remove('active'); });
            document.querySelectorAll('.method-content').forEach(function(c) { c.classList.remove('active'); });
            tab.classList.add('active');
            document.getElementById(tab.getAttribute('data-method') + 'Steps').classList.add('active');
        });
    });

    // --- Update ---
    function update() {
        drawGraph();
        buildSteps();
    }

    // --- Init ---
    window.addEventListener('resize', update);
    update();
})();
</script>
</body>
</html>