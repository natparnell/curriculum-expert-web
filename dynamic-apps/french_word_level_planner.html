<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Word-Level Lesson Planner</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 0;
            min-height: 600px;
        }

        .left-panel {
            background: #f7fafc;
            border-right: 1px solid #e2e8f0;
            padding: 25px;
            overflow-y: auto;
            max-height: 85vh;
        }

        .right-panel {
            padding: 25px;
            overflow-y: auto;
            max-height: 85vh;
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 5px;
        }

        input[type="text"],
        textarea,
        select,
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .word-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            min-height: 60px;
        }

        .word-tag {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .word-tag .remove {
            cursor: pointer;
            font-weight: bold;
            opacity: 0.8;
        }

        .word-tag .remove:hover {
            opacity: 1;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #5568d3;
        }

        button:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-secondary:hover {
            background: #5a6c7d;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .output-section {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .output-section h3 {
            font-size: 18px;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .material-output {
            background: white;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .material-output h4 {
            color: #2d3748;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .material-output p {
            margin-bottom: 10px;
        }

        .exercise-item {
            padding: 12px;
            background: #f7fafc;
            border-left: 3px solid #667eea;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .exercise-item strong {
            color: #2d3748;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #718096;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab:hover {
            background: #f7fafc;
            color: #2d3748;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: none;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grammar-tag {
            display: inline-block;
            background: #e6fffa;
            color: #234e52;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 8px;
            margin-bottom: 5px;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .difficulty-foundation {
            background: #c6f6d5;
            color: #22543d;
        }

        .difficulty-higher {
            background: #fed7d7;
            color: #742a2a;
        }

        .quick-add {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .quick-add input {
            flex: 1;
        }

        .saved-sets {
            max-height: 200px;
            overflow-y: auto;
        }

        .saved-set-item {
            padding: 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }

        .saved-set-item:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .saved-set-item strong {
            display: block;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .saved-set-item small {
            color: #718096;
            font-size: 12px;
        }

        .blank {
            display: inline-block;
            border-bottom: 2px solid #2d3748;
            min-width: 100px;
            margin: 0 4px;
        }

        .info-badge {
            display: inline-block;
            background: #bee3f8;
            color: #2c5282;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            margin-top: 8px;
        }

        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .upload-area.has-file {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .collapsible-section {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 15px;
            background: white;
        }

        .collapsible-header {
            padding: 12px 15px;
            cursor: pointer;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .collapsible-header:hover {
            background: #f7fafc;
        }

        .collapsible-content {
            padding: 15px;
            border-top: 1px solid #e2e8f0;
            display: none;
        }

        .collapsible-content.active {
            display: block;
        }

        .target-word {
            background: #fef5e7;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
            color: #d97706;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
            }

            .left-panel,
            .button-group,
            button,
            .tabs {
                display: none;
            }

            .main-content {
                grid-template-columns: 1fr;
            }

            .material-output {
                border: none;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö French Word-Level Lesson Planner</h1>
            <p>Create precise, bespoke materials with contextualized vocabulary for Year 11 French</p>
        </header>

        <div class="main-content">
            <div class="left-panel">
                <div class="section">
                    <div class="section-title">üìñ Vocabulary Pool</div>
                    <div class="collapsible-section">
                        <div class="collapsible-header" onclick="toggleCollapsible(this)">
                            <span>Upload Vocabulary Lists</span>
                            <span>‚ñº</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="input-group">
                                <label>Exam Spec Word List (.txt or .csv)</label>
                                <input type="file" id="examSpecFile" accept=".txt,.csv" onchange="handleVocabUpload(this, 'examSpec')">
                                <div class="info-badge" id="examSpecInfo">No file loaded</div>
                            </div>
                            <div class="input-group">
                                <label>Scheme of Work Word List (.txt or .csv)</label>
                                <input type="file" id="sowFile" accept=".txt,.csv" onchange="handleVocabUpload(this, 'sow')">
                                <div class="info-badge" id="sowInfo">No file loaded</div>
                            </div>
                            <p style="font-size: 12px; color: #718096; margin-top: 10px;">
                                üí° Upload lists as plain text (one word per line) or CSV format
                            </p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">üéØ Focus Words (Target Vocabulary)</div>
                    <div class="input-group">
                        <label>Add words to focus on in this lesson</label>
                        <div class="quick-add">
                            <input type="text" id="wordInput" placeholder="e.g., aimer, int√©ressant, la maison">
                            <button onclick="addWord()" class="btn-small">Add</button>
                        </div>
                    </div>
                    <div class="word-list" id="wordBank"></div>
                </div>

                <div class="section">
                    <div class="section-title">Lesson Context</div>
                    <div class="input-group">
                        <label>Topic/Theme</label>
                        <input type="text" id="topicInput" placeholder="e.g., La famille, Les vacances">
                    </div>
                    <div class="input-group">
                        <label>Grammar Focus</label>
                        <select id="grammarFocus">
                            <option value="">Select grammar point...</option>
                            <option value="present">Present tense</option>
                            <option value="perfect">Perfect tense (pass√© compos√©)</option>
                            <option value="imperfect">Imperfect tense</option>
                            <option value="future">Future tense</option>
                            <option value="conditional">Conditional</option>
                            <option value="subjunctive">Subjunctive</option>
                            <option value="adjectives">Adjective agreement</option>
                            <option value="negatives">Negatives</option>
                            <option value="pronouns">Pronouns</option>
                            <option value="opinions">Opinion phrases</option>
                            <option value="time">Time expressions</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Tier</label>
                        <select id="tierSelect">
                            <option value="foundation">Foundation</option>
                            <option value="higher">Higher</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Material Settings</div>
                    <div class="input-group">
                        <label>Number of exercises</label>
                        <input type="number" id="exerciseCount" value="6" min="3" max="15">
                    </div>
                    <div class="input-group">
                        <label>Additional context (optional)</label>
                        <textarea id="contextNotes" placeholder="Any specific requirements or focus areas..."></textarea>
                    </div>
                </div>

                <div class="section">
                    <button onclick="generateMaterials()" style="width: 100%; padding: 14px;">‚ú® Generate Materials</button>
                </div>

                <div class="section">
                    <div class="section-title">Save/Load Word Sets</div>
                    <div class="input-group">
                        <input type="text" id="setNameInput" placeholder="Name this word set">
                        <button onclick="saveWordSet()" style="width: 100%; margin-top: 8px;" class="btn-secondary">Save Current Set</button>
                    </div>
                    <div class="saved-sets" id="savedSets"></div>
                </div>
            </div>

            <div class="right-panel">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('sentences')">Sentence Builder</button>
                    <button class="tab" onclick="switchTab('gap')">Gap Fill</button>
                    <button class="tab" onclick="switchTab('translation')">Translation</button>
                    <button class="tab" onclick="switchTab('vocab')">Vocab Test</button>
                    <button class="tab" onclick="switchTab('speaking')">Speaking Cards</button>
                </div>

                <div id="sentences" class="tab-content active">
                    <div class="output-section">
                        <h3>Sentence Building Exercise</h3>
                        <div class="material-output" id="sentenceOutput">
                            <p style="color: #718096; font-style: italic;">Add focus words and click "Generate Materials" to create contextualized exercises</p>
                        </div>
                        <div class="button-group">
                            <button onclick="copyToClipboard('sentenceOutput')">üìã Copy</button>
                            <button onclick="window.print()" class="btn-secondary">üñ®Ô∏è Print</button>
                        </div>
                    </div>
                </div>

                <div id="gap" class="tab-content">
                    <div class="output-section">
                        <h3>Gap Fill Exercise</h3>
                        <div class="material-output" id="gapOutput">
                            <p style="color: #718096; font-style: italic;">Add focus words and click "Generate Materials" to create contextualized exercises</p>
                        </div>
                        <div class="button-group">
                            <button onclick="copyToClipboard('gapOutput')">üìã Copy</button>
                            <button onclick="window.print()" class="btn-secondary">üñ®Ô∏è Print</button>
                        </div>
                    </div>
                </div>

                <div id="translation" class="tab-content">
                    <div class="output-section">
                        <h3>Translation Practice</h3>
                        <div class="material-output" id="translationOutput">
                            <p style="color: #718096; font-style: italic;">Add focus words and click "Generate Materials" to create contextualized exercises</p>
                        </div>
                        <div class="button-group">
                            <button onclick="copyToClipboard('translationOutput')">üìã Copy</button>
                            <button onclick="window.print()" class="btn-secondary">üñ®Ô∏è Print</button>
                        </div>
                    </div>
                </div>

                <div id="vocab" class="tab-content">
                    <div class="output-section">
                        <h3>Vocabulary Test</h3>
                        <div class="material-output" id="vocabOutput">
                            <p style="color: #718096; font-style: italic;">Add focus words and click "Generate Materials" to create contextualized exercises</p>
                        </div>
                        <div class="button-group">
                            <button onclick="copyToClipboard('vocabOutput')">üìã Copy</button>
                            <button onclick="window.print()" class="btn-secondary">üñ®Ô∏è Print</button>
                        </div>
                    </div>
                </div>

                <div id="speaking" class="tab-content">
                    <div class="output-section">
                        <h3>Speaking Prompt Cards</h3>
                        <div class="material-output" id="speakingOutput">
                            <p style="color: #718096; font-style: italic;">Add focus words and click "Generate Materials" to create contextualized exercises</p>
                        </div>
                        <div class="button-group">
                            <button onclick="copyToClipboard('speakingOutput')">üìã Copy</button>
                            <button onclick="window.print()" class="btn-secondary">üñ®Ô∏è Print</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let wordBank = [];
        let vocabPool = {
            examSpec: [],
            sow: [],
            combined: []
        };

        // Expanded default vocabulary database
        const defaultVocab = {
            verbs: ['aimer', 'adorer', 'd√©tester', 'pr√©f√©rer', 'avoir', '√™tre', 'faire', 'aller', 'venir', 'partir', 'arriver', 'pouvoir', 'devoir', 'vouloir', 'prendre', 'manger', 'boire', 'regarder', '√©couter', 'parler', 'jouer', 'habiter', 'travailler', 'voyager', 'visiter', 'acheter', 'vendre', 'donner', 'trouver', 'penser', 'croire', 'savoir', 'conna√Ætre', 'comprendre', 'apprendre', '√©crire', 'lire', 'dire', 'voir', 'entendre', 'sortir', 'rentrer', 'rester', 'devenir', 'finir', 'commencer', 'continuer', 'essayer', 'aider', 'chercher', 'porter', 'montrer', 'ouvrir', 'fermer', 'dormir', 'se lever', 'se coucher', 'se r√©veiller'],
            nouns: ['maison', 'appartement', 'chambre', 'cuisine', 'salon', 'jardin', 'famille', 'p√®re', 'm√®re', 'fr√®re', 's≈ìur', 'parents', 'enfants', 'ami', 'amie', 'copain', 'copine', '√©cole', 'coll√®ge', 'lyc√©e', 'universit√©', 'classe', 'cours', 'professeur', '√©l√®ve', '√©tudiant', 'ville', 'village', 'pays', 'r√©gion', 'quartier', 'rue', 'avenue', 'place', 'parc', 'magasin', 'supermarch√©', 'restaurant', 'caf√©', 'cin√©ma', 'th√©√¢tre', 'mus√©e', 'biblioth√®que', '√©glise', 'gare', 'a√©roport', 'temps', 'jour', 'semaine', 'mois', 'ann√©e', 'heure', 'minute', 'matin', 'apr√®s-midi', 'soir', 'nuit', 'travail', 'm√©tier', 'emploi', 'vacances', 'weekend', 'f√™te', 'anniversaire', 'cadeau', 'livre', 'cahier', 'stylo', 'ordinateur', 't√©l√©phone', 'portable', 'voiture', 'v√©lo', 'bus', 'train', 'avion', 'animal', 'chien', 'chat', 'oiseau', 'poisson', 'nourriture', 'repas', 'petit-d√©jeuner', 'd√©jeuner', 'd√Æner', 'pain', 'viande', 'poisson', 'l√©gume', 'fruit', 'eau', 'lait', 'caf√©', 'th√©', 'jus', 'vin', 'argent', 'euro', 'prix', 'v√™tement', 'pantalon', 'chemise', 'robe', 'chaussure', 'manteau', 'couleur', 'sport', 'football', 'tennis', 'natation', 'musique', 'film', 'chanson', '√©mission', 'programme', 'chose', 'id√©e', 'probl√®me', 'solution', 'question', 'r√©ponse', 'monde', 'vie', 'mort', 'sant√©', 'maladie', 'm√©decin', 'h√¥pital'],
            adjectives: ['beau', 'belle', 'joli', 'bon', 'mauvais', 'grand', 'petit', 'gros', 'mince', 'long', 'court', 'haut', 'bas', 'large', '√©troit', 'nouveau', 'vieux', 'ancien', 'moderne', 'jeune', '√¢g√©', 'vieux', 'content', 'heureux', 'triste', 'malheureux', 'joyeux', 'gai', 's√©rieux', 'dr√¥le', 'amusant', 'ennuyeux', 'int√©ressant', 'important', 'facile', 'difficile', 'simple', 'compliqu√©', 'rapide', 'lent', 'fort', 'faible', 'riche', 'pauvre', 'cher', 'bon march√©', 'gratuit', 'chaud', 'froid', 'ti√®de', 'frais', 'sec', 'humide', 'propre', 'sale', 'clair', 'sombre', 'lumineux', 'brillant', 'mat', 'doux', 'dur', 'mou', 'l√©ger', 'lourd', 'plein', 'vide', 'ouvert', 'ferm√©', 'possible', 'impossible', 'probable', 'certain', 's√ªr', 'dangereux', 's√ªr', 'calme', 'agit√©', 'tranquille', 'bruyant', 'silencieux', 'parfait', 'excellent', 'magnifique', 'superbe', 'horrible', 'terrible', 'affreux', 'd√©licieux', 'mauvais', 'agr√©able', 'd√©sagr√©able', 'confortable', 'inconfortable', 'pratique', 'utile', 'inutile', 'n√©cessaire', 'obligatoire', 'facultatif', 'libre', 'occup√©', 'disponible', 'absent', 'pr√©sent'],
            adverbs: ['tr√®s', 'assez', 'trop', 'peu', 'beaucoup', 'bien', 'mal', 'mieux', 'moins', 'plus', 'aussi', 'toujours', 'jamais', 'souvent', 'parfois', 'rarement', 'quelquefois', 'd√©j√†', 'encore', 'maintenant', 'aujourd\'hui', 'hier', 'demain', 'bient√¥t', 'tard', 't√¥t', 'vite', 'lentement', 'ensemble', 'seul', 'seulement', 'vraiment', 'certainement', 'probablement', 'peut-√™tre', '√©videmment', 'naturellement', 'heureusement', 'malheureusement', 'surtout', 'environ', 'presque', 'compl√®tement', 'enti√®rement', 'absolument'],
            conjunctions: ['et', 'ou', 'mais', 'donc', 'or', 'car', 'ni', 'parce que', 'puisque', 'comme', 'quand', 'lorsque', 'si', 'que', 'qui', 'o√π', 'dont', 'lequel', 'bien que', 'quoique', 'tandis que', 'alors que', 'pendant que', 'pour que', 'afin que', 'avant que', 'apr√®s que', 'depuis que', 'd√®s que'],
            prepositions: ['√†', 'de', 'dans', 'sur', 'sous', 'devant', 'derri√®re', 'entre', 'parmi', 'avec', 'sans', 'pour', 'par', 'en', 'vers', 'chez', 'contre', 'selon', 'malgr√©', 'pendant', 'durant', 'avant', 'apr√®s', 'depuis', 'd√®s', 'jusqu\'√†', 'jusque'],
            expressions: ['il y a', 'il faut', '√ßa va', '√ßa marche', 'c\'est', 'ce sont', 'voici', 'voil√†', 's\'il vous pla√Æt', 's\'il te pla√Æt', 'merci', 'de rien', 'excusez-moi', 'pardon', 'bonjour', 'bonsoir', 'au revoir', 'salut', '√† bient√¥t', '√† tout √† l\'heure', 'bonne chance', 'bon courage', 'bon app√©tit', 'bonne journ√©e', 'bonne soir√©e', 'bonne nuit', 'joyeux anniversaire', 'bonne ann√©e', 'joyeux No√´l', 'bonnes vacances']
        };

        // Combine all default vocab
        function getAllVocab() {
            const all = [...Object.values(defaultVocab).flat()];
            if (vocabPool.combined.length > 0) {
                return [...new Set([...all, ...vocabPool.combined])];
            }
            return all;
        }

        function toggleCollapsible(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('span:last-child');
            content.classList.toggle('active');
            arrow.textContent = content.classList.contains('active') ? '‚ñ≤' : '‚ñº';
        }

        function handleVocabUpload(input, type) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const words = parseVocabFile(text);

                vocabPool[type] = words;
                vocabPool.combined = [...new Set([...vocabPool.examSpec, ...vocabPool.sow])];

                const infoId = type === 'examSpec' ? 'examSpecInfo' : 'sowInfo';
                document.getElementById(infoId).textContent = `‚úì Loaded ${words.length} words`;
                document.getElementById(infoId).style.background = '#c6f6d5';
                document.getElementById(infoId).style.color = '#22543d';
            };
            reader.readAsText(file);
        }

        function parseVocabFile(text) {
            // Handle both comma-separated and line-separated formats
            let words = [];

            // Try CSV first (comma separated)
            if (text.includes(',')) {
                words = text.split(',').map(w => w.trim()).filter(w => w.length > 0);
            } else {
                // Otherwise assume one word per line
                words = text.split('\n').map(w => w.trim()).filter(w => w.length > 0);
            }

            return [...new Set(words)]; // Remove duplicates
        }

        function addWord() {
            const input = document.getElementById('wordInput');
            const word = input.value.trim();

            if (word && !wordBank.includes(word)) {
                wordBank.push(word);
                updateWordBank();
                input.value = '';
            }
        }

        function removeWord(word) {
            wordBank = wordBank.filter(w => w !== word);
            updateWordBank();
        }

        function updateWordBank() {
            const container = document.getElementById('wordBank');
            container.innerHTML = '';

            wordBank.forEach(word => {
                const tag = document.createElement('div');
                tag.className = 'word-tag';
                tag.innerHTML = `${word} <span class="remove" onclick="removeWord('${word.replace(/'/g, "\\'")}')">√ó</span>`;
                container.appendChild(tag);
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function generateMaterials() {
            if (wordBank.length === 0) {
                alert('Please add some focus words to your word bank first!');
                return;
            }

            const topic = document.getElementById('topicInput').value || 'General';
            const grammar = document.getElementById('grammarFocus').value;
            const tier = document.getElementById('tierSelect').value;
            const count = parseInt(document.getElementById('exerciseCount').value);

            generateSentences(topic, grammar, tier, count);
            generateGapFill(topic, grammar, tier, count);
            generateTranslation(topic, grammar, tier, count);
            generateVocabTest(tier, count);
            generateSpeakingCards(topic, grammar, tier);
        }

        function generateSentences(topic, grammar, tier, count) {
            const output = document.getElementById('sentenceOutput');
            let html = `<h4>‚úèÔ∏è Contextualized Sentence Building</h4>`;
            html += `<p><span class="grammar-tag">${grammar || 'mixed grammar'}</span><span class="difficulty-badge difficulty-${tier}">${tier}</span></p>`;
            html += `<p><strong>Instructions:</strong> Write complete sentences that include the highlighted focus word. Use the grammar structure indicated.</p>`;

            const sentences = generateContextualSentencePrompts(topic, grammar, tier, count);
            sentences.forEach((sent, i) => {
                html += `<div class="exercise-item">`;
                html += `<strong>${i + 1}.</strong> ${sent.prompt}<br>`;
                html += `<em style="font-size: 12px; color: #718096;">Focus word: <span class="target-word">${sent.focusWord}</span></em>`;
                html += `<div style="margin-top: 10px; border-bottom: 1px solid #cbd5e0; min-height: 35px;"></div>`;
                html += `</div>`;
            });

            output.innerHTML = html;
        }

        function generateGapFill(topic, grammar, tier, count) {
            const output = document.getElementById('gapOutput');
            let html = `<h4>üìù Contextualized Gap Fill</h4>`;
            html += `<p><span class="grammar-tag">${grammar || 'mixed grammar'}</span><span class="difficulty-badge difficulty-${tier}">${tier}</span></p>`;
            html += `<p><strong>Instructions:</strong> Complete each sentence with the appropriate word. The focus words are highlighted.</p>`;

            const sentences = generateContextualGapFill(topic, grammar, tier, count);
            sentences.forEach((sentence, i) => {
                html += `<div class="exercise-item">`;
                html += `<strong>${i + 1}.</strong> ${sentence.text}`;
                if (sentence.focusWord) {
                    html += `<br><em style="font-size: 12px; color: #718096;">Contains: <span class="target-word">${sentence.focusWord}</span></em>`;
                }
                html += `</div>`;
            });

            output.innerHTML = html;
        }

        function generateTranslation(topic, grammar, tier, count) {
            const output = document.getElementById('translationOutput');
            let html = `<h4>üîÑ Contextualized Translation</h4>`;
            html += `<p><span class="grammar-tag">${grammar || 'mixed grammar'}</span><span class="difficulty-badge difficulty-${tier}">${tier}</span></p>`;

            html += `<div style="margin-bottom: 25px;">`;
            html += `<h4 style="font-size: 14px; margin-bottom: 12px; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">Section A: French to English</h4>`;

            const frenchSentences = generateFrenchToEnglishSentences(topic, grammar, tier, Math.min(count, 6));
            frenchSentences.forEach((sent, i) => {
                html += `<div class="exercise-item">`;
                html += `<strong>${i + 1}.</strong> ${sent.french}<br>`;
                html += `<div style="margin-top: 8px; border-bottom: 1px solid #cbd5e0; min-height: 30px;"></div>`;
                html += `</div>`;
            });
            html += `</div>`;

            html += `<div>`;
            html += `<h4 style="font-size: 14px; margin-bottom: 12px; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px;">Section B: English to French</h4>`;
            html += `<p style="font-size: 13px; color: #718096; margin-bottom: 10px;">Translate using the focus words provided:</p>`;

            const englishSentences = generateEnglishToFrenchSentences(topic, tier, Math.min(count, 6));
            englishSentences.forEach((sent, i) => {
                html += `<div class="exercise-item">`;
                html += `<strong>${i + 1}.</strong> ${sent.english}<br>`;
                html += `<em style="font-size: 12px; color: #718096;">Use: <span class="target-word">${sent.focusWord}</span></em>`;
                html += `<div style="margin-top: 8px; border-bottom: 1px solid #cbd5e0; min-height: 30px;"></div>`;
                html += `</div>`;
            });
            html += `</div>`;

            output.innerHTML = html;
        }

        function generateVocabTest(tier, count) {
            const output = document.getElementById('vocabOutput');
            let html = `<h4>üìñ Vocabulary Test - Focus Words</h4>`;
            html += `<p><span class="difficulty-badge difficulty-${tier}">${tier}</span></p>`;

            html += `<div style="margin-bottom: 20px;">`;
            html += `<h4 style="font-size: 14px; margin-bottom: 10px;">Section A: French to English</h4>`;

            wordBank.forEach((word, i) => {
                html += `<div class="exercise-item">`;
                html += `<strong>${i + 1}.</strong> <span class="target-word">${word}</span> <span style="margin-left: 40px;">_____________________</span>`;
                html += `</div>`;
            });
            html += `</div>`;

            html += `<div style="margin-bottom: 20px;">`;
            html += `<h4 style="font-size: 14px; margin-bottom: 10px;">Section B: Use in a sentence</h4>`;
            html += `<p style="font-size: 13px; color: #718096; margin-bottom: 10px;">Write a complete sentence using each word:</p>`;

            wordBank.forEach((word, i) => {
                html += `<div class="exercise-item">`;
                html += `<strong>${i + 1}.</strong> <span class="target-word">${word}</span>`;
                html += `<div style="margin-top: 8px; border-bottom: 1px solid #cbd5e0; min-height: 30px;"></div>`;
                html += `</div>`;
            });
            html += `</div>`;

            html += `<div>`;
            html += `<h4 style="font-size: 14px; margin-bottom: 10px;">Section C: Spelling Test</h4>`;
            html += `<p style="font-size: 13px; color: #718096; margin-bottom: 10px;">Teacher will say the word - students write it:</p>`;

            wordBank.forEach((word, i) => {
                html += `<div class="exercise-item">`;
                html += `<strong>${i + 1}.</strong> <span style="margin-left: 20px;">_____________________</span>`;
                html += `</div>`;
            });
            html += `</div>`;

            output.innerHTML = html;
        }

        function generateSpeakingCards(topic, grammar, tier) {
            const output = document.getElementById('speakingOutput');
            let html = `<h4>üí¨ Speaking Prompt Cards</h4>`;
            html += `<p><span class="grammar-tag">${grammar || 'mixed grammar'}</span><span class="difficulty-badge difficulty-${tier}">${tier}</span></p>`;
            html += `<p style="margin-bottom: 20px;"><strong>Instructions:</strong> Students must use the focus words in their spoken responses.</p>`;

            const prompts = generateSpeakingPrompts(topic, tier, 6);
            prompts.forEach((prompt, i) => {
                html += `<div style="border: 2px dashed #667eea; padding: 15px; margin-bottom: 15px; border-radius: 8px; page-break-inside: avoid;">`;
                html += `<div style="font-weight: 600; color: #667eea; margin-bottom: 8px;">Card ${i + 1}</div>`;
                html += `<div style="font-size: 15px; margin-bottom: 10px;">${prompt.question}</div>`;
                html += `<div style="font-size: 12px; color: #718096; margin-bottom: 6px;">`;
                html += `<strong>Focus word:</strong> <span class="target-word">${prompt.focusWord}</span>`;
                html += `</div>`;
                if (prompt.hint) {
                    html += `<div style="font-size: 11px; color: #a0aec0; font-style: italic;">`;
                    html += `üí° ${prompt.hint}`;
                    html += `</div>`;
                }
                html += `</div>`;
            });

            output.innerHTML = html;
        }

        function getRandomFromArray(arr, count = 1) {
            const shuffled = [...arr].sort(() => 0.5 - Math.random());
            return count === 1 ? shuffled[0] : shuffled.slice(0, count);
        }

        function getVocabByType(type) {
            const allVocab = getAllVocab();
            return defaultVocab[type] || allVocab.slice(0, 20);
        }

        function generateContextualSentencePrompts(topic, grammar, tier, count) {
            const prompts = [];
            const allVocab = getAllVocab();

            for (let i = 0; i < count && i < wordBank.length; i++) {
                const focusWord = wordBank[i];
                let prompt = '';

                if (grammar === 'present') {
                    const verb = getRandomFromArray(getVocabByType('verbs'));
                    prompt = `Write a sentence using the present tense of "${verb}" that includes the word`;
                } else if (grammar === 'perfect') {
                    prompt = `Write a sentence in the pass√© compos√© (perfect tense) that includes the word`;
                } else if (grammar === 'future') {
                    prompt = `Write a sentence about the future that includes the word`;
                } else if (grammar === 'adjectives') {
                    prompt = `Write a sentence with correct adjective agreement that includes the word`;
                } else if (grammar === 'opinions') {
                    prompt = `Write an opinion sentence that includes the word`;
                } else {
                    const contexts = [
                        `Write a sentence about ${topic || 'your day'} that includes the word`,
                        `Describe something using the word`,
                        `Write a sentence about your opinion using the word`,
                        `Write a sentence about the past that includes the word`
                    ];
                    prompt = getRandomFromArray(contexts);
                }

                prompts.push({ prompt, focusWord });
            }

            return prompts;
        }

        function generateContextualGapFill(topic, grammar, tier, count) {
            const sentences = [];
            const allVocab = getAllVocab();

            for (let i = 0; i < count && i < wordBank.length; i++) {
                const focusWord = wordBank[i];
                let sentence = { text: '', focusWord };

                // Build context around the focus word
                const verb = getRandomFromArray(getVocabByType('verbs'));
                const adj = getRandomFromArray(getVocabByType('adjectives'));
                const adv = getRandomFromArray(getVocabByType('adverbs'));
                const prep = getRandomFromArray(getVocabByType('prepositions'));

                const templates = [
                    `Je trouve que <span class="target-word">${focusWord}</span> est _____ ${adj}.`,
                    `_____ <span class="target-word">${focusWord}</span> ${prep} le weekend est ${adj}.`,
                    `Hier, j'ai vu <span class="target-word">${focusWord}</span> et c'√©tait _____.`,
                    `<span class="target-word">${focusWord}</span> _____ ${adv} dans la ville.`,
                    `Il faut _____ <span class="target-word">${focusWord}</span> chaque jour.`,
                    `Ma famille aime <span class="target-word">${focusWord}</span> parce que c'est _____.`
                ];

                sentence.text = getRandomFromArray(templates);
                sentences.push(sentence);
            }

            return sentences;
        }

        function generateFrenchToEnglishSentences(topic, grammar, tier, count) {
            const sentences = [];
            const allVocab = getAllVocab();

            for (let i = 0; i < count && i < wordBank.length; i++) {
                const focusWord = wordBank[i];
                const verb = getRandomFromArray(getVocabByType('verbs'));
                const adj = getRandomFromArray(getVocabByType('adjectives'));
                const noun = getRandomFromArray(getVocabByType('nouns'));

                const templates = [
                    `J'aime beaucoup <span class="target-word">${focusWord}</span> parce que c'est ${adj}.`,
                    `Ma famille trouve <span class="target-word">${focusWord}</span> tr√®s ${adj}.`,
                    `Quand je vais au ${noun}, je pense √† <span class="target-word">${focusWord}</span>.`,
                    `C'est important d'avoir <span class="target-word">${focusWord}</span> dans la vie.`,
                    `Hier, j'ai vu <span class="target-word">${focusWord}</span> en ville.`,
                    `<span class="target-word">${focusWord}</span> est ${adj} et ${adj}.`
                ];

                sentences.push({ french: getRandomFromArray(templates) });
            }

            return sentences;
        }

        function generateEnglishToFrenchSentences(topic, tier, count) {
            const sentences = [];

            for (let i = 0; i < count && i < wordBank.length; i++) {
                const focusWord = wordBank[i];

                const templates = [
                    `I really like ${focusWord}`,
                    `My family thinks ${focusWord} is important`,
                    `Yesterday I saw ${focusWord}`,
                    `${focusWord} is very interesting`,
                    `I want to have ${focusWord}`,
                    `We often talk about ${focusWord}`
                ];

                sentences.push({
                    english: getRandomFromArray(templates).replace(focusWord, '______'),
                    focusWord
                });
            }

            return sentences;
        }

        function generateSpeakingPrompts(topic, tier, count) {
            const prompts = [];

            const questionTemplates = [
                { q: 'Parle-moi de {word}. Pourquoi est-ce important pour toi?', hint: 'Give at least 3 reasons' },
                { q: 'Qu\'est-ce que tu penses de {word}?', hint: 'Express your opinion with justification' },
                { q: 'D√©cris {word} en d√©tail.', hint: 'Use lots of adjectives' },
                { q: 'Qu\'as-tu fait avec {word} r√©cemment?', hint: 'Use past tense' },
                { q: 'Comment est-ce que {word} influence ta vie?', hint: 'Give examples' },
                { q: 'Si tu pouvais changer {word}, que ferais-tu?', hint: 'Use conditional tense' }
            ];

            for (let i = 0; i < count && i < wordBank.length; i++) {
                const template = getRandomFromArray(questionTemplates);
                const focusWord = wordBank[i];

                prompts.push({
                    question: template.q.replace('{word}', focusWord),
                    focusWord,
                    hint: template.hint
                });
            }

            return prompts;
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.innerText;

            navigator.clipboard.writeText(text).then(() => {
                alert('‚úì Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy. Please try selecting and copying manually.');
            });
        }

        function saveWordSet() {
            const setName = document.getElementById('setNameInput').value.trim();

            if (!setName) {
                alert('Please enter a name for this word set');
                return;
            }

            if (wordBank.length === 0) {
                alert('Add some words before saving');
                return;
            }

            const sets = JSON.parse(localStorage.getItem('frenchWordSets') || '[]');
            sets.push({
                name: setName,
                words: [...wordBank],
                date: new Date().toLocaleDateString()
            });

            localStorage.setItem('frenchWordSets', JSON.stringify(sets));
            document.getElementById('setNameInput').value = '';
            loadSavedSets();
        }

        function loadSavedSets() {
            const sets = JSON.parse(localStorage.getItem('frenchWordSets') || '[]');
            const container = document.getElementById('savedSets');

            if (sets.length === 0) {
                container.innerHTML = '<p style="color: #718096; font-size: 13px; padding: 10px;">No saved sets yet</p>';
                return;
            }

            container.innerHTML = '';
            sets.forEach((set, index) => {
                const item = document.createElement('div');
                item.className = 'saved-set-item';
                item.innerHTML = `
                    <strong>${set.name}</strong>
                    <small>${set.words.length} words ‚Ä¢ Saved ${set.date}</small>
                `;
                item.onclick = () => loadWordSet(index);
                container.appendChild(item);
            });
        }

        function loadWordSet(index) {
            const sets = JSON.parse(localStorage.getItem('frenchWordSets') || '[]');
            if (sets[index]) {
                wordBank = [...sets[index].words];
                updateWordBank();
            }
        }

        // Allow Enter key to add words
        document.getElementById('wordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addWord();
            }
        });

        // Load saved sets on page load
        loadSavedSets();
    </script>
</body>
</html>