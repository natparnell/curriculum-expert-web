<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enzyme Kinetics Simulator</title>
<style>
  :root {
    --bg-primary: #f4f7f2;
    --bg-secondary: #ffffff;
    --bg-panel: #e8f0e4;
    --bg-info: #f0f5ed;
    --green-dark: #2d5a27;
    --green-mid: #4a8c3f;
    --green-light: #7bc06b;
    --green-pale: #c5e4bb;
    --accent-warm: #d4913b;
    --accent-red: #c0483b;
    --accent-blue: #3b7fc0;
    --text-primary: #2c2c2c;
    --text-secondary: #5a5a5a;
    --text-muted: #8a8a8a;
    --border-colour: #c8d8c2;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
    --shadow-md: 0 3px 10px rgba(0,0,0,0.1);
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 14px;
    --font-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --font-mono: 'Courier New', Courier, monospace;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font-main);
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
  }

  header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: linear-gradient(135deg, var(--green-dark), var(--green-mid));
    color: #fff;
    padding: 16px 24px;
    box-shadow: var(--shadow-md);
  }

  header h1 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.02em;
  }

  header p {
    font-size: 0.85rem;
    opacity: 0.85;
    margin-top: 2px;
  }

  .app-container {
    display: grid;
    grid-template-columns: 340px 1fr;
    gap: 20px;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }

  /* Controls panel */
  .controls-panel {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-colour);
    box-shadow: var(--shadow-sm);
    padding: 20px;
    height: fit-content;
    position: sticky;
    top: 90px;
  }

  .controls-panel h2 {
    font-size: 1.05rem;
    color: var(--green-dark);
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--green-pale);
  }

  .control-group {
    margin-bottom: 16px;
  }

  .control-group label {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 6px;
  }

  .control-group label span.value {
    font-family: var(--font-mono);
    font-weight: 700;
    color: var(--green-mid);
    font-size: 0.85rem;
  }

  input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: var(--green-pale);
    outline: none;
    cursor: pointer;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--green-mid);
    border: 2px solid #fff;
    box-shadow: var(--shadow-sm);
    cursor: pointer;
  }

  input[type="range"]::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--green-mid);
    border: 2px solid #fff;
    box-shadow: var(--shadow-sm);
    cursor: pointer;
  }

  .inhibitor-select {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid var(--border-colour);
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    background: var(--bg-panel);
    color: var(--text-primary);
    cursor: pointer;
    font-family: var(--font-main);
  }

  .separator {
    border: none;
    border-top: 1px dashed var(--border-colour);
    margin: 16px 0;
  }

  /* Right column */
  .main-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .graph-container {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-colour);
    box-shadow: var(--shadow-sm);
    padding: 20px;
  }

  .graph-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .graph-header h2 {
    font-size: 1.05rem;
    color: var(--green-dark);
  }

  .toggle-btn {
    padding: 6px 14px;
    border: 1px solid var(--green-mid);
    border-radius: var(--radius-sm);
    background: transparent;
    color: var(--green-mid);
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    font-family: var(--font-main);
    transition: all 0.2s;
  }

  .toggle-btn:hover, .toggle-btn.active {
    background: var(--green-mid);
    color: #fff;
  }

  .canvas-wrap {
    position: relative;
    width: 100%;
    background: #fafcf9;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-colour);
    overflow: hidden;
  }

  .canvas-wrap canvas {
    display: block;
    width: 100%;
    height: auto;
  }

  /* Stats bar */
  .stats-bar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
    margin-top: 12px;
  }

  .stat-card {
    background: var(--bg-panel);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    text-align: center;
  }

  .stat-card .stat-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    font-weight: 600;
  }

  .stat-card .stat-value {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--green-dark);
    font-family: var(--font-mono);
  }

  /* Animation container */
  .animation-container {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-colour);
    box-shadow: var(--shadow-sm);
    padding: 20px;
  }

  .animation-container h2 {
    font-size: 1.05rem;
    color: var(--green-dark);
    margin-bottom: 12px;
  }

  .anim-canvas-wrap {
    width: 100%;
    background: #fafcf9;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-colour);
    overflow: hidden;
  }

  .anim-canvas-wrap canvas {
    display: block;
    width: 100%;
    height: auto;
  }

  .anim-legend {
    display: flex;
    gap: 16px;
    margin-top: 10px;
    flex-wrap: wrap;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.78rem;
    color: var(--text-secondary);
  }

  .legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* Info panel */
  .info-panel {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-colour);
    box-shadow: var(--shadow-sm);
    padding: 20px;
  }

  .info-panel h2 {
    font-size: 1.05rem;
    color: var(--green-dark);
    margin-bottom: 14px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--green-pale);
  }

  .info-section {
    margin-bottom: 16px;
  }

  .info-section h3 {
    font-size: 0.9rem;
    color: var(--green-mid);
    margin-bottom: 6px;
  }

  .info-section p {
    font-size: 0.84rem;
    color: var(--text-secondary);
    line-height: 1.65;
  }

  .equation-box {
    background: var(--bg-info);
    border: 1px solid var(--border-colour);
    border-left: 3px solid var(--green-mid);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    margin: 8px 0;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    color: var(--green-dark);
    text-align: center;
  }

  .info-columns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .app-container {
      grid-template-columns: 1fr;
    }
    .controls-panel {
      position: static;
    }
    .info-columns {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 600px) {
    header { padding: 12px 16px; }
    header h1 { font-size: 1.2rem; }
    .app-container { padding: 12px; gap: 14px; }
    .controls-panel, .graph-container, .animation-container, .info-panel { padding: 14px; }
  }
</style>
</head>
<body>

<header>
  <h1>Enzyme Kinetics Simulator</h1>
  <p>Interactive Michaelis-Menten curves: explore how substrate, temperature, pH, and inhibitors affect reaction rate</p>
</header>

<div class="app-container">
  <!-- LEFT: Controls -->
  <div class="controls-panel">
    <h2>Parameters</h2>

    <div class="control-group">
      <label>Substrate [S] <span class="value" id="val-substrate">50</span></label>
      <input type="range" id="slider-substrate" min="0" max="100" value="50">
    </div>

    <div class="control-group">
      <label>Temperature (&#176;C) <span class="value" id="val-temp">37</span></label>
      <input type="range" id="slider-temp" min="0" max="80" value="37">
    </div>

    <div class="control-group">
      <label>pH <span class="value" id="val-ph">7.0</span></label>
      <input type="range" id="slider-ph" min="10" max="140" value="70">
    </div>

    <div class="control-group">
      <label>Enzyme Concentration <span class="value" id="val-enzyme">50</span></label>
      <input type="range" id="slider-enzyme" min="1" max="100" value="50">
    </div>

    <hr class="separator">

    <div class="control-group">
      <label>Inhibitor Type</label>
      <select class="inhibitor-select" id="select-inhibitor">
        <option value="none">None</option>
        <option value="competitive">Competitive</option>
        <option value="noncompetitive">Non-competitive</option>
      </select>
    </div>

    <div class="control-group" id="inhibitor-conc-group" style="display:none;">
      <label>Inhibitor Concentration <span class="value" id="val-inhibitor">30</span></label>
      <input type="range" id="slider-inhibitor" min="0" max="100" value="30">
    </div>

    <hr class="separator">

    <div class="control-group" style="margin-bottom:0;">
      <label style="font-size:0.78rem; color:var(--text-muted); font-weight:400;">
        Adjust parameters to see real-time changes in reaction rate and curve shape.
      </label>
    </div>
  </div>

  <!-- RIGHT: Content -->
  <div class="main-content">
    <!-- Graph -->
    <div class="graph-container">
      <div class="graph-header">
        <h2 id="graph-title">Michaelis-Menten Plot</h2>
        <button class="toggle-btn" id="btn-toggle-lb">Lineweaver-Burk Plot</button>
      </div>
      <div class="canvas-wrap">
        <canvas id="graph-canvas" width="800" height="480"></canvas>
      </div>
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-label">V<sub>max</sub></div>
          <div class="stat-value" id="stat-vmax">--</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">K<sub>m</sub> (apparent)</div>
          <div class="stat-value" id="stat-km">--</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Current V</div>
          <div class="stat-value" id="stat-v">--</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Enzyme Activity</div>
          <div class="stat-value" id="stat-activity">--</div>
        </div>
      </div>
    </div>

    <!-- Animation -->
    <div class="animation-container">
      <h2>Enzyme-Substrate Binding Animation</h2>
      <div class="anim-canvas-wrap">
        <canvas id="anim-canvas" width="800" height="240"></canvas>
      </div>
      <div class="anim-legend">
        <div class="legend-item"><div class="legend-dot" style="background:#4a8c3f;"></div>Enzyme</div>
        <div class="legend-item"><div class="legend-dot" style="background:#d4913b;"></div>Substrate</div>
        <div class="legend-item"><div class="legend-dot" style="background:#c0483b;"></div>Enzyme-Substrate Complex</div>
        <div class="legend-item"><div class="legend-dot" style="background:#3b7fc0;"></div>Product</div>
        <div class="legend-item"><div class="legend-dot" style="background:#888;"></div>Inhibitor</div>
      </div>
    </div>

    <!-- Info panel -->
    <div class="info-panel">
      <h2>Key Concepts</h2>
      <div class="info-columns">
        <div class="info-section">
          <h3>Lock and Key Model</h3>
          <p>Proposed by Emil Fischer (1894), this model suggests that the enzyme's active site has a rigid shape that exactly matches the substrate, like a lock and key. Only the correct substrate can fit into the active site, explaining enzyme specificity.</p>
        </div>
        <div class="info-section">
          <h3>Induced Fit Model</h3>
          <p>Proposed by Daniel Koshland (1958), this model refines the lock and key idea. The active site is flexible and changes shape slightly as the substrate binds, moulding around it for a tighter fit. This conformational change lowers the activation energy of the reaction.</p>
        </div>
        <div class="info-section">
          <h3>The Michaelis-Menten Equation</h3>
          <div class="equation-box">V = (V<sub>max</sub> &middot; [S]) / (K<sub>m</sub> + [S])</div>
          <p>This equation describes how reaction velocity (V) depends on substrate concentration [S]. At low [S], V increases almost linearly. As [S] rises, V approaches V<sub>max</sub> asymptotically because enzyme active sites become saturated.</p>
        </div>
        <div class="info-section">
          <h3>V<sub>max</sub> and K<sub>m</sub></h3>
          <p><strong>V<sub>max</sub></strong> is the maximum reaction rate when all enzyme active sites are saturated with substrate. It depends on enzyme concentration and catalytic efficiency.</p>
          <p style="margin-top:6px;"><strong>K<sub>m</sub></strong> (Michaelis constant) is the substrate concentration at which V = V<sub>max</sub>/2. A low K<sub>m</sub> means high affinity (the enzyme binds substrate tightly); a high K<sub>m</sub> means low affinity.</p>
        </div>
        <div class="info-section">
          <h3>Competitive Inhibition</h3>
          <p>A competitive inhibitor has a similar shape to the substrate and competes for the active site. It increases the apparent K<sub>m</sub> (lower apparent affinity) but V<sub>max</sub> remains unchanged because at very high [S], substrate outcompetes the inhibitor.</p>
        </div>
        <div class="info-section">
          <h3>Non-competitive Inhibition</h3>
          <p>A non-competitive inhibitor binds to an allosteric site (not the active site), changing the enzyme's shape. This reduces V<sub>max</sub> because some enzyme molecules are inactivated regardless of [S], but K<sub>m</sub> is unaffected since substrate binding affinity does not change.</p>
        </div>
        <div class="info-section">
          <h3>Temperature Effects</h3>
          <p>Increasing temperature raises kinetic energy, so molecules collide more often and reaction rate increases. However, above the optimum temperature (around 37&#176;C for human enzymes), the enzyme denatures: hydrogen bonds and other weak interactions break, distorting the active site and dramatically reducing activity.</p>
        </div>
        <div class="info-section">
          <h3>pH Effects</h3>
          <p>Each enzyme has an optimum pH. Deviations alter the ionisation of amino acid side chains in the active site, weakening substrate binding and reducing catalytic activity. Extreme pH values cause denaturation. For example, pepsin works best at pH 2 (stomach), while trypsin prefers pH 8 (small intestine).</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';

  /* ===== DOM REFERENCES ===== */
  const sliderSubstrate = document.getElementById('slider-substrate');
  const sliderTemp = document.getElementById('slider-temp');
  const sliderPH = document.getElementById('slider-ph');
  const sliderEnzyme = document.getElementById('slider-enzyme');
  const selectInhibitor = document.getElementById('select-inhibitor');
  const sliderInhibitor = document.getElementById('slider-inhibitor');
  const inhibitorGroup = document.getElementById('inhibitor-conc-group');

  const valSubstrate = document.getElementById('val-substrate');
  const valTemp = document.getElementById('val-temp');
  const valPH = document.getElementById('val-ph');
  const valEnzyme = document.getElementById('val-enzyme');
  const valInhibitor = document.getElementById('val-inhibitor');

  const statVmax = document.getElementById('stat-vmax');
  const statKm = document.getElementById('stat-km');
  const statV = document.getElementById('stat-v');
  const statActivity = document.getElementById('stat-activity');

  const graphCanvas = document.getElementById('graph-canvas');
  const graphCtx = graphCanvas.getContext('2d');
  const animCanvas = document.getElementById('anim-canvas');
  const animCtx = animCanvas.getContext('2d');

  const btnToggleLB = document.getElementById('btn-toggle-lb');
  const graphTitle = document.getElementById('graph-title');

  let showLB = false;

  /* ===== PARAMETERS ===== */
  function getParams() {
    return {
      substrate: +sliderSubstrate.value,
      temp: +sliderTemp.value,
      ph: +sliderPH.value / 10,
      enzyme: +sliderEnzyme.value,
      inhibitorType: selectInhibitor.value,
      inhibitorConc: +sliderInhibitor.value
    };
  }

  /* ===== KINETICS MODEL ===== */
  const BASE_VMAX = 100;
  const BASE_KM = 20;
  const OPT_TEMP = 37;
  const OPT_PH = 7.0;

  function tempFactor(t) {
    // Bell-shaped: activity rises then falls with denaturation
    if (t <= 0) return 0.02;
    // Rising phase: Arrhenius-like increase
    var rising = 1 - Math.exp(-0.08 * t);
    // Denaturation phase: sharp drop above optimum
    var denaturing = Math.exp(-0.005 * Math.pow(t - OPT_TEMP, 2));
    if (t > OPT_TEMP) {
      // Sharper denaturation above optimum
      denaturing = Math.exp(-0.008 * Math.pow(t - OPT_TEMP, 2));
    }
    return Math.max(0.01, rising * denaturing);
  }

  function phFactor(ph) {
    // Bell curve around optimum pH
    return Math.max(0.01, Math.exp(-0.5 * Math.pow(ph - OPT_PH, 2)));
  }

  function getKinetics(p) {
    var tf = tempFactor(p.temp);
    var pf = phFactor(p.ph);
    var activity = tf * pf;

    var enzymeScale = p.enzyme / 50; // normalised to 1 at 50
    var vmax = BASE_VMAX * activity * enzymeScale;
    var km = BASE_KM;

    // Inhibitor effects
    if (p.inhibitorType === 'competitive') {
      // Competitive: Km increases, Vmax unchanged
      var alpha = 1 + (p.inhibitorConc / 25);
      km = BASE_KM * alpha;
    } else if (p.inhibitorType === 'noncompetitive') {
      // Non-competitive: Vmax decreases, Km unchanged
      var alphaPrime = 1 + (p.inhibitorConc / 25);
      vmax = vmax / alphaPrime;
    }

    // Current V at the selected [S]
    var v = (vmax * p.substrate) / (km + p.substrate);

    return { vmax: vmax, km: km, v: v, activity: activity };
  }

  /* ===== GRAPH DRAWING ===== */
  const GRAPH_PAD = { top: 40, right: 30, bottom: 55, left: 65 };
  const COLOURS = {
    curve: '#4a8c3f',
    curveNoInhibitor: '#c5e4bb',
    vmax: '#c0483b',
    km: '#3b7fc0',
    grid: '#e0e8dc',
    axis: '#5a5a5a',
    text: '#5a5a5a',
    marker: '#d4913b',
    bg: '#fafcf9'
  };

  function resizeCanvas(canvas) {
    var rect = canvas.parentElement.getBoundingClientRect();
    var dpr = window.devicePixelRatio || 1;
    var w = rect.width;
    var h = canvas === graphCanvas ? Math.min(480, w * 0.6) : Math.min(240, w * 0.3);
    canvas.width = w * dpr;
    canvas.height = h * dpr;
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
    var ctx = canvas.getContext('2d');
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    return { w: w, h: h };
  }

  function drawGraph() {
    var size = resizeCanvas(graphCanvas);
    var w = size.w, h = size.h;
    var ctx = graphCtx;
    var p = getParams();
    var k = getKinetics(p);

    ctx.clearRect(0, 0, w, h);
    ctx.fillStyle = COLOURS.bg;
    ctx.fillRect(0, 0, w, h);

    var plotW = w - GRAPH_PAD.left - GRAPH_PAD.right;
    var plotH = h - GRAPH_PAD.top - GRAPH_PAD.bottom;

    if (showLB) {
      drawLineweaverBurk(ctx, w, h, plotW, plotH, p, k);
      return;
    }

    // Axes ranges for Michaelis-Menten
    var xMax = 100;
    var yMax = Math.max(k.vmax * 1.15, 10);

    function toX(s) { return GRAPH_PAD.left + (s / xMax) * plotW; }
    function toY(v) { return GRAPH_PAD.top + plotH - (v / yMax) * plotH; }

    // Grid lines
    ctx.strokeStyle = COLOURS.grid;
    ctx.lineWidth = 0.5;
    for (var i = 0; i <= 5; i++) {
      var gy = GRAPH_PAD.top + (plotH / 5) * i;
      ctx.beginPath(); ctx.moveTo(GRAPH_PAD.left, gy); ctx.lineTo(GRAPH_PAD.left + plotW, gy); ctx.stroke();
      var gx = GRAPH_PAD.left + (plotW / 5) * i;
      ctx.beginPath(); ctx.moveTo(gx, GRAPH_PAD.top); ctx.lineTo(gx, GRAPH_PAD.top + plotH); ctx.stroke();
    }

    // Reference curve (no inhibitor) if inhibitor is active
    if (p.inhibitorType !== 'none') {
      var refP = Object.assign({}, p, { inhibitorType: 'none', inhibitorConc: 0 });
      var refK = getKinetics(refP);
      ctx.strokeStyle = COLOURS.curveNoInhibitor;
      ctx.lineWidth = 2;
      ctx.setLineDash([6, 4]);
      ctx.beginPath();
      for (var s = 0; s <= xMax; s += 0.5) {
        var rv = (refK.vmax * s) / (refK.km + s);
        var px = toX(s), py = toY(rv);
        s === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
      }
      ctx.stroke();
      ctx.setLineDash([]);
    }

    // Main curve
    ctx.strokeStyle = COLOURS.curve;
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    for (var s = 0; s <= xMax; s += 0.5) {
      var v = (k.vmax * s) / (k.km + s);
      var px = toX(s), py = toY(v);
      s === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
    }
    ctx.stroke();

    // Vmax dashed line
    ctx.strokeStyle = COLOURS.vmax;
    ctx.lineWidth = 1.5;
    ctx.setLineDash([8, 5]);
    ctx.beginPath();
    ctx.moveTo(GRAPH_PAD.left, toY(k.vmax));
    ctx.lineTo(GRAPH_PAD.left + plotW, toY(k.vmax));
    ctx.stroke();
    ctx.setLineDash([]);

    // Vmax label
    ctx.fillStyle = COLOURS.vmax;
    ctx.font = 'bold 11px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'left';
    ctx.fillText('Vmax = ' + k.vmax.toFixed(1), GRAPH_PAD.left + plotW - 90, toY(k.vmax) - 6);

    // Km dashed line (vertical at Km, up to Vmax/2)
    var vmaxHalf = k.vmax / 2;
    if (k.km <= xMax) {
      ctx.strokeStyle = COLOURS.km;
      ctx.lineWidth = 1.5;
      ctx.setLineDash([8, 5]);
      // Horizontal at Vmax/2
      ctx.beginPath();
      ctx.moveTo(GRAPH_PAD.left, toY(vmaxHalf));
      ctx.lineTo(toX(k.km), toY(vmaxHalf));
      ctx.stroke();
      // Vertical down from Vmax/2 to x-axis
      ctx.beginPath();
      ctx.moveTo(toX(k.km), toY(vmaxHalf));
      ctx.lineTo(toX(k.km), toY(0));
      ctx.stroke();
      ctx.setLineDash([]);

      // Km label
      ctx.fillStyle = COLOURS.km;
      ctx.textAlign = 'center';
      ctx.fillText('Km = ' + k.km.toFixed(1), toX(k.km), toY(0) + 14);

      // Vmax/2 label
      ctx.textAlign = 'right';
      ctx.fillText('Vmax/2', GRAPH_PAD.left - 6, toY(vmaxHalf) + 4);
    }

    // Current point marker
    var curV = (k.vmax * p.substrate) / (k.km + p.substrate);
    ctx.fillStyle = COLOURS.marker;
    ctx.beginPath();
    ctx.arc(toX(p.substrate), toY(curV), 6, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(toX(p.substrate), toY(curV), 2.5, 0, Math.PI * 2);
    ctx.fill();

    // Axes
    ctx.strokeStyle = COLOURS.axis;
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(GRAPH_PAD.left, GRAPH_PAD.top);
    ctx.lineTo(GRAPH_PAD.left, GRAPH_PAD.top + plotH);
    ctx.lineTo(GRAPH_PAD.left + plotW, GRAPH_PAD.top + plotH);
    ctx.stroke();

    // Axis labels
    ctx.fillStyle = COLOURS.text;
    ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'center';
    ctx.fillText('Substrate Concentration [S]', GRAPH_PAD.left + plotW / 2, h - 8);

    ctx.save();
    ctx.translate(14, GRAPH_PAD.top + plotH / 2);
    ctx.rotate(-Math.PI / 2);
    ctx.textAlign = 'center';
    ctx.fillText('Reaction Rate (V)', 0, 0);
    ctx.restore();

    // Tick labels
    ctx.font = '10px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'center';
    for (var i = 0; i <= 5; i++) {
      var xv = (xMax / 5) * i;
      ctx.fillText(xv.toFixed(0), toX(xv), GRAPH_PAD.top + plotH + 16);
    }
    ctx.textAlign = 'right';
    for (var i = 0; i <= 5; i++) {
      var yv = (yMax / 5) * i;
      ctx.fillText(yv.toFixed(0), GRAPH_PAD.left - 8, toY(yv) + 4);
    }

    // Legend if inhibitor active
    if (p.inhibitorType !== 'none') {
      var lx = GRAPH_PAD.left + 12, ly = GRAPH_PAD.top + 12;
      ctx.font = '11px ' + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = 'left';

      ctx.strokeStyle = COLOURS.curveNoInhibitor;
      ctx.lineWidth = 2;
      ctx.setLineDash([6, 4]);
      ctx.beginPath(); ctx.moveTo(lx, ly); ctx.lineTo(lx + 24, ly); ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillStyle = COLOURS.text;
      ctx.fillText('Without inhibitor', lx + 30, ly + 4);

      ctx.strokeStyle = COLOURS.curve;
      ctx.lineWidth = 2.5;
      ctx.beginPath(); ctx.moveTo(lx, ly + 18); ctx.lineTo(lx + 24, ly + 18); ctx.stroke();
      ctx.fillText('With ' + (p.inhibitorType === 'competitive' ? 'competitive' : 'non-competitive') + ' inhibitor', lx + 30, ly + 22);
    }
  }

  function drawLineweaverBurk(ctx, w, h, plotW, plotH, p, k) {
    // Lineweaver-Burk: 1/V vs 1/[S]
    // 1/V = (Km / Vmax) * (1/[S]) + 1/Vmax

    var sMin = 2; // avoid 1/0
    var sMax = 100;
    var invSMax = 1 / sMin;  // largest 1/[S]
    var invSMin = -0.3 * invSMax; // extend left of y-axis for intercept

    // Calculate 1/V range
    var invVatSMin = (k.km + sMin) / (k.vmax * sMin);
    var invVMin = 0;
    var invVMax = invVatSMin * 1.15;

    // Also get no-inhibitor values for reference line
    var refP = Object.assign({}, p, { inhibitorType: 'none', inhibitorConc: 0 });
    var refK = getKinetics(refP);
    var refInvVatSMin = (refK.km + sMin) / (refK.vmax * sMin);
    invVMax = Math.max(invVMax, refInvVatSMin * 1.15);

    // Extend invVMax a bit and allow negative invS
    var xRange = invSMax - invSMin;
    var yRange = invVMax;

    function toX(invS) { return GRAPH_PAD.left + ((invS - invSMin) / xRange) * plotW; }
    function toY(invV) { return GRAPH_PAD.top + plotH - (invV / yRange) * plotH; }

    // Grid
    ctx.strokeStyle = COLOURS.grid;
    ctx.lineWidth = 0.5;
    for (var i = 0; i <= 5; i++) {
      var gy = GRAPH_PAD.top + (plotH / 5) * i;
      ctx.beginPath(); ctx.moveTo(GRAPH_PAD.left, gy); ctx.lineTo(GRAPH_PAD.left + plotW, gy); ctx.stroke();
      var gx = GRAPH_PAD.left + (plotW / 5) * i;
      ctx.beginPath(); ctx.moveTo(gx, GRAPH_PAD.top); ctx.lineTo(gx, GRAPH_PAD.top + plotH); ctx.stroke();
    }

    // Draw y-axis at 1/[S] = 0
    var zeroX = toX(0);
    ctx.strokeStyle = COLOURS.axis;
    ctx.lineWidth = 1;
    ctx.setLineDash([4, 3]);
    ctx.beginPath(); ctx.moveTo(zeroX, GRAPH_PAD.top); ctx.lineTo(zeroX, GRAPH_PAD.top + plotH); ctx.stroke();
    ctx.setLineDash([]);

    // Reference line (no inhibitor)
    if (p.inhibitorType !== 'none') {
      var slope_ref = refK.km / refK.vmax;
      var intercept_ref = 1 / refK.vmax;
      ctx.strokeStyle = COLOURS.curveNoInhibitor;
      ctx.lineWidth = 2;
      ctx.setLineDash([6, 4]);
      ctx.beginPath();
      var y1 = slope_ref * invSMin + intercept_ref;
      var y2 = slope_ref * invSMax + intercept_ref;
      ctx.moveTo(toX(invSMin), toY(y1));
      ctx.lineTo(toX(invSMax), toY(y2));
      ctx.stroke();
      ctx.setLineDash([]);
    }

    // Main line
    var slope = k.km / k.vmax;
    var intercept = 1 / k.vmax;
    ctx.strokeStyle = COLOURS.curve;
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    var ly1 = slope * invSMin + intercept;
    var ly2 = slope * invSMax + intercept;
    ctx.moveTo(toX(invSMin), toY(ly1));
    ctx.lineTo(toX(invSMax), toY(ly2));
    ctx.stroke();

    // 1/Vmax intercept marker
    ctx.fillStyle = COLOURS.vmax;
    ctx.beginPath();
    ctx.arc(toX(0), toY(intercept), 5, 0, Math.PI * 2);
    ctx.fill();
    ctx.font = 'bold 11px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'left';
    ctx.fillText('1/Vmax', toX(0) + 8, toY(intercept) + 4);

    // -1/Km intercept marker (x-intercept of the line: 1/V = 0 => 1/[S] = -1/Km)
    var xIntercept = -1 / k.km;
    if (xIntercept >= invSMin) {
      ctx.fillStyle = COLOURS.km;
      ctx.beginPath();
      ctx.arc(toX(xIntercept), toY(0), 5, 0, Math.PI * 2);
      ctx.fill();
      ctx.textAlign = 'center';
      ctx.fillText('-1/Km', toX(xIntercept), toY(0) + 16);
    }

    // Axes
    ctx.strokeStyle = COLOURS.axis;
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(GRAPH_PAD.left, GRAPH_PAD.top);
    ctx.lineTo(GRAPH_PAD.left, GRAPH_PAD.top + plotH);
    ctx.lineTo(GRAPH_PAD.left + plotW, GRAPH_PAD.top + plotH);
    ctx.stroke();

    // Labels
    ctx.fillStyle = COLOURS.text;
    ctx.font = '12px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'center';
    ctx.fillText('1 / [S]', GRAPH_PAD.left + plotW / 2, h - 8);

    ctx.save();
    ctx.translate(14, GRAPH_PAD.top + plotH / 2);
    ctx.rotate(-Math.PI / 2);
    ctx.textAlign = 'center';
    ctx.fillText('1 / V', 0, 0);
    ctx.restore();

    // Tick labels (sparse)
    ctx.font = '10px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'center';
    for (var i = 0; i <= 4; i++) {
      var xv = invSMin + (xRange / 4) * i;
      ctx.fillText(xv.toFixed(2), toX(xv), GRAPH_PAD.top + plotH + 16);
    }
    ctx.textAlign = 'right';
    for (var i = 0; i <= 4; i++) {
      var yv = (yRange / 4) * i;
      ctx.fillText(yv.toFixed(3), GRAPH_PAD.left - 8, toY(yv) + 4);
    }

    // Legend
    if (p.inhibitorType !== 'none') {
      var lx = GRAPH_PAD.left + plotW - 200, ly = GRAPH_PAD.top + 12;
      ctx.font = '11px ' + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = 'left';
      ctx.strokeStyle = COLOURS.curveNoInhibitor;
      ctx.lineWidth = 2;
      ctx.setLineDash([6, 4]);
      ctx.beginPath(); ctx.moveTo(lx, ly); ctx.lineTo(lx + 24, ly); ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillStyle = COLOURS.text;
      ctx.fillText('Without inhibitor', lx + 30, ly + 4);

      ctx.strokeStyle = COLOURS.curve;
      ctx.lineWidth = 2.5;
      ctx.beginPath(); ctx.moveTo(lx, ly + 18); ctx.lineTo(lx + 24, ly + 18); ctx.stroke();
      ctx.fillText('With inhibitor', lx + 30, ly + 22);
    }
  }

  /* ===== ANIMATION ===== */
  var animState = {
    phase: 'approach',  // approach, bind, catalyse, release
    t: 0,
    speed: 1,
    enzymeX: 0, enzymeY: 0,
    substrateX: 0, substrateY: 0,
    productX: 0, productY: 0,
    inhibitorX: 0, inhibitorY: 0,
    enzymeOpen: 1, // 1 = open, 0 = closed
    denatured: false,
    inhibitorBlocking: false
  };

  function resetAnim() {
    animState.phase = 'approach';
    animState.t = 0;
    animState.enzymeOpen = 1;
    animState.denatured = false;
    animState.inhibitorBlocking = false;
  }

  function drawEnzyme(ctx, cx, cy, size, openness, denatured, complexed) {
    // Draw enzyme as a pac-man like shape (active site = mouth)
    ctx.save();
    if (denatured) {
      // Wobbly denatured shape
      ctx.fillStyle = '#a0a0a0';
      ctx.beginPath();
      for (var i = 0; i < 12; i++) {
        var ang = (Math.PI * 2 / 12) * i;
        var r = size * (0.6 + 0.4 * Math.sin(i * 3.7 + performance.now() * 0.003));
        var px = cx + Math.cos(ang) * r;
        var py = cy + Math.sin(ang) * r;
        i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
      }
      ctx.closePath();
      ctx.fill();
      ctx.strokeStyle = '#888';
      ctx.lineWidth = 1.5;
      ctx.stroke();
    } else {
      var mouthAngle = openness * 0.5; // 0 to 0.5 radians
      ctx.fillStyle = complexed ? '#c0483b' : '#4a8c3f';
      ctx.beginPath();
      ctx.arc(cx, cy, size, mouthAngle, Math.PI * 2 - mouthAngle, false);
      ctx.lineTo(cx, cy);
      ctx.closePath();
      ctx.fill();
      ctx.strokeStyle = complexed ? '#8a3028' : '#2d5a27';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Active site notch detail
      if (!complexed) {
        ctx.fillStyle = '#e8f0e4';
        ctx.beginPath();
        ctx.arc(cx + size * 0.3, cy, size * 0.25 * openness, 0, Math.PI * 2);
        ctx.fill();
      }
    }
    ctx.restore();
  }

  function drawSubstrate(ctx, cx, cy, size) {
    // Triangle-ish substrate
    ctx.fillStyle = '#d4913b';
    ctx.beginPath();
    ctx.moveTo(cx - size * 0.5, cy + size * 0.4);
    ctx.lineTo(cx + size * 0.5, cy + size * 0.4);
    ctx.lineTo(cx + size * 0.3, cy - size * 0.4);
    ctx.lineTo(cx - size * 0.3, cy - size * 0.4);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = '#b07020';
    ctx.lineWidth = 1.5;
    ctx.stroke();
  }

  function drawProduct(ctx, cx, cy, size) {
    // Two small shapes (products)
    ctx.fillStyle = '#3b7fc0';
    ctx.beginPath();
    ctx.arc(cx - size * 0.35, cy, size * 0.3, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#2a5a8a';
    ctx.lineWidth = 1.5;
    ctx.stroke();

    ctx.fillStyle = '#5aa0e0';
    ctx.beginPath();
    ctx.arc(cx + size * 0.35, cy, size * 0.25, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#3b7fc0';
    ctx.stroke();
  }

  function drawInhibitorMol(ctx, cx, cy, size) {
    // Diamond shape inhibitor
    ctx.fillStyle = '#888';
    ctx.beginPath();
    ctx.moveTo(cx, cy - size * 0.45);
    ctx.lineTo(cx + size * 0.4, cy);
    ctx.lineTo(cx, cy + size * 0.45);
    ctx.lineTo(cx - size * 0.4, cy);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 1.5;
    ctx.stroke();
  }

  function drawAnimation(timestamp) {
    var size = resizeCanvas(animCanvas);
    var w = size.w, h = size.h;
    var ctx = animCtx;
    var p = getParams();
    var k = getKinetics(p);

    ctx.clearRect(0, 0, w, h);
    ctx.fillStyle = '#fafcf9';
    ctx.fillRect(0, 0, w, h);

    var enzymeSize = Math.min(h * 0.25, 40);
    var midY = h / 2;
    var enzymeCX = w * 0.35;
    var denatured = k.activity < 0.1;

    // Speed based on activity
    animState.speed = Math.max(0.2, k.activity * 2);

    var inhibitorActive = p.inhibitorType !== 'none' && p.inhibitorConc > 20;

    // Phase machine
    animState.t += animState.speed * 0.016;

    var phase = animState.phase;
    var t = animState.t;

    // Labels
    ctx.fillStyle = '#8a8a8a';
    ctx.font = '11px ' + getComputedStyle(document.body).fontFamily;
    ctx.textAlign = 'center';

    if (denatured) {
      // Denatured enzyme - just draw the wobbly enzyme
      drawEnzyme(ctx, enzymeCX, midY, enzymeSize, 0.5, true, false);
      ctx.fillStyle = '#c0483b';
      ctx.font = 'bold 13px ' + getComputedStyle(document.body).fontFamily;
      ctx.fillText('Enzyme denatured!', enzymeCX, midY + enzymeSize + 20);

      // Substrate drifting
      var sx = enzymeCX + enzymeSize * 2.5 + Math.sin(timestamp * 0.002) * 15;
      drawSubstrate(ctx, sx, midY + Math.cos(timestamp * 0.003) * 8, enzymeSize * 0.6);
      ctx.fillStyle = '#8a8a8a';
      ctx.font = '10px ' + getComputedStyle(document.body).fontFamily;
      ctx.fillText('Substrate', sx, midY + enzymeSize * 0.6 + 16);

      requestAnimationFrame(drawAnimation);
      return;
    }

    if (inhibitorActive && phase === 'approach' && t > 0.5 && !animState.inhibitorBlocking) {
      animState.inhibitorBlocking = true;
      animState.t = 0;
    }

    if (animState.inhibitorBlocking) {
      // Show inhibitor blocking
      var inhT = Math.min(animState.t / 1.5, 1);
      var inhStartX = w * 0.75;
      var inhX = inhStartX + (enzymeCX + enzymeSize * 0.6 - inhStartX) * inhT;

      if (p.inhibitorType === 'competitive') {
        // Inhibitor goes to active site
        drawEnzyme(ctx, enzymeCX, midY, enzymeSize, 1 - inhT * 0.8, false, inhT > 0.8);
        drawInhibitorMol(ctx, inhX, midY, enzymeSize * 0.5);
        ctx.fillStyle = '#8a8a8a';
        ctx.font = '10px ' + getComputedStyle(document.body).fontFamily;
        ctx.fillText('Competitive inhibitor', inhX, midY - enzymeSize * 0.5 - 8);

        // Substrate waiting
        var sx = w * 0.8 + Math.sin(timestamp * 0.003) * 10;
        drawSubstrate(ctx, sx, midY, enzymeSize * 0.6);
        ctx.fillText('Substrate blocked', sx, midY + enzymeSize * 0.6 + 14);
      } else {
        // Non-competitive: binds elsewhere
        var alloX = enzymeCX - enzymeSize * 0.8;
        var alloY = midY - enzymeSize * 0.7;
        var inhTargetX = alloX;
        var inhTargetY = alloY;
        var curInhX = inhStartX + (inhTargetX - inhStartX) * inhT;
        var curInhY = midY + (inhTargetY - midY) * inhT;

        drawEnzyme(ctx, enzymeCX, midY, enzymeSize * (1 - inhT * 0.15), 0.3, false, inhT > 0.8);
        drawInhibitorMol(ctx, curInhX, curInhY, enzymeSize * 0.4);
        ctx.fillStyle = '#8a8a8a';
        ctx.font = '10px ' + getComputedStyle(document.body).fontFamily;
        ctx.fillText('Non-competitive inhibitor', curInhX, curInhY - enzymeSize * 0.4 - 6);

        if (inhT > 0.8) {
          ctx.fillStyle = '#c0483b';
          ctx.font = 'bold 11px ' + getComputedStyle(document.body).fontFamily;
          ctx.fillText('Shape changed', enzymeCX, midY + enzymeSize + 18);
        }
      }

      ctx.fillStyle = '#8a8a8a';
      ctx.font = '10px ' + getComputedStyle(document.body).fontFamily;
      ctx.fillText('Enzyme', enzymeCX, midY + enzymeSize + 6);

      if (animState.t > 3) {
        animState.inhibitorBlocking = false;
        resetAnim();
      }

      requestAnimationFrame(drawAnimation);
      return;
    }

    // Normal catalysis animation
    if (phase === 'approach') {
      // Substrate approaches enzyme from right
      var progress = Math.min(t / 1.5, 1);
      var ease = progress < 0.5 ? 2 * progress * progress : 1 - Math.pow(-2 * progress + 2, 2) / 2;
      var subStartX = w * 0.8;
      var subTargetX = enzymeCX + enzymeSize * 0.7;
      var sx = subStartX + (subTargetX - subStartX) * ease;
      var sy = midY + Math.sin(progress * Math.PI * 3) * 5;

      drawEnzyme(ctx, enzymeCX, midY, enzymeSize, 1, false, false);
      drawSubstrate(ctx, sx, sy, enzymeSize * 0.6);

      ctx.fillStyle = '#8a8a8a';
      ctx.font = '10px ' + getComputedStyle(document.body).fontFamily;
      ctx.fillText('Enzyme', enzymeCX, midY + enzymeSize + 14);
      ctx.fillText('Substrate', sx, sy + enzymeSize * 0.6 + 10);

      if (progress >= 1) { animState.phase = 'bind'; animState.t = 0; }
    } else if (phase === 'bind') {
      // Enzyme closes around substrate (induced fit)
      var progress = Math.min(t / 0.8, 1);
      var openness = 1 - progress * 0.85;
      var sx = enzymeCX + enzymeSize * 0.5 * (1 - progress * 0.5);

      drawEnzyme(ctx, enzymeCX, midY, enzymeSize, openness, false, progress > 0.7);
      if (progress < 0.7) {
        drawSubstrate(ctx, sx, midY, enzymeSize * 0.6 * (1 - progress * 0.3));
      }

      ctx.fillStyle = '#8a8a8a';
      ctx.font = '10px ' + getComputedStyle(document.body).fontFamily;
      if (progress > 0.5) {
        ctx.fillStyle = '#c0483b';
        ctx.font = 'bold 11px ' + getComputedStyle(document.body).fontFamily;
        ctx.fillText('ES Complex', enzymeCX, midY + enzymeSize + 14);
      } else {
        ctx.fillText('Binding...', enzymeCX + enzymeSize, midY - enzymeSize);
      }

      if (progress >= 1) { animState.phase = 'catalyse'; animState.t = 0; }
    } else if (phase === 'catalyse') {
      // Enzyme-substrate complex; brief pause with glow
      var progress = Math.min(t / 1.0, 1);
      var glow = Math.sin(progress * Math.PI * 4) * 0.3;

      // Glow effect
      ctx.shadowColor = '#7bc06b';
      ctx.shadowBlur = 10 + glow * 20;
      drawEnzyme(ctx, enzymeCX, midY, enzymeSize + glow * 3, 0.15, false, true);
      ctx.shadowBlur = 0;

      ctx.fillStyle = '#c0483b';
      ctx.font = 'bold 11px ' + getComputedStyle(document.body).fontFamily;
      ctx.fillText('Catalysis occurring...', enzymeCX, midY + enzymeSize + 18);

      if (progress >= 1) { animState.phase = 'release'; animState.t = 0; }
    } else if (phase === 'release') {
      // Enzyme opens, products fly out
      var progress = Math.min(t / 1.5, 1);
      var ease = progress < 0.5 ? 2 * progress * progress : 1 - Math.pow(-2 * progress + 2, 2) / 2;

      var openness = 0.15 + ease * 0.85;
      drawEnzyme(ctx, enzymeCX, midY, enzymeSize, openness, false, false);

      // Products separate
      var p1x = enzymeCX + enzymeSize + ease * w * 0.25;
      var p1y = midY - ease * 30;
      var p2x = enzymeCX + enzymeSize + ease * w * 0.3;
      var p2y = midY + ease * 25;
      drawProduct(ctx, p1x, p1y, enzymeSize * 0.5);
      drawProduct(ctx, p2x, p2y, enzymeSize * 0.4);

      ctx.fillStyle = '#8a8a8a';
      ctx.font = '10px ' + getComputedStyle(document.body).fontFamily;
      ctx.fillText('Products released', p2x, p2y + enzymeSize * 0.5 + 12);
      ctx.fillText('Enzyme', enzymeCX, midY + enzymeSize + 14);

      if (progress >= 1) { resetAnim(); }
    }

    requestAnimationFrame(drawAnimation);
  }

  /* ===== STATS UPDATE ===== */
  function updateStats() {
    var p = getParams();
    var k = getKinetics(p);

    statVmax.textContent = k.vmax.toFixed(1);
    statKm.textContent = k.km.toFixed(1);
    statV.textContent = k.v.toFixed(1);
    statActivity.textContent = (k.activity * 100).toFixed(0) + '%';
  }

  /* ===== EVENT LISTENERS ===== */
  function onParamChange() {
    valSubstrate.textContent = sliderSubstrate.value;
    valTemp.textContent = sliderTemp.value;
    valPH.textContent = (sliderPH.value / 10).toFixed(1);
    valEnzyme.textContent = sliderEnzyme.value;
    valInhibitor.textContent = sliderInhibitor.value;

    drawGraph();
    updateStats();
  }

  sliderSubstrate.addEventListener('input', onParamChange);
  sliderTemp.addEventListener('input', onParamChange);
  sliderPH.addEventListener('input', onParamChange);
  sliderEnzyme.addEventListener('input', onParamChange);
  sliderInhibitor.addEventListener('input', onParamChange);

  selectInhibitor.addEventListener('change', function() {
    inhibitorGroup.style.display = selectInhibitor.value === 'none' ? 'none' : 'block';
    resetAnim();
    onParamChange();
  });

  btnToggleLB.addEventListener('click', function() {
    showLB = !showLB;
    btnToggleLB.classList.toggle('active', showLB);
    graphTitle.textContent = showLB ? 'Lineweaver-Burk Plot (1/V vs 1/[S])' : 'Michaelis-Menten Plot';
    btnToggleLB.textContent = showLB ? 'Michaelis-Menten Plot' : 'Lineweaver-Burk Plot';
    drawGraph();
  });

  window.addEventListener('resize', function() {
    drawGraph();
  });

  /* ===== INIT ===== */
  onParamChange();
  requestAnimationFrame(drawAnimation);

})();
</script>
</body>
</html>