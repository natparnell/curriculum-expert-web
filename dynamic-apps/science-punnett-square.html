<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Punnett Square &amp; Inheritance</title>
  <style>
    /* =====================================================
       ROOT VARIABLES
    ===================================================== */
    :root {
      --green-dark:    #1a5c3a;
      --green-mid:     #2e7d52;
      --green-light:   #4caf80;
      --teal-dark:     #00695c;
      --teal-mid:      #00897b;
      --teal-light:    #4db6ac;
      --teal-pale:     #b2dfdb;
      --bg-page:       #f0f7f4;
      --bg-card:       #ffffff;
      --bg-section:    #e8f5e9;
      --text-main:     #1b2e24;
      --text-muted:    #4a6357;
      --text-light:    #ffffff;
      --border:        #b2dfdb;
      --border-strong: #4db6ac;
      --dominant-bg:   #2e7d52;
      --dominant-text: #ffffff;
      --het-bg:        #80cbc4;
      --het-text:      #003d33;
      --recessive-bg:  #f9a825;
      --recessive-text:#3e2700;
      --shadow:        0 2px 8px rgba(0,0,0,0.10);
      --radius:        8px;
      --radius-lg:     14px;
      --font:          'Segoe UI', system-ui, sans-serif;
    }

    /* =====================================================
       RESET & BASE
    ===================================================== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font);
      background: var(--bg-page);
      color: var(--text-main);
      min-height: 100vh;
      line-height: 1.55;
    }

    h1, h2, h3, h4 { line-height: 1.25; }
    a { color: var(--teal-dark); }

    /* =====================================================
       HEADER
    ===================================================== */
    header {
      background: linear-gradient(135deg, var(--green-dark) 0%, var(--teal-dark) 100%);
      color: var(--text-light);
      padding: 1.25rem 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    header .header-icon {
      font-size: 2.2rem;
      line-height: 1;
    }

    header h1 {
      font-size: 1.6rem;
      font-weight: 700;
    }

    header p {
      font-size: 0.88rem;
      opacity: 0.85;
      margin-top: 0.1rem;
    }

    /* =====================================================
       MAIN LAYOUT
    ===================================================== */
    .app-wrapper {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1rem 3rem;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: 1.4rem 1.6rem;
    }

    .card-title {
      font-size: 1.05rem;
      font-weight: 700;
      color: var(--green-dark);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-title span.icon { font-size: 1.2rem; }

    /* =====================================================
       ROW LAYOUT FOR CONTROLS + SQUARE
    ===================================================== */
    .main-row {
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 1.25rem;
      align-items: start;
    }

    /* =====================================================
       CONTROLS PANEL
    ===================================================== */
    .control-section {
      margin-bottom: 1.1rem;
    }

    .control-label {
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.45rem;
    }

    /* Toggle switch row */
    .toggle-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: var(--bg-section);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.55rem 0.9rem;
    }

    .toggle-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-main);
      flex: 1;
    }

    .toggle-switch {
      position: relative;
      width: 48px;
      height: 26px;
      flex-shrink: 0;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
      position: absolute;
    }

    .toggle-track {
      position: absolute;
      inset: 0;
      background: var(--border-strong);
      border-radius: 999px;
      cursor: pointer;
      transition: background 0.25s;
    }

    .toggle-track::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      left: 3px;
      top: 3px;
      background: white;
      border-radius: 50%;
      transition: transform 0.25s;
    }

    input:checked + .toggle-track {
      background: var(--green-mid);
    }

    input:checked + .toggle-track::before {
      transform: translateX(22px);
    }

    /* Trait selector */
    .trait-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.4rem;
    }

    .trait-btn {
      background: var(--bg-section);
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      padding: 0.45rem 0.6rem;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--text-main);
      cursor: pointer;
      transition: all 0.18s;
      text-align: left;
    }

    .trait-btn:hover {
      border-color: var(--teal-mid);
      background: var(--teal-pale);
    }

    .trait-btn.active {
      background: var(--teal-dark);
      border-color: var(--teal-dark);
      color: white;
    }

    /* Parent genotype selectors */
    .parents-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    .parent-block {
      background: var(--bg-section);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.7rem 0.8rem;
    }

    .parent-block h4 {
      font-size: 0.82rem;
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 0.5rem;
    }

    .allele-btns {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }

    .allele-btn {
      background: white;
      border: 1.5px solid var(--border-strong);
      border-radius: 6px;
      padding: 0.3rem 0.55rem;
      font-size: 0.88rem;
      font-weight: 700;
      color: var(--teal-dark);
      cursor: pointer;
      font-family: 'Courier New', monospace;
      transition: all 0.16s;
      min-width: 36px;
      text-align: center;
    }

    .allele-btn:hover {
      background: var(--teal-pale);
    }

    .allele-btn.active {
      background: var(--teal-dark);
      border-color: var(--teal-dark);
      color: white;
    }

    /* Trait info pill */
    .trait-info-bar {
      background: var(--bg-section);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.6rem 0.9rem;
      font-size: 0.84rem;
    }

    .trait-info-bar strong { color: var(--green-dark); }

    /* =====================================================
       PUNNETT SQUARE
    ===================================================== */
    .square-panel {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .punnett-container {
      overflow-x: auto;
    }

    .punnett-table-wrap {
      display: inline-block;
    }

    table.punnett {
      border-collapse: collapse;
      margin: 0 auto;
    }

    table.punnett th, table.punnett td {
      border: 2px solid var(--border-strong);
      width: 72px;
      height: 72px;
      text-align: center;
      vertical-align: middle;
      font-size: 1.05rem;
      font-weight: 700;
      font-family: 'Courier New', monospace;
    }

    table.punnett th {
      background: var(--green-dark);
      color: white;
      font-size: 1.1rem;
      border-color: var(--green-dark);
    }

    table.punnett th.corner {
      background: var(--green-mid);
    }

    /* Cell phenotype colours */
    table.punnett td.pheno-dominant {
      background: var(--dominant-bg);
      color: var(--dominant-text);
    }

    table.punnett td.pheno-heterozygous {
      background: var(--het-bg);
      color: var(--het-text);
    }

    table.punnett td.pheno-recessive {
      background: var(--recessive-bg);
      color: var(--recessive-text);
    }

    table.punnett td .cell-genotype {
      display: block;
      font-size: 1.05rem;
    }

    table.punnett td .cell-phenotype {
      display: block;
      font-size: 0.62rem;
      font-family: var(--font);
      font-weight: 600;
      margin-top: 3px;
      opacity: 0.85;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    /* 16-cell smaller */
    table.punnett.dihybrid th,
    table.punnett.dihybrid td {
      width: 86px;
      height: 78px;
      font-size: 0.82rem;
    }

    table.punnett.dihybrid th {
      font-size: 0.88rem;
    }

    table.punnett.dihybrid td .cell-phenotype {
      font-size: 0.58rem;
    }

    /* =====================================================
       RATIOS PANEL
    ===================================================== */
    .ratios-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    .ratio-block {
      background: var(--bg-section);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.7rem 0.9rem;
    }

    .ratio-block h4 {
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: 0.55rem;
    }

    .ratio-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .ratio-list li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.88rem;
    }

    .ratio-swatch {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      flex-shrink: 0;
      border: 1px solid rgba(0,0,0,0.15);
    }

    .ratio-fraction {
      font-weight: 700;
      font-family: 'Courier New', monospace;
      color: var(--green-dark);
      min-width: 32px;
    }

    .ratio-label {
      color: var(--text-muted);
      font-size: 0.83rem;
    }

    /* probability note */
    .prob-note {
      font-size: 0.82rem;
      color: var(--text-muted);
      background: var(--bg-section);
      border-left: 3px solid var(--teal-mid);
      border-radius: 0 var(--radius) var(--radius) 0;
      padding: 0.5rem 0.8rem;
    }

    /* =====================================================
       SIMULATION
    ===================================================== */
    .sim-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-bottom: 0.85rem;
    }

    .sim-n-label {
      font-size: 0.88rem;
      font-weight: 600;
      color: var(--text-muted);
    }

    .sim-n-select {
      border: 1.5px solid var(--border-strong);
      border-radius: var(--radius);
      padding: 0.35rem 0.6rem;
      font-size: 0.88rem;
      background: white;
      color: var(--text-main);
      font-family: var(--font);
    }

    .btn-primary {
      background: var(--green-mid);
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 0.5rem 1.2rem;
      font-size: 0.92rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.18s;
      font-family: var(--font);
    }

    .btn-primary:hover { background: var(--green-dark); }

    .btn-secondary {
      background: white;
      color: var(--teal-dark);
      border: 1.5px solid var(--teal-mid);
      border-radius: var(--radius);
      padding: 0.45rem 1rem;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.18s;
      font-family: var(--font);
    }

    .btn-secondary:hover {
      background: var(--teal-pale);
    }

    /* Bar chart */
    .bar-chart {
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
    }

    .bar-row {
      display: grid;
      grid-template-columns: 160px 1fr 60px;
      align-items: center;
      gap: 0.6rem;
    }

    .bar-row-label {
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--text-main);
      text-align: right;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .bar-track {
      background: var(--bg-section);
      border-radius: 999px;
      height: 22px;
      position: relative;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .bar-fill-actual {
      height: 100%;
      border-radius: 999px;
      background: var(--teal-mid);
      transition: width 0.4s ease;
    }

    .bar-fill-expected {
      position: absolute;
      top: 0;
      height: 100%;
      width: 2px;
      background: rgba(0,0,0,0.5);
    }

    .bar-row-value {
      font-size: 0.82rem;
      font-family: 'Courier New', monospace;
      color: var(--text-muted);
    }

    .sim-legend {
      display: flex;
      gap: 1.2rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.3rem;
    }

    .sim-legend-item {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .sim-legend-swatch {
      width: 24px;
      height: 10px;
      border-radius: 999px;
    }

    .sim-legend-swatch.actual { background: var(--teal-mid); }
    .sim-legend-swatch.expected { width: 3px; height: 16px; background: rgba(0,0,0,0.5); }

    /* =====================================================
       KEY / GLOSSARY
    ===================================================== */
    .key-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.75rem;
    }

    .key-card {
      border-radius: var(--radius);
      padding: 0.75rem 0.9rem;
      border: 1.5px solid transparent;
    }

    .key-card.dominant {
      background: var(--dominant-bg);
      border-color: var(--green-dark);
      color: var(--dominant-text);
    }

    .key-card.heterozygous {
      background: var(--het-bg);
      border-color: var(--teal-mid);
      color: var(--het-text);
    }

    .key-card.recessive {
      background: var(--recessive-bg);
      border-color: #e65100;
      color: var(--recessive-text);
    }

    .key-card h4 {
      font-size: 0.88rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 0.3rem;
    }

    .key-card p {
      font-size: 0.8rem;
      opacity: 0.92;
    }

    /* =====================================================
       EXPLAINER / GCSE NOTES
    ===================================================== */
    .explainer {
      background: var(--bg-section);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.2rem 1.5rem;
    }

    .explainer h3 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--green-dark);
      margin-bottom: 0.7rem;
    }

    .explainer p {
      font-size: 0.88rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .explainer p:last-child { margin-bottom: 0; }

    .explainer strong { color: var(--green-dark); }

    /* =====================================================
       DIHYBRID INFO PANEL
    ===================================================== */
    .dihybrid-info {
      background: #e8f4fd;
      border: 1px solid #90caf9;
      border-radius: var(--radius);
      padding: 0.7rem 1rem;
      font-size: 0.84rem;
      color: #0d47a1;
      display: none;
    }

    .dihybrid-info.visible { display: block; }

    /* =====================================================
       EMPTY / ERROR STATE
    ===================================================== */
    .empty-state {
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
      padding: 2rem 1rem;
    }

    /* =====================================================
       RESPONSIVE
    ===================================================== */
    @media (max-width: 768px) {
      header { padding: 1rem; }
      header h1 { font-size: 1.25rem; }
      header .header-icon { font-size: 1.7rem; }

      .main-row {
        grid-template-columns: 1fr;
      }

      .trait-grid {
        grid-template-columns: 1fr 1fr;
      }

      table.punnett th, table.punnett td {
        width: 58px;
        height: 58px;
        font-size: 0.88rem;
      }

      table.punnett.dihybrid th,
      table.punnett.dihybrid td {
        width: 64px;
        height: 64px;
        font-size: 0.72rem;
      }

      .ratios-row {
        grid-template-columns: 1fr;
      }

      .bar-row {
        grid-template-columns: 120px 1fr 50px;
      }

      .key-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 480px) {
      .app-wrapper { padding: 1rem 0.6rem 2rem; }
      .card { padding: 1rem 1rem; }
      .parents-row { grid-template-columns: 1fr; }
      .key-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<header>
  <div class="header-icon">ðŸ§¬</div>
  <div>
    <h1>Punnett Square &amp; Inheritance</h1>
    <p>Set parent genotypes, generate Punnett squares, and simulate offspring populations</p>
  </div>
</header>

<div class="app-wrapper">

  <!-- MODE TOGGLE -->
  <div class="card">
    <div class="toggle-row">
      <span class="toggle-label" id="mode-label">Monohybrid cross (1 trait)</span>
      <label class="toggle-switch" title="Switch between monohybrid and dihybrid">
        <input type="checkbox" id="toggle-dihybrid" />
        <div class="toggle-track"></div>
      </label>
      <span style="font-size:0.88rem;font-weight:600;color:var(--teal-dark)">Dihybrid</span>
    </div>
    <div class="dihybrid-info" id="dihybrid-info">
      <strong>Dihybrid cross:</strong> Two traits are tracked simultaneously, producing a 4 x 4 grid (16 cells).
      Choose Trait A (first gene) and Trait B (second gene) below. Each parent has a combined genotype e.g. AaBb.
    </div>
  </div>

  <!-- MAIN ROW: CONTROLS + SQUARE -->
  <div class="main-row">

    <!-- LEFT: CONTROLS -->
    <div class="card" id="controls-panel">

      <!-- TRAIT A -->
      <div class="control-section">
        <div class="card-title" style="margin-bottom:0.5rem;">
          <span class="icon">ðŸŒ¿</span>
          <span id="trait-a-heading">Trait</span>
        </div>
        <div class="control-label">Select trait</div>
        <div class="trait-grid" id="trait-a-grid"></div>
      </div>

      <!-- TRAIT B (dihybrid only) -->
      <div class="control-section" id="trait-b-section" style="display:none;">
        <div class="card-title" style="margin-bottom:0.5rem;">
          <span class="icon">ðŸŒ¼</span>
          <span>Trait B (second gene)</span>
        </div>
        <div class="control-label">Select trait B</div>
        <div class="trait-grid" id="trait-b-grid"></div>
      </div>

      <!-- TRAIT INFO -->
      <div class="trait-info-bar" id="trait-info-bar">
        Select a trait above.
      </div>

      <div style="margin-top:1rem;">
        <!-- PARENT GENOTYPES -->
        <div class="control-label">Parent genotypes</div>
        <div class="parents-row">
          <div class="parent-block">
            <h4>Parent 1</h4>
            <div class="allele-btns" id="p1-btns"></div>
          </div>
          <div class="parent-block">
            <h4>Parent 2</h4>
            <div class="allele-btns" id="p2-btns"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: PUNNETT SQUARE + RATIOS -->
    <div class="square-panel">

      <div class="card">
        <div class="card-title">
          <span class="icon">ðŸ”²</span>
          Punnett Square
        </div>
        <div class="punnett-container">
          <div class="punnett-table-wrap" id="punnett-output">
            <div class="empty-state">Select a trait and parent genotypes to generate the grid.</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">
          <span class="icon">ðŸ“Š</span>
          Genotype &amp; Phenotype Ratios
        </div>
        <div class="ratios-row" id="ratios-output">
          <div class="empty-state" style="grid-column:1/-1">Generate the Punnett square to see ratios.</div>
        </div>
        <div class="prob-note" id="prob-note" style="margin-top:0.75rem; display:none;"></div>
      </div>

    </div>
  </div>

  <!-- COLOUR KEY -->
  <div class="card">
    <div class="card-title">
      <span class="icon">ðŸ”‘</span>
      Colour Key
    </div>
    <div class="key-grid">
      <div class="key-card dominant">
        <h4>Homozygous dominant</h4>
        <p>Both alleles are the dominant form (e.g. BB). The dominant phenotype is expressed.</p>
      </div>
      <div class="key-card heterozygous">
        <h4>Heterozygous</h4>
        <p>One dominant and one recessive allele (e.g. Bb). The dominant phenotype is expressed due to dominance.</p>
      </div>
      <div class="key-card recessive">
        <h4>Homozygous recessive</h4>
        <p>Both alleles are the recessive form (e.g. bb). Only this genotype shows the recessive phenotype.</p>
      </div>
    </div>
  </div>

  <!-- SIMULATION -->
  <div class="card">
    <div class="card-title">
      <span class="icon">ðŸŽ²</span>
      Monte Carlo Offspring Simulation
    </div>
    <div class="sim-controls">
      <span class="sim-n-label">Simulate</span>
      <select class="sim-n-select" id="sim-n">
        <option value="50">50</option>
        <option value="100" selected>100</option>
        <option value="500">500</option>
        <option value="1000">1,000</option>
        <option value="10000">10,000</option>
      </select>
      <span class="sim-n-label">offspring</span>
      <button class="btn-primary" id="btn-simulate">Run Simulation</button>
      <button class="btn-secondary" id="btn-reset-sim">Reset</button>
    </div>
    <div id="sim-output">
      <div class="empty-state">Configure parents and click "Run Simulation" to see results.</div>
    </div>
  </div>

  <!-- GCSE EXPLAINER -->
  <div class="explainer">
    <h3>GCSE Genetics: Key Concepts</h3>
    <p><strong>Gene:</strong> A section of DNA that codes for a particular characteristic (e.g. eye colour).</p>
    <p><strong>Allele:</strong> A version of a gene. Most genes have at least two alleles: a dominant allele (written as a capital letter) and a recessive allele (written as a lower-case letter).</p>
    <p><strong>Genotype:</strong> The combination of alleles an organism carries for a given gene (e.g. BB, Bb, or bb). The genotype is the genetic make-up.</p>
    <p><strong>Phenotype:</strong> The observable characteristic that results from the genotype (e.g. brown eyes or blue eyes). The phenotype is what you can see.</p>
    <p><strong>Homozygous dominant (BB):</strong> Both alleles are dominant. Only the dominant phenotype can be expressed.</p>
    <p><strong>Heterozygous (Bb):</strong> One dominant and one recessive allele. Because the dominant allele masks the recessive allele, the dominant phenotype is expressed.</p>
    <p><strong>Homozygous recessive (bb):</strong> Both alleles are recessive. The recessive phenotype is expressed because there is no dominant allele to mask it.</p>
    <p><strong>Probability:</strong> Each cell in a Punnett square represents an equal probability (25% for a 2x2 grid, 6.25% for a 4x4 grid). Ratios such as 3:1 arise because three cells out of four show the dominant phenotype.</p>
    <p><strong>Dihybrid cross:</strong> Examines two genes simultaneously. Based on Mendel's Law of Independent Assortment, the alleles for different genes are inherited independently of each other.</p>
  </div>

</div>

<script>
/* ======================================================
   DATA: TRAITS
====================================================== */
const TRAITS = [
  {
    id: 'flower-colour',
    name: 'Flower Colour',
    icon: 'ðŸŒ¸',
    letter: 'P',
    dominant: { name: 'Purple', short: 'Pur' },
    recessive: { name: 'White', short: 'Wht' },
    example: 'Purple (P) is dominant over white (p). This was one of Mendel\'s original pea plant experiments.'
  },
  {
    id: 'pea-shape',
    name: 'Pea Shape',
    icon: 'ðŸŸ¢',
    letter: 'R',
    dominant: { name: 'Round', short: 'Rnd' },
    recessive: { name: 'Wrinkled', short: 'Wrk' },
    example: 'Round (R) is dominant over wrinkled (r) seed shape, another of Mendel\'s classic traits.'
  },
  {
    id: 'pea-colour',
    name: 'Pea Colour',
    icon: 'ðŸ«›',
    letter: 'Y',
    dominant: { name: 'Yellow', short: 'Yel' },
    recessive: { name: 'Green', short: 'Grn' },
    example: 'Yellow (Y) pea colour is dominant over green (y). Studied extensively by Gregor Mendel in the 1860s.'
  },
  {
    id: 'eye-colour',
    name: 'Eye Colour',
    icon: 'ðŸ‘',
    letter: 'B',
    dominant: { name: 'Brown', short: 'Brn' },
    recessive: { name: 'Blue', short: 'Blu' },
    example: 'Brown eye colour (B) is dominant over blue (b). Note: real eye colour involves multiple genes; this is a simplified model.'
  },
  {
    id: 'tongue-rolling',
    name: 'Tongue Rolling',
    icon: 'ðŸ‘…',
    letter: 'T',
    dominant: { name: 'Roller', short: 'Rol' },
    recessive: { name: 'Non-roller', short: 'Non' },
    example: 'The ability to roll the tongue (T) is traditionally described as dominant over non-rolling (t), though it is more complex in reality.'
  },
  {
    id: 'earlobe',
    name: 'Earlobe Type',
    icon: 'ðŸ‘‚',
    letter: 'E',
    dominant: { name: 'Free', short: 'Fre' },
    recessive: { name: 'Attached', short: 'Att' },
    example: 'Free earlobes (E) are dominant over attached earlobes (e). A classic example used in human genetics.'
  },
  {
    id: 'plant-height',
    name: 'Plant Height',
    icon: 'ðŸŒ±',
    letter: 'H',
    dominant: { name: 'Tall', short: 'Tal' },
    recessive: { name: 'Short', short: 'Sht' },
    example: 'Tall (H) is dominant over short (h) plant height, another of Mendel\'s original seven traits.'
  },
  {
    id: 'pod-colour',
    name: 'Pod Colour',
    icon: 'ðŸŸ©',
    letter: 'G',
    dominant: { name: 'Green', short: 'Grn' },
    recessive: { name: 'Yellow', short: 'Yel' },
    example: 'Green pod colour (G) is dominant over yellow (g) in pea plants. Mendel observed this in his breeding experiments.'
  }
];

/* ======================================================
   STATE
====================================================== */
let isDihybrid = false;
let selectedTraitAId = TRAITS[0].id;
let selectedTraitBId = TRAITS[1].id;
let parent1GenoA = 'Bb';
let parent2GenoA = 'Bb';
let parent1GenoB = 'Bb';
let parent2GenoB = 'Bb';

/* ======================================================
   HELPERS
====================================================== */
function getTraitById(id) {
  return TRAITS.find(t => t.id === id);
}

// Produce gametes for a single-gene genotype e.g. "Bb" -> ["B","b"]
function gametes1(geno) {
  return [geno[0], geno[1]];
}

// Cross two allele arrays, return all combinations
function crossAlleles(g1, g2) {
  const cells = [];
  for (let a of g1) {
    for (let b of g2) {
      cells.push(sortAlleles(a, b));
    }
  }
  return cells;
}

// Sort so dominant (uppercase) comes first
function sortAlleles(a, b) {
  if (a === a.toUpperCase() && b === b.toLowerCase()) return a + b;
  if (b === b.toUpperCase() && a === a.toLowerCase()) return b + a;
  return a + b;
}

function isDominantPhenotype(geno) {
  return geno[0] === geno[0].toUpperCase();
}

function phenoClass(geno) {
  const a1 = geno[0];
  const a2 = geno[1];
  const isDomA1 = a1 === a1.toUpperCase();
  const isDomA2 = a2 === a2.toUpperCase();
  if (isDomA1 && isDomA2) return 'pheno-dominant';
  if (isDomA1 || isDomA2) return 'pheno-heterozygous';
  return 'pheno-recessive';
}

function phenoName1(geno, trait) {
  return isDominantPhenotype(geno) ? trait.dominant.short : trait.recessive.short;
}

// For dihybrid: phenotype name from two genotypes
function phenoNameDi(genoA, genoB, traitA, traitB) {
  const pa = isDominantPhenotype(genoA) ? traitA.dominant.short : traitA.recessive.short;
  const pb = isDominantPhenotype(genoB) ? traitB.dominant.short : traitB.recessive.short;
  return pa + '/' + pb;
}

function phenoClassDi(genoA, genoB) {
  const ca = phenoClass(genoA);
  const cb = phenoClass(genoB);
  // Priority: both recessive < het in either < both dominant
  if (ca === 'pheno-recessive' && cb === 'pheno-recessive') return 'pheno-recessive';
  const domA = isDominantPhenotype(genoA);
  const domB = isDominantPhenotype(genoB);
  if (domA && domB) return 'pheno-dominant';
  return 'pheno-heterozygous';
}

// Count occurrences in array
function countMap(arr) {
  const m = {};
  for (const v of arr) m[v] = (m[v] || 0) + 1;
  return m;
}

// Allele options for single gene
function allelesForTrait(trait) {
  const L = trait.letter;
  const l = L.toLowerCase();
  return [L+L, L+l, l+l];
}

// Dihybrid parent genotype from two single genotypes
function combinedGeno(genoA, genoB) {
  return genoA + genoB;
}

// Gametes for dihybrid parent e.g. AaBb -> [AB, Ab, aB, ab]
function gametesDi(genoA, genoB) {
  const gA = gametes1(genoA);
  const gB = gametes1(genoB);
  const out = [];
  for (const a of gA) for (const b of gB) out.push(a + b);
  return out;
}

// Parse dihybrid gamete pair into two genotypes
function parseDiGametePair(g1, g2, traitA, traitB) {
  // g1 = e.g. "AB", g2 = e.g. "ab"
  const genoA = sortAlleles(g1[0], g2[0]);
  const genoB = sortAlleles(g1[1], g2[1]);
  return { genoA, genoB };
}

/* ======================================================
   RENDER TRAIT BUTTONS
====================================================== */
function renderTraitGrid(containerId, selectedId, onSelect, excludeId) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  TRAITS.forEach(trait => {
    if (excludeId && trait.id === excludeId) return;
    const btn = document.createElement('button');
    btn.className = 'trait-btn' + (trait.id === selectedId ? ' active' : '');
    btn.textContent = trait.icon + ' ' + trait.name;
    btn.addEventListener('click', () => onSelect(trait.id));
    container.appendChild(btn);
  });
}

function renderAlleleButtons(containerId, trait, currentGeno, onChange) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  const options = allelesForTrait(trait);
  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'allele-btn' + (opt === currentGeno ? ' active' : '');
    btn.textContent = opt;
    btn.addEventListener('click', () => onChange(opt));
    container.appendChild(btn);
  });
}

/* ======================================================
   BUILD MONOHYBRID PUNNETT SQUARE
====================================================== */
function buildMonohybrid(traitA, p1, p2) {
  const row1 = gametes1(p1);
  const row2 = gametes1(p2);

  let html = '<table class="punnett">';
  // Header row
  html += '<tr>';
  html += '<th class="corner"></th>';
  row2.forEach(g => { html += `<th>${g}</th>`; });
  html += '</tr>';
  // Data rows
  row1.forEach(r => {
    html += '<tr>';
    html += `<th>${r}</th>`;
    row2.forEach(c => {
      const geno = sortAlleles(r, c);
      const cls = phenoClass(geno);
      const pheno = phenoName1(geno, traitA);
      html += `<td class="${cls}"><span class="cell-genotype">${geno}</span><span class="cell-phenotype">${pheno}</span></td>`;
    });
    html += '</tr>';
  });
  html += '</table>';
  return html;
}

/* ======================================================
   BUILD DIHYBRID PUNNETT SQUARE
====================================================== */
function buildDihybrid(traitA, traitB, p1A, p1B, p2A, p2B) {
  const g1 = gametesDi(p1A, p1B);
  const g2 = gametesDi(p2A, p2B);

  let html = '<table class="punnett dihybrid">';
  // Header row
  html += '<tr>';
  html += '<th class="corner"></th>';
  g2.forEach(g => { html += `<th>${g}</th>`; });
  html += '</tr>';
  // Data rows
  g1.forEach(rg => {
    html += '<tr>';
    html += `<th>${rg}</th>`;
    g2.forEach(cg => {
      const { genoA, genoB } = parseDiGametePair(rg, cg, traitA, traitB);
      const cls = phenoClassDi(genoA, genoB);
      const pname = phenoNameDi(genoA, genoB, traitA, traitB);
      html += `<td class="${cls}"><span class="cell-genotype">${genoA}${genoB}</span><span class="cell-phenotype">${pname}</span></td>`;
    });
    html += '</tr>';
  });
  html += '</table>';
  return html;
}

/* ======================================================
   COMPUTE MONOHYBRID RATIOS
====================================================== */
function computeMonoRatios(traitA, p1, p2) {
  const g1 = gametes1(p1);
  const g2 = gametes1(p2);
  const cells = crossAlleles(g1, g2);

  const genoCounts = countMap(cells);

  // Phenotype grouping
  const phenoCounts = {};
  cells.forEach(geno => {
    const pname = isDominantPhenotype(geno) ? traitA.dominant.name : traitA.recessive.name;
    phenoCounts[pname] = (phenoCounts[pname] || 0) + 1;
  });

  return { genoCounts, phenoCounts, total: cells.length };
}

/* ======================================================
   COMPUTE DIHYBRID RATIOS
====================================================== */
function computeDiRatios(traitA, traitB, p1A, p1B, p2A, p2B) {
  const g1 = gametesDi(p1A, p1B);
  const g2 = gametesDi(p2A, p2B);

  const genoCells = [];
  const phenoCells = [];

  g1.forEach(rg => {
    g2.forEach(cg => {
      const { genoA, genoB } = parseDiGametePair(rg, cg, traitA, traitB);
      genoCells.push(genoA + genoB);
      const pa = isDominantPhenotype(genoA) ? traitA.dominant.name : traitA.recessive.name;
      const pb = isDominantPhenotype(genoB) ? traitB.dominant.name : traitB.recessive.name;
      phenoCells.push(pa + ' / ' + pb);
    });
  });

  const genoCounts = countMap(genoCells);
  const phenoCounts = countMap(phenoCells);

  return { genoCounts, phenoCounts, total: genoCells.length };
}

/* ======================================================
   RENDER RATIOS
====================================================== */
const SWATCH_COLORS = {
  'pheno-dominant': { bg: '#2e7d52', border: '#1a5c3a' },
  'pheno-heterozygous': { bg: '#80cbc4', border: '#00897b' },
  'pheno-recessive': { bg: '#f9a825', border: '#e65100' }
};

function genoToClass(geno) {
  const a1 = geno[0];
  const a2 = geno[1];
  const d1 = a1 === a1.toUpperCase();
  const d2 = a2 === a2.toUpperCase();
  if (d1 && d2) return 'pheno-dominant';
  if (d1 || d2) return 'pheno-heterozygous';
  return 'pheno-recessive';
}

function genoToClassDi(genoStr) {
  // e.g. AaBb, AABB, aabb
  const genoA = genoStr.slice(0, 2);
  const genoB = genoStr.slice(2, 4);
  return phenoClassDi(genoA, genoB);
}

function renderRatiosHTML(genoCounts, phenoCounts, total, isDi) {
  const genoEntries = Object.entries(genoCounts).sort((a, b) => b[1] - a[1]);
  const phenoEntries = Object.entries(phenoCounts).sort((a, b) => b[1] - a[1]);

  function swatchStyle(cls) {
    const c = SWATCH_COLORS[cls];
    return `background:${c.bg};border:1px solid ${c.border};`;
  }

  function buildList(entries, classFunc) {
    const ratioVals = entries.map(e => e[1]);
    const gcd = ratioVals.reduce((a, b) => { while (b) { [a, b] = [b, a % b]; } return a; }, ratioVals[0]);
    let html = '<ul class="ratio-list">';
    entries.forEach(([key, count]) => {
      const cls = classFunc(key);
      const frac = count / total;
      const pct = (frac * 100).toFixed(1);
      const ratioN = count / gcd;
      html += `<li>
        <span class="ratio-swatch" style="${swatchStyle(cls)}"></span>
        <span class="ratio-fraction">${ratioN}</span>
        <span class="ratio-label">${key} &mdash; ${pct}%</span>
      </li>`;
    });
    html += '</ul>';
    // Ratio string
    const ratioStr = entries.map(e => e[1] / gcd).join(' : ');
    html += `<p style="font-size:0.8rem;margin-top:0.5rem;color:var(--text-muted);">Ratio: <strong style="color:var(--green-dark)">${ratioStr}</strong></p>`;
    return html;
  }

  const genoHTML = buildList(genoEntries, isDi ? genoToClassDi : genoToClass);
  const phenoHTML = buildList(phenoEntries, (key) => {
    // Map phenotype name back to class
    if (!isDi) {
      // We need the trait info but we just check dominant vs recessive from counts
      // Since phenotype entries are dominant/recessive names, we check count rank
      // Actually we use a simpler approach: check if entry is in top count
      // We'll use a heuristic: if only one entry, recessive if count < total
    }
    // For simplicity: use color by order (most common = dominant if >1 phenotype)
    if (phenoEntries.length === 1) return 'pheno-dominant';
    const rank = phenoEntries.findIndex(e => e[0] === key);
    const classes = ['pheno-dominant', 'pheno-heterozygous', 'pheno-recessive', 'pheno-recessive'];
    return classes[rank] || 'pheno-recessive';
  });

  return `
    <div class="ratio-block">
      <h4>Genotype Ratios</h4>
      ${genoHTML}
    </div>
    <div class="ratio-block">
      <h4>Phenotype Ratios</h4>
      ${phenoHTML}
    </div>
  `;
}

/* ======================================================
   PROBABILITY NOTE
====================================================== */
function buildProbNote(phenoCounts, total) {
  const entries = Object.entries(phenoCounts).sort((a, b) => b[1] - a[1]);
  if (entries.length === 0) return '';
  const parts = entries.map(([name, count]) => {
    const pct = ((count / total) * 100).toFixed(1);
    const frac = count + '/' + total;
    return `${name}: ${frac} (${pct}%)`;
  });
  return 'Probability per offspring: ' + parts.join('; ') + '.';
}

/* ======================================================
   SIMULATION
====================================================== */
function pickWeighted(probMap) {
  const entries = Object.entries(probMap);
  const r = Math.random();
  let cum = 0;
  for (const [key, p] of entries) {
    cum += p;
    if (r < cum) return key;
  }
  return entries[entries.length - 1][0];
}

function runSimulation(n) {
  const traitA = getTraitById(selectedTraitAId);
  const traitB = getTraitById(selectedTraitBId);

  let expected;
  let labelFn;
  let colorFn;

  if (!isDihybrid) {
    const { phenoCounts, total } = computeMonoRatios(traitA, parent1GenoA, parent2GenoA);
    const probMap = {};
    Object.entries(phenoCounts).forEach(([k, v]) => { probMap[k] = v / total; });

    expected = {};
    Object.entries(probMap).forEach(([k, v]) => { expected[k] = v * n; });

    const actual = {};
    for (let i = 0; i < n; i++) {
      const pick = pickWeighted(probMap);
      actual[pick] = (actual[pick] || 0) + 1;
    }

    // Ensure all keys present
    Object.keys(expected).forEach(k => { if (!actual[k]) actual[k] = 0; });

    labelFn = k => k;
    colorFn = (k, rank) => {
      const sorted = Object.keys(expected).sort((a, b) => expected[b] - expected[a]);
      const r = sorted.indexOf(k);
      return ['var(--dominant-bg)', 'var(--het-bg)', 'var(--recessive-bg)'][r] || 'var(--teal-mid)';
    };

    return { actual, expected, n, labelFn, colorFn };
  } else {
    const { phenoCounts, total } = computeDiRatios(traitA, traitB, parent1GenoA, parent1GenoB, parent2GenoA, parent2GenoB);
    const probMap = {};
    Object.entries(phenoCounts).forEach(([k, v]) => { probMap[k] = v / total; });

    expected = {};
    Object.entries(probMap).forEach(([k, v]) => { expected[k] = v * n; });

    const actual = {};
    for (let i = 0; i < n; i++) {
      const pick = pickWeighted(probMap);
      actual[pick] = (actual[pick] || 0) + 1;
    }

    Object.keys(expected).forEach(k => { if (!actual[k]) actual[k] = 0; });

    labelFn = k => k;
    const sortedKeys = Object.keys(expected).sort((a, b) => expected[b] - expected[a]);
    const diColors = ['var(--dominant-bg)', 'var(--het-bg)', 'var(--recessive-bg)', '#7e57c2'];
    colorFn = (k) => {
      const r = sortedKeys.indexOf(k);
      return diColors[r] || 'var(--teal-mid)';
    };

    return { actual, expected, n, labelFn, colorFn };
  }
}

function renderSimulation(result) {
  const { actual, expected, n, colorFn } = result;
  const sortedKeys = Object.keys(expected).sort((a, b) => expected[b] - expected[a]);
  const maxExpected = Math.max(...Object.values(expected));

  let html = '<div class="bar-chart">';
  sortedKeys.forEach(key => {
    const act = actual[key] || 0;
    const exp = expected[key];
    const maxVal = Math.max(act, exp, maxExpected);
    const actPct = maxVal > 0 ? (act / maxVal * 100).toFixed(1) : 0;
    const expPct = maxVal > 0 ? (exp / maxVal * 100).toFixed(1) : 0;
    const color = colorFn(key);
    const label = key.length > 22 ? key.substring(0, 20) + '...' : key;

    html += `
      <div class="bar-row">
        <span class="bar-row-label" title="${key}">${label}</span>
        <div class="bar-track">
          <div class="bar-fill-actual" style="width:${actPct}%;background:${color};"></div>
          <div class="bar-fill-expected" style="left:${expPct}%;"></div>
        </div>
        <span class="bar-row-value">${act}/${Math.round(exp)}</span>
      </div>`;
  });
  html += '</div>';
  html += `
    <div class="sim-legend">
      <div class="sim-legend-item"><span class="sim-legend-swatch actual"></span> Actual count</div>
      <div class="sim-legend-item"><span class="sim-legend-swatch expected"></span> Expected count</div>
    </div>`;
  html += `<p style="font-size:0.8rem;color:var(--text-muted);margin-top:0.6rem;">Total simulated: <strong>${n}</strong>. Values shown as actual/expected. The more offspring simulated, the closer results approach the expected ratio.</p>`;
  return html;
}

/* ======================================================
   MAIN RENDER
====================================================== */
function render() {
  const traitA = getTraitById(selectedTraitAId);
  const traitB = getTraitById(selectedTraitBId);

  // Trait A heading
  document.getElementById('trait-a-heading').textContent = isDihybrid ? 'Trait A (first gene)' : 'Trait';

  // Trait info bar
  let infoText = `<strong>${traitA.icon} ${traitA.name}:</strong> ${traitA.example} `;
  infoText += `Dominant allele: <strong>${traitA.letter}</strong> (${traitA.dominant.name}). Recessive allele: <strong>${traitA.letter.toLowerCase()}</strong> (${traitA.recessive.name}).`;
  if (isDihybrid) {
    infoText += `<br><strong>${traitB.icon} ${traitB.name} (Trait B):</strong> ${traitB.example} `;
    infoText += `Dominant: <strong>${traitB.letter}</strong> (${traitB.dominant.name}). Recessive: <strong>${traitB.letter.toLowerCase()}</strong> (${traitB.recessive.name}).`;
  }
  document.getElementById('trait-info-bar').innerHTML = infoText;

  // Render trait grids
  renderTraitGrid('trait-a-grid', selectedTraitAId, (id) => {
    selectedTraitAId = id;
    // Reset alleles to Bb
    parent1GenoA = getTraitById(id).letter + getTraitById(id).letter.toLowerCase();
    parent2GenoA = getTraitById(id).letter + getTraitById(id).letter.toLowerCase();
    render();
  }, isDihybrid ? selectedTraitBId : null);

  if (isDihybrid) {
    renderTraitGrid('trait-b-grid', selectedTraitBId, (id) => {
      selectedTraitBId = id;
      parent1GenoB = getTraitById(id).letter + getTraitById(id).letter.toLowerCase();
      parent2GenoB = getTraitById(id).letter + getTraitById(id).letter.toLowerCase();
      render();
    }, selectedTraitAId);
  }

  // Allele buttons for Parent 1 and Parent 2
  if (!isDihybrid) {
    renderAlleleButtons('p1-btns', traitA, parent1GenoA, (g) => { parent1GenoA = g; render(); });
    renderAlleleButtons('p2-btns', traitA, parent2GenoA, (g) => { parent2GenoA = g; render(); });
  } else {
    // Show combined genotype buttons: for A and B independently
    // P1 block: show traitA alleles + traitB alleles side by side
    renderDiAlleleButtons('p1-btns', traitA, traitB, parent1GenoA, parent1GenoB, (gA, gB) => {
      parent1GenoA = gA;
      parent1GenoB = gB;
      render();
    });
    renderDiAlleleButtons('p2-btns', traitA, traitB, parent2GenoA, parent2GenoB, (gA, gB) => {
      parent2GenoA = gA;
      parent2GenoB = gB;
      render();
    });
  }

  // Punnett square
  const punnettOut = document.getElementById('punnett-output');
  if (!isDihybrid) {
    punnettOut.innerHTML = buildMonohybrid(traitA, parent1GenoA, parent2GenoA);
  } else {
    punnettOut.innerHTML = buildDihybrid(traitA, traitB, parent1GenoA, parent1GenoB, parent2GenoA, parent2GenoB);
  }

  // Ratios
  const ratiosOut = document.getElementById('ratios-output');
  const probNoteEl = document.getElementById('prob-note');
  let genoCounts, phenoCounts, total;

  if (!isDihybrid) {
    const result = computeMonoRatios(traitA, parent1GenoA, parent2GenoA);
    genoCounts = result.genoCounts;
    phenoCounts = result.phenoCounts;
    total = result.total;
  } else {
    const result = computeDiRatios(traitA, traitB, parent1GenoA, parent1GenoB, parent2GenoA, parent2GenoB);
    genoCounts = result.genoCounts;
    phenoCounts = result.phenoCounts;
    total = result.total;
  }

  ratiosOut.innerHTML = renderRatiosHTML(genoCounts, phenoCounts, total, isDihybrid);
  probNoteEl.style.display = 'block';
  probNoteEl.textContent = buildProbNote(phenoCounts, total);

  // Clear simulation
  document.getElementById('sim-output').innerHTML = '<div class="empty-state">Click "Run Simulation" to generate offspring data.</div>';
}

/* ======================================================
   DIHYBRID ALLELE BUTTONS
====================================================== */
function renderDiAlleleButtons(containerId, traitA, traitB, currentGenoA, currentGenoB, onChange) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';

  const optionsA = allelesForTrait(traitA);
  const optionsB = allelesForTrait(traitB);

  // Small label
  const lblA = document.createElement('div');
  lblA.style.cssText = 'font-size:0.72rem;color:var(--text-muted);font-weight:700;width:100%;margin-bottom:2px;text-transform:uppercase;letter-spacing:0.04em;';
  lblA.textContent = 'Trait A:';
  container.appendChild(lblA);

  optionsA.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'allele-btn' + (opt === currentGenoA ? ' active' : '');
    btn.textContent = opt;
    btn.addEventListener('click', () => onChange(opt, currentGenoB));
    container.appendChild(btn);
  });

  const lblB = document.createElement('div');
  lblB.style.cssText = 'font-size:0.72rem;color:var(--text-muted);font-weight:700;width:100%;margin:6px 0 2px;text-transform:uppercase;letter-spacing:0.04em;';
  lblB.textContent = 'Trait B:';
  container.appendChild(lblB);

  optionsB.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'allele-btn' + (opt === currentGenoB ? ' active' : '');
    btn.textContent = opt;
    btn.addEventListener('click', () => onChange(currentGenoA, opt));
    container.appendChild(btn);
  });
}

/* ======================================================
   EVENT LISTENERS
====================================================== */
document.getElementById('toggle-dihybrid').addEventListener('change', function() {
  isDihybrid = this.checked;
  document.getElementById('mode-label').textContent = isDihybrid
    ? 'Dihybrid cross (2 traits)'
    : 'Monohybrid cross (1 trait)';
  document.getElementById('trait-b-section').style.display = isDihybrid ? '' : 'none';
  document.getElementById('dihybrid-info').classList.toggle('visible', isDihybrid);

  // Ensure B trait differs from A
  if (isDihybrid && selectedTraitBId === selectedTraitAId) {
    selectedTraitBId = TRAITS.find(t => t.id !== selectedTraitAId).id;
    const tb = getTraitById(selectedTraitBId);
    parent1GenoB = tb.letter + tb.letter.toLowerCase();
    parent2GenoB = tb.letter + tb.letter.toLowerCase();
  }
  render();
});

document.getElementById('btn-simulate').addEventListener('click', () => {
  const n = parseInt(document.getElementById('sim-n').value, 10);
  const result = runSimulation(n);
  document.getElementById('sim-output').innerHTML = renderSimulation(result);
});

document.getElementById('btn-reset-sim').addEventListener('click', () => {
  document.getElementById('sim-output').innerHTML = '<div class="empty-state">Click "Run Simulation" to generate offspring data.</div>';
});

/* ======================================================
   INIT
====================================================== */
// Default: Bb x Bb
parent1GenoA = TRAITS[0].letter + TRAITS[0].letter.toLowerCase();
parent2GenoA = TRAITS[0].letter + TRAITS[0].letter.toLowerCase();
parent1GenoB = TRAITS[1].letter + TRAITS[1].letter.toLowerCase();
parent2GenoB = TRAITS[1].letter + TRAITS[1].letter.toLowerCase();
selectedTraitBId = TRAITS[1].id;

render();
</script>
</body>
</html>
