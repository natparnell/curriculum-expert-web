<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Electromagnetic Spectrum Explorer</title>
  <style>
    :root {
      --green-dark:    #1a3a2a;
      --green-mid:     #2d6a4f;
      --green-light:   #52b788;
      --green-pale:    #b7e4c7;
      --green-bg:      #f0faf4;
      --accent:        #1b4332;
      --accent-light:  #40916c;
      --text-main:     #1a2e22;
      --text-muted:    #4a7060;
      --card-bg:       #ffffff;
      --border:        #c8e6d4;
      --shadow:        0 2px 12px rgba(29,74,50,0.10);
      --radius:        10px;
      --header-h:      60px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--green-bg);
      color: var(--text-main);
      min-height: 100vh;
    }

    /* ── HEADER ───────────────────────────────────────── */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      height: var(--header-h);
      background: var(--green-dark);
      display: flex;
      align-items: center;
      padding: 0 1.5rem;
      gap: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    header .icon {
      width: 36px; height: 36px;
      background: var(--green-light);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    header h1 {
      color: #fff;
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: 0.01em;
    }

    header .subtitle {
      color: var(--green-pale);
      font-size: 0.8rem;
      margin-top: 1px;
    }

    header .formula-badge {
      margin-left: auto;
      background: var(--green-mid);
      color: #fff;
      padding: 0.3rem 0.85rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-style: italic;
      letter-spacing: 0.03em;
      white-space: nowrap;
    }

    /* ── MAIN LAYOUT ───────────────────────────────────── */
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.25rem 1rem 2.5rem;
    }

    /* ── INFO PANEL ────────────────────────────────────── */
    .info-panel {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-left: 4px solid var(--green-light);
      border-radius: var(--radius);
      padding: 1rem 1.25rem;
      margin-bottom: 1.25rem;
      box-shadow: var(--shadow);
    }

    .info-panel summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--accent);
      font-size: 0.95rem;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      user-select: none;
    }

    .info-panel summary::before {
      content: '▶';
      font-size: 0.65rem;
      transition: transform 0.2s;
      color: var(--green-light);
    }

    .info-panel[open] summary::before { transform: rotate(90deg); }

    .info-body {
      margin-top: 0.85rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 0.85rem;
    }

    .info-card {
      background: var(--green-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.75rem 1rem;
    }

    .info-card h3 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--accent-light);
      margin-bottom: 0.4rem;
    }

    .info-card p {
      font-size: 0.875rem;
      color: var(--text-main);
      line-height: 1.5;
    }

    .info-card .eq {
      font-family: 'Courier New', monospace;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--green-dark);
      margin: 0.3rem 0;
    }

    /* ── SPECTRUM SECTION ──────────────────────────────── */
    .spectrum-section {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      margin-bottom: 1.25rem;
      box-shadow: var(--shadow);
    }

    .section-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent-light);
      font-weight: 600;
      margin-bottom: 0.9rem;
    }

    /* Quick-select buttons */
    .region-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
      margin-bottom: 1rem;
    }

    .region-btn {
      padding: 0.35rem 0.85rem;
      border: 2px solid transparent;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.18s;
      color: #fff;
    }

    .region-btn:hover { filter: brightness(1.15); transform: translateY(-1px); }
    .region-btn.active { border-color: var(--green-dark); box-shadow: 0 0 0 3px rgba(29,74,50,0.18); }

    /* Spectrum bar wrapper */
    .spectrum-wrapper {
      position: relative;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .spectrum-bar-container {
      position: relative;
      min-width: 600px;
      height: 110px;
      margin-bottom: 0.5rem;
    }

    /* Colour gradient bar */
    #spectrumCanvas {
      width: 100%;
      height: 60px;
      border-radius: 8px;
      cursor: pointer;
      display: block;
    }

    /* Draggable pointer */
    .pointer-track {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      pointer-events: none;
    }

    #pointer {
      position: absolute;
      top: -6px;
      width: 22px;
      height: 72px;
      transform: translateX(-50%);
      cursor: grab;
      pointer-events: all;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
      z-index: 10;
    }

    #pointer:active { cursor: grabbing; }

    .pointer-arrow {
      width: 0; height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 10px solid var(--green-dark);
      flex-shrink: 0;
    }

    .pointer-line {
      width: 3px;
      flex: 1;
      background: var(--green-dark);
      opacity: 0.85;
      border-radius: 2px;
    }

    /* Axis labels */
    .axis-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.68rem;
      color: var(--text-muted);
      padding: 0 2px;
      margin-top: 2px;
      min-width: 600px;
    }

    .axis-label { text-align: center; }

    /* Region label band */
    .region-label-band {
      display: flex;
      min-width: 600px;
      height: 24px;
      border-radius: 0 0 6px 6px;
      overflow: hidden;
      margin-top: 6px;
    }

    .region-seg {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.6rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.92);
      cursor: pointer;
      transition: filter 0.15s;
      white-space: nowrap;
      overflow: hidden;
    }

    .region-seg:hover { filter: brightness(1.2); }
    .region-seg.active-seg { outline: 3px solid #fff; outline-offset: -3px; }

    /* ── SLIDERS ───────────────────────────────────────── */
    .sliders-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    @media (max-width: 560px) {
      .sliders-row { grid-template-columns: 1fr; }
    }

    .slider-group label {
      display: flex;
      justify-content: space-between;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 0.35rem;
    }

    .slider-group label span {
      font-weight: 400;
      color: var(--text-muted);
      font-size: 0.78rem;
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      appearance: none;
      background: var(--green-pale);
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 18px; height: 18px;
      border-radius: 50%;
      background: var(--green-mid);
      border: 2px solid #fff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
      cursor: grab;
    }

    input[type="range"]::-webkit-slider-thumb:active { cursor: grabbing; background: var(--green-dark); }
    input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px;
      border-radius: 50%;
      background: var(--green-mid);
      border: 2px solid #fff;
      cursor: grab;
    }

    /* ── BOTTOM GRID ───────────────────────────────────── */
    .bottom-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.25rem;
    }

    @media (max-width: 768px) {
      .bottom-grid { grid-template-columns: 1fr; }
    }

    /* ── PROPERTIES PANEL ──────────────────────────────── */
    .properties-panel {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      box-shadow: var(--shadow);
    }

    .region-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding-bottom: 0.85rem;
      border-bottom: 2px solid var(--border);
    }

    .region-colour-dot {
      width: 18px; height: 18px;
      border-radius: 50%;
      flex-shrink: 0;
      box-shadow: 0 1px 4px rgba(0,0,0,0.18);
    }

    .region-name {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--green-dark);
    }

    .props-grid {
      display: grid;
      gap: 0.65rem;
    }

    .prop-row {
      display: grid;
      grid-template-columns: 130px 1fr;
      gap: 0.5rem;
      align-items: start;
      font-size: 0.875rem;
    }

    .prop-label {
      font-weight: 600;
      color: var(--text-muted);
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding-top: 1px;
    }

    .prop-value {
      color: var(--text-main);
      line-height: 1.45;
    }

    .prop-value.mono {
      font-family: 'Courier New', monospace;
      font-size: 0.92rem;
      font-weight: 600;
      color: var(--green-dark);
    }

    .danger-tag {
      display: inline-block;
      padding: 0.15rem 0.55rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .danger-none  { background: #d1fae5; color: #065f46; }
    .danger-low   { background: #fef9c3; color: #713f12; }
    .danger-med   { background: #fed7aa; color: #7c2d12; }
    .danger-high  { background: #fecaca; color: #7f1d1d; }

    /* uses list */
    .uses-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.1rem;
    }

    .use-chip {
      background: var(--green-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 0.15rem 0.6rem;
      font-size: 0.76rem;
      color: var(--accent);
      font-weight: 500;
    }

    /* visible light swatch */
    .vis-swatch {
      height: 18px;
      border-radius: 4px;
      background: linear-gradient(to right, #7b00d4, #4400ff, #00aaff, #00cc44, #aaff00, #ffee00, #ff7700, #ff0000);
      margin-top: 0.3rem;
    }

    /* ── WAVE CANVAS ───────────────────────────────────── */
    .wave-panel {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
    }

    #waveCanvas {
      width: 100%;
      border-radius: 8px;
      background: #0d1f17;
      flex: 1;
      min-height: 220px;
      display: block;
    }

    .wave-info {
      margin-top: 0.75rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .wave-info strong { color: var(--accent); }

    /* ── DETECTION BADGE ────────────────────────────────── */
    .detection-box {
      margin-top: 0.75rem;
      background: var(--green-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.65rem 0.9rem;
    }

    .detection-box h4 {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--accent-light);
      margin-bottom: 0.3rem;
    }

    .detection-box p {
      font-size: 0.83rem;
      color: var(--text-main);
      line-height: 1.5;
    }

    /* ── RESPONSIVE ─────────────────────────────────────── */
    @media (max-width: 768px) {
      header h1 { font-size: 1rem; }
      header .subtitle { display: none; }
      .formula-badge { display: none; }
      .prop-row { grid-template-columns: 110px 1fr; }
    }

    @media (max-width: 480px) {
      main { padding: 0.75rem 0.5rem 2rem; }
      .region-btn { font-size: 0.72rem; padding: 0.3rem 0.65rem; }
    }
  </style>
</head>
<body>

<header>
  <div class="icon">⚡</div>
  <div>
    <h1>Electromagnetic Spectrum Explorer</h1>
    <div class="subtitle">Drag the pointer or use the buttons to explore each region</div>
  </div>
  <div class="formula-badge">c = f &lambda;</div>
</header>

<main>

  <!-- INFO PANEL -->
  <details class="info-panel">
    <summary>About Electromagnetic Waves</summary>
    <div class="info-body">
      <div class="info-card">
        <h3>What are EM Waves?</h3>
        <p>Electromagnetic waves are oscillating electric and magnetic fields that travel through a vacuum at the speed of light. Unlike sound, they require no medium.</p>
      </div>
      <div class="info-card">
        <h3>The Key Equation</h3>
        <div class="eq">c = f &times; &lambda;</div>
        <p><strong>c</strong> = speed of light (3 &times; 10&sup8; m/s)<br><strong>f</strong> = frequency (Hz)<br><strong>&lambda;</strong> = wavelength (m)</p>
      </div>
      <div class="info-card">
        <h3>The Spectrum</h3>
        <p>All EM waves travel at the same speed in a vacuum. Higher frequency means shorter wavelength and more energy per photon. The full range spans over 20 orders of magnitude.</p>
      </div>
      <div class="info-card">
        <h3>Energy &amp; Frequency</h3>
        <p>Photon energy is given by <strong>E = hf</strong> where <em>h</em> is Planck's constant (6.63 &times; 10&#8315;&sup3;&sup4; J&middot;s). Higher frequency = more energetic = more potentially harmful.</p>
      </div>
    </div>
  </details>

  <!-- SPECTRUM SECTION -->
  <div class="spectrum-section">
    <div class="section-title">Spectrum Navigator</div>

    <!-- Quick-select buttons -->
    <div class="region-buttons" id="regionButtons"></div>

    <!-- Spectrum bar -->
    <div class="spectrum-wrapper">
      <div class="spectrum-bar-container" id="barContainer">
        <canvas id="spectrumCanvas" height="60"></canvas>
        <div class="pointer-track">
          <div id="pointer">
            <div class="pointer-arrow"></div>
            <div class="pointer-line"></div>
          </div>
        </div>
      </div>
      <div class="region-label-band" id="regionBand"></div>
      <div class="axis-labels" id="axisLabels"></div>
    </div>

    <!-- Sliders -->
    <div class="sliders-row">
      <div class="slider-group">
        <label>Wavelength <span id="wlDisplay">—</span></label>
        <input type="range" id="wlSlider" min="0" max="1000" value="500" />
      </div>
      <div class="slider-group">
        <label>Frequency <span id="freqDisplay">—</span></label>
        <input type="range" id="freqSlider" min="0" max="1000" value="500" />
      </div>
    </div>
  </div>

  <!-- BOTTOM GRID -->
  <div class="bottom-grid">

    <!-- Properties Panel -->
    <div class="properties-panel">
      <div class="section-title">Region Properties</div>
      <div class="region-header">
        <div class="region-colour-dot" id="regionDot"></div>
        <div class="region-name" id="regionName">—</div>
      </div>
      <div class="props-grid">
        <div class="prop-row">
          <div class="prop-label">Wavelength</div>
          <div class="prop-value mono" id="propWavelength">—</div>
        </div>
        <div class="prop-row">
          <div class="prop-label">Frequency</div>
          <div class="prop-value mono" id="propFrequency">—</div>
        </div>
        <div class="prop-row">
          <div class="prop-label">Photon Energy</div>
          <div class="prop-value mono" id="propEnergy">—</div>
        </div>
        <div class="prop-row">
          <div class="prop-label">Uses</div>
          <div class="prop-value" id="propUses">—</div>
        </div>
        <div class="prop-row">
          <div class="prop-label">Danger Level</div>
          <div class="prop-value" id="propDanger">—</div>
        </div>
        <div id="visSwatchRow" class="prop-row" style="display:none">
          <div class="prop-label">Colour Range</div>
          <div class="prop-value"><div class="vis-swatch"></div></div>
        </div>
      </div>

      <div class="detection-box">
        <h4>Detection / Instruments</h4>
        <p id="propDetection">—</p>
      </div>
    </div>

    <!-- Wave Animation Panel -->
    <div class="wave-panel">
      <div class="section-title">Wave Visualisation</div>
      <canvas id="waveCanvas" height="220"></canvas>
      <div class="wave-info">
        <strong id="waveLabel">—</strong> &mdash;
        <span id="waveDesc">Select a region to see its wave characteristics.</span>
      </div>
    </div>

  </div>
</main>

<script>
(function () {
  'use strict';

  // ─── CONSTANTS ──────────────────────────────────────────────────────────────
  const C = 3e8;        // speed of light m/s
  const H = 6.626e-34;  // Planck's constant

  // ─── REGION DATA ────────────────────────────────────────────────────────────
  // logPos: 0–1 position on a log10 scale from 10^-1 Hz to 10^25 Hz (mapped to slider)
  // We define spectrum in terms of log10(frequency / Hz)
  const LOG_MIN = 4;   // 10^4 Hz  (long radio)
  const LOG_MAX = 24;  // 10^24 Hz (gamma)

  const REGIONS = [
    {
      id: 'radio',
      name: 'Radio Waves',
      colour: '#4a1577',
      logFreqMin: 4,
      logFreqMax: 9,
      wavelengthRange: '1 mm – 100 km',
      frequencyRange: '3 kHz – 300 GHz',
      uses: ['AM/FM radio', 'Television', 'Radar', 'Wi-Fi', 'Mobile phones', 'MRI scanning'],
      danger: 'none',
      dangerText: 'Generally safe — non-ionising with very low energy.',
      detection: 'Radio antennae and aerials convert oscillating electric fields into electrical signals. Large dish receivers are used for deep-space signals.',
      waveDesc: 'Very long wavelengths — wave shown compressed for visualisation. Used in broadcasting and communications.',
    },
    {
      id: 'microwave',
      name: 'Microwaves',
      colour: '#7b2d8b',
      logFreqMin: 9,
      logFreqMax: 11.5,
      wavelengthRange: '1 mm – 300 mm',
      frequencyRange: '1 GHz – 300 GHz',
      uses: ['Microwave ovens', 'Satellite communications', 'Radar (speed cameras)', '5G networks', 'Cooking food'],
      danger: 'low',
      dangerText: 'Low — can heat body tissue at high intensities; safe in everyday use.',
      detection: 'Microwave receivers and waveguide systems. Radar dishes detect reflected microwaves to measure distance and speed.',
      waveDesc: 'Wavelengths from millimetres to centimetres. Water molecules absorb microwaves efficiently — the basis of microwave cooking.',
    },
    {
      id: 'infrared',
      name: 'Infrared',
      colour: '#c0392b',
      logFreqMin: 11.5,
      logFreqMax: 14,
      wavelengthRange: '700 nm – 1 mm',
      frequencyRange: '300 GHz – 400 THz',
      uses: ['Thermal imaging', 'TV remote controls', 'Night-vision goggles', 'Heat lamps', 'Optical fibre (near-IR)', 'Intruder alarms'],
      danger: 'low',
      dangerText: 'Low — prolonged exposure can cause skin burns and eye damage.',
      detection: 'Thermopile sensors, pyroelectric detectors, infrared cameras (using cooled detector arrays), and photodiodes.',
      waveDesc: 'Emitted by all warm objects. "Near-IR" is used in remotes; "far-IR" corresponds to heat radiation from bodies.',
    },
    {
      id: 'visible',
      name: 'Visible Light',
      colour: '#f8c200',
      logFreqMin: 14,
      logFreqMax: 14.85,
      wavelengthRange: '400 nm – 700 nm',
      frequencyRange: '430 THz – 750 THz',
      uses: ['Human vision', 'Photography', 'Optical fibres', 'Lasers', 'Plant photosynthesis', 'Lighting'],
      danger: 'none',
      dangerText: 'Safe — lasers can cause eye damage; never look into a laser beam.',
      detection: 'Human eyes (rods and cones), CCD/CMOS sensors in cameras, photodiodes, and photomultiplier tubes.',
      waveDesc: 'The only part of the spectrum visible to the human eye — violet (~400 nm) through to red (~700 nm).',
      isVisible: true,
    },
    {
      id: 'ultraviolet',
      name: 'Ultraviolet',
      colour: '#6c3ebc',
      logFreqMin: 14.85,
      logFreqMax: 17,
      wavelengthRange: '10 nm – 400 nm',
      frequencyRange: '750 THz – 30 PHz',
      uses: ['Sterilisation (UV-C)', 'Sun tanning / sunburn', 'Security markings (UV ink)', 'Vitamin D production', 'Fluorescence microscopy', 'Black lights'],
      danger: 'med',
      dangerText: 'Moderate — UV-A and UV-B cause skin cancer and cataracts. UV-C is very dangerous but blocked by glass.',
      detection: 'Photomultiplier tubes, UV-sensitive photodiodes, specialised CCD sensors, and photographic film.',
      waveDesc: 'Just beyond violet. Sun emits significant UV — the ozone layer absorbs most UV-C and much UV-B reaching Earth.',
    },
    {
      id: 'xray',
      name: 'X-Rays',
      colour: '#0984c9',
      logFreqMin: 17,
      logFreqMax: 20,
      wavelengthRange: '0.01 nm – 10 nm',
      frequencyRange: '30 PHz – 30 EHz',
      uses: ['Medical imaging', 'Dental X-rays', 'Airport security', 'Crystallography', 'Cancer radiotherapy', 'Industrial inspection'],
      danger: 'high',
      dangerText: 'High — ionising radiation that can damage DNA and cause cancer with excessive exposure.',
      detection: 'Photographic film, scintillation detectors, Geiger counters, flat-panel digital detectors (in hospitals).',
      waveDesc: 'High-energy ionising radiation. Penetrates soft tissue but is absorbed by dense bone — hence their medical use.',
    },
    {
      id: 'gamma',
      name: 'Gamma Rays',
      colour: '#12916e',
      logFreqMin: 20,
      logFreqMax: 24,
      wavelengthRange: '< 0.01 nm',
      frequencyRange: '> 30 EHz',
      uses: ['Sterilising medical equipment', 'Cancer radiotherapy (Gamma Knife)', 'PET scans', 'Nuclear power monitoring', 'Astronomy (gamma-ray telescopes)'],
      danger: 'high',
      dangerText: 'Very high — most penetrating ionising radiation; can cause radiation sickness, genetic damage, and death.',
      detection: 'Geiger-Müller tubes, scintillation detectors (e.g. sodium iodide crystals), semiconductor detectors in satellites.',
      waveDesc: 'Emitted by radioactive nuclei during nuclear decay. Most energetic form of EM radiation — highly penetrating.',
    },
  ];

  const DANGER_CLASS = { none: 'danger-none', low: 'danger-low', med: 'danger-med', high: 'danger-high' };
  const DANGER_LABEL = { none: 'None', low: 'Low', med: 'Moderate', high: 'High' };

  // ─── STATE ───────────────────────────────────────────────────────────────────
  let sliderPos = 0.5; // 0–1 position across spectrum (left = low freq)
  let currentRegionIdx = 3; // visible light default
  let waveAnimId = null;
  let wavePhase = 0;
  let spectrumDrawn = false;

  // ─── DOM REFS ────────────────────────────────────────────────────────────────
  const specCanvas   = document.getElementById('spectrumCanvas');
  const specCtx      = specCanvas.getContext('2d');
  const waveCanvas   = document.getElementById('waveCanvas');
  const waveCtx      = waveCanvas.getContext('2d');
  const pointer      = document.getElementById('pointer');
  const barContainer = document.getElementById('barContainer');
  const wlSlider     = document.getElementById('wlSlider');
  const freqSlider   = document.getElementById('freqSlider');
  const wlDisplay    = document.getElementById('wlDisplay');
  const freqDisplay  = document.getElementById('freqDisplay');
  const regionBand   = document.getElementById('regionBand');
  const axisLabels   = document.getElementById('axisLabels');
  const regionBtns   = document.getElementById('regionButtons');

  // Properties panel
  const regionDot      = document.getElementById('regionDot');
  const regionName     = document.getElementById('regionName');
  const propWavelength = document.getElementById('propWavelength');
  const propFrequency  = document.getElementById('propFrequency');
  const propEnergy     = document.getElementById('propEnergy');
  const propUses       = document.getElementById('propUses');
  const propDanger     = document.getElementById('propDanger');
  const propDetection  = document.getElementById('propDetection');
  const visSwatchRow   = document.getElementById('visSwatchRow');
  const waveLabel      = document.getElementById('waveLabel');
  const waveDesc       = document.getElementById('waveDesc');

  // ─── HELPERS ─────────────────────────────────────────────────────────────────
  function lerp(a, b, t) { return a + (b - a) * t; }

  function logFreqFromPos(pos) {
    return lerp(LOG_MIN, LOG_MAX, pos);
  }

  function posFromLogFreq(lf) {
    return (lf - LOG_MIN) / (LOG_MAX - LOG_MIN);
  }

  function regionFromLogFreq(lf) {
    for (let i = 0; i < REGIONS.length; i++) {
      if (lf <= REGIONS[i].logFreqMax) return i;
    }
    return REGIONS.length - 1;
  }

  function fmtFreq(logF) {
    const f = Math.pow(10, logF);
    if (f < 1e3)  return f.toFixed(0) + ' Hz';
    if (f < 1e6)  return (f / 1e3).toPrecision(3) + ' kHz';
    if (f < 1e9)  return (f / 1e6).toPrecision(3) + ' MHz';
    if (f < 1e12) return (f / 1e9).toPrecision(3) + ' GHz';
    if (f < 1e15) return (f / 1e12).toPrecision(3) + ' THz';
    if (f < 1e18) return (f / 1e15).toPrecision(3) + ' PHz';
    if (f < 1e21) return (f / 1e18).toPrecision(3) + ' EHz';
    return (f / 1e21).toPrecision(3) + ' ZHz';
  }

  function fmtWavelength(logF) {
    const f = Math.pow(10, logF);
    const wl = C / f; // metres
    if (wl >= 1e3)    return (wl / 1e3).toPrecision(3) + ' km';
    if (wl >= 1)      return wl.toPrecision(3) + ' m';
    if (wl >= 1e-2)   return (wl * 100).toPrecision(3) + ' cm';
    if (wl >= 1e-3)   return (wl * 1e3).toPrecision(3) + ' mm';
    if (wl >= 1e-6)   return (wl * 1e6).toPrecision(3) + ' \u03bcm';
    if (wl >= 1e-9)   return (wl * 1e9).toPrecision(3) + ' nm';
    if (wl >= 1e-12)  return (wl * 1e12).toPrecision(3) + ' pm';
    return (wl * 1e15).toPrecision(3) + ' fm';
  }

  function fmtEnergy(logF) {
    const f = Math.pow(10, logF);
    const e = H * f; // joules
    if (e < 1e-19) return (e * 1e22).toPrecision(3) + ' \u00d710\u207b\u00b2\u00b2 J';
    if (e < 1e-15) return (e * 1e19).toPrecision(3) + ' \u00d710\u207b\u00b9\u2079 J';
    if (e < 1e-12) return (e * 1e16).toPrecision(3) + ' \u00d710\u207b\u00b9\u2076 J';
    return e.toExponential(2) + ' J';
  }

  // ─── BUILD QUICK-SELECT BUTTONS ─────────────────────────────────────────────
  REGIONS.forEach((r, i) => {
    const btn = document.createElement('button');
    btn.className = 'region-btn';
    btn.textContent = r.name;
    btn.style.background = r.colour;
    btn.dataset.idx = i;
    btn.addEventListener('click', () => jumpToRegion(i));
    regionBtns.appendChild(btn);
  });

  // ─── BUILD REGION LABEL BAND ─────────────────────────────────────────────────
  const totalLog = LOG_MAX - LOG_MIN;
  REGIONS.forEach((r, i) => {
    const span = document.createElement('div');
    span.className = 'region-seg';
    span.dataset.idx = i;
    const pct = ((r.logFreqMax - r.logFreqMin) / totalLog) * 100;
    span.style.width = pct + '%';
    span.style.background = r.colour;
    span.textContent = r.name;
    span.title = r.name;
    span.addEventListener('click', () => jumpToRegion(i));
    regionBand.appendChild(span);
  });

  // ─── AXIS LABELS ─────────────────────────────────────────────────────────────
  const axisPoints = [4, 6, 8, 10, 12, 14, 15, 17, 19, 21, 23];
  const axisLabelsStr = ['10\u2074 Hz', '1 MHz', '100 MHz', '10 GHz', '1 THz', '100 THz', '1 PHz', '10 EHz', '1 ZHz', '100 ZHz', '10 YHz'];
  axisLabels.innerHTML = '';
  axisPoints.forEach((lf, i) => {
    const pct = ((lf - LOG_MIN) / totalLog) * 100;
    const span = document.createElement('div');
    span.className = 'axis-label';
    span.style.position = 'absolute';
    span.style.left = pct + '%';
    span.style.transform = 'translateX(-50%)';
    span.textContent = axisLabelsStr[i];
    axisLabels.appendChild(span);
  });
  axisLabels.style.position = 'relative';
  axisLabels.style.height = '18px';

  // ─── DRAW SPECTRUM CANVAS ────────────────────────────────────────────────────
  function drawSpectrum() {
    const w = specCanvas.offsetWidth || 700;
    const h = 60;
    specCanvas.width = w;
    specCanvas.height = h;

    // Background gradient across all regions
    const grd = specCtx.createLinearGradient(0, 0, w, 0);
    REGIONS.forEach((r) => {
      const startPct = (r.logFreqMin - LOG_MIN) / totalLog;
      const endPct   = (r.logFreqMax - LOG_MIN) / totalLog;
      grd.addColorStop(startPct, r.colour);
      grd.addColorStop(endPct, r.colour);
    });

    // Visible light overrides with real rainbow
    const visR = REGIONS.find(r => r.id === 'visible');
    const visStart = (visR.logFreqMin - LOG_MIN) / totalLog;
    const visEnd   = (visR.logFreqMax - LOG_MIN) / totalLog;

    specCtx.fillStyle = grd;
    specCtx.fillRect(0, 0, w, h);

    // Rainbow over visible
    const visGrd = specCtx.createLinearGradient(visStart * w, 0, visEnd * w, 0);
    visGrd.addColorStop(0,    '#7b00d4');
    visGrd.addColorStop(0.15, '#4400ff');
    visGrd.addColorStop(0.32, '#00aaff');
    visGrd.addColorStop(0.50, '#00cc44');
    visGrd.addColorStop(0.66, '#aaff00');
    visGrd.addColorStop(0.82, '#ffee00');
    visGrd.addColorStop(0.92, '#ff7700');
    visGrd.addColorStop(1,    '#ff0000');
    specCtx.fillStyle = visGrd;
    specCtx.fillRect(visStart * w, 0, (visEnd - visStart) * w, h);

    // Subtle sheen
    const sheen = specCtx.createLinearGradient(0, 0, 0, h);
    sheen.addColorStop(0, 'rgba(255,255,255,0.22)');
    sheen.addColorStop(0.5, 'rgba(255,255,255,0)');
    specCtx.fillStyle = sheen;
    specCtx.fillRect(0, 0, w, h);

    spectrumDrawn = true;
  }

  // ─── UPDATE POINTER POSITION ─────────────────────────────────────────────────
  function setPointerPos(pos) {
    sliderPos = Math.max(0, Math.min(1, pos));
    const pct = sliderPos * 100;
    pointer.style.left = pct + '%';

    // Sync sliders
    wlSlider.value  = Math.round((1 - sliderPos) * 1000); // wavelength inverted
    freqSlider.value = Math.round(sliderPos * 1000);

    const logF = logFreqFromPos(sliderPos);
    wlDisplay.textContent   = fmtWavelength(logF);
    freqDisplay.textContent = fmtFreq(logF);

    const idx = regionFromLogFreq(logF);
    updateProperties(idx, logF);
  }

  // ─── UPDATE PROPERTIES PANEL ─────────────────────────────────────────────────
  function updateProperties(idx, logF) {
    const r = REGIONS[idx];

    if (idx !== currentRegionIdx) {
      currentRegionIdx = idx;
      if (waveAnimId) cancelAnimationFrame(waveAnimId);
      wavePhase = 0;
      animateWave();
    }

    // Update active states
    document.querySelectorAll('.region-btn').forEach((b, i) => {
      b.classList.toggle('active', i === idx);
    });
    document.querySelectorAll('.region-seg').forEach((s, i) => {
      s.classList.toggle('active-seg', i === idx);
    });

    regionDot.style.background = r.colour;
    regionName.textContent = r.name;

    propWavelength.textContent = fmtWavelength(logF);
    propFrequency.textContent  = fmtFreq(logF);
    propEnergy.textContent     = fmtEnergy(logF);

    // Uses chips
    propUses.innerHTML = '';
    const ul = document.createElement('div');
    ul.className = 'uses-list';
    r.uses.forEach(u => {
      const chip = document.createElement('span');
      chip.className = 'use-chip';
      chip.textContent = u;
      ul.appendChild(chip);
    });
    propUses.appendChild(ul);

    // Danger
    propDanger.innerHTML = `<span class="danger-tag ${DANGER_CLASS[r.danger]}">${DANGER_LABEL[r.danger]}</span> <span style="font-size:0.8rem;color:var(--text-muted)">${r.dangerText}</span>`;

    // Visible light swatch
    visSwatchRow.style.display = r.isVisible ? 'grid' : 'none';

    propDetection.textContent = r.detection;

    waveLabel.textContent = r.name;
    waveDesc.textContent  = r.waveDesc;
  }

  // ─── WAVE ANIMATION ───────────────────────────────────────────────────────────
  function animateWave() {
    const r = REGIONS[currentRegionIdx];
    const w = waveCanvas.offsetWidth || 500;
    const h = waveCanvas.offsetHeight || 220;
    waveCanvas.width  = w;
    waveCanvas.height = h;

    // Frequency-dependent wave cycles (visual only)
    // More cycles = higher relative frequency in the spectrum
    const cycleMap = [1.5, 3, 5, 8, 12, 18, 28];
    const cycles = cycleMap[currentRegionIdx];
    const amplitude = h * 0.32;
    const cx = w / 2;
    const cy = h / 2;

    waveCtx.clearRect(0, 0, w, h);

    // Background
    waveCtx.fillStyle = '#0d1f17';
    waveCtx.fillRect(0, 0, w, h);

    // Centre line
    waveCtx.strokeStyle = 'rgba(82,183,136,0.12)';
    waveCtx.lineWidth = 1;
    waveCtx.beginPath();
    waveCtx.moveTo(0, cy);
    waveCtx.lineTo(w, cy);
    waveCtx.stroke();

    // Draw E field wave
    const gradient = waveCtx.createLinearGradient(0, 0, w, 0);
    gradient.addColorStop(0, 'rgba(82,183,136,0)');
    gradient.addColorStop(0.2, r.colour + 'ee');
    gradient.addColorStop(0.5, r.colour);
    gradient.addColorStop(0.8, r.colour + 'ee');
    gradient.addColorStop(1, 'rgba(82,183,136,0)');

    waveCtx.strokeStyle = gradient;
    waveCtx.lineWidth = 2.5;
    waveCtx.shadowColor = r.colour;
    waveCtx.shadowBlur = 8;
    waveCtx.beginPath();
    for (let x = 0; x <= w; x++) {
      const phase = (x / w) * cycles * Math.PI * 2 - wavePhase;
      const y = cy - Math.sin(phase) * amplitude;
      if (x === 0) waveCtx.moveTo(x, y);
      else waveCtx.lineTo(x, y);
    }
    waveCtx.stroke();
    waveCtx.shadowBlur = 0;

    // Draw B field wave (perpendicular, shown offset vertically at reduced scale)
    const bAmplitude = amplitude * 0.55;
    waveCtx.strokeStyle = 'rgba(100,180,255,0.55)';
    waveCtx.lineWidth = 1.5;
    waveCtx.setLineDash([4, 3]);
    waveCtx.beginPath();
    for (let x = 0; x <= w; x++) {
      const phase = (x / w) * cycles * Math.PI * 2 - wavePhase;
      const y = cy - Math.cos(phase) * bAmplitude;
      if (x === 0) waveCtx.moveTo(x, y);
      else waveCtx.lineTo(x, y);
    }
    waveCtx.stroke();
    waveCtx.setLineDash([]);

    // Labels
    waveCtx.font = '11px Segoe UI, sans-serif';
    waveCtx.fillStyle = r.colour;
    waveCtx.fillText('E field', 8, cy - amplitude - 6);
    waveCtx.fillStyle = 'rgba(100,180,255,0.8)';
    waveCtx.fillText('B field', 8, cy - bAmplitude - 6);

    // Direction arrow
    waveCtx.fillStyle = 'rgba(180,220,200,0.5)';
    waveCtx.font = '10px Segoe UI, sans-serif';
    waveCtx.fillText('\u2192 Direction of propagation', w - 165, cy + amplitude + 18);

    wavePhase += 0.04;
    waveAnimId = requestAnimationFrame(animateWave);
  }

  // ─── SLIDER EVENTS ────────────────────────────────────────────────────────────
  freqSlider.addEventListener('input', () => {
    const pos = freqSlider.value / 1000;
    setPointerPos(pos);
  });

  wlSlider.addEventListener('input', () => {
    // Wavelength inversely related to frequency
    const pos = 1 - (wlSlider.value / 1000);
    setPointerPos(pos);
  });

  // ─── POINTER DRAG ─────────────────────────────────────────────────────────────
  let dragging = false;

  pointer.addEventListener('mousedown', (e) => {
    dragging = true;
    e.preventDefault();
  });

  pointer.addEventListener('touchstart', (e) => {
    dragging = true;
    e.preventDefault();
  }, { passive: false });

  function getBarRect() {
    return specCanvas.getBoundingClientRect();
  }

  function posFromEvent(e) {
    const rect = getBarRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    return (clientX - rect.left) / rect.width;
  }

  document.addEventListener('mousemove', (e) => {
    if (!dragging) return;
    setPointerPos(posFromEvent(e));
  });

  document.addEventListener('touchmove', (e) => {
    if (!dragging) return;
    setPointerPos(posFromEvent(e));
    e.preventDefault();
  }, { passive: false });

  document.addEventListener('mouseup',  () => { dragging = false; });
  document.addEventListener('touchend', () => { dragging = false; });

  // Click on spectrum bar
  specCanvas.addEventListener('click', (e) => {
    const rect = specCanvas.getBoundingClientRect();
    const pos = (e.clientX - rect.left) / rect.width;
    setPointerPos(pos);
  });

  // ─── JUMP TO REGION ───────────────────────────────────────────────────────────
  function jumpToRegion(idx) {
    const r = REGIONS[idx];
    const midLog = (r.logFreqMin + r.logFreqMax) / 2;
    const pos = posFromLogFreq(midLog);
    setPointerPos(pos);
  }

  // ─── RESIZE HANDLING ─────────────────────────────────────────────────────────
  const resizeObserver = new ResizeObserver(() => {
    drawSpectrum();
    const w = waveCanvas.offsetWidth || 500;
    const h = waveCanvas.offsetHeight || 220;
    waveCanvas.width = w;
    waveCanvas.height = h;
  });

  resizeObserver.observe(specCanvas);
  resizeObserver.observe(waveCanvas);

  // ─── INIT ─────────────────────────────────────────────────────────────────────
  function init() {
    drawSpectrum();

    // Default: middle of visible light
    const visR = REGIONS.find(r => r.id === 'visible');
    const midLog = (visR.logFreqMin + visR.logFreqMax) / 2;
    setPointerPos(posFromLogFreq(midLog));

    animateWave();
  }

  // Small delay to allow layout to settle
  setTimeout(init, 60);

})();
</script>
</body>
</html>
