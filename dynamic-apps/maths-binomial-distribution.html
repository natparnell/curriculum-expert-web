<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Binomial Distribution</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
    --primary: #4361ee;
    --primary-dark: #2b44c7;
    --col-n: #3b82f6; --col-n-light: #dbeafe;
    --col-p: #10b981; --col-p-light: #d1fae5;
    --col-r: #ef4444; --col-r-light: #fee2e2;
    --col-q: #f59e0b; --col-q-light: #fef3c7;
    --gray-50: #f9fafb; --gray-100: #f3f4f6; --gray-200: #e5e7eb; --gray-300: #d1d5db;
    --gray-500: #6b7280; --gray-600: #4b5563; --gray-700: #374151; --gray-800: #1f2937; --gray-900: #111827;
    --radius: 12px;
    --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
}

body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: var(--gray-50); color: var(--gray-800); line-height: 1.6; }

.header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 2.5rem 1.5rem; text-align: center; position: relative; overflow: hidden; }
.header::before { content: ''; position: absolute; inset: 0; background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
.header h1 { font-size: 2.2rem; font-weight: 800; margin-bottom: 0.3rem; position: relative; }
.header p { font-size: 1.15rem; opacity: 0.9; position: relative; }

.container { max-width: 1200px; margin: 0 auto; padding: 1.5rem; }
.section { margin-bottom: 2rem; }
.section-title { font-size: 1.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; }
.section-title .icon { font-size: 1.3rem; }

.card { background: white; border-radius: var(--radius); border: 1px solid var(--gray-200); padding: 1.5rem; box-shadow: var(--shadow); transition: box-shadow 0.25s ease; }
.card:hover { box-shadow: var(--shadow-lg); }

.var-n { color: var(--col-n); font-weight: 700; }
.var-p { color: var(--col-p); font-weight: 700; }
.var-r { color: var(--col-r); font-weight: 700; }
.var-q { color: var(--col-q); font-weight: 700; }

.formula { font-family: 'Cambria Math', 'Times New Roman', serif; }

/* Intro grid */
.intro-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; }
.intro-card { background: white; border-radius: var(--radius); border: 1px solid var(--gray-200); padding: 1.25rem; box-shadow: var(--shadow); transition: box-shadow 0.25s ease, transform 0.2s ease; }
.intro-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-2px); }
.intro-card h3 { font-size: 1rem; font-weight: 700; color: var(--primary); margin-bottom: 0.75rem; }
.condition-list { list-style: none; }
.condition-list li { padding: 0.4rem 0; border-bottom: 1px solid var(--gray-100); font-size: 0.95rem; display: flex; align-items: center; gap: 0.5rem; }
.condition-list li:last-child { border-bottom: none; }
.condition-icon { font-size: 1.1rem; }
.formula-big { font-family: 'Cambria Math', 'Times New Roman', serif; font-size: 1.5rem; text-align: center; margin: 1rem 0; line-height: 1.6; }
.notation-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
.notation-table td { padding: 0.4rem 0.6rem; border-bottom: 1px solid var(--gray-100); }
.notation-table .sym { font-family: 'Cambria Math', 'Times New Roman', serif; font-size: 1.15rem; font-weight: 700; width: 50px; text-align: center; }

/* nCr section */
.ncr-tool { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
.ncr-inputs { display: flex; gap: 1rem; align-items: flex-end; margin-bottom: 1rem; }
.ncr-inputs label { font-size: 0.85rem; font-weight: 600; color: var(--gray-700); display: block; margin-bottom: 0.3rem; }
.ncr-inputs input { width: 70px; padding: 0.4rem 0.6rem; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 1rem; text-align: center; }
.ncr-inputs button { padding: 0.5rem 1rem; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
.ncr-inputs button:hover { background: var(--primary-dark); }
.ncr-result { background: var(--gray-50); border-radius: 8px; padding: 1rem; font-size: 0.95rem; line-height: 1.8; min-height: 80px; }
.ncr-result .step { font-family: 'Cambria Math', 'Times New Roman', serif; font-size: 1.1rem; display: block; margin: 0.3rem 0; padding: 0.3rem 0.5rem; background: white; border-radius: 6px; }

.pascal-wrap { overflow-x: auto; }
.pascal-triangle { text-align: center; }
.pascal-row { display: flex; justify-content: center; gap: 2px; margin-bottom: 2px; }
.pascal-cell { width: 36px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; background: var(--col-n-light); color: var(--col-n); border-radius: 4px; cursor: pointer; transition: all 0.2s; }
.pascal-cell:hover { background: var(--primary); color: white; transform: scale(1.15); }

/* Playground */
.pg-controls { display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: flex-end; margin-bottom: 1rem; }
.pg-control { flex: 1; min-width: 150px; }
.pg-control label { display: block; font-size: 0.85rem; font-weight: 600; color: var(--gray-700); margin-bottom: 0.3rem; }
.pg-control input[type="range"] { width: 100%; }
.pg-val { font-size: 0.85rem; font-weight: 700; text-align: right; }

.pg-canvas-wrap { background: var(--gray-100); border-radius: var(--radius); padding: 0.75rem; margin-bottom: 1rem; }
.pg-canvas-wrap canvas { width: 100%; display: block; border-radius: 8px; background: white; cursor: crosshair; }

.pg-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; margin-bottom: 1rem; }
.pg-stat { text-align: center; padding: 0.6rem; border-radius: 8px; font-weight: 700; font-size: 1rem; }
.pg-stat .pg-stat-label { font-size: 0.75rem; font-weight: 600; display: block; margin-bottom: 0.15rem; }
.pg-stat-mean { background: var(--col-n-light); color: var(--col-n); }
.pg-stat-var { background: var(--col-q-light); color: var(--col-q); }
.pg-stat-sd { background: var(--col-p-light); color: #065f46; }
.pg-stat-mode { background: var(--col-r-light); color: var(--col-r); }

.pg-toggle { display: flex; gap: 0; margin-bottom: 1rem; }
.pg-toggle button { padding: 0.4rem 1rem; border: 1px solid var(--gray-300); background: white; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
.pg-toggle button:first-child { border-radius: 8px 0 0 8px; }
.pg-toggle button:last-child { border-radius: 0 8px 8px 0; }
.pg-toggle button.active { background: var(--primary); color: white; border-color: var(--primary); }

.pg-detail { background: var(--gray-50); border-radius: 8px; padding: 1rem; font-size: 0.9rem; min-height: 50px; margin-bottom: 0.75rem; }
.pg-shape { font-size: 0.9rem; color: var(--gray-600); font-style: italic; }

/* Worked examples */
.we-card { margin-bottom: 1rem; }
.we-scenario { font-size: 1.05rem; line-height: 1.7; padding: 1.25rem; background: var(--gray-50); border-radius: 8px; border-left: 4px solid var(--primary); margin-bottom: 0.75rem; }
.we-btn { padding: 0.5rem 1rem; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; margin-right: 0.5rem; margin-bottom: 0.5rem; transition: all 0.2s; }
.we-btn-setup { background: var(--col-n-light); color: #1e40af; border: 1px solid var(--col-n); }
.we-btn-setup:hover { background: var(--col-n); color: white; }
.we-btn-calc { background: var(--col-p-light); color: #065f46; border: 1px solid var(--col-p); }
.we-btn-calc:hover { background: var(--col-p); color: white; }
.we-reveal { display: none; margin-top: 0.75rem; background: white; border-radius: 8px; padding: 1rem; border: 1px solid var(--gray-200); }
.we-reveal.visible { display: block; }
.we-step { padding: 0.4rem 0; border-bottom: 1px solid var(--gray-100); font-size: 0.95rem; line-height: 1.7; }
.we-step:last-child { border-bottom: none; }
.we-step-label { font-weight: 700; color: var(--primary); margin-right: 0.5rem; }
.we-eq { font-family: 'Cambria Math', 'Times New Roman', serif; font-size: 1.1rem; display: block; margin: 0.3rem 0; padding: 0.4rem 0.75rem; background: var(--gray-50); border-radius: 6px; }

/* Word problems (same as SUVAT) */
.wp-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }
.wp-nav button { padding: 0.5rem 1.2rem; border: 1px solid var(--gray-300); border-radius: 8px; background: white; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
.wp-nav button:hover:not(:disabled) { background: var(--gray-100); border-color: var(--primary); color: var(--primary); }
.wp-nav button:disabled { opacity: 0.4; cursor: default; }
.wp-counter { font-weight: 700; color: var(--gray-700); }

.wp-problem { display: none; }
.wp-problem.active { display: block; }
.wp-text { font-size: 1.05rem; line-height: 1.7; padding: 1.25rem; background: var(--gray-50); border-radius: 8px; border-left: 4px solid var(--primary); margin-bottom: 1rem; }
.wp-text .inference { background: transparent; padding: 0.1rem 0.3rem; border-radius: 4px; font-weight: 600; transition: background 0.3s; }
.wp-text .inference.shown { background: var(--col-q-light); }

.wp-btn { padding: 0.5rem 1rem; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; margin-right: 0.5rem; margin-bottom: 0.5rem; transition: all 0.2s; }
.wp-btn-extract { background: var(--col-p-light); color: #065f46; border: 1px solid var(--col-p); }
.wp-btn-extract:hover { background: var(--col-p); color: white; }
.wp-btn-solution { background: var(--col-n-light); color: #1e40af; border: 1px solid var(--col-n); }
.wp-btn-solution:hover { background: var(--col-n); color: white; }

.wp-extract, .wp-solution { display: none; margin-top: 1rem; }
.wp-extract.visible, .wp-solution.visible { display: block; }
.wp-extract { background: white; border-radius: 8px; padding: 1rem; border: 1px solid var(--gray-200); }
.wp-extract table { width: 100%; border-collapse: collapse; }
.wp-extract th, .wp-extract td { padding: 0.4rem 0.75rem; text-align: left; font-size: 0.9rem; }
.wp-extract th { font-weight: 700; border-bottom: 2px solid var(--gray-200); }
.wp-extract td { border-bottom: 1px solid var(--gray-100); }
.wp-extract .reasoning { color: var(--gray-600); font-style: italic; font-size: 0.85rem; }

.wp-solution { background: white; border-radius: 8px; padding: 1.25rem; border: 2px solid var(--primary); }
.wp-solution .step { padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100); font-size: 0.95rem; line-height: 1.7; }
.wp-solution .step:last-child { border-bottom: none; }
.wp-solution .step-label { font-weight: 700; color: var(--primary); margin-right: 0.5rem; }
.wp-solution .step .eq-highlight { font-family: 'Cambria Math', 'Times New Roman', serif; font-size: 1.1rem; display: block; margin: 0.3rem 0; padding: 0.4rem 0.75rem; background: var(--gray-50); border-radius: 6px; }

/* Quick reference */
.qr-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
.qr-card { background: white; border-radius: var(--radius); border: 1px solid var(--gray-200); padding: 1.25rem; box-shadow: var(--shadow); }
.qr-card h3 { font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; color: var(--gray-800); }
.cw-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
.cw-table th, .cw-table td { padding: 0.4rem 0.6rem; text-align: left; }
.cw-table th { border-bottom: 2px solid var(--gray-200); font-weight: 700; }
.cw-table td { border-bottom: 1px solid var(--gray-100); }
.cw-table tr:hover { background: var(--gray-50); }
.cw-keyword { font-weight: 700; color: var(--col-q); }
.cond-list { list-style: none; font-size: 0.9rem; }
.cond-list li { padding: 0.3rem 0; border-bottom: 1px solid var(--gray-100); }

.footer { text-align: center; padding: 1.5rem; color: var(--gray-500); font-size: 0.85rem; }

@media (max-width: 700px) {
    .intro-grid { grid-template-columns: 1fr; }
    .ncr-tool { grid-template-columns: 1fr; }
    .pg-controls { flex-direction: column; }
    .pg-stats { grid-template-columns: repeat(2, 1fr); }
    .qr-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<div class="header">
    <h1>The Binomial Distribution</h1>
    <p>Modelling the number of successes in a fixed number of independent trials</p>
</div>

<div class="container">

<!-- ‚ïê‚ïê‚ïê‚ïê 1. INTRODUCTION ‚ïê‚ïê‚ïê‚ïê -->
<div class="section">
    <div class="section-title"><span class="icon">üìö</span> What Is the Binomial Distribution?</div>
    <div class="intro-grid">
        <div class="intro-card">
            <h3>When to Use It</h3>
            <ul class="condition-list">
                <li><span class="condition-icon">üî¢</span> Fixed number of trials (<span class="var-n">n</span>)</li>
                <li><span class="condition-icon">‚öñÔ∏è</span> Two outcomes only: success or failure</li>
                <li><span class="condition-icon">üéØ</span> Constant probability of success (<span class="var-p">p</span>) each trial</li>
                <li><span class="condition-icon">üîÄ</span> Trials are independent of each other</li>
            </ul>
        </div>
        <div class="intro-card">
            <h3>Key Notation</h3>
            <table class="notation-table">
                <tr><td class="sym formula" style="color:var(--primary);">X ~ B(<span class="var-n">n</span>, <span class="var-p">p</span>)</td><td>X follows a binomial distribution</td></tr>
                <tr><td class="sym var-n">n</td><td>Number of trials</td></tr>
                <tr><td class="sym var-p">p</td><td>Probability of success on each trial</td></tr>
                <tr><td class="sym var-q">q</td><td>Probability of failure = 1 - <span class="var-p">p</span></td></tr>
                <tr><td class="sym var-r">r</td><td>Number of successes we are interested in</td></tr>
            </table>
        </div>
        <div class="intro-card">
            <h3>The Formula</h3>
            <div class="formula-big">
                P(X = <span class="var-r">r</span>) = <sup><span class="var-n">n</span></sup>C<sub><span class="var-r">r</span></sub> &#215; <span class="var-p">p</span><sup><span class="var-r">r</span></sup> &#215; <span class="var-q">q</span><sup><span class="var-n">n</span>-<span class="var-r">r</span></sup>
            </div>
            <p style="font-size:0.9rem;color:var(--gray-600);text-align:center;">where <span class="var-q">q</span> = 1 - <span class="var-p">p</span></p>
            <p style="font-size:0.85rem;color:var(--gray-500);text-align:center;margin-top:0.5rem;"><sup><span class="var-n">n</span></sup>C<sub><span class="var-r">r</span></sub> counts the number of ways to choose which <span class="var-r">r</span> trials are successes</p>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê 2. UNDERSTANDING nCr ‚ïê‚ïê‚ïê‚ïê -->
<div class="section">
    <div class="section-title"><span class="icon">üßÆ</span> Understanding Combinations (<sup>n</sup>C<sub>r</sub>)</div>
    <div class="card">
        <div class="ncr-tool">
            <div>
                <div class="formula-big" style="text-align:left;font-size:1.3rem;margin-bottom:1rem;">
                    <sup><span class="var-n">n</span></sup>C<sub><span class="var-r">r</span></sub> = <span class="var-n">n</span>! / (<span class="var-r">r</span>! &#215; (<span class="var-n">n</span> - <span class="var-r">r</span>)!)
                </div>
                <div class="ncr-inputs">
                    <div><label><span class="var-n">n</span></label><input type="number" id="ncrN" value="5" min="0" max="30"></div>
                    <div><label><span class="var-r">r</span></label><input type="number" id="ncrR" value="2" min="0" max="30"></div>
                    <button id="ncrCalc">Calculate</button>
                </div>
                <div class="ncr-result" id="ncrResult">Click Calculate to see the step-by-step working.</div>
            </div>
            <div>
                <h4 style="font-size:0.9rem;font-weight:700;color:var(--gray-700);margin-bottom:0.75rem;">Pascal's Triangle (click any cell)</h4>
                <div class="pascal-wrap" id="pascalTriangle"></div>
            </div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê 3. INTERACTIVE PLAYGROUND ‚ïê‚ïê‚ïê‚ïê -->
<div class="section">
    <div class="section-title"><span class="icon">üéÆ</span> Interactive Playground</div>
    <div class="card">
        <div class="pg-controls">
            <div class="pg-control">
                <label><span class="var-n">n</span> &#8212; number of trials</label>
                <input type="range" id="pgN" min="1" max="30" value="10" style="accent-color:#3b82f6">
                <div class="pg-val" style="color:var(--col-n)" id="pgNval">10</div>
            </div>
            <div class="pg-control">
                <label><span class="var-p">p</span> &#8212; probability of success</label>
                <input type="range" id="pgP" min="0.01" max="0.99" step="0.01" value="0.5" style="accent-color:#10b981">
                <div class="pg-val" style="color:var(--col-p)" id="pgPval">0.50</div>
            </div>
        </div>

        <div class="pg-toggle">
            <button class="active" id="pgToggleProb">P(X = r)</button>
            <button id="pgToggleCum">P(X &#8804; r)</button>
        </div>

        <div class="pg-canvas-wrap">
            <canvas id="pgChart" width="1000" height="350"></canvas>
        </div>

        <div class="pg-stats">
            <div class="pg-stat pg-stat-mean"><span class="pg-stat-label">Mean (np)</span><span id="pgMean">5.00</span></div>
            <div class="pg-stat pg-stat-var"><span class="pg-stat-label">Variance (npq)</span><span id="pgVar">2.50</span></div>
            <div class="pg-stat pg-stat-sd"><span class="pg-stat-label">Std Dev</span><span id="pgSD">1.58</span></div>
            <div class="pg-stat pg-stat-mode"><span class="pg-stat-label">Mode</span><span id="pgMode">5</span></div>
        </div>

        <div class="pg-detail" id="pgDetail">Hover over a bar to see the full calculation for that value of <span class="var-r">r</span>.</div>
        <div class="pg-shape" id="pgShape"></div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê 4. WORKED EXAMPLES ‚ïê‚ïê‚ïê‚ïê -->
<div class="section">
    <div class="section-title"><span class="icon">‚úèÔ∏è</span> Worked Examples</div>
    <div id="weContainer"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê 5. EXAM-STYLE PROBLEMS ‚ïê‚ïê‚ïê‚ïê -->
<div class="section">
    <div class="section-title"><span class="icon">üìù</span> Exam-Style Problems</div>
    <div class="card">
        <div class="wp-nav">
            <button id="wpPrev" disabled>&#8592; Previous</button>
            <span class="wp-counter"><span id="wpNum">1</span> / 6</span>
            <button id="wpNext">Next &#8594;</button>
        </div>
        <div id="wpContainer"></div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê 6. QUICK REFERENCE ‚ïê‚ïê‚ïê‚ïê -->
<div class="section">
    <div class="section-title"><span class="icon">üìã</span> Quick Reference</div>
    <div class="qr-grid">
        <div class="qr-card">
            <h3>The Binomial Formula</h3>
            <div class="formula-big" style="font-size:1.3rem;">P(X = <span class="var-r">r</span>) = <sup><span class="var-n">n</span></sup>C<sub><span class="var-r">r</span></sub> &#215; <span class="var-p">p</span><sup><span class="var-r">r</span></sup> &#215; <span class="var-q">q</span><sup><span class="var-n">n</span>-<span class="var-r">r</span></sup></div>
            <div style="text-align:center;font-size:0.95rem;margin-top:0.5rem;">
                <div>E(X) = <span class="var-n">n</span><span class="var-p">p</span></div>
                <div>Var(X) = <span class="var-n">n</span><span class="var-p">p</span><span class="var-q">q</span></div>
            </div>
        </div>
        <div class="qr-card">
            <h3>Four Conditions</h3>
            <ul class="cond-list">
                <li>&#10003; Fixed number of trials (<span class="var-n">n</span>)</li>
                <li>&#10003; Two outcomes: success or failure</li>
                <li>&#10003; Constant probability (<span class="var-p">p</span>)</li>
                <li>&#10003; Independent trials</li>
            </ul>
        </div>
        <div class="qr-card">
            <h3>Code Words Cheat Sheet</h3>
            <table class="cw-table">
                <thead><tr><th>Phrase</th><th>Meaning</th></tr></thead>
                <tbody>
                    <tr><td><span class="cw-keyword">"exactly r"</span></td><td>P(X = <span class="var-r">r</span>)</td></tr>
                    <tr><td><span class="cw-keyword">"at most r"</span></td><td>P(X &#8804; <span class="var-r">r</span>)</td></tr>
                    <tr><td><span class="cw-keyword">"fewer than r"</span></td><td>P(X &#8804; <span class="var-r">r</span> - 1)</td></tr>
                    <tr><td><span class="cw-keyword">"at least r"</span></td><td>1 - P(X &#8804; <span class="var-r">r</span> - 1)</td></tr>
                    <tr><td><span class="cw-keyword">"more than r"</span></td><td>1 - P(X &#8804; <span class="var-r">r</span>)</td></tr>
                    <tr><td><span class="cw-keyword">"none"</span></td><td>P(X = 0)</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

</div>

<div class="footer">Binomial Distribution Explorer &#8212; A-Level Mathematics</div>

<script>
'use strict';

/* ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ */
function R(v, dp) { dp = dp || 4; var f = Math.pow(10, dp); return Math.round(v * f) / f; }
function R2(v) { return R(v, 2); }
function R4(v) { return R(v, 4); }
function R6(v) { return R(v, 6); }

function factorial(n) { if (n <= 1) return 1; var r = 1; for (var i = 2; i <= n; i++) r *= i; return r; }
function nCr(n, r) { if (r < 0 || r > n) return 0; return factorial(n) / (factorial(r) * factorial(n - r)); }
function binomP(n, r, p) { return nCr(n, r) * Math.pow(p, r) * Math.pow(1 - p, n - r); }


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê nCr CALCULATOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
(function() {
    document.getElementById('ncrCalc').addEventListener('click', function() {
        var n = parseInt(document.getElementById('ncrN').value) || 0;
        var r = parseInt(document.getElementById('ncrR').value) || 0;
        var el = document.getElementById('ncrResult');

        if (r > n || r < 0 || n < 0) {
            el.innerHTML = '<span style="color:var(--col-r)">r must be between 0 and n.</span>';
            return;
        }

        var result = nCr(n, r);
        var nFact = factorial(n);
        var rFact = factorial(r);
        var nrFact = factorial(n - r);

        var html = '<div style="font-weight:600;margin-bottom:0.5rem;">Calculating <sup>' + n + '</sup>C<sub>' + r + '</sub>:</div>';
        html += '<span class="step"><sup>' + n + '</sup>C<sub>' + r + '</sub> = ' + n + '! / (' + r + '! \u00D7 ' + (n-r) + '!)</span>';
        html += '<span class="step">= ' + nFact + ' / (' + rFact + ' \u00D7 ' + nrFact + ')</span>';
        html += '<span class="step">= ' + nFact + ' / ' + (rFact * nrFact) + '</span>';
        html += '<span class="step" style="font-weight:700;color:var(--primary);">= ' + result + '</span>';
        el.innerHTML = html;
    });

    // Pascal's triangle
    var pascal = document.getElementById('pascalTriangle');
    var rows = 8;
    for (var i = 0; i <= rows; i++) {
        var rowDiv = document.createElement('div');
        rowDiv.className = 'pascal-row';
        for (var j = 0; j <= i; j++) {
            var cell = document.createElement('div');
            cell.className = 'pascal-cell';
            cell.textContent = nCr(i, j);
            cell.setAttribute('data-n', i);
            cell.setAttribute('data-r', j);
            cell.addEventListener('click', function() {
                var cn = this.getAttribute('data-n');
                var cr = this.getAttribute('data-r');
                document.getElementById('ncrN').value = cn;
                document.getElementById('ncrR').value = cr;
                document.getElementById('ncrCalc').click();
            });
            rowDiv.appendChild(cell);
        }
        pascal.appendChild(rowDiv);
    }
})();


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INTERACTIVE PLAYGROUND ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
(function() {
    var nSlider = document.getElementById('pgN');
    var pSlider = document.getElementById('pgP');
    var nVal = document.getElementById('pgNval');
    var pVal = document.getElementById('pgPval');
    var canvas = document.getElementById('pgChart');
    var ctx = canvas.getContext('2d');
    var cumulative = false;
    var hoveredR = -1;

    var btnProb = document.getElementById('pgToggleProb');
    var btnCum = document.getElementById('pgToggleCum');

    btnProb.addEventListener('click', function() { cumulative = false; btnProb.classList.add('active'); btnCum.classList.remove('active'); draw(); });
    btnCum.addEventListener('click', function() { cumulative = true; btnCum.classList.add('active'); btnProb.classList.remove('active'); draw(); });

    nSlider.addEventListener('input', function() { nVal.textContent = this.value; update(); });
    pSlider.addEventListener('input', function() { pVal.textContent = parseFloat(this.value).toFixed(2); update(); });

    canvas.addEventListener('mousemove', function(e) {
        var rect = canvas.getBoundingClientRect();
        var x = (e.clientX - rect.left) * (canvas.width / rect.width);
        var n = parseInt(nSlider.value);
        var pad = { l: 50, r: 20 };
        var gw = canvas.width - pad.l - pad.r;
        var barW = gw / (n + 1);
        var idx = Math.floor((x - pad.l) / barW);
        if (idx >= 0 && idx <= n && idx !== hoveredR) {
            hoveredR = idx;
            draw();
            showDetail(idx);
        } else if (idx < 0 || idx > n) {
            hoveredR = -1;
            draw();
        }
    });

    canvas.addEventListener('mouseleave', function() {
        hoveredR = -1;
        draw();
    });

    function update() {
        var n = parseInt(nSlider.value);
        var p = parseFloat(pSlider.value);
        var q = 1 - p;

        var mean = n * p;
        var variance = n * p * q;
        var sd = Math.sqrt(variance);

        // Mode: floor((n+1)p) or floor((n+1)p) and floor((n+1)p)-1
        var modeVal = Math.floor((n + 1) * p);
        if (modeVal > n) modeVal = n;

        document.getElementById('pgMean').textContent = R2(mean);
        document.getElementById('pgVar').textContent = R2(variance);
        document.getElementById('pgSD').textContent = R2(sd);
        document.getElementById('pgMode').textContent = modeVal;

        // Shape commentary
        var shapeEl = document.getElementById('pgShape');
        if (Math.abs(p - 0.5) < 0.02) {
            shapeEl.textContent = 'The distribution is approximately symmetric (p \u2248 0.5).';
        } else if (p < 0.5) {
            shapeEl.textContent = 'The distribution is right-skewed (positively skewed) because p < 0.5.';
        } else {
            shapeEl.textContent = 'The distribution is left-skewed (negatively skewed) because p > 0.5.';
        }

        draw();
    }

    function showDetail(r) {
        var n = parseInt(nSlider.value);
        var p = parseFloat(pSlider.value);
        var q = 1 - p;
        var el = document.getElementById('pgDetail');

        if (cumulative) {
            var cumP = 0;
            var terms = [];
            for (var i = 0; i <= r; i++) {
                var pi = binomP(n, i, p);
                cumP += pi;
                terms.push('P(' + i + ')');
            }
            el.innerHTML = '<strong>P(X \u2264 ' + r + ')</strong> = ' + terms.join(' + ') + ' = <strong>' + R6(cumP) + '</strong>';
        } else {
            var c = nCr(n, r);
            var prob = binomP(n, r, p);
            el.innerHTML = '<strong>P(X = <span class="var-r">' + r + '</span>)</strong> = ' +
                '<sup>' + n + '</sup>C<sub>' + r + '</sub> \u00D7 ' + R4(p) + '<sup>' + r + '</sup> \u00D7 ' + R4(q) + '<sup>' + (n - r) + '</sup>' +
                ' = ' + c + ' \u00D7 ' + R6(Math.pow(p, r)) + ' \u00D7 ' + R6(Math.pow(q, n - r)) +
                ' = <strong>' + R6(prob) + '</strong>';
        }
    }

    function draw() {
        var n = parseInt(nSlider.value);
        var p = parseFloat(pSlider.value);
        var W = canvas.width, H = canvas.height;
        ctx.clearRect(0, 0, W, H);

        var pad = { l: 50, r: 20, t: 20, b: 40 };
        var gw = W - pad.l - pad.r, gh = H - pad.t - pad.b;

        // Compute probabilities
        var probs = [];
        var cumProbs = [];
        var cumSum = 0;
        for (var i = 0; i <= n; i++) {
            var pi = binomP(n, i, p);
            probs.push(pi);
            cumSum += pi;
            cumProbs.push(cumSum);
        }

        var data = cumulative ? cumProbs : probs;
        var maxP = 0;
        for (var i = 0; i < data.length; i++) { if (data[i] > maxP) maxP = data[i]; }
        if (maxP === 0) maxP = 1;
        maxP *= 1.1;

        var barW = gw / (n + 1);
        var barGap = Math.max(1, barW * 0.15);

        // Axes
        ctx.strokeStyle = '#ccc'; ctx.lineWidth = 1;
        ctx.beginPath(); ctx.moveTo(pad.l, pad.t); ctx.lineTo(pad.l, H - pad.b); ctx.lineTo(W - pad.r, H - pad.b); ctx.stroke();

        // Y axis labels
        ctx.fillStyle = '#999'; ctx.font = '11px system-ui'; ctx.textAlign = 'right';
        for (var i = 0; i <= 4; i++) {
            var yVal = maxP * i / 4;
            var yPos = H - pad.b - (gh * i / 4);
            ctx.fillText(yVal.toFixed(3), pad.l - 5, yPos + 4);
            ctx.strokeStyle = '#eee'; ctx.beginPath(); ctx.moveTo(pad.l, yPos); ctx.lineTo(W - pad.r, yPos); ctx.stroke();
        }

        // Bars
        for (var i = 0; i <= n; i++) {
            var x = pad.l + i * barW + barGap / 2;
            var bw = barW - barGap;
            var bh = (data[i] / maxP) * gh;
            var y = H - pad.b - bh;

            if (i === hoveredR) {
                ctx.fillStyle = '#4361ee';
            } else {
                // Gradient based on probability
                var intensity = Math.min(1, data[i] / (maxP * 0.8));
                var r1 = Math.round(67 + (59 - 67) * intensity);
                var g1 = Math.round(97 + (130 - 97) * intensity);
                var b1 = Math.round(238 + (246 - 238) * intensity);
                ctx.fillStyle = 'rgba(' + r1 + ',' + g1 + ',' + b1 + ',' + (0.5 + 0.5 * intensity) + ')';
            }
            ctx.fillRect(x, y, bw, bh);

            // Bar border
            ctx.strokeStyle = i === hoveredR ? '#2b44c7' : 'rgba(67,97,238,0.3)';
            ctx.lineWidth = i === hoveredR ? 2 : 1;
            ctx.strokeRect(x, y, bw, bh);

            // X labels
            ctx.fillStyle = '#666'; ctx.font = (n > 20 ? '9' : '11') + 'px system-ui'; ctx.textAlign = 'center';
            ctx.fillText(i, x + bw / 2, H - pad.b + 15);

            // Value on hover
            if (i === hoveredR) {
                ctx.fillStyle = '#374151'; ctx.font = 'bold 11px system-ui';
                ctx.fillText(R4(data[i]), x + bw / 2, y - 5);
            }
        }

        // X axis label
        ctx.fillStyle = '#666'; ctx.font = '12px system-ui'; ctx.textAlign = 'center';
        ctx.fillText('r (number of successes)', pad.l + gw / 2, H - 5);

        // Y axis label
        ctx.save(); ctx.translate(14, pad.t + gh / 2); ctx.rotate(-Math.PI / 2);
        ctx.fillText(cumulative ? 'P(X \u2264 r)' : 'P(X = r)', 0, 0);
        ctx.restore();
    }

    update();
})();


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WORKED EXAMPLES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
(function() {
    var examples = [
        {
            title: 'Example 1: Simple P(X = r)',
            scenario: 'A fair coin is tossed 8 times. Find the probability of getting exactly 3 heads.',
            setup: [
                { label: 'Identify', text: 'X = number of heads in 8 tosses' },
                { label: 'Distribution', text: 'X ~ B(8, 0.5)', isEq: true },
                { label: 'Values', text: 'n = 8, p = 0.5, r = 3' }
            ],
            calc: [
                { label: 'Formula', text: 'P(X = 3) = \u2078C\u2083 \u00D7 0.5\u00B3 \u00D7 0.5\u2075', isEq: true },
                { label: 'nCr', text: '\u2078C\u2083 = 8! / (3! \u00D7 5!) = 56', isEq: true },
                { label: 'Substitute', text: 'P(X = 3) = 56 \u00D7 0.125 \u00D7 0.03125', isEq: true },
                { label: 'Answer', text: 'P(X = 3) = 0.2188 (4 d.p.)', isEq: true }
            ]
        },
        {
            title: 'Example 2: Cumulative P(X \u2264 r)',
            scenario: 'A factory produces items with a 5% defect rate. In a batch of 20, find the probability that at most 2 are defective.',
            setup: [
                { label: 'Identify', text: 'X = number of defective items' },
                { label: 'Distribution', text: 'X ~ B(20, 0.05)', isEq: true },
                { label: 'Values', text: 'n = 20, p = 0.05, want P(X \u2264 2)' }
            ],
            calc: [
                { label: 'Cumulative', text: 'P(X \u2264 2) = P(X=0) + P(X=1) + P(X=2)' },
                { label: 'P(X=0)', text: '\u00B2\u2070C\u2080 \u00D7 0.05\u2070 \u00D7 0.95\u00B2\u2070 = 1 \u00D7 1 \u00D7 0.3585 = 0.3585', isEq: true },
                { label: 'P(X=1)', text: '\u00B2\u2070C\u2081 \u00D7 0.05\u00B9 \u00D7 0.95\u00B9\u2079 = 20 \u00D7 0.05 \u00D7 0.3774 = 0.3774', isEq: true },
                { label: 'P(X=2)', text: '\u00B2\u2070C\u2082 \u00D7 0.05\u00B2 \u00D7 0.95\u00B9\u2078 = 190 \u00D7 0.0025 \u00D7 0.3972 = 0.1887', isEq: true },
                { label: 'Total', text: 'P(X \u2264 2) = 0.3585 + 0.3774 + 0.1887 = 0.9246', isEq: true },
                { label: 'Answer', text: 'There is a 92.46% probability that at most 2 items are defective.' }
            ]
        },
        {
            title: 'Example 3: Complement P(X \u2265 r)',
            scenario: 'A student guesses on a 10-question multiple choice test (4 options each). Find the probability of passing with 5 or more correct.',
            setup: [
                { label: 'Identify', text: 'X = number of correct answers' },
                { label: 'Distribution', text: 'X ~ B(10, 0.25)', isEq: true },
                { label: 'Values', text: 'n = 10, p = 0.25 (1 in 4 chance), want P(X \u2265 5)' },
                { label: 'Strategy', text: 'Use complement: P(X \u2265 5) = 1 - P(X \u2264 4)' }
            ],
            calc: [
                { label: 'P(X=0)', text: '0.0563', isEq: true },
                { label: 'P(X=1)', text: '0.1877', isEq: true },
                { label: 'P(X=2)', text: '0.2816', isEq: true },
                { label: 'P(X=3)', text: '0.2503', isEq: true },
                { label: 'P(X=4)', text: '0.1460', isEq: true },
                { label: 'Sum', text: 'P(X \u2264 4) = 0.9219', isEq: true },
                { label: 'Complement', text: 'P(X \u2265 5) = 1 - 0.9219 = 0.0781', isEq: true },
                { label: 'Answer', text: 'There is only a 7.81% chance of passing by guessing.' }
            ]
        }
    ];

    var container = document.getElementById('weContainer');
    for (var i = 0; i < examples.length; i++) {
        (function(idx) {
            var ex = examples[idx];
            var div = document.createElement('div');
            div.className = 'card we-card';

            var setupHTML = '';
            for (var j = 0; j < ex.setup.length; j++) {
                var s = ex.setup[j];
                setupHTML += '<div class="we-step"><span class="we-step-label">' + s.label + ':</span> ' + (s.isEq ? '<span class="we-eq">' + s.text + '</span>' : s.text) + '</div>';
            }
            var calcHTML = '';
            for (var j = 0; j < ex.calc.length; j++) {
                var s = ex.calc[j];
                calcHTML += '<div class="we-step"><span class="we-step-label">' + s.label + ':</span> ' + (s.isEq ? '<span class="we-eq">' + s.text + '</span>' : s.text) + '</div>';
            }

            div.innerHTML = '<h3 style="margin-bottom:0.5rem;color:var(--gray-800);font-size:1rem;">' + ex.title + '</h3>' +
                '<div class="we-scenario">' + ex.scenario + '</div>' +
                '<div>' +
                '<button class="we-btn we-btn-setup" data-idx="' + idx + '" data-type="setup">\uD83D\uDCCB Show Setup</button>' +
                '<button class="we-btn we-btn-calc" data-idx="' + idx + '" data-type="calc">\uD83E\uDDEE Show Calculation</button>' +
                '</div>' +
                '<div class="we-reveal" id="weSetup' + idx + '">' + setupHTML + '</div>' +
                '<div class="we-reveal" id="weCalc' + idx + '">' + calcHTML + '</div>';
            container.appendChild(div);
        })(i);
    }

    container.addEventListener('click', function(e) {
        var btn = e.target.closest('[data-idx]');
        if (!btn) return;
        var idx = btn.getAttribute('data-idx');
        var type = btn.getAttribute('data-type');
        var el = document.getElementById(type === 'setup' ? 'weSetup' + idx : 'weCalc' + idx);
        el.classList.toggle('visible');
    });
})();


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EXAM-STYLE PROBLEMS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
(function() {
    var problems = [
        {
            title: 'Problem 1 \u2014 Simple',
            text: 'A biased coin has P(heads) = <span class="inference">0.6</span>. It is flipped <span class="inference">10 times</span>. Find the probability of getting <span class="inference">exactly 4</span> heads.',
            extract: [
                { v: 'n', val: '10', reason: '"flipped 10 times" gives the number of trials' },
                { v: 'p', val: '0.6', reason: 'P(heads) = 0.6 given directly' },
                { v: 'r', val: '4', reason: '"exactly 4" is the number of successes' },
                { v: 'q', val: '0.4', reason: 'q = 1 - 0.6 = 0.4' }
            ],
            solution: [
                { label: 'Distribution', text: 'X ~ B(10, 0.6)', isEq: true },
                { label: 'Formula', text: 'P(X = 4) = \u00B9\u2070C\u2084 \u00D7 0.6\u2074 \u00D7 0.4\u2076', isEq: true },
                { label: 'nCr', text: '\u00B9\u2070C\u2084 = 210', isEq: true },
                { label: 'Calculate', text: 'P(X = 4) = 210 \u00D7 0.1296 \u00D7 0.004096', isEq: true },
                { label: 'Answer', text: 'P(X = 4) = 0.1115 (4 d.p.)', isEq: true }
            ]
        },
        {
            title: 'Problem 2 \u2014 Cumulative',
            text: 'A machine produces bolts, <span class="inference">8%</span> of which are faulty. A sample of <span class="inference">15 bolts</span> is taken. Find the probability that <span class="inference">fewer than 3</span> are faulty.',
            extract: [
                { v: 'n', val: '15', reason: 'Sample of 15 bolts' },
                { v: 'p', val: '0.08', reason: '8% defect rate' },
                { v: 'r', val: '\u2264 2', reason: '"fewer than 3" means 0, 1 or 2' },
                { v: 'q', val: '0.92', reason: 'q = 1 - 0.08 = 0.92' }
            ],
            solution: [
                { label: 'Distribution', text: 'X ~ B(15, 0.08)', isEq: true },
                { label: 'Strategy', text: '"fewer than 3" means P(X < 3) = P(X \u2264 2) = P(0) + P(1) + P(2)' },
                { label: 'P(X=0)', text: '\u00B9\u2075C\u2080 \u00D7 0.08\u2070 \u00D7 0.92\u00B9\u2075 = 1 \u00D7 1 \u00D7 0.2863 = 0.2863', isEq: true },
                { label: 'P(X=1)', text: '\u00B9\u2075C\u2081 \u00D7 0.08\u00B9 \u00D7 0.92\u00B9\u2074 = 15 \u00D7 0.08 \u00D7 0.3112 = 0.3734', isEq: true },
                { label: 'P(X=2)', text: '\u00B9\u2075C\u2082 \u00D7 0.08\u00B2 \u00D7 0.92\u00B9\u00B3 = 105 \u00D7 0.0064 \u00D7 0.3383 = 0.2273', isEq: true },
                { label: 'Total', text: 'P(X < 3) = 0.2863 + 0.3734 + 0.2273 = 0.8870', isEq: true },
                { label: 'Answer', text: 'The probability that fewer than 3 bolts are faulty is 0.8870 (4 d.p.).', isEq: false }
            ]
        },
        {
            title: 'Problem 3 \u2014 Complement',
            text: 'In a class of <span class="inference">25 students</span>, each independently has a <span class="inference">0.7 probability</span> of passing an exam. Find the probability that <span class="inference">at least 20</span> pass.',
            extract: [
                { v: 'n', val: '25', reason: '25 students (independent trials)' },
                { v: 'p', val: '0.7', reason: 'Probability of passing = 0.7' },
                { v: 'r', val: '\u2265 20', reason: '"at least 20" means 20, 21, 22, 23, 24 or 25' },
                { v: 'q', val: '0.3', reason: 'q = 1 - 0.7 = 0.3' }
            ],
            solution: [
                { label: 'Distribution', text: 'X ~ B(25, 0.7)', isEq: true },
                { label: 'Strategy', text: 'P(X \u2265 20) = P(20) + P(21) + P(22) + P(23) + P(24) + P(25)' },
                { label: 'P(X=20)', text: '\u00B2\u2075C\u2082\u2080 \u00D7 0.7\u00B2\u2070 \u00D7 0.3\u2075 = 53130 \u00D7 0.000798 \u00D7 0.00243 = 0.1030', isEq: true },
                { label: 'P(X=21)', text: '0.0572', isEq: true },
                { label: 'P(X=22)', text: '0.0234', isEq: true },
                { label: 'P(X=23)', text: '0.0067', isEq: true },
                { label: 'P(X=24)', text: '0.0012', isEq: true },
                { label: 'P(X=25)', text: '0.0001', isEq: true },
                { label: 'Total', text: 'P(X \u2265 20) = 0.1916', isEq: true },
                { label: 'Answer', text: 'The probability that at least 20 students pass is 0.1916 (4 d.p.).', isEq: false }
            ]
        },
        {
            title: 'Problem 4 \u2014 Mean and Variance',
            text: 'Eggs are packed in boxes of <span class="inference">12</span>. The probability that an egg is cracked is <span class="inference">0.05</span>. Find the <span class="inference">expected number</span> of cracked eggs per box and the <span class="inference">standard deviation</span>.',
            extract: [
                { v: 'n', val: '12', reason: '12 eggs per box' },
                { v: 'p', val: '0.05', reason: 'Probability of cracked egg' },
                { v: 'r', val: 'N/A', reason: 'Not looking for a specific r here' },
                { v: 'q', val: '0.95', reason: 'q = 1 - 0.05 = 0.95' }
            ],
            solution: [
                { label: 'Distribution', text: 'X ~ B(12, 0.05)', isEq: true },
                { label: 'Expected value', text: 'E(X) = np = 12 \u00D7 0.05 = 0.6', isEq: true },
                { label: 'Variance', text: 'Var(X) = npq = 12 \u00D7 0.05 \u00D7 0.95 = 0.57', isEq: true },
                { label: 'Std Dev', text: '\u03C3 = \u221A0.57 = 0.7550', isEq: true },
                { label: 'Answer', text: 'The expected number of cracked eggs is 0.6 and the standard deviation is 0.755 (3 d.p.).', isEq: false }
            ]
        },
        {
            title: 'Problem 5 \u2014 Reverse Problem',
            text: 'X ~ B(<span class="inference">20</span>, <span class="inference">p</span>). Given that <span class="inference">P(X = 0) = 0.0115</span>, find the value of <span class="var-p">p</span>.',
            extract: [
                { v: 'n', val: '20', reason: 'Given in the distribution' },
                { v: 'p', val: '?', reason: 'This is what we want to find' },
                { v: 'r', val: '0', reason: 'P(X = 0) is given' },
                { v: 'q', val: '1 - p', reason: 'Unknown until we find p' }
            ],
            solution: [
                { label: 'Setup', text: 'P(X = 0) = \u00B2\u2070C\u2080 \u00D7 p\u2070 \u00D7 (1-p)\u00B2\u2070 = 0.0115' },
                { label: 'Simplify', text: '(1 - p)\u00B2\u2070 = 0.0115', isEq: true },
                { label: 'Root', text: '1 - p = 0.0115^(1/20)', isEq: true },
                { label: 'Calculate', text: '1 - p = 0.0115^0.05 = 0.7943', isEq: true },
                { label: 'Solve', text: 'p = 1 - 0.7943 = 0.2057', isEq: true },
                { label: 'Answer', text: 'p = 0.206 (3 d.p.).', isEq: false }
            ]
        },
        {
            title: 'Problem 6 \u2014 Multi-Part',
            text: 'A test has <span class="inference">12</span> true/false questions. A student <span class="inference">guesses every answer</span>. Find (a) P(exactly 6 correct), (b) P(at least 10 correct), (c) the expected number correct.',
            extract: [
                { v: 'n', val: '12', reason: '12 questions' },
                { v: 'p', val: '0.5', reason: '"guesses" on true/false means 50/50' },
                { v: 'r', val: 'varies', reason: 'Part (a): r=6, Part (b): r\u226510' },
                { v: 'q', val: '0.5', reason: 'q = 1 - 0.5 = 0.5' }
            ],
            solution: [
                { label: 'Distribution', text: 'X ~ B(12, 0.5)', isEq: true },
                { label: '(a) P(X=6)', text: '\u00B9\u00B2C\u2086 \u00D7 0.5\u2076 \u00D7 0.5\u2076 = 924 \u00D7 0.5\u00B9\u00B2 = 924 / 4096 = 0.2256', isEq: true },
                { label: '(b) Strategy', text: 'P(X \u2265 10) = P(10) + P(11) + P(12)' },
                { label: 'P(X=10)', text: '\u00B9\u00B2C\u2081\u2080 \u00D7 0.5\u00B9\u00B2 = 66/4096 = 0.0161', isEq: true },
                { label: 'P(X=11)', text: '\u00B9\u00B2C\u2081\u2081 \u00D7 0.5\u00B9\u00B2 = 12/4096 = 0.0029', isEq: true },
                { label: 'P(X=12)', text: '0.5\u00B9\u00B2 = 1/4096 = 0.0002', isEq: true },
                { label: '(b) Total', text: 'P(X \u2265 10) = 0.0161 + 0.0029 + 0.0002 = 0.0193', isEq: true },
                { label: '(c) E(X)', text: 'E(X) = np = 12 \u00D7 0.5 = 6', isEq: true },
                { label: 'Answer', text: '(a) 0.2256, (b) 0.0193, (c) 6 correct answers expected.', isEq: false }
            ]
        }
    ];

    var container = document.getElementById('wpContainer');
    var current = 0;

    for (var pi = 0; pi < problems.length; pi++) {
        (function(i) {
            var p = problems[i];
            var div = document.createElement('div');
            div.className = 'wp-problem' + (i === 0 ? ' active' : '');
            div.id = 'wp-' + i;

            var extractHTML = '<table><thead><tr><th>Variable</th><th>Value</th><th>Reasoning</th></tr></thead><tbody>';
            for (var j = 0; j < p.extract.length; j++) {
                var e = p.extract[j];
                extractHTML += '<tr><td><span class="var-' + e.v + '" style="font-size:1.1rem;font-weight:700;">' + e.v + '</span></td><td style="font-weight:600;">' + e.val + '</td><td class="reasoning">' + e.reason + '</td></tr>';
            }
            extractHTML += '</tbody></table>';

            var solHTML = '';
            for (var j = 0; j < p.solution.length; j++) {
                var s = p.solution[j];
                solHTML += '<div class="step"><span class="step-label">' + s.label + ':</span> ' + (s.isEq ? '<span class="eq-highlight">' + s.text + '</span>' : s.text) + '</div>';
            }

            div.innerHTML = '<h3 style="margin-bottom:0.75rem;color:var(--gray-800);">' + p.title + '</h3>' +
                '<div class="wp-text">' + p.text + '</div>' +
                '<div>' +
                '<button class="wp-btn wp-btn-extract" data-idx="' + i + '" data-type="extract">\uD83D\uDCCA Extract Values</button>' +
                '<button class="wp-btn wp-btn-solution" data-idx="' + i + '" data-type="solution">\u2705 Show Solution</button>' +
                '</div>' +
                '<div class="wp-extract" id="wpE' + i + '">' + extractHTML + '</div>' +
                '<div class="wp-solution" id="wpS' + i + '">' + solHTML + '</div>';
            container.appendChild(div);
        })(pi);
    }

    container.addEventListener('click', function(e) {
        var btn = e.target.closest('[data-idx]');
        if (!btn) return;
        var idx = parseInt(btn.getAttribute('data-idx'));
        var type = btn.getAttribute('data-type');
        var el = document.getElementById(type === 'extract' ? 'wpE' + idx : 'wpS' + idx);
        el.classList.toggle('visible');
        if (type === 'extract' && el.classList.contains('visible')) {
            var infs = document.querySelectorAll('#wp-' + idx + ' .inference');
            for (var j = 0; j < infs.length; j++) infs[j].classList.add('shown');
        }
    });

    document.getElementById('wpPrev').addEventListener('click', function() { nav(-1); });
    document.getElementById('wpNext').addEventListener('click', function() { nav(1); });

    function nav(dir) {
        document.getElementById('wp-' + current).classList.remove('active');
        current = Math.max(0, Math.min(problems.length - 1, current + dir));
        document.getElementById('wp-' + current).classList.add('active');
        document.getElementById('wpNum').textContent = current + 1;
        document.getElementById('wpPrev').disabled = current === 0;
        document.getElementById('wpNext').disabled = current === problems.length - 1;
    }
})();
</script>
</body>
</html>
