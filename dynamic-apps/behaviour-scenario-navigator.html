<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bullying Scenario Navigator</title>
<style>
  :root {
    --bg-primary: #e8f4f8;
    --bg-secondary: #f0f7fa;
    --header-bg: #2c6e7a;
    --header-text: #ffffff;
    --card-bg: #ffffff;
    --card-warm: #fef9f0;
    --card-border: #d4e8ed;
    --text-primary: #1a3a40;
    --text-secondary: #4a6d75;
    --text-muted: #7a9da6;
    --accent-teal: #3a9fb5;
    --accent-blue: #4a8bc2;
    --outcome-green: #2d9a5c;
    --outcome-green-bg: #e6f7ed;
    --outcome-green-border: #a3dbb8;
    --outcome-amber: #d4930a;
    --outcome-amber-bg: #fef6e0;
    --outcome-amber-border: #f0d78a;
    --outcome-red: #c0392b;
    --outcome-red-bg: #fce8e6;
    --outcome-red-border: #f0a8a1;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
    --shadow-md: 0 3px 10px rgba(0,0,0,0.1);
    --shadow-lg: 0 6px 20px rgba(0,0,0,0.12);
    --radius: 10px;
    --radius-sm: 6px;
    --transition: 0.25s ease;
    --physical-colour: #e74c3c;
    --verbal-colour: #e67e22;
    --social-colour: #8e44ad;
    --cyber-colour: #2980b9;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
  }
  header {
    position: sticky; top: 0; z-index: 100;
    background: var(--header-bg);
    color: var(--header-text);
    padding: 14px 24px;
    box-shadow: var(--shadow-md);
  }
  header h1 { font-size: 1.35rem; font-weight: 700; }
  header p { font-size: 0.85rem; opacity: 0.85; margin-top: 2px; }
  .container { max-width: 960px; margin: 0 auto; padding: 20px 16px 40px; }
  .nav-tabs {
    display: flex; gap: 6px; flex-wrap: wrap;
    background: var(--card-bg); border-radius: var(--radius);
    padding: 8px; margin-bottom: 20px; box-shadow: var(--shadow-sm);
  }
  .nav-tab {
    padding: 8px 16px; border: none; background: transparent;
    border-radius: var(--radius-sm); cursor: pointer;
    font-size: 0.85rem; font-weight: 500; color: var(--text-secondary);
    transition: var(--transition);
  }
  .nav-tab:hover { background: var(--bg-secondary); }
  .nav-tab.active { background: var(--accent-teal); color: #fff; }
  .section { display: none; }
  .section.active { display: block; }
  .card {
    background: var(--card-bg); border-radius: var(--radius);
    padding: 22px; margin-bottom: 16px; box-shadow: var(--shadow-sm);
    border: 1px solid var(--card-border);
  }
  .card-warm { background: var(--card-warm); }
  h2 { font-size: 1.2rem; margin-bottom: 14px; color: var(--header-bg); }
  h3 { font-size: 1.05rem; margin-bottom: 10px; color: var(--text-primary); }
  p { margin-bottom: 10px; }
  .type-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 14px; }
  .type-card {
    border-radius: var(--radius); padding: 18px;
    background: var(--card-bg); border-left: 5px solid;
    box-shadow: var(--shadow-sm); transition: var(--transition);
  }
  .type-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
  .type-card.physical { border-color: var(--physical-colour); }
  .type-card.verbal { border-color: var(--verbal-colour); }
  .type-card.social { border-color: var(--social-colour); }
  .type-card.cyber { border-color: var(--cyber-colour); }
  .type-card h4 { font-size: 0.95rem; margin-bottom: 6px; }
  .type-card.physical h4 { color: var(--physical-colour); }
  .type-card.verbal h4 { color: var(--verbal-colour); }
  .type-card.social h4 { color: var(--social-colour); }
  .type-card.cyber h4 { color: var(--cyber-colour); }
  .type-card p { font-size: 0.85rem; color: var(--text-secondary); margin: 0; }
  .type-card .examples { font-size: 0.8rem; color: var(--text-muted); margin-top: 8px; font-style: italic; }
  .scenario-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 14px; }
  .scenario-card {
    background: var(--card-bg); border-radius: var(--radius);
    padding: 18px; cursor: pointer; border: 2px solid var(--card-border);
    transition: var(--transition); text-align: center;
  }
  .scenario-card:hover { border-color: var(--accent-teal); box-shadow: var(--shadow-md); }
  .scenario-card .icon { font-size: 2rem; margin-bottom: 8px; }
  .scenario-card h4 { font-size: 0.95rem; margin-bottom: 4px; }
  .scenario-card p { font-size: 0.8rem; color: var(--text-secondary); margin: 0; }
  .scenario-card .badge {
    display: inline-block; margin-top: 8px; padding: 2px 10px;
    border-radius: 12px; font-size: 0.72rem; font-weight: 600;
  }
  .scenario-card .badge.completed { background: var(--outcome-green-bg); color: var(--outcome-green); }
  .scenario-card .badge.not-done { background: var(--bg-secondary); color: var(--text-muted); }
  .role-selector { display: flex; gap: 10px; flex-wrap: wrap; margin: 14px 0; }
  .role-btn {
    padding: 10px 20px; border: 2px solid var(--card-border);
    border-radius: var(--radius-sm); background: var(--card-bg);
    cursor: pointer; font-size: 0.88rem; font-weight: 500;
    transition: var(--transition);
  }
  .role-btn:hover { border-color: var(--accent-teal); }
  .role-btn.active { border-color: var(--accent-teal); background: var(--accent-teal); color: #fff; }
  .story-text {
    background: var(--card-warm); border-radius: var(--radius-sm);
    padding: 18px; margin: 14px 0; font-size: 0.95rem;
    border-left: 4px solid var(--accent-teal); line-height: 1.7;
  }
  .choices { display: flex; flex-direction: column; gap: 10px; margin: 14px 0; }
  .choice-btn {
    padding: 14px 18px; border: 2px solid var(--card-border);
    border-radius: var(--radius-sm); background: var(--card-bg);
    cursor: pointer; text-align: left; font-size: 0.88rem;
    transition: var(--transition); line-height: 1.5;
  }
  .choice-btn:hover { border-color: var(--accent-teal); background: var(--bg-secondary); }
  .consequence {
    border-radius: var(--radius-sm); padding: 16px; margin: 14px 0;
    font-size: 0.9rem; line-height: 1.6;
  }
  .consequence.positive { background: var(--outcome-green-bg); border: 1px solid var(--outcome-green-border); }
  .consequence.neutral { background: var(--outcome-amber-bg); border: 1px solid var(--outcome-amber-border); }
  .consequence.negative { background: var(--outcome-red-bg); border: 1px solid var(--outcome-red-border); }
  .consequence .label {
    font-weight: 700; font-size: 0.78rem; text-transform: uppercase;
    letter-spacing: 0.5px; margin-bottom: 6px;
  }
  .consequence.positive .label { color: var(--outcome-green); }
  .consequence.neutral .label { color: var(--outcome-amber); }
  .consequence.negative .label { color: var(--outcome-red); }
  .btn {
    padding: 10px 22px; border: none; border-radius: var(--radius-sm);
    font-size: 0.88rem; font-weight: 600; cursor: pointer;
    transition: var(--transition);
  }
  .btn-primary { background: var(--accent-teal); color: #fff; }
  .btn-primary:hover { background: #2c8a9e; }
  .btn-secondary { background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--card-border); }
  .btn-secondary:hover { background: #dbe9ee; }
  .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 16px; }
  .outcome-banner {
    text-align: center; padding: 24px; border-radius: var(--radius);
    margin-bottom: 16px;
  }
  .outcome-banner.positive { background: var(--outcome-green-bg); border: 2px solid var(--outcome-green-border); }
  .outcome-banner.neutral { background: var(--outcome-amber-bg); border: 2px solid var(--outcome-amber-border); }
  .outcome-banner.negative { background: var(--outcome-red-bg); border: 2px solid var(--outcome-red-border); }
  .outcome-banner h3 { font-size: 1.15rem; }
  .outcome-banner.positive h3 { color: var(--outcome-green); }
  .outcome-banner.neutral h3 { color: var(--outcome-amber); }
  .outcome-banner.negative h3 { color: var(--outcome-red); }
  .review-item {
    padding: 12px 16px; border-radius: var(--radius-sm);
    margin-bottom: 8px; font-size: 0.88rem;
  }
  .review-item .step-label { font-weight: 600; font-size: 0.78rem; color: var(--text-muted); text-transform: uppercase; }
  .best-response {
    background: var(--outcome-green-bg); border: 1px solid var(--outcome-green-border);
    border-radius: var(--radius-sm); padding: 16px; margin: 10px 0;
  }
  .best-response h4 { color: var(--outcome-green); margin-bottom: 6px; font-size: 0.9rem; }
  .best-response p { font-size: 0.85rem; margin: 0; }
  .takeaway-list { list-style: none; }
  .takeaway-list li {
    padding: 8px 0 8px 24px; position: relative;
    font-size: 0.88rem; border-bottom: 1px solid var(--card-border);
  }
  .takeaway-list li:last-child { border: none; }
  .takeaway-list li::before {
    content: '\2713'; position: absolute; left: 0;
    color: var(--outcome-green); font-weight: 700;
  }
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 14px; }
  .stat-card {
    text-align: center; padding: 18px; background: var(--card-bg);
    border-radius: var(--radius); box-shadow: var(--shadow-sm);
  }
  .stat-card .stat-value { font-size: 2rem; font-weight: 700; color: var(--accent-teal); }
  .stat-card .stat-label { font-size: 0.78rem; color: var(--text-muted); margin-top: 4px; }
  .contact-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 14px; }
  .contact-card {
    padding: 18px; border-radius: var(--radius);
    background: var(--card-bg); box-shadow: var(--shadow-sm);
    border: 1px solid var(--card-border);
  }
  .contact-card h4 { color: var(--accent-teal); margin-bottom: 4px; font-size: 0.95rem; }
  .contact-card p { font-size: 0.82rem; color: var(--text-secondary); margin: 0; }
  .contact-card .phone { font-weight: 600; color: var(--text-primary); font-size: 0.95rem; margin-top: 6px; display: block; }
  .info-block { margin-bottom: 16px; }
  .info-block h3 { color: var(--header-bg); margin-bottom: 6px; }
  .info-block p, .info-block ul { font-size: 0.9rem; color: var(--text-secondary); }
  .info-block ul { padding-left: 20px; }
  .info-block li { margin-bottom: 4px; }
  .progress-bar-track {
    height: 8px; background: var(--bg-secondary); border-radius: 4px;
    overflow: hidden; margin: 10px 0;
  }
  .progress-bar-fill {
    height: 100%; background: var(--accent-teal); border-radius: 4px;
    transition: width 0.4s ease;
  }
  .step-indicator { font-size: 0.82rem; color: var(--text-muted); margin-bottom: 8px; }
  @media (max-width: 600px) {
    header { padding: 12px 16px; }
    header h1 { font-size: 1.1rem; }
    .nav-tabs { gap: 4px; padding: 6px; }
    .nav-tab { padding: 6px 12px; font-size: 0.78rem; }
    .container { padding: 14px 10px 30px; }
    .card { padding: 16px; }
    .type-grid, .scenario-list, .contact-grid { grid-template-columns: 1fr; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>
<header>
  <h1>Bullying Scenario Navigator</h1>
  <p>Scenario-based training: recognise bullying, choose the right response, understand the impact</p>
</header>
<div class="container">
  <nav class="nav-tabs" id="navTabs">
    <button class="nav-tab active" data-tab="types">Types of Bullying</button>
    <button class="nav-tab" data-tab="scenarios">Scenarios</button>
    <button class="nav-tab" data-tab="stats">Progress</button>
    <button class="nav-tab" data-tab="contacts">Key Contacts</button>
    <button class="nav-tab" data-tab="info">Understanding Bullying</button>
  </nav>

  <!-- Types Section -->
  <div class="section active" id="sec-types">
    <div class="card">
      <h2>Recognising Types of Bullying</h2>
      <p>Bullying is repeated behaviour intended to hurt, intimidate, or control someone. It can take many forms. Understanding the types helps us recognise it early and take action.</p>
    </div>
    <div class="type-grid">
      <div class="type-card physical">
        <h4>Physical Bullying</h4>
        <p>Using physical force or actions to harm, intimidate, or control another person.</p>
        <div class="examples">Examples: pushing, hitting, blocking someone's path, taking or damaging belongings, threatening gestures</div>
      </div>
      <div class="type-card verbal">
        <h4>Verbal Bullying</h4>
        <p>Using words to cause distress, humiliate, or belittle someone repeatedly.</p>
        <div class="examples">Examples: name-calling, mocking, making threats, hurtful comments about appearance or ability</div>
      </div>
      <div class="type-card social">
        <h4>Social / Relational Bullying</h4>
        <p>Deliberately damaging someone's social standing, friendships, or sense of belonging.</p>
        <div class="examples">Examples: spreading rumours, excluding someone from groups, whispering about someone, embarrassing someone publicly</div>
      </div>
      <div class="type-card cyber">
        <h4>Cyberbullying</h4>
        <p>Using technology and online platforms to harass, threaten, or humiliate someone.</p>
        <div class="examples">Examples: nasty messages in group chats, sharing embarrassing photos, creating fake accounts, online threats</div>
      </div>
    </div>
  </div>

  <!-- Scenarios Section -->
  <div class="section" id="sec-scenarios">
    <div class="card">
      <h2>Choose a Scenario</h2>
      <p>Work through each scenario by choosing a role and making decisions at key moments. Your choices affect the outcome.</p>
    </div>
    <div class="scenario-list" id="scenarioList"></div>
    <div id="scenarioPlay" style="display:none;"></div>
  </div>

  <!-- Stats Section -->
  <div class="section" id="sec-stats">
    <div class="card">
      <h2>Your Progress</h2>
      <p>Track how you are doing across all scenarios.</p>
    </div>
    <div class="stats-grid" id="statsGrid"></div>
    <div class="card" style="margin-top:16px;" id="statsDetail"></div>
  </div>

  <!-- Contacts Section -->
  <div class="section" id="sec-contacts">
    <div class="card">
      <h2>Key Contacts</h2>
      <p>If you or someone you know is being bullied, these people and organisations can help. You are never alone, and speaking up is always the right thing to do.</p>
    </div>
    <div class="contact-grid">
      <div class="contact-card">
        <h4>A Trusted Teacher</h4>
        <p>Your form tutor, head of year, or any adult in school you feel safe talking to. They are trained to help.</p>
      </div>
      <div class="contact-card">
        <h4>A Parent or Carer</h4>
        <p>Talk to a parent, carer, or trusted family member. They can support you and contact the school if needed.</p>
      </div>
      <div class="contact-card">
        <h4>Childline</h4>
        <p>Free, confidential helpline for children and young people. Available 24 hours a day.</p>
        <span class="phone">0800 1111</span>
      </div>
      <div class="contact-card">
        <h4>CEOP (Child Exploitation and Online Protection)</h4>
        <p>Report concerns about online abuse or inappropriate contact. Part of the National Crime Agency.</p>
        <span class="phone">ceop.police.uk</span>
      </div>
      <div class="contact-card">
        <h4>Anti-Bullying Alliance</h4>
        <p>Information, advice, and resources for young people, parents, and professionals.</p>
        <span class="phone">anti-bullyingalliance.org.uk</span>
      </div>
      <div class="contact-card">
        <h4>School Pastoral Team</h4>
        <p>Your school's pastoral or safeguarding team can provide direct support and put plans in place to keep you safe.</p>
      </div>
    </div>
  </div>

  <!-- Info Section -->
  <div class="section" id="sec-info">
    <div class="card">
      <h2>Understanding Bullying</h2>
    </div>
    <div class="card info-block">
      <h3>What Is Bullying (and What Is It Not)?</h3>
      <p>Bullying is repeated, intentional behaviour that causes harm to another person. It involves an imbalance of power, where the person doing the bullying has (or is perceived to have) more power than the target.</p>
      <p>Conflict is different from bullying. A disagreement between two people of equal standing, or a one-off falling out, is not necessarily bullying. However, if conflict becomes one-sided, repeated, and deliberately hurtful, it may cross the line into bullying.</p>
    </div>
    <div class="card info-block">
      <h3>Impact on Mental Health</h3>
      <p>Being bullied can have serious and lasting effects on mental health, including:</p>
      <ul>
        <li>Anxiety, low mood, and depression</li>
        <li>Loss of confidence and self-esteem</li>
        <li>Difficulty concentrating and declining academic performance</li>
        <li>Withdrawal from friends, activities, and school</li>
        <li>Physical symptoms such as headaches, stomach aches, and difficulty sleeping</li>
        <li>In severe cases, self-harm or suicidal thoughts</li>
      </ul>
      <p>It is important that anyone experiencing these effects speaks to a trusted adult as soon as possible.</p>
    </div>
    <div class="card info-block">
      <h3>The Bystander Effect</h3>
      <p>The bystander effect describes how people are less likely to help someone in distress when others are present. Each person assumes someone else will step in. In bullying situations, this means the target may feel completely alone even when surrounded by people.</p>
      <p>Research shows that when a bystander does intervene, bullying stops within 10 seconds over half the time. Being an active bystander, even by simply standing with the person being bullied or reporting it to an adult, can make a significant difference.</p>
    </div>
    <div class="card info-block">
      <h3>How to Report Bullying</h3>
      <ul>
        <li>Tell a trusted adult: a teacher, parent, carer, or other family member.</li>
        <li>Use your school's reporting system (some schools have anonymous reporting tools).</li>
        <li>Keep evidence: save messages, take screenshots, note dates and times.</li>
        <li>For online bullying: report content directly on the platform and block the person.</li>
        <li>Contact Childline (0800 1111) if you need someone to talk to confidentially.</li>
        <li>If you feel in immediate danger, call 999.</li>
      </ul>
    </div>
  </div>
</div>

<script>
const SCENARIOS = [
  {
    id: 'cyber', title: 'Cyberbullying: Group Chat', icon: '\uD83D\uDCF1',
    type: 'Cyberbullying', colour: 'cyber',
    desc: 'Nasty messages are being sent about a classmate in a group chat.',
    intro: 'A group chat that started for a school project has taken a nasty turn. Over the past week, three or four people have been posting mean comments about Jamie, a quiet student in your class. Tonight the messages have become especially cruel, mocking Jamie\'s appearance and making up embarrassing stories. Several people have seen the messages. Jamie is in the chat and has gone silent.',
    roles: ['The Target (Jamie)', 'A Bystander in the Chat', 'Jamie\'s Friend'],
    stages: [
      {
        text: {
          0: 'You open the group chat and see a flood of messages mocking you. Your stomach drops. Some people have reacted with laughing emojis. Nobody has said anything in your defence. What do you do first?',
          1: 'You scroll through the chat and see the cruel messages about Jamie. Several others are online but nobody has said anything. You feel uncomfortable. What do you do?',
          2: 'Jamie has just messaged you privately saying they feel sick about what is happening in the group chat. You open it and see the messages. What do you do?'
        },
        choices: [
          {
            text: { 0: 'Screenshot the messages and leave the group chat.', 1: 'Type a message telling people to stop because this is bullying.', 2: 'Reply to Jamie with support, then screenshot the messages and tell a trusted adult.' },
            consequence: 'You take action to preserve evidence and protect yourself (or your friend). This is a strong first step that keeps you safe while making it possible to report what happened.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Send a message defending yourself and telling them to stop.', 1: 'Message Jamie privately to check on them, but say nothing in the group.', 2: 'Tell Jamie to just leave the chat and ignore it.' },
            consequence: 'Reaching out to the target shows care, but without reporting or challenging the behaviour publicly, the bullying is likely to continue unchecked.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Delete the app and try to forget about it.', 1: 'Close the chat and decide it is not your problem.', 2: 'Read the messages but decide not to get involved in case you become a target too.' },
            consequence: 'Avoiding the situation means the bullying continues with no consequences for anyone. The target feels even more isolated and alone.',
            rating: 'negative', score: 1
          }
        ]
      },
      {
        text: {
          0: 'The next morning at school, you see some of the people from the chat laughing in a group. One of them smirks at you as you walk past. What do you do next?',
          1: 'The next day at school, you notice Jamie sitting alone at break looking upset. The people from the chat are nearby, still laughing. What do you do?',
          2: 'At school the next day, Jamie looks withdrawn and has not spoken to anyone. You overhear the group laughing about the chat. What do you do?'
        },
        choices: [
          {
            text: { 0: 'Go straight to your head of year and show them the screenshots.', 1: 'Sit with Jamie and then go together to tell a teacher what happened.', 2: 'Walk over to Jamie, sit with them, and suggest you both go to a teacher together.' },
            consequence: 'Speaking to a trusted adult means the school can investigate and take action. Having evidence (screenshots) makes it much easier for staff to address the situation effectively.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Confront the group and tell them what they did was wrong.', 1: 'Sit with Jamie to show support, but do not report it.', 2: 'Tell the group to stop, but do not involve any adults.' },
            consequence: 'Standing up takes courage, but without adult involvement, the behaviour may continue behind the scenes or escalate. The school needs to know so they can put proper support in place.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Keep your head down and hope it blows over.', 1: 'Walk past and sit somewhere else; you do not want to draw attention to yourself.', 2: 'Wait to see if Jamie brings it up; you do not want to make things awkward.' },
            consequence: 'Inaction allows the bullying to continue. The target remains unsupported, and the people responsible face no accountability.',
            rating: 'negative', score: 1
          }
        ]
      },
      {
        text: {
          0: 'A teacher has been told about the situation and asks to speak to you. They want to understand what happened. How do you handle this?',
          1: 'A teacher has heard something happened in the group chat and asks if you know anything about it. What do you say?',
          2: 'A teacher asks you if you know anything about what has been going on with Jamie. How do you respond?'
        },
        choices: [
          {
            text: { 0: 'Show the teacher everything, explain how it made you feel, and ask what happens next.', 1: 'Tell the truth, share what you saw, and offer to show your phone if it helps.', 2: 'Explain everything you know, share screenshots Jamie sent you, and ask how you can support Jamie.' },
            consequence: 'Being honest and transparent helps the school take appropriate action. Sharing evidence and your feelings means the full picture is understood and proper support can be put in place.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Tell the teacher some of what happened but downplay it because you feel embarrassed.', 1: 'Confirm something happened but say you do not remember the details.', 2: 'Say you heard something but are not sure of the details, as you do not want to get anyone in trouble.' },
            consequence: 'Partially sharing information is better than nothing, but important details may be missed. The school may not be able to fully address the situation without the complete picture.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Say it was just banter and that you are fine.', 1: 'Say you were not really paying attention and do not know anything.', 2: 'Say Jamie is fine and it was just a joke that got out of hand.' },
            consequence: 'Minimising or hiding what happened protects the bullies and leaves the target without support. The behaviour is likely to continue or get worse.',
            rating: 'negative', score: 1
          }
        ]
      }
    ],
    bestPath: [0, 0, 0],
    takeaways: [
      'Always screenshot evidence of cyberbullying before leaving a chat or blocking.',
      'Reporting to a trusted adult is the most effective step you can take.',
      'Standing with the target, even just sitting with them, shows them they are not alone.',
      'Being honest when a teacher asks helps the school take proper action.',
      'Cyberbullying is just as serious as face-to-face bullying. Never dismiss it as "just online".'
    ]
  },
  {
    id: 'social', title: 'Social Exclusion', icon: '\uD83D\uDEAB',
    type: 'Social / Relational', colour: 'social',
    desc: 'A student is being deliberately left out by their friendship group.',
    intro: 'Over the past two weeks, Alex has gradually been pushed out of their friendship group. It started with not being told about plans at the weekend. Now, at lunchtime, the group moves away when Alex approaches. When Alex asks what is wrong, they are met with shrugs and "nothing". Yesterday, Alex found out through social media that the whole group went to the cinema without them.',
    roles: ['The Target (Alex)', 'A Member of the Group', 'An Outside Friend'],
    stages: [
      {
        text: {
          0: 'You walk over to your usual table at lunch and everyone gets up and moves to a different spot. They do not say anything to you. You are standing there alone. What do you do?',
          1: 'The group has just moved away from Alex again. You can see the hurt on their face. Someone whispers "just ignore them". What do you do?',
          2: 'You notice Alex standing alone in the lunch hall looking confused and upset. You know they used to sit with that group. What do you do?'
        },
        choices: [
          {
            text: { 0: 'Find a teacher or trusted adult and explain what has been happening over the past two weeks.', 1: 'Stay behind, go to Alex, and say you think what the group is doing is wrong.', 2: 'Go over to Alex, invite them to sit with you, and ask if they are okay.' },
            consequence: 'Reaching out directly and acknowledging the problem is a powerful step. It breaks the isolation and shows the target that someone cares enough to act.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Sit somewhere else on your own and try not to let anyone see you are upset.', 1: 'Feel uncomfortable but stay with the group; you do not want to be excluded too.', 2: 'Smile at Alex from across the room but continue with your own group.' },
            consequence: 'Avoiding confrontation is understandable, but it allows the exclusion to continue. The target remains isolated and may believe nobody has noticed or cares.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Pretend you wanted to sit somewhere else anyway. Act like you do not care.', 1: 'Go along with the group. It is easier not to make a fuss.', 2: 'Assume it is just a normal friendship fallout and that they will sort it out themselves.' },
            consequence: 'Doing nothing, or pretending the problem does not exist, reinforces the exclusion. The target feels invisible, and the group faces no challenge to their behaviour.',
            rating: 'negative', score: 1
          }
        ]
      },
      {
        text: {
          0: 'Someone from the group sends you a message saying "nobody wants you around any more". You feel devastated. What do you do?',
          1: 'You see a message in the group chat organising another event without Alex. Someone says "do NOT invite Alex". What do you do?',
          2: 'Alex tells you they received a message saying "nobody wants you around". They are in tears. What do you do?'
        },
        choices: [
          {
            text: { 0: 'Save the message and show it to a parent or teacher as evidence of what is happening.', 1: 'Screenshot the message and take it to a teacher. This is clear evidence of deliberate exclusion.', 2: 'Comfort Alex, help them save the message, and offer to go with them to tell a trusted adult.' },
            consequence: 'Evidence is crucial. Saving the message and reporting it means an adult can intervene properly. The pattern of exclusion becomes undeniable and can be addressed.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Reply angrily telling them they are being cruel.', 1: 'Privately message Alex to say you are sorry about what is happening.', 2: 'Tell Alex it will get better and try to cheer them up.' },
            consequence: 'Emotional support matters, but without reporting the behaviour, the group is unlikely to change. The target needs more than kind words; they need an adult to step in.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Delete the message and try to move on.', 1: 'Say nothing because you do not want to be the next target.', 2: 'Tell Alex they should try to find new friends and move on.' },
            consequence: 'Deleting evidence or dismissing the situation allows the bullying to continue without accountability. The target loses both proof and hope that things might change.',
            rating: 'negative', score: 1
          }
        ]
      },
      {
        text: {
          0: 'The school has investigated and asked you how you would like things to move forward. What do you suggest?',
          1: 'A teacher has spoken to the group and asks if you have anything to add about what you witnessed. What do you do?',
          2: 'The school is now aware of the situation. A teacher asks if you can help support Alex going forward. What do you say?'
        },
        choices: [
          {
            text: { 0: 'Ask for a meeting where the group hears how their actions affected you, with a teacher present to keep it safe.', 1: 'Share everything honestly, including your own role in not speaking up sooner, and support whatever the school decides.', 2: 'Offer to include Alex in your friend group and check in with them regularly. Ask the teacher how else you can help.' },
            consequence: 'Open, honest resolution with adult support creates the best chance for lasting change. Accountability, empathy, and a plan for moving forward help everyone involved.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Say you just want it to stop and do not want a big fuss made about it.', 1: 'Confirm the basics but do not go into too much detail.', 2: 'Say you will keep an eye on things but do not commit to anything specific.' },
            consequence: 'Wanting a quiet resolution is understandable, but without clear accountability and a plan, the same patterns can easily return.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Say everything is fine now and you do not need any help.', 1: 'Say you did not really see much and downplay your involvement.', 2: 'Say Alex seems fine now and probably does not need extra support.' },
            consequence: 'Dismissing the situation or withdrawing from the process means the underlying issues remain unresolved. Without follow-through, the risk of repeated exclusion is high.',
            rating: 'negative', score: 1
          }
        ]
      }
    ],
    bestPath: [0, 0, 0],
    takeaways: [
      'Social exclusion is a form of bullying, even when there is no name-calling or physical aggression.',
      'Keep evidence of deliberate exclusion (messages, screenshots) to show a trusted adult.',
      'If you are part of a group that is excluding someone, you have the power to change the dynamic.',
      'Inviting someone who is being excluded to join you can make an enormous difference to how they feel.',
      'Schools can help with restorative conversations where everyone is heard safely.'
    ]
  },
  {
    id: 'verbal', title: 'Verbal Bullying: Name-Calling', icon: '\uD83D\uDDE3\uFE0F',
    type: 'Verbal', colour: 'verbal',
    desc: 'Repeated name-calling is happening openly in class.',
    intro: 'For the past three weeks, Sam has been called hurtful names by a small group of students during lessons. It happens when the teacher\'s back is turned or during group work. The names target Sam\'s appearance and the way they speak. Some students laugh, which encourages it. Sam has started sitting at the back of the room and barely participates any more.',
    roles: ['The Target (Sam)', 'A Classmate Who Witnesses It', 'Sam\'s Friend'],
    stages: [
      {
        text: {
          0: 'During group work, someone mutters a cruel name at you and two others snigger. The teacher does not hear. Your face burns. What do you do?',
          1: 'You hear someone call Sam a hurtful name during group work. Others laugh. Sam looks down and says nothing. What do you do?',
          2: 'You are sitting near Sam when you hear the name-calling. Sam flinches but stays quiet. You can see they are upset. What do you do?'
        },
        choices: [
          {
            text: { 0: 'Put your hand up and tell the teacher what just happened, clearly and calmly.', 1: 'Speak up immediately: "That is not okay. Stop saying that."', 2: 'Calmly but clearly say to the group: "That is bullying. Stop it." Then check on Sam.' },
            consequence: 'Speaking up in the moment disrupts the bullying and sends a clear signal that the behaviour is unacceptable. It takes courage, but it is highly effective.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Write down what was said and who said it so you have a record.', 1: 'After the lesson, tell Sam you heard what happened and ask if they are okay.', 2: 'Quietly tell Sam you are on their side and will support them if they want to report it.' },
            consequence: 'Noting details and offering private support is helpful, but without challenging the behaviour or reporting it, the name-calling will likely continue in future lessons.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Stay quiet and hope they lose interest.', 1: 'Look away; you do not want to get involved.', 2: 'Whisper to Sam to just ignore them.' },
            consequence: 'Silence in the face of bullying can feel like agreement to the target. The bullies face no resistance, and Sam continues to suffer alone.',
            rating: 'negative', score: 1
          }
        ]
      },
      {
        text: {
          0: 'At break time, the same group walks past and one of them says the name loudly enough for others to hear. A few people laugh. What do you do?',
          1: 'At break, you see the same group target Sam again in the corridor. Other students are watching. What do you do?',
          2: 'Sam tells you at break that this has been happening every day for weeks and they dread coming to school. What do you do?'
        },
        choices: [
          {
            text: { 0: 'Go to your head of year and explain that this has been happening repeatedly. Give names, dates, and details.', 1: 'Walk over to Sam and stand with them. Then find a teacher together and report what you have seen.', 2: 'Take Sam seriously. Say: "This is not okay and it needs to be reported." Offer to go with them to a teacher right now.' },
            consequence: 'Formal reporting with specific details enables the school to take this seriously as a pattern of bullying. The school can investigate and put protective measures in place.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Tell the group to grow up, but do not go to a teacher.', 1: 'Give Sam a sympathetic look and make a mental note to say something later.', 2: 'Comfort Sam and promise to help, but suggest waiting to see if it stops on its own.' },
            consequence: 'Good intentions without follow-through leave Sam in the same position. The bullying has been going on for weeks; waiting longer is unlikely to help.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Laugh it off and pretend it does not bother you.', 1: 'Walk the other way; it is between them and Sam.', 2: 'Tell Sam not to let it get to them and change the subject.' },
            consequence: 'Minimising or avoiding the issue compounds Sam\'s sense of helplessness. The message is that nobody will stand up for them, and the bullying is their burden to carry alone.',
            rating: 'negative', score: 1
          }
        ]
      },
      {
        text: {
          0: 'The school has addressed the situation. A teacher asks how you are feeling and what support you might need. What do you say?',
          1: 'A teacher thanks you for speaking up and asks if there is anything else you have noticed or think should happen. What do you say?',
          2: 'Sam\'s parents have been told and the school is taking action. Sam thanks you for helping but says they still feel anxious about coming to school. How do you respond?'
        },
        choices: [
          {
            text: { 0: 'Be honest about how it has affected you. Ask if you can talk to a counsellor and request a check-in plan.', 1: 'Share everything you have observed. Suggest that the school keep an eye on the situation to make sure it does not start again.', 2: 'Reassure Sam that it is normal to feel anxious, commit to walking with them between lessons, and suggest they talk to the school counsellor.' },
            consequence: 'Honest communication about feelings and ongoing support creates a safety net. Requesting follow-up ensures the bullying does not simply resume once attention fades.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Say you feel better now and just want to move on.', 1: 'Say you think the situation is sorted now and no further action is needed.', 2: 'Tell Sam things will get easier with time and not to worry.' },
            consequence: 'Wanting to move on is natural, but without ongoing support and monitoring, the emotional impact can linger and the behaviour may resume.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Say you are fine even though you are not, because you do not want more attention.', 1: 'Downplay what happened because you feel awkward about getting people in trouble.', 2: 'Distance yourself from Sam because the situation has become stressful for you too.' },
            consequence: 'Hiding your true feelings or pulling away leaves everyone without the support they need. Bullying affects bystanders and friends too, and getting help is important for everyone involved.',
            rating: 'negative', score: 1
          }
        ]
      }
    ],
    bestPath: [0, 0, 0],
    takeaways: [
      'Repeated name-calling is verbal bullying, never "just banter" if it is unwanted and hurtful.',
      'Speaking up in the moment sends a powerful message to both the bully and the target.',
      'Keep a record: who, what, when, where. This makes reporting more effective.',
      'It is important to ask for ongoing support, even after the immediate situation is resolved.',
      'Bullying can affect mental health long after it stops. There is no shame in asking for help.'
    ]
  },
  {
    id: 'physical', title: 'Physical Intimidation', icon: '\u26A0\uFE0F',
    type: 'Physical', colour: 'physical',
    desc: 'Someone is blocking a student\'s path and taking their bag.',
    intro: 'Over the past fortnight, a larger student called Ryan has been targeting a younger student called Priya at the end of the school day. Ryan stands in the corridor blocking Priya\'s route to the exit, takes her bag, and will not give it back until other students have left. Yesterday, Ryan tipped the contents of the bag onto the floor and walked away laughing. Other students see it happen but nobody intervenes.',
    roles: ['The Target (Priya)', 'A Bystander', 'Priya\'s Friend'],
    stages: [
      {
        text: {
          0: 'It is the end of the day. You see Ryan standing in the corridor ahead, clearly waiting for you. Your heart starts racing. What do you do?',
          1: 'You see Ryan step in front of Priya, blocking her path. Priya looks scared. Other students walk past without stopping. What do you do?',
          2: 'Priya grabs your arm and says "Ryan is there again. I cannot face it today." She looks close to tears. What do you do?'
        },
        choices: [
          {
            text: { 0: 'Turn around and go to the nearest teacher or the school office to report what has been happening.', 1: 'Go and stand next to Priya. Say clearly: "Leave her alone." Then find a teacher.', 2: 'Say: "We are going to a teacher right now." Walk with Priya to the nearest member of staff.' },
            consequence: 'Prioritising safety by involving an adult immediately is the right response to physical intimidation. You do not have to confront the situation alone.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Take a different route to avoid Ryan.', 1: 'Watch from a distance and plan to tell a teacher later.', 2: 'Take Priya a different way out of school to avoid Ryan.' },
            consequence: 'Avoiding the situation keeps you safe in the short term, but Ryan faces no consequences and will likely continue. The problem is delayed, not solved.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Walk towards Ryan and hope they leave you alone this time.', 1: 'Keep walking; it is not your problem and you do not want Ryan to target you too.', 2: 'Tell Priya to just hand over the bag quickly and it will be over faster.' },
            consequence: 'Walking into a physically intimidating situation without support is risky. Ignoring or accepting the behaviour allows it to escalate.',
            rating: 'negative', score: 1
          }
        ]
      },
      {
        text: {
          0: 'Ryan has taken your bag again and is holding it above your head while laughing. Other students are watching. What do you do?',
          1: 'Ryan has taken Priya\'s bag and is rifling through it. Priya is asking for it back but Ryan ignores her. What do you do?',
          2: 'You and Priya have just seen Ryan take another student\'s belongings. You know this is a pattern. What do you do?'
        },
        choices: [
          {
            text: { 0: 'Do not try to grab it back. Say loudly and clearly: "Give me my bag back. This is not okay." Then walk to a teacher.', 1: 'Approach calmly and say: "Give that back. I am going to get a teacher." Then go directly to a member of staff.', 2: 'Go immediately to the head of year and report the pattern of behaviour, including today and every previous incident you know about.' },
            consequence: 'Asserting yourself verbally without escalating physically, combined with getting adult help, is the safest and most effective approach.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Wait for Ryan to get bored and drop the bag.', 1: 'Shout at Ryan to stop from a safe distance.', 2: 'Comfort Priya but decide to wait until tomorrow to report it.' },
            consequence: 'Waiting or half-measures mean the intimidation continues. Without a formal report, the school cannot put protective measures in place.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Try to grab the bag back by force.', 1: 'Film it on your phone to post online.', 2: 'Tell Priya to fight back next time.' },
            consequence: 'Physical confrontation risks injury and could result in both students being disciplined. Filming without helping is exploitation, not support. Encouraging retaliation escalates danger.',
            rating: 'negative', score: 1
          }
        ]
      },
      {
        text: {
          0: 'The school has taken action against Ryan. A teacher asks if you feel safe now and what else might help. What do you say?',
          1: 'A teacher asks you to describe what you saw. They want to understand the full picture. What do you tell them?',
          2: 'Priya\'s parents have contacted the school. A teacher asks you and Priya what would help her feel safe. What do you suggest?'
        },
        choices: [
          {
            text: { 0: 'Explain honestly that you still feel anxious. Ask if a safe route or buddy system could be set up until you feel confident.', 1: 'Give a full, honest account of everything you witnessed, including dates and details. Offer to put it in writing.', 2: 'Suggest a buddy system so Priya is not alone at the end of the day. Ask for regular check-ins with a pastoral team member.' },
            consequence: 'Practical safety measures and ongoing monitoring help rebuild confidence. Honest, detailed witness accounts strengthen the school\'s ability to act.',
            rating: 'positive', score: 3
          },
          {
            text: { 0: 'Say you feel okay now and hope things stay that way.', 1: 'Give a brief account but leave out some details because you do not want to seem like a snitch.', 2: 'Say Priya seems better now and probably just needs time.' },
            consequence: 'An incomplete response may leave gaps in the school\'s understanding. Without safety measures, there is a risk of the behaviour resuming.',
            rating: 'neutral', score: 2
          },
          {
            text: { 0: 'Say everything is fine and you do not need anything.', 1: 'Say you did not really see much and cannot remember details.', 2: 'Suggest Priya just avoids that corridor from now on.' },
            consequence: 'Downplaying the situation or placing the burden of avoidance on the target is unfair. The person who needs to change their behaviour is the bully, not the target.',
            rating: 'negative', score: 1
          }
        ]
      }
    ],
    bestPath: [0, 0, 0],
    takeaways: [
      'Never confront physical intimidation alone. Your safety is the priority.',
      'Report physical bullying to an adult immediately; do not wait for it to escalate further.',
      'Bystanders who stand with the target and seek help can stop the situation quickly.',
      'Schools can put practical safety measures in place (buddy systems, safe routes, supervision).',
      'Filming bullying instead of helping is harmful and may be a disciplinary offence.'
    ]
  }
];

let state = {
  completed: {},
  currentScenario: null,
  currentRole: null,
  currentStage: 0,
  choices: [],
  showingResults: false
};

function loadState() {
  try {
    const saved = localStorage.getItem('bsn-state');
    if (saved) { const p = JSON.parse(saved); state.completed = p.completed || {}; }
  } catch (e) {}
}
function saveState() {
  try { localStorage.setItem('bsn-state', JSON.stringify({ completed: state.completed })); } catch (e) {}
}

function switchTab(tab) {
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
  document.querySelectorAll('.section').forEach(s => s.classList.toggle('active', s.id === 'sec-' + tab));
  if (tab === 'scenarios') renderScenarioList();
  if (tab === 'stats') renderStats();
}

document.getElementById('navTabs').addEventListener('click', e => {
  if (e.target.classList.contains('nav-tab')) switchTab(e.target.dataset.tab);
});

function renderScenarioList() {
  const list = document.getElementById('scenarioList');
  const play = document.getElementById('scenarioPlay');
  if (state.currentScenario !== null) { list.style.display = 'none'; play.style.display = 'block'; return; }
  list.style.display = ''; play.style.display = 'none';
  list.innerHTML = SCENARIOS.map(s => {
    const done = state.completed[s.id];
    return `<div class="scenario-card" onclick="startScenario('${s.id}')">
      <div class="icon">${s.icon}</div>
      <h4>${s.title}</h4>
      <p>${s.desc}</p>
      <span class="badge ${done ? 'completed' : 'not-done'}">${done ? 'Completed' : 'Not started'}</span>
    </div>`;
  }).join('');
}

function startScenario(id) {
  const sc = SCENARIOS.find(s => s.id === id);
  state.currentScenario = sc;
  state.currentRole = null;
  state.currentStage = 0;
  state.choices = [];
  state.showingResults = false;
  renderScenarioPlay();
}

function selectRole(idx) {
  state.currentRole = idx;
  state.currentStage = 0;
  state.choices = [];
  renderScenarioPlay();
}

function renderScenarioPlay() {
  const el = document.getElementById('scenarioPlay');
  const sc = state.currentScenario;
  if (!sc) return;
  el.style.display = 'block';
  document.getElementById('scenarioList').style.display = 'none';

  if (state.showingResults) { renderResults(el); return; }
  if (state.currentRole === null) {
    el.innerHTML = `<div class="card"><h2>${sc.icon} ${sc.title}</h2>
      <span style="display:inline-block;padding:2px 10px;border-radius:12px;font-size:0.75rem;font-weight:600;background:var(--bg-secondary);color:var(--text-muted);margin-bottom:10px;">${sc.type}</span>
      <div class="story-text">${sc.intro}</div>
      <h3>Choose your role</h3>
      <p style="font-size:0.88rem;color:var(--text-secondary);">Each role gives a different perspective on the situation.</p>
      <div class="role-selector">${sc.roles.map((r, i) =>
        `<button class="role-btn" onclick="selectRole(${i})">${r}</button>`
      ).join('')}</div>
      <div class="btn-group"><button class="btn btn-secondary" onclick="exitScenario()">Back to Scenarios</button></div>
    </div>`;
    return;
  }

  const stage = sc.stages[state.currentStage];
  const stageText = stage.text[state.currentRole];
  const progress = ((state.currentStage) / sc.stages.length) * 100;
  const lastChoice = state.choices.length > state.currentStage ? state.choices[state.currentStage] : null;

  let html = `<div class="card">
    <h2>${sc.icon} ${sc.title}</h2>
    <span style="display:inline-block;padding:2px 10px;border-radius:12px;font-size:0.75rem;font-weight:600;background:var(--bg-secondary);color:var(--text-muted);margin-bottom:10px;">Role: ${sc.roles[state.currentRole]}</span>
    <div class="step-indicator">Decision ${state.currentStage + 1} of ${sc.stages.length}</div>
    <div class="progress-bar-track"><div class="progress-bar-fill" style="width:${progress}%"></div></div>
    <div class="story-text">${stageText}</div>`;

  if (lastChoice === null) {
    html += `<h3>What do you do?</h3><div class="choices">`;
    stage.choices.forEach((c, i) => {
      html += `<button class="choice-btn" onclick="makeChoice(${i})">${c.text[state.currentRole]}</button>`;
    });
    html += `</div>`;
  } else {
    const chosen = stage.choices[lastChoice];
    html += `<p style="font-size:0.88rem;"><strong>Your choice:</strong> ${chosen.text[state.currentRole]}</p>`;
    html += `<div class="consequence ${chosen.rating}"><div class="label">${chosen.rating === 'positive' ? 'Positive outcome' : chosen.rating === 'neutral' ? 'Mixed outcome' : 'Negative outcome'}</div>${chosen.consequence}</div>`;
    if (state.currentStage < sc.stages.length - 1) {
      html += `<div class="btn-group"><button class="btn btn-primary" onclick="nextStage()">Continue</button></div>`;
    } else {
      html += `<div class="btn-group"><button class="btn btn-primary" onclick="showResults()">See Your Results</button></div>`;
    }
  }
  html += `<div class="btn-group" style="margin-top:8px;"><button class="btn btn-secondary" onclick="exitScenario()">Exit Scenario</button></div></div>`;
  el.innerHTML = html;
}

function makeChoice(idx) {
  state.choices[state.currentStage] = idx;
  renderScenarioPlay();
}

function nextStage() {
  state.currentStage++;
  renderScenarioPlay();
}

function showResults() {
  const sc = state.currentScenario;
  const totalScore = state.choices.reduce((sum, ci, si) => sum + sc.stages[si].choices[ci].score, 0);
  const maxScore = sc.stages.length * 3;
  const pct = Math.round((totalScore / maxScore) * 100);
  state.completed[sc.id] = { role: state.currentRole, choices: [...state.choices], score: totalScore, max: maxScore, pct };
  saveState();
  state.showingResults = true;
  renderScenarioPlay();
}

function renderResults(el) {
  const sc = state.currentScenario;
  const data = state.completed[sc.id];
  const overall = data.pct >= 78 ? 'positive' : data.pct >= 45 ? 'neutral' : 'negative';
  const overallLabel = overall === 'positive' ? 'Good Outcome' : overall === 'neutral' ? 'Mixed Outcome' : 'Poor Outcome';

  let html = `<div class="outcome-banner ${overall}">
    <h3>${overallLabel}</h3>
    <p style="margin:6px 0 0;font-size:0.9rem;">You scored ${data.score} out of ${data.max} (${data.pct}%)</p>
    <p style="margin:4px 0 0;font-size:0.82rem;color:var(--text-secondary);">Role: ${sc.roles[data.role]}</p>
  </div>`;

  html += `<div class="card"><h3>Your Choices and Their Impact</h3>`;
  data.choices.forEach((ci, si) => {
    const stage = sc.stages[si];
    const chosen = stage.choices[ci];
    html += `<div class="review-item consequence ${chosen.rating}">
      <div class="step-label">Decision ${si + 1}</div>
      <p style="margin:4px 0;"><strong>${chosen.text[data.role]}</strong></p>
      <p style="margin:0;font-size:0.82rem;">${chosen.consequence}</p>
    </div>`;
  });
  html += `</div>`;

  html += `<div class="card"><h3>Best Responses</h3><p style="font-size:0.88rem;color:var(--text-secondary);margin-bottom:12px;">Here is the strongest response at each decision point, with an explanation of why it works.</p>`;
  sc.bestPath.forEach((bi, si) => {
    const best = sc.stages[si].choices[bi];
    html += `<div class="best-response">
      <h4>Decision ${si + 1}: Best Response</h4>
      <p><strong>${best.text[data.role]}</strong></p>
      <p style="margin-top:6px;">${best.consequence}</p>
    </div>`;
  });
  html += `</div>`;

  html += `<div class="card"><h3>Key Takeaways</h3><ul class="takeaway-list">`;
  sc.takeaways.forEach(t => { html += `<li>${t}</li>`; });
  html += `</ul></div>`;

  html += `<div class="btn-group">
    <button class="btn btn-primary" onclick="restartScenario()">Try Again (Different Role)</button>
    <button class="btn btn-secondary" onclick="exitScenario()">Back to Scenarios</button>
  </div>`;
  el.innerHTML = html;
}

function restartScenario() {
  state.currentRole = null;
  state.currentStage = 0;
  state.choices = [];
  state.showingResults = false;
  renderScenarioPlay();
}

function exitScenario() {
  state.currentScenario = null;
  state.currentRole = null;
  state.currentStage = 0;
  state.choices = [];
  state.showingResults = false;
  renderScenarioList();
}

function renderStats() {
  const grid = document.getElementById('statsGrid');
  const detail = document.getElementById('statsDetail');
  const completedCount = Object.keys(state.completed).length;
  const totalScenarios = SCENARIOS.length;
  const scores = Object.values(state.completed).map(c => c.pct);
  const avgScore = scores.length ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length) : 0;
  const greenCount = scores.filter(s => s >= 78).length;
  const amberCount = scores.filter(s => s >= 45 && s < 78).length;
  const redCount = scores.filter(s => s < 45).length;

  grid.innerHTML = `
    <div class="stat-card"><div class="stat-value">${completedCount}/${totalScenarios}</div><div class="stat-label">Scenarios Completed</div></div>
    <div class="stat-card"><div class="stat-value">${avgScore}%</div><div class="stat-label">Average Score</div></div>
    <div class="stat-card"><div class="stat-value" style="color:var(--outcome-green)">${greenCount}</div><div class="stat-label">Good Outcomes</div></div>
    <div class="stat-card"><div class="stat-value" style="color:var(--outcome-amber)">${amberCount}</div><div class="stat-label">Mixed Outcomes</div></div>
    <div class="stat-card"><div class="stat-value" style="color:var(--outcome-red)">${redCount}</div><div class="stat-label">Poor Outcomes</div></div>
  `;

  if (completedCount === 0) {
    detail.innerHTML = `<h3>No Scenarios Completed Yet</h3><p>Complete scenarios to see your detailed results here.</p>`;
    return;
  }

  let dHtml = `<h3>Scenario Results</h3>`;
  SCENARIOS.forEach(sc => {
    const d = state.completed[sc.id];
    if (!d) { dHtml += `<p style="font-size:0.88rem;color:var(--text-muted);padding:6px 0;border-bottom:1px solid var(--card-border);">${sc.icon} ${sc.title}: Not attempted</p>`; return; }
    const rating = d.pct >= 78 ? 'positive' : d.pct >= 45 ? 'neutral' : 'negative';
    const colour = rating === 'positive' ? 'var(--outcome-green)' : rating === 'neutral' ? 'var(--outcome-amber)' : 'var(--outcome-red)';
    dHtml += `<div style="padding:8px 0;border-bottom:1px solid var(--card-border);font-size:0.88rem;">
      <strong>${sc.icon} ${sc.title}</strong> (${sc.roles[d.role]})<br>
      <span style="color:${colour};font-weight:600;">${d.pct}%</span> (${d.score}/${d.max})
    </div>`;
  });
  dHtml += `<div class="btn-group"><button class="btn btn-secondary" onclick="if(confirm('Reset all progress?')){state.completed={};saveState();renderStats();}">Reset Progress</button></div>`;
  detail.innerHTML = dHtml;
}

loadState();
renderScenarioList();
</script>
</body>
</html>
